/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var bn=Object.defineProperty;var Ui=Object.getOwnPropertyDescriptor;var $i=Object.getOwnPropertyNames;var ji=Object.prototype.hasOwnProperty;var Gi=(t,e,n)=>e in t?bn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Ki=(t,e)=>{for(var n in e)bn(t,n,{get:e[n],enumerable:!0})},Xi=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of $i(e))!ji.call(t,o)&&o!==n&&bn(t,o,{get:()=>e[o],enumerable:!(r=Ui(e,o))||r.enumerable});return t};var Yi=t=>Xi(bn({},"__esModule",{value:!0}),t);var Oe=(t,e,n)=>(Gi(t,typeof e!="symbol"?e+"":e,n),n);var pc={};Ki(pc,{DEFAULT_SETTINGS:()=>Ur,default:()=>$n});module.exports=Yi(pc);var mn=require("obsidian");var ro=require("obsidian");var We=[];for(let t=0;t<256;++t)We.push((t+256).toString(16).slice(1));function Kr(t,e=0){return(We[t[e+0]]+We[t[e+1]]+We[t[e+2]]+We[t[e+3]]+"-"+We[t[e+4]]+We[t[e+5]]+"-"+We[t[e+6]]+We[t[e+7]]+"-"+We[t[e+8]]+We[t[e+9]]+"-"+We[t[e+10]]+We[t[e+11]]+We[t[e+12]]+We[t[e+13]]+We[t[e+14]]+We[t[e+15]]).toLowerCase()}var Xn,Ji=new Uint8Array(16);function Yn(){if(!Xn){if(typeof crypto=="undefined"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Xn=crypto.getRandomValues.bind(crypto)}return Xn(Ji)}var Zi=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Jn={randomUUID:Zi};function Qi(t,e,n){var o,i,s;if(Jn.randomUUID&&!e&&!t)return Jn.randomUUID();t=t||{};let r=(s=(i=t.random)!=null?i:(o=t.rng)==null?void 0:o.call(t))!=null?s:Yn();if(r.length<16)throw new Error("Random bytes length must be >= 16");if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){if(n=n||0,n<0||n+16>e.length)throw new RangeError(`UUID byte range ${n}:${n+15} is out of buffer bounds`);for(let a=0;a<16;++a)e[n+a]=r[a];return e}return Kr(r)}var Gt=Qi;var Tt=class{constructor(){this.cache=new Map;this.maxCacheSize=50}static getInstance(){return Tt.instance||(Tt.instance=new Tt),Tt.instance}getCachedTree(e,n){let r=this.cache.get(e);if(!r)return null;let o=this.hashContent(n);return r.contentHash===o?(r.timestamp=Date.now(),this.cloneTree(r.tree)):null}cacheTree(e,n,r){this.evictOldEntries();let o=this.hashContent(n),i=this.generateLineHashes(n),s=this.buildHeaderMap(r);this.cache.set(e,{content:n,contentHash:o,tree:this.cloneTree(r),lineHashes:i,headerMap:s,timestamp:Date.now()})}updateTreeIncremental(e,n,r,o){let i=this.cache.get(e);if(!i||i.content!==n){let c=o(r);return this.cacheTree(e,r,c),c}let s=this.hashContent(n),a=this.hashContent(r);if(s===a)return this.cloneTree(i.tree);let l=o(r);return this.cacheTree(e,r,l),l}detectChanges(e,n){let r=e.split(`
`),o=n.split(`
`),i=r.map(d=>this.hashLine(d)),s=o.map(d=>this.hashLine(d)),a=[],l=0,c=0;for(;l<i.length||c<s.length;)if(l>=i.length){let d=c;for(;c<s.length;)c++;a.push({startLine:d,endLine:c-1,type:"added"})}else if(c>=s.length){a.push({startLine:l,endLine:i.length-1,type:"removed"});break}else if(i[l]===s[c])l++,c++;else{let d=c,u=c;for(;c<s.length&&l<i.length&&i[l]!==s[c];)l++,c++,u=c;a.push({startLine:d,endLine:u-1,type:"modified"})}return this.mergeAdjacentChanges(a)}performIncrementalUpdate(e,n,r,o,i,s){let a=s(o);return this.preserveNodeIds(e,a,n)}preserveNodeIds(e,n,r){let o=i=>i.map(s=>{let a=this.getHeaderKey(s),l=r.get(a);return l&&(s.id=l.id),s.children&&s.children.length>0&&(s.children=o(s.children)),s});return o(n)}shouldFullReparse(e,n){if(!n||e.length===0)return!1;let r=n.split(`
`).length;return r===0?!0:e.reduce((i,s)=>i+Math.max(0,s.endLine-s.startLine+1),0)/r>.3||e.length>10}mergeAdjacentChanges(e){if(e.length<=1)return e;let n=[],r=e[0];for(let o=1;o<e.length;o++){let i=e[o];i.startLine<=r.endLine+2?r={startLine:r.startLine,endLine:Math.max(r.endLine,i.endLine),type:"modified"}:(n.push(r),r=i)}return n.push(r),n}buildHeaderMap(e){let n=new Map,r=o=>{o.forEach(i=>{let s=this.getHeaderKey(i);n.set(s,i),i.children&&r(i.children)})};return r(e),n}getHeaderKey(e){return`${e.level}:${e.header}`}generateLineHashes(e){return e.split(`
`).map(n=>this.hashLine(n))}hashContent(e){if(!e)return"0";let n=2166136261;for(let r=0;r<e.length;r++)n^=e.charCodeAt(r),n=n*16777619>>>0;return n.toString(36)}hashLine(e){if(!e)return"0";if(e.length<32)return e.length+e.slice(0,Math.min(8,e.length))+e.slice(Math.max(0,e.length-4));let n=2166136261;for(let r=0;r<e.length;r++)n^=e.charCodeAt(r),n=n*16777619>>>0;return n.toString(36)}cloneTree(e){var r;if(!e||e.length===0)return[];let n=new Array(e.length);for(let o=0;o<e.length;o++){let i=e[o];n[o]={id:i.id,header:i.header,content:i.content,level:i.level,startLine:i.startLine,endLine:i.endLine,startChar:i.startChar,endChar:i.endChar,children:(r=i.children)!=null&&r.length?this.cloneTree(i.children):[]}}return n}evictOldEntries(){if(this.cache.size<this.maxCacheSize)return;let e=Array.from(this.cache.entries()).sort(([,r],[,o])=>r.timestamp-o.timestamp);e.slice(0,e.length-this.maxCacheSize+1).forEach(([r,o])=>{o.headerMap.clear(),o.tree=[],o.lineHashes=[],this.cache.delete(r)})}clearCache(e){if(e){let n=this.cache.get(e);n&&(n.headerMap.clear(),n.tree=[],n.lineHashes=[],this.cache.delete(e))}else this.cache.forEach(n=>{n.headerMap.clear(),n.tree=[],n.lineHashes=[]}),this.cache.clear()}getCacheStats(){return{size:this.cache.size,maxSize:this.maxCacheSize,hitRate:0}}},xt=Tt;xt.codeBlockRegex=/^```/,xt.headerRegex=/^(#{1,6})\s+/;function yn(t){let e=t.split(`
`),n=[],r=[],o=0,i=!1,s=/^(#{1,6})\s+(.*)$/,a=/^```/,l=new Map,c=-1,d=!1;for(let h=0;h<e.length;h++){let p=e[h];if(a.test(p.trim())&&(d=!d),!d&&s.test(p)){c=h;break}}if(c===-1)return[{id:Gt(),header:"Document",content:t,level:1,children:[],startLine:1,endLine:e.length,startChar:0,endChar:t.length}];if(c>0){let h=e.slice(0,c),p=h.join(`
`);if(p.trim()){let m={id:Gt(),header:"Document Header",content:p+`
`,level:1,children:[],startLine:1,endLine:c,startChar:0,endChar:h.join(`
`).length+1};n.push(m),r.push(m),o=m.endChar}}e.forEach((h,p)=>{var g;if(c>0&&p<c){o+=h.length+1;return}a.test(h.trim())&&(i=!i);let m=i?null:h.match(s);if(m){let v=m[1].length,b=m[2],_=Gt(),y={id:_,header:b,content:"",level:v,children:[],startLine:p+1,endLine:p+1,startChar:o,endChar:o+h.length+1};l.set(_,[]);let x=0;for(let M=r.length-1;M>=0&&r[M].level>=v;M--)x++;x>0&&r.splice(-x),r.length===0?n.push(y):r[r.length-1].children.push(y),r.push(y)}else if(r.length>0){let v=r[r.length-1];(g=l.get(v.id))==null||g.push(h+`
`),v.endLine=p+1,v.endChar=o+h.length+1}o+=h.length+1});for(let h=0;h<r.length;h++){let p=r[h];p.endLine<e.length&&(p.endLine=e.length,p.endChar=o)}let u=[...n],f=[...n];for(;f.length>0;){let h=f.pop();f.push(...h.children),u.push(...h.children)}return u.forEach(h=>{let p=l.get(h.id);p&&(h.content=p.join(""))}),n}function Kt(t,e){let n=t.split(/\r?\n/);if(e<1||e>n.length)throw new Error("currentLineNumber \u8D85\u51FA\u6587\u672C\u884C\u6570\u8303\u56F4");let o=n[e-1].trim().match(/^(#{1,6})\s+/);if(!o)throw new Error("\u6307\u5B9A\u884C\u4E0D\u662F\u4E00\u4E2A\u6709\u6548\u7684 Markdown \u6807\u9898");let i=o[1].length,s=!1;for(let a=0;a<e-1;a++)/^\s*```/.test(n[a])&&(s=!s);for(let a=e;a<n.length;a++){let l=n[a];if(/^\s*```/.test(l)){s=!s;continue}if(!s){let c=l.trim().match(/^(#{1,6})\s+/);if(c&&c[1].length<=i)return a+1}}return n.length+1}function Xr(t,e){let n=t.split(/\r?\n/),r=e-1,o=!1;for(let i=0;i<e;i++)/^\s*```/.test(n[i])&&(o=!o);for(;r>0;){let i=n[r];if(/^\s*```/.test(i)&&(o=!o),!o&&i.match(/^(#{1,6})\s+/))return r;r--}return null}function Yr(t,e){let n=t.split(/\r?\n/),r=e,o=!1;for(let i=0;i<e&&i<n.length;i++)/^\s*```/.test(n[i])&&(o=!o);for(;r<n.length;){let i=n[r];if(/^\s*```/.test(i)&&(o=!o),!o&&i.match(/^(#{1,6})\s+/))return r;r++}return null}function dt(t,e,n){if(typeof t!="string")return console.warn("md2treeWithCache: markdown must be a string"),[];let r=xt.getInstance();if(!e||e.trim()==="")return yn(t);try{let o=r.getCachedTree(e,t);if(o)return o;if(n&&typeof n=="string"&&n!==t)return r.updateTreeIncremental(e,n,t,yn);let i=yn(t);return r.cacheTree(e,t,i),i}catch(o){return console.error("md2treeWithCache\u51FA\u9519:",o),yn(t)}}function Jr(t){xt.getInstance().clearCache(t)}function Zr(t,e,n){let r=t.split(/\r?\n/),o=!1;for(let i=0;i<e-1;i++)/^\s*```/.test(r[i])&&(o=!o);for(let i=e;i<r.length;i++){let s=r[i];if(/^\s*```/.test(s)){o=!o;continue}if(!o){let a=s.trim().match(/^(#{1,6})\s+/);if(a&&a[1].length<=n)return i+1}}return r.length+1}function Qr(t,e){let n=t.split(/\r?\n/),r=!1;for(let o=0;o<e-1;o++)/^\s*```/.test(n[o])&&(r=!r);for(let o=e;o<n.length;o++){let i=n[o];if(/^\s*```/.test(i)){r=!r;continue}if(!r&&i.trim().match(/^(#{1,6})\s+/))return o+1}for(let o=n.length-1;o>=e;o--)if(n[o].trim()!=="")return o+2;return e+1}function eo(t,e,n,r="\u65B0\u5EFA\u6807\u9898"){if(n<1||n>6)throw new Error(`Invalid header level: ${n}. Must be between 1 and 6.`);let o=t.split(/\r?\n/),s=`${"#".repeat(n)} ${r}`,a=Math.max(0,Math.min(e-1,o.length));return o.splice(a,0,s,""),o.join(`
`)}function to(t){let e=[];function n(r){for(let o of r)e.push({line:o.startLine,level:o.level,header:o.header}),o.children&&o.children.length>0&&n(o.children)}return n(t),e}function Zn(t,e,n){for(let r=t.length-1;r>=0;r--)if(t[r].line<e&&t[r].level===n)return t[r].line;return null}function Qn(t,e,n){for(let r=0;r<t.length;r++)if(t[r].line>e&&t[r].level===n)return t[r].line;return null}function no(t,e,n){for(let r=t.length-1;r>=0;r--)if(t[r].line<e&&t[r].level<n)return t[r].line;return null}function er(t,e,n){let r=n+1;for(let o=0;o<t.length;o++)if(t[o].line>e){if(t[o].level<=n)break;if(t[o].level===r)return t[o].line}return null}var Ze="Grid-Note-Markdown-View",At=class extends ro.MarkdownView{getViewType(){return Ze}getIcon(){return"star"}constructor(e){super(e)}async onOpen(){this.headerEl.style.display="flex",this.onClickEditor(),this.actionsEl.empty()}onScrollToSelectedRange(e){let n=e-1,r=Yr(this.editor.getValue(),e);this.editor.setSelection({line:n,ch:0},{line:r?r-1:n,ch:0}),this.editor.focus()}onClickEditor(){this.editor.cm.dom.addEventListener("click",this.handleClick.bind(this))}handleClick(e){let n=e.target;if(n instanceof HTMLAnchorElement){let r=n.innerText,{basename:o,path:i}=this.file;if(!r.startsWith(o)){let s=n.parentNode;s&&s.classList.contains("cm-link")||this.app.workspace.openLinkText(r,i,!0)}}else this.handleScrollToLine()}handleScrollToLine(){let e=this.editor.getCursor(),n=Xr(this.editor.getValue(),e.line+1),r=n?n+1:e.line+1;this.syncScrollToGridNoteView(r)}syncScrollToGridNoteView(e){var n,r,o,i;try{let s=this.app.workspace.getActiveViewOfType(At);if(!s||s.leaf!==this.leaf)return;let l=this.app.workspace.getLeavesOfType("markdown").find(c=>{var u,f;let d=c.view;return d&&((u=d.file)==null?void 0:u.path)===((f=this.file)==null?void 0:f.path)&&c!==this.leaf});if(l){let c=l.view,d=(n=c.contentEl)==null?void 0:n.querySelector(".gridnote-container");if(d){if(this.app.workspace.setActiveLeaf(l),this.isLineVisibleInGridNoteView(c,e))return;try{let u=null;if(c.instance&&c.instance.currentLines&&(u=c.instance),!u){let f=(i=(o=(r=this.app.plugins)==null?void 0:r.plugins)==null?void 0:o["gird-note"])==null?void 0:i.viewToggleManager;if(f&&f.viewStates){let h=f.viewStates.get(l);h&&h.instance&&h.instance.currentLines&&(u=h.instance)}}if(!u){let f=d.querySelectorAll("*");for(let h of f)if(h.__svelte__&&h.__svelte__.ctx){let p=h.__svelte__.ctx;if(p&&p.length>0){for(let m=0;m<p.length;m++)if(p[m]&&typeof p[m]=="object"&&p[m].currentLines){u=p[m];break}}if(u)break}}u&&u.currentLines?(u.currentLines.set(-1),setTimeout(()=>{u.currentLines.set(e)},50)):c.scrollToLine&&c.scrollToLine(e-1)}catch(u){console.error("Error accessing Svelte instance:",u)}}}}catch(s){console.error("Error syncing scroll to GridNote view:",s)}}isLineVisibleInGridNoteView(e,n){try{if(!e.instance||!e.contentEl)return!1;let r=e.contentEl.querySelector(".gridnote-container");if(!r)return!1;let o=r.querySelector(`[data-line="${n}"]`)||r.querySelector(`[data-start-line="${n}"]`);if(!o)return!1;let i=r.getBoundingClientRect(),s=o.getBoundingClientRect();return s.top<i.bottom&&s.bottom>i.top}catch(r){return!1}}onSimulateClickFoldBtn(e,n){return this.editor.scrollIntoView({from:{line:n,ch:0},to:{line:n,ch:0}},!0),new Promise(r=>{let i=this.editor.cm.domAtPos(e),s=i.node instanceof Element?i.node:i.node.parentElement;if(!s)return r(!1);let a=s.querySelector(".cm-fold-indicator");if(a){let l=new MouseEvent("click",{bubbles:!1,cancelable:!0,view:window,button:0});a.dispatchEvent(l),r(!0)}else r(!1)})}async onClose(){this.editor.cm.dom.removeEventListener("click",this.handleClick)}};var pn=require("obsidian");function ae(){}var gt=t=>t;function tr(t){return t()}function wn(){return Object.create(null)}function be(t){t.forEach(tr)}function Ue(t){return typeof t=="function"}function Ee(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function oo(t){return Object.keys(t).length===0}function ut(t,...e){if(t==null){for(let r of e)r(void 0);return ae}let n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function Xt(t){let e;return ut(t,n=>e=n)(),e}function ft(t,e,n){t.$$.on_destroy.push(ut(e,n))}function io(t){return t&&Ue(t.destroy)?t.destroy:ae}function nr(t){let e=typeof t=="string"&&t.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return e?[parseFloat(e[1]),e[2]||"px"]:[t,"px"]}var so=typeof window!="undefined",Yt=so?()=>window.performance.now():()=>Date.now(),Jt=so?t=>requestAnimationFrame(t):ae;var Nt=new Set;function ao(t){Nt.forEach(e=>{e.c(t)||(Nt.delete(e),e.f())}),Nt.size!==0&&Jt(ao)}function Zt(t){let e;return Nt.size===0&&Jt(ao),{promise:new Promise(n=>{Nt.add(e={c:t,f:n})}),abort(){Nt.delete(e)}}}var rr=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:global;var Ft=class{constructor(e){Oe(this,"_listeners","WeakMap"in rr?new WeakMap:void 0);Oe(this,"_observer");Oe(this,"options");this.options=e}observe(e,n){return this._listeners.set(e,n),this._getObserver().observe(e,this.options),()=>{this._listeners.delete(e),this._observer.unobserve(e)}}_getObserver(){var e;return(e=this._observer)!=null?e:this._observer=new ResizeObserver(n=>{var r;for(let o of n)Ft.entries.set(o.target,o),(r=this._listeners.get(o.target))==null||r(o)})}};Ft.entries="WeakMap"in rr?new WeakMap:void 0;var lo=!1;function co(){lo=!0}function uo(){lo=!1}function A(t,e){t.appendChild(e)}function Ie(t,e,n){let r=xn(t);if(!r.getElementById(e)){let o=F("style");o.id=e,o.textContent=n,ho(r,o)}}function xn(t){if(!t)return document;let e=t.getRootNode?t.getRootNode():t.ownerDocument;return e&&e.host?e:t.ownerDocument}function fo(t){let e=F("style");return e.textContent="/* empty */",ho(xn(t),e),e.sheet}function ho(t,e){return A(t.head||t,e),e.sheet}function $(t,e,n){t.insertBefore(e,n||null)}function q(t){t.parentNode&&t.parentNode.removeChild(t)}function kt(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function F(t){return document.createElement(t)}function Qe(t){return document.createTextNode(t)}function X(){return Qe(" ")}function _t(){return Qe("")}function le(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function or(t){return function(e){return e.preventDefault(),t.call(this,e)}}function Qt(t){return function(e){return e.stopPropagation(),t.call(this,e)}}function w(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function po(t){return Array.from(t.childNodes)}function St(t,e){e=""+e,t.data!==e&&(t.data=e)}function mo(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function ir(t,e){t.value=e==null?"":e}function we(t,e,n,r){n==null?t.style.removeProperty(e):t.style.setProperty(e,n,r?"important":"")}function Z(t,e,n){t.classList.toggle(e,!!n)}function en(t,e,{bubbles:n=!1,cancelable:r=!1}={}){return new CustomEvent(t,{detail:e,bubbles:n,cancelable:r})}function go(t){let e={};return t.childNodes.forEach(n=>{e[n.slot||"default"]=!0}),e}var kn=new Map,_n=0;function ts(t){let e=5381,n=t.length;for(;n--;)e=(e<<5)-e^t.charCodeAt(n);return e>>>0}function ns(t,e){let n={stylesheet:fo(e),rules:{}};return kn.set(t,n),n}function Dt(t,e,n,r,o,i,s,a=0){let l=16.666/r,c=`{
`;for(let g=0;g<=1;g+=l){let v=e+(n-e)*i(g);c+=g*100+`%{${s(v,1-v)}}
`}let d=c+`100% {${s(n,1-n)}}
}`,u=`__svelte_${ts(d)}_${a}`,f=xn(t),{stylesheet:h,rules:p}=kn.get(f)||ns(f,t);p[u]||(p[u]=!0,h.insertRule(`@keyframes ${u} ${d}`,h.cssRules.length));let m=t.style.animation||"";return t.style.animation=`${m?`${m}, `:""}${u} ${r}ms linear ${o}ms 1 both`,_n+=1,u}function Rt(t,e){let n=(t.style.animation||"").split(", "),r=n.filter(e?i=>i.indexOf(e)<0:i=>i.indexOf("__svelte")===-1),o=n.length-r.length;o&&(t.style.animation=r.join(", "),_n-=o,_n||rs())}function rs(){Jt(()=>{_n||(kn.forEach(t=>{let{ownerNode:e}=t.stylesheet;e&&q(e)}),kn.clear())})}var vt;function ht(t){vt=t}function Ht(){if(!vt)throw new Error("Function called outside component initialization");return vt}function $e(t){Ht().$$.on_mount.push(t)}function tt(t){Ht().$$.on_destroy.push(t)}function tn(){let t=Ht();return(e,n,{cancelable:r=!1}={})=>{let o=t.$$.callbacks[e];if(o){let i=en(e,n,{cancelable:r});return o.slice().forEach(s=>{s.call(t,i)}),!i.defaultPrevented}return!0}}function bt(t,e){return Ht().$$.context.set(t,e),e}function ot(t){return Ht().$$.context.get(t)}var Ct=[];var pe=[],Ot=[],ar=[],vo=Promise.resolve(),lr=!1;function cr(){lr||(lr=!0,vo.then(Sn))}function nt(){return cr(),vo}function je(t){Ot.push(t)}function bo(t){ar.push(t)}var sr=new Set,Vt=0;function Sn(){if(Vt!==0)return;let t=vt;do{try{for(;Vt<Ct.length;){let e=Ct[Vt];Vt++,ht(e),os(e.$$)}}catch(e){throw Ct.length=0,Vt=0,e}for(ht(null),Ct.length=0,Vt=0;pe.length;)pe.pop()();for(let e=0;e<Ot.length;e+=1){let n=Ot[e];sr.has(n)||(sr.add(n),n())}Ot.length=0}while(Ct.length);for(;ar.length;)ar.pop()();lr=!1,sr.clear(),ht(t)}function os(t){if(t.fragment!==null){t.update(),be(t.before_update);let e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(je)}}function yo(t){let e=[],n=[];Ot.forEach(r=>t.indexOf(r)===-1?e.push(r):n.push(r)),n.forEach(r=>r()),Ot=e}var nn;function dr(){return nn||(nn=Promise.resolve(),nn.then(()=>{nn=null})),nn}function Et(t,e,n){t.dispatchEvent(en(`${e?"intro":"outro"}${n}`))}var Cn=new Set,it;function Ne(){it={r:0,c:[],p:it}}function Fe(){it.r||be(it.c),it=it.p}function z(t,e){t&&t.i&&(Cn.delete(t),t.i(e))}function J(t,e,n,r){if(t&&t.o){if(Cn.has(t))return;Cn.add(t),it.c.push(()=>{Cn.delete(t),r&&(n&&t.d(1),r())}),t.o(e)}else r&&r()}var ur={duration:0};function fr(t,e,n){let r={direction:"in"},o=e(t,n,r),i=!1,s,a,l=0;function c(){s&&Rt(t,s)}function d(){let{delay:f=0,duration:h=300,easing:p=gt,tick:m=ae,css:g}=o||ur;g&&(s=Dt(t,0,1,h,f,p,g,l++)),m(0,1);let v=Yt()+f,b=v+h;a&&a.abort(),i=!0,je(()=>Et(t,!0,"start")),a=Zt(_=>{if(i){if(_>=b)return m(1,0),Et(t,!0,"end"),c(),i=!1;if(_>=v){let y=p((_-v)/h);m(y,1-y)}}return i})}let u=!1;return{start(){u||(u=!0,Rt(t),Ue(o)?(o=o(r),dr().then(d)):d())},invalidate(){u=!1},end(){i&&(c(),i=!1)}}}function hr(t,e,n){let r={direction:"out"},o=e(t,n,r),i=!0,s,a=it;a.r+=1;let l;function c(){let{delay:d=0,duration:u=300,easing:f=gt,tick:h=ae,css:p}=o||ur;p&&(s=Dt(t,1,0,u,d,f,p));let m=Yt()+d,g=m+u;je(()=>Et(t,!1,"start")),"inert"in t&&(l=t.inert,t.inert=!0),Zt(v=>{if(i){if(v>=g)return h(0,1),Et(t,!1,"end"),--a.r||be(a.c),!1;if(v>=m){let b=f((v-m)/u);h(1-b,b)}}return i})}return Ue(o)?dr().then(()=>{o=o(r),c()}):c(),{end(d){d&&"inert"in t&&(t.inert=l),d&&o.tick&&o.tick(1,0),i&&(s&&Rt(t,s),i=!1)}}}function st(t,e,n,r){let i=e(t,n,{direction:"both"}),s=r?0:1,a=null,l=null,c=null,d;function u(){c&&Rt(t,c)}function f(p,m){let g=p.b-s;return m*=Math.abs(g),{a:s,b:p.b,d:g,duration:m,start:p.start,end:p.start+m,group:p.group}}function h(p){let{delay:m=0,duration:g=300,easing:v=gt,tick:b=ae,css:_}=i||ur,y={start:Yt()+m,b:p};p||(y.group=it,it.r+=1),"inert"in t&&(p?d!==void 0&&(t.inert=d):(d=t.inert,t.inert=!0)),a||l?l=y:(_&&(u(),c=Dt(t,s,p,g,m,v,_)),p&&b(0,1),a=f(y,g),je(()=>Et(t,p,"start")),Zt(x=>{if(l&&x>l.start&&(a=f(l,g),l=null,Et(t,a.b,"start"),_&&(u(),c=Dt(t,s,a.b,a.duration,0,v,i.css))),a){if(x>=a.end)b(s=a.b,1-s),Et(t,a.b,"end"),l||(a.b?u():--a.group.r||be(a.group.c)),a=null;else if(x>=a.start){let M=x-a.start;s=a.a+a.d*v(M/a.duration),b(s,1-s)}}return!!(a||l)}))}return{run(p){Ue(i)?dr().then(()=>{i=i({direction:p?"in":"out"}),h(p)}):h(p)},end(){u(),a=l=null}}}function ze(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function wo(t,e){J(t,1,1,()=>{e.delete(t.key)})}function xo(t,e,n,r,o,i,s,a,l,c,d,u){let f=t.length,h=i.length,p=f,m={};for(;p--;)m[t[p].key]=p;let g=[],v=new Map,b=new Map,_=[];for(p=h;p--;){let I=u(o,i,p),L=n(I),W=s.get(L);W?r&&_.push(()=>W.p(I,e)):(W=c(L,I),W.c()),v.set(L,g[p]=W),L in m&&b.set(L,Math.abs(p-m[L]))}let y=new Set,x=new Set;function M(I){z(I,1),I.m(a,d),s.set(I.key,I),d=I.first,h--}for(;f&&h;){let I=g[h-1],L=t[f-1],W=I.key,Y=L.key;I===L?(d=I.first,f--,h--):v.has(Y)?!s.has(W)||y.has(W)?M(I):x.has(Y)?f--:b.get(W)>b.get(Y)?(x.add(W),M(I)):(y.add(Y),f--):(l(L,s),f--)}for(;f--;){let I=t[f];v.has(I.key)||l(I,s)}for(;h;)M(g[h-1]);return be(_),g}var is=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],ss=new Set([...is]);function ko(t,e,n){let r=t.$$.props[e];r!==void 0&&(t.$$.bound[r]=n,n(t.$$.ctx[r]))}function Ve(t){t&&t.c()}function De(t,e,n){let{fragment:r,after_update:o}=t.$$;r&&r.m(e,n),je(()=>{let i=t.$$.on_mount.map(tr).filter(Ue);t.$$.on_destroy?t.$$.on_destroy.push(...i):be(i),t.$$.on_mount=[]}),o.forEach(je)}function Re(t,e){let n=t.$$;n.fragment!==null&&(yo(n.after_update),be(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function ls(t,e){t.$$.dirty[0]===-1&&(Ct.push(t),cr(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Te(t,e,n,r,o,i,s=null,a=[-1]){let l=vt;ht(t);let c=t.$$={fragment:null,ctx:[],props:i,update:ae,not_equal:o,bound:wn(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:wn(),dirty:a,skip_bound:!1,root:e.target||l.$$.root};s&&s(c.root);let d=!1;if(c.ctx=n?n(t,e.props||{},(u,f,...h)=>{let p=h.length?h[0]:f;return c.ctx&&o(c.ctx[u],c.ctx[u]=p)&&(!c.skip_bound&&c.bound[u]&&c.bound[u](p),d&&ls(t,u)),f}):[],c.update(),d=!0,be(c.before_update),c.fragment=r?r(c.ctx):!1,e.target){if(e.hydrate){co();let u=po(e.target);c.fragment&&c.fragment.l(u),u.forEach(q)}else c.fragment&&c.fragment.c();e.intro&&z(t.$$.fragment),De(t,e.target,e.anchor),uo(),Sn()}ht(l)}var cs;typeof HTMLElement=="function"&&(cs=class extends HTMLElement{constructor(e,n,r){super();Oe(this,"$$ctor");Oe(this,"$$s");Oe(this,"$$c");Oe(this,"$$cn",!1);Oe(this,"$$d",{});Oe(this,"$$r",!1);Oe(this,"$$p_d",{});Oe(this,"$$l",{});Oe(this,"$$l_u",new Map);this.$$ctor=e,this.$$s=n,r&&this.attachShadow({mode:"open"})}addEventListener(e,n,r){if(this.$$l[e]=this.$$l[e]||[],this.$$l[e].push(n),this.$$c){let o=this.$$c.$on(e,n);this.$$l_u.set(n,o)}super.addEventListener(e,n,r)}removeEventListener(e,n,r){if(super.removeEventListener(e,n,r),this.$$c){let o=this.$$l_u.get(n);o&&(o(),this.$$l_u.delete(n))}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){let e=function(i){return()=>{let s;return{c:function(){s=F("slot"),i!=="default"&&w(s,"name",i)},m:function(c,d){$(c,s,d)},d:function(c){c&&q(s)}}}};if(await Promise.resolve(),!this.$$cn||this.$$c)return;let n={},r=go(this);for(let i of this.$$s)i in r&&(n[i]=[e(i)]);for(let i of this.attributes){let s=this.$$g_p(i.name);s in this.$$d||(this.$$d[s]=pr(s,i.value,this.$$p_d,"toProp"))}for(let i in this.$$p_d)!(i in this.$$d)&&this[i]!==void 0&&(this.$$d[i]=this[i],delete this[i]);this.$$c=new this.$$ctor({target:this.shadowRoot||this,props:{...this.$$d,$$slots:n,$$scope:{ctx:[]}}});let o=()=>{this.$$r=!0;for(let i in this.$$p_d)if(this.$$d[i]=this.$$c.$$.ctx[this.$$c.$$.props[i]],this.$$p_d[i].reflect){let s=pr(i,this.$$d[i],this.$$p_d,"toAttribute");s==null?this.removeAttribute(this.$$p_d[i].attribute||i):this.setAttribute(this.$$p_d[i].attribute||i,s)}this.$$r=!1};this.$$c.$$.after_update.push(o),o();for(let i in this.$$l)for(let s of this.$$l[i]){let a=this.$$c.$on(i,s);this.$$l_u.set(s,a)}this.$$l={}}}attributeChangedCallback(e,n,r){var o;this.$$r||(e=this.$$g_p(e),this.$$d[e]=pr(e,r,this.$$p_d,"toProp"),(o=this.$$c)==null||o.$set({[e]:this.$$d[e]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then(()=>{!this.$$cn&&this.$$c&&(this.$$c.$destroy(),this.$$c=void 0)})}$$g_p(e){return Object.keys(this.$$p_d).find(n=>this.$$p_d[n].attribute===e||!this.$$p_d[n].attribute&&n.toLowerCase()===e)||e}});function pr(t,e,n,r){var i;let o=(i=n[t])==null?void 0:i.type;if(e=o==="Boolean"&&typeof e!="boolean"?e!=null:e,!r||!n[t])return e;if(r==="toAttribute")switch(o){case"Object":case"Array":return e==null?null:JSON.stringify(e);case"Boolean":return e?"":null;case"Number":return e==null?null:e;default:return e}else switch(o){case"Object":case"Array":return e&&JSON.parse(e);case"Boolean":return e;case"Number":return e!=null?+e:e;default:return e}}var Ce=class{constructor(){Oe(this,"$$");Oe(this,"$$set")}$destroy(){Re(this,1),this.$destroy=ae}$on(e,n){if(!Ue(n))return ae;let r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{let o=r.indexOf(n);o!==-1&&r.splice(o,1)}}$set(e){this.$$set&&!oo(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}};var _o="4";typeof window!="undefined"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(_o);var Mn=require("obsidian");var Pt=[];function Pe(t,e=ae){let n,r=new Set;function o(a){if(Ee(t,a)&&(t=a,n)){let l=!Pt.length;for(let c of r)c[1](),Pt.push(c,t);if(l){for(let c=0;c<Pt.length;c+=2)Pt[c][0](Pt[c+1]);Pt.length=0}}}function i(a){o(a(t))}function s(a,l=ae){let c=[a,l];return r.add(c),r.size===1&&(n=e(o,i)||ae),a(t),()=>{r.delete(c),r.size===0&&n&&(n(),n=null)}}return{set:o,update:i,subscribe:s}}var ds=Pe({activeEditorId:null}),yt=class{constructor(){this.state=ds}static getInstance(){return yt.instance||(yt.instance=new yt),yt.instance}requestEdit(e){return this.state.update(n=>({...n,activeEditorId:e})),!0}exitEdit(e){this.state.update(n=>n.activeEditorId===e?{...n,activeEditorId:null}:n)}isEditing(e){let n={activeEditorId:null};return this.state.subscribe(o=>{n=o})(),n.activeEditorId===e}subscribe(e){return this.state.subscribe(e)}forceExitAll(){this.state.set({activeEditorId:null})}},pt=yt.getInstance();var So=require("obsidian"),rn=require("@codemirror/state"),Bt=class extends So.Component{constructor(n,r,o={}){super();this.widgetEditor=null;this.app=n,this.containerEl=r,this.options=o,this._value=o.value||"",this.initialize()}async initialize(){try{await this.createObsidianEditor()||this.createTextareaEditor()}catch(n){this.createTextareaEditor()}}async createObsidianEditor(){var n,r,o,i,s,a;try{let l=this.app;if(!((r=(n=l.embedRegistry)==null?void 0:n.embedByExtension)!=null&&r.md))return console.warn("embedRegistry not available"),!1;if(this.widgetEditor=l.embedRegistry.embedByExtension.md({app:this.app,containerEl:this.containerEl},null,this._value||""),!this.widgetEditor)return console.warn("Failed to create widget editor"),!1;if(this.widgetEditor.editable=!0,this.widgetEditor.showEditor&&this.widgetEditor.showEditor(),(o=this.widgetEditor.editMode)!=null&&o.editor){let c=this.widgetEditor.editMode.editor;if((i=c.cm)!=null&&i.dom?this.editorEl=c.cm.dom:this.editorEl=this.containerEl.querySelector(".cm-editor"),this._value&&c.setValue)c.setValue(this._value);else if(this._value&&c.cm)try{c.cm.dispatch({changes:{from:0,to:c.cm.state.doc.length,insert:this._value}})}catch(d){console.warn("Failed to set initial value:",d)}if(this.options.cursorLocation&&((s=c.cm)!=null&&s.dispatch))try{c.cm.dispatch({selection:rn.EditorSelection.range(this.options.cursorLocation.anchor,this.options.cursorLocation.head)})}catch(d){console.warn("Failed to set cursor:",d)}else if((a=c.cm)!=null&&a.dispatch)try{let d=c.cm.state.doc.length;c.cm.dispatch({selection:rn.EditorSelection.cursor(d)})}catch(d){console.warn("Failed to set cursor to end:",d)}return this.options.cls&&this.editorEl&&this.editorEl.classList.add(this.options.cls),this.setupObsidianEditorEvents(c),!0}return console.warn("Editor instance not available"),!1}catch(l){return console.warn("Failed to create Obsidian editor:",l),!1}}setupObsidianEditorEvents(n){if(!n.cm)return;let r=n.cm,o=r.contentDOM||r.dom;if(!o){console.warn("Content DOM not available");return}let i=()=>{setTimeout(()=>{var u,f;let d=this.value;d!==this._value&&(this._value=d,(f=(u=this.options).onChange)==null||f.call(u,d))},0)},s=d=>{var u,f,h,p,m,g;if(d.key==="Escape")(f=(u=this.options).onEscape)==null||f.call(u,this),d.preventDefault(),d.stopPropagation();else if(d.key==="Enter"){let v=d.ctrlKey||d.metaKey,b=d.shiftKey;(p=(h=this.options).onEnter)!=null&&p.call(h,this,v,b)&&d.preventDefault()}else d.key==="s"&&(d.ctrlKey||d.metaKey)&&((g=(m=this.options).onSave)==null||g.call(m,this),d.preventDefault())},a=()=>{var d,u;(u=(d=this.options).onBlur)==null||u.call(d,this)},l=d=>{var u,f;(f=(u=this.options).onPaste)==null||f.call(u,d,this)};o.addEventListener("keydown",s),o.addEventListener("blur",a),o.addEventListener("paste",l),o.addEventListener("input",i);let c=new MutationObserver(i);c.observe(o,{childList:!0,subtree:!0,characterData:!0}),this.register(()=>{c.disconnect(),o.removeEventListener("keydown",s),o.removeEventListener("blur",a),o.removeEventListener("paste",l),o.removeEventListener("input",i)})}createTextareaEditor(){this.editorEl=this.containerEl.createEl("textarea",{cls:this.options.cls||"embeddable-editor-textarea",attr:{placeholder:this.options.placeholder||"Edit markdown here...",value:this._value}});let n=this.editorEl;Object.assign(n.style,{width:"100%",minHeight:"120px",border:"1px solid var(--background-modifier-border)",borderRadius:"6px",outline:"none",resize:"vertical",fontFamily:"var(--font-text)",fontSize:"var(--font-text-size)",background:"var(--background-primary)",color:"var(--text-normal)",padding:"12px",lineHeight:"var(--line-height-normal)"}),n.addEventListener("input",()=>{var r,o;this._value=n.value,(o=(r=this.options).onChange)==null||o.call(r,this._value)}),n.addEventListener("keydown",r=>{var o,i,s,a,l,c,d,u;if(r.key==="Escape")(i=(o=this.options).onEscape)==null||i.call(o,this),r.preventDefault(),r.stopPropagation();else if(r.key==="Enter"&&(r.ctrlKey||r.metaKey))(a=(s=this.options).onEnter)!=null&&a.call(s,this,!0,r.shiftKey)&&r.preventDefault();else if(r.key==="s"&&(r.ctrlKey||r.metaKey))(c=(l=this.options).onSave)==null||c.call(l,this),r.preventDefault();else if(r.key==="Tab"){r.preventDefault();let f=n.selectionStart,h=n.selectionEnd;n.value=n.value.substring(0,f)+"	"+n.value.substring(h),n.selectionStart=n.selectionEnd=f+1,this._value=n.value,(u=(d=this.options).onChange)==null||u.call(d,this._value)}}),n.addEventListener("blur",()=>{var r,o;(o=(r=this.options).onBlur)==null||o.call(r,this)}),n.addEventListener("paste",r=>{var o,i;(i=(o=this.options).onPaste)==null||i.call(o,r,this)}),setTimeout(()=>{let r=n.value.length;n.selectionStart=n.selectionEnd=r},0)}get value(){var r,o,i,s;if((o=(r=this.widgetEditor)==null?void 0:r.editMode)!=null&&o.editor)try{let a=this.widgetEditor.editMode.editor;if(a.getValue&&typeof a.getValue=="function")return a.getValue();if((s=(i=a.cm)==null?void 0:i.state)!=null&&s.doc)return a.cm.state.doc.toString()}catch(a){console.warn("Error getting value from native editor:",a)}let n=this.editorEl;return(n==null?void 0:n.value)||this._value}setValue(n){var o,i;if(this._value=n,(i=(o=this.widgetEditor)==null?void 0:o.editMode)!=null&&i.editor)try{let s=this.widgetEditor.editMode.editor;s.setValue?s.setValue(n):s.cm&&s.cm.dispatch({changes:{from:0,to:s.cm.state.doc.length,insert:n}});return}catch(s){console.warn("Error setting value to native editor:",s)}let r=this.editorEl;r&&(r.value=n)}focus(){var n,r,o,i;if((o=(r=(n=this.widgetEditor)==null?void 0:n.editMode)==null?void 0:r.editor)!=null&&o.cm)try{this.widgetEditor.editMode.editor.cm.focus();return}catch(s){console.warn("Error focusing native editor:",s)}(i=this.editorEl)==null||i.focus()}getCursor(){var r,o,i;if((i=(o=(r=this.widgetEditor)==null?void 0:r.editMode)==null?void 0:o.editor)!=null&&i.cm)try{return this.widgetEditor.editMode.editor.cm.state.selection.main.head}catch(s){console.warn("Error getting cursor from native editor:",s)}let n=this.editorEl;return(n==null?void 0:n.selectionStart)||0}setCursor(n){var o,i,s;if((s=(i=(o=this.widgetEditor)==null?void 0:o.editMode)==null?void 0:i.editor)!=null&&s.cm)try{this.widgetEditor.editMode.editor.cm.dispatch({selection:rn.EditorSelection.cursor(n)});return}catch(a){console.warn("Error setting cursor in native editor:",a)}let r=this.editorEl;r&&(r.selectionStart=r.selectionEnd=n,r.focus())}setCursorToEnd(){var r,o,i;if((i=(o=(r=this.widgetEditor)==null?void 0:r.editMode)==null?void 0:o.editor)!=null&&i.cm)try{let s=this.widgetEditor.editMode.editor.cm.state.doc.length;this.widgetEditor.editMode.editor.cm.dispatch({selection:rn.EditorSelection.cursor(s)});return}catch(s){console.warn("Error setting cursor to end in native editor:",s)}let n=this.editorEl;if(n){let s=n.value.length;n.selectionStart=n.selectionEnd=s,n.focus()}}destroy(){var n,r;if(this.widgetEditor){try{(r=(n=this.widgetEditor).unload)==null||r.call(n)}catch(o){console.warn("Error unloading widget editor:",o)}this.widgetEditor=null}this.containerEl.empty(),super.unload()}onunload(){this.destroy()}};var qe=class{constructor(e){this.activeEditors=new Map;this.eventRefs=[];this.cleanupDebounceTimer=null;this.app=e,this.setupEventListeners()}static getInstance(e){return qe.instance||(qe.instance=new qe(e)),qe.instance}setupEventListeners(){this.eventRefs.push(this.app.workspace.on("layout-change",()=>{this.debouncedCleanupClosedEditors()})),this.eventRefs.push(this.app.workspace.on("file-open",e=>{e&&e.extension==="md"&&this.handleFileOpen(e)}))}debouncedCleanupClosedEditors(){this.cleanupDebounceTimer&&clearTimeout(this.cleanupDebounceTimer),this.cleanupDebounceTimer=setTimeout(()=>{this.cleanupClosedEditors(),this.cleanupDebounceTimer=null},100)}async openFallbackEditor(e,n,r){if(!e)return null;let o=e.path,i=this.activeEditors.get(o);if(i){if(this.app.workspace.getLeavesOfType(Ze).some(l=>l===i.leaf)&&i.leaf.view)return this.app.workspace.setActiveLeaf(i.leaf),n&&i.view.onScrollToSelectedRange&&queueMicrotask(()=>{i.view.onScrollToSelectedRange(n.startLine)}),i.view;this.activeEditors.delete(o)}return this.createNewFallbackEditor(e,n,r)}async createNewFallbackEditor(e,n,r){var o,i,s;try{(o=this.app.workspace.rightSplit)!=null&&o.collapsed&&((i=this.app.workspace.rightSplit)==null||i.expand());let a=this.app.workspace.getRightLeaf(!1);if(!a)return null;await a.setViewState({type:Ze,state:{file:e.path}});let l=a.view;return l?(await new Promise(c=>queueMicrotask(()=>c(void 0))),((s=l.file)==null?void 0:s.path)!==e.path&&await a.setViewState({type:Ze,state:{file:e.path}}),this.activeEditors.set(e.path,{leaf:a,view:l,filePath:e.path}),this.app.workspace.setActiveLeaf(a),n&&l.onScrollToSelectedRange&&queueMicrotask(()=>{l.onScrollToSelectedRange(n.startLine)}),l):null}catch(a){return console.error("Error creating fallback editor:",a),null}}static isEmbeddableEditorAvailable(e){var n,r;try{return!!((r=(n=e.embedRegistry)==null?void 0:n.embedByExtension)!=null&&r.md)}catch(o){return!1}}getFallbackEditor(e){return this.activeEditors.get(e)}closeFallbackEditor(e){let n=this.activeEditors.get(e);n&&(n.leaf&&n.leaf.view&&n.leaf.detach(),this.activeEditors.delete(e))}handleFileOpen(e){var r;let n=this.activeEditors.get(e.path);n&&((r=n.view.file)==null?void 0:r.path)!==e.path&&n.leaf.setViewState({type:Ze,state:{file:e.path}})}cleanupClosedEditors(){let e=[],n=new Set;this.app.workspace.getLeavesOfType("markdown").forEach(o=>{let i=o.view;i&&i.file&&n.add(i.file.path)}),this.activeEditors.forEach((o,i)=>{(!this.app.workspace.getLeavesOfType(Ze).some(l=>l===o.leaf)||!o.leaf.view||!n.has(i))&&e.push(i)}),e.forEach(o=>{let i=this.activeEditors.get(o);i&&(i.leaf&&i.leaf.view&&i.leaf.detach(),this.activeEditors.delete(o))})}getActiveEditors(){return new Map(this.activeEditors)}closeAllFallbackEditors(){this.activeEditors.forEach((e,n)=>{e.leaf&&e.leaf.view&&e.leaf.detach()}),this.activeEditors.clear()}destroy(){this.cleanupDebounceTimer&&(clearTimeout(this.cleanupDebounceTimer),this.cleanupDebounceTimer=null),this.eventRefs.forEach(e=>{this.app.workspace.offref(e)}),this.eventRefs=[],this.closeAllFallbackEditors(),qe.instance=null}};var Co=require("obsidian"),En=class extends Co.Modal{constructor(n,r,o=""){super(n);this.imageSrc=r,this.imageAlt=o}onOpen(){let{contentEl:n,modalEl:r,titleEl:o}=this;r.addClass("image-preview-modal");let i=r.querySelector(".modal-close-button");i&&(i.style.display="none"),o&&this.imageAlt?o.setText(this.imageAlt):o&&o.setText("\u56FE\u7247\u9884\u89C8"),n.empty();let a=n.createDiv("image-preview-container").createEl("img",{attr:{src:this.imageSrc,alt:this.imageAlt}});a.onload=()=>{this.adjustImageSize(a)},this.addStyles()}onClose(){let{contentEl:n}=this;n.empty()}adjustImageSize(n){let r=window.innerWidth*.9,o=window.innerHeight*.8,i=60,s=40,a=o-i,l=n.naturalWidth,c=n.naturalHeight;if(l===0||c===0)return;let d=(r-s)/l,u=a/c,f=Math.min(d,u,1),h=l*f,p=c*f;n.style.width=`${h}px`,n.style.height=`${p}px`,n.style.maxWidth=`${h}px`,n.style.maxHeight=`${p}px`;let m=Math.min(h+s,r),g=p+i+s;this.modalEl.style.width=`${m}px`,this.modalEl.style.height=`${g}px`,this.modalEl.style.maxWidth=`${m}px`,this.modalEl.style.maxHeight=`${g}px`,this.modalEl.style.overflow="hidden",this.modalEl.style.position="fixed",this.modalEl.style.left="50%",this.modalEl.style.top="50%",this.modalEl.style.transform="translate(-50%, -50%)"}addStyles(){if(document.getElementById("image-preview-modal-styles"))return;let n=document.createElement("style");n.id="image-preview-modal-styles",n.textContent=`
			.image-preview-modal {
				padding: 0;
				overflow: hidden !important;
			}
			
			.image-preview-modal .modal-content {
				padding: 0;
				background: var(--background-primary);
				border-radius: 12px;
				box-shadow: var(--shadow-l);
				overflow: hidden;
				margin: 0;
				height: 100%;
				display: flex;
				flex-direction: column;
			}
			
			.image-preview-modal .modal-header {
				flex-shrink: 0;
				border-bottom: 1px solid var(--background-modifier-border);
				padding: 16px 20px;
			}
			
			.image-preview-modal .modal-title {
				font-size: 16px;
				font-weight: 500;
				color: var(--text-normal);
				margin: 0;
				text-align: center;
			}
			
			.image-preview-modal .modal-close-button {
				display: none !important;
			}
			
			.image-preview-container {
				flex: 1;
				display: flex;
				align-items: center;
				justify-content: center;
				padding: 20px;
				background: var(--background-primary);
				overflow: hidden;
			}
			
			.image-preview-container img {
				object-fit: contain;
				border-radius: 8px;
				box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
				display: block;
			}
			
			/* \u6697\u8272\u4E3B\u9898\u9002\u914D */
			.theme-dark .image-preview-container {
				background: var(--background-primary);
			}
			
			.theme-dark .image-preview-container img {
				box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
			}
			
			/* \u79FB\u52A8\u7AEF\u9002\u914D */
			@media (max-width: 768px) {
				.image-preview-container {
					padding: 10px;
				}
				
				.image-preview-container img {
					max-width: 95vw;
					max-height: 75vh;
				}
				
				.image-preview-caption {
					font-size: 12px;
					padding: 0 10px 10px;
				}
			}
		`,document.head.appendChild(n)}};function Eo(t,e={}){let n=e;function r(i){if(!n.enabled)return;let s=i.target;if(s.tagName==="IMG"){let a=s;if(o(a))return;i.preventDefault(),i.stopPropagation();let l=a.src,c=a.alt||"";n.onImageClick&&n.onImageClick(l,c)}}function o(i){let s=i.naturalWidth||parseInt(i.getAttribute("width")||"0"),a=i.naturalHeight||parseInt(i.getAttribute("height")||"0");if(s>0&&a>0&&(s<64||a<64))return!0;let l=i.src.toLowerCase(),c=i.alt.toLowerCase();return!!(l.includes("icon")||l.includes("avatar")||c.includes("icon")||c.includes("avatar")||i.classList.contains("no-preview")||i.classList.contains("icon")||i.classList.contains("avatar"))}return t.addEventListener("click",r,!0),{update(i){n={...n,...i}},destroy(){t.removeEventListener("click",r,!0)}}}function us(t){Ie(t,"svelte-1evr0xc",'@charset "UTF-8";.markdown-editor-wrapper.svelte-1evr0xc{position:relative;min-height:120px;border-radius:4px}.markdown-editor-container.svelte-1evr0xc{border:2px solid var(--interactive-accent);border-radius:8px;background:var(--background-primary);overflow:hidden;box-shadow:0 4px 16px rgba(var(--color-accent-rgb), 0.15)}.editor-container.svelte-1evr0xc{min-height:120px;font-size:var(--font-text-size)}.editor-container.svelte-1evr0xc .cm-editor{font-size:var(--font-text-size) !important}.editor-container.svelte-1evr0xc .cm-scroller{padding:8px !important;font-size:var(--font-text-size) !important}.editor-container.svelte-1evr0xc .cm-content{font-size:var(--font-text-size) !important}.editor-container.svelte-1evr0xc .markdown-embed-link{display:none}.editor-toolbar.svelte-1evr0xc{display:flex;justify-content:space-between;align-items:center;padding:8px 12px;background:var(--background-secondary);border-top:1px solid var(--background-modifier-border)}.editor-hint.svelte-1evr0xc{font-size:11px;color:var(--text-faint);opacity:0.8}.editor-actions.svelte-1evr0xc{display:flex;gap:8px}.btn-primary.svelte-1evr0xc,.btn-secondary.svelte-1evr0xc{padding:4px 12px;border:none;border-radius:4px;font-size:12px;font-weight:500;cursor:pointer;transition:all 0.2s ease}.btn-primary.svelte-1evr0xc{background:var(--interactive-accent);color:var(--text-on-accent)}.btn-primary.svelte-1evr0xc:hover{background:var(--interactive-accent-hover);transform:translateY(-1px)}.btn-secondary.svelte-1evr0xc{background:var(--background-primary);color:var(--text-normal);border:1px solid var(--background-modifier-border)}.btn-secondary.svelte-1evr0xc:hover{background:var(--background-modifier-hover);transform:translateY(-1px)}.markdown-rendered.svelte-1evr0xc{max-width:100%;min-height:100px;user-select:text;font-size:var(--font-text-size);line-height:1.5;cursor:pointer;transition:opacity 0.2s;overflow-x:hidden;word-wrap:break-word}.markdown-rendered.svelte-1evr0xc h1{font-size:calc(var(--font-text-size) * 2)}.markdown-rendered.svelte-1evr0xc h2{font-size:calc(var(--font-text-size) * 1.6)}.markdown-rendered.svelte-1evr0xc h3{font-size:calc(var(--font-text-size) * 1.4)}.markdown-rendered.svelte-1evr0xc h4{font-size:calc(var(--font-text-size) * 1.2)}.markdown-rendered.svelte-1evr0xc h5{font-size:calc(var(--font-text-size) * 1.1)}.markdown-rendered.svelte-1evr0xc h6{font-size:var(--font-text-size)}.markdown-rendered.svelte-1evr0xc:lang(zh){letter-spacing:0.05em}.markdown-rendered.svelte-1evr0xc img{width:100%;min-width:200px;max-width:500px;height:auto;border-radius:8px;box-shadow:0 2px 8px rgba(0, 0, 0, 0.1);margin:16px 0}.markdown-rendered.svelte-1evr0xc img:hover{box-shadow:0 4px 16px rgba(0, 0, 0, 0.15);transform:scale(1.02);transition:all 0.3s ease}.markdown-rendered.svelte-1evr0xc .layout-left{display:block;margin:16px auto 16px 0}.markdown-rendered.svelte-1evr0xc .layout-right{display:block;margin:16px 0 16px auto}.markdown-rendered.svelte-1evr0xc .layout-center{display:block;margin:16px auto}.markdown-rendered.svelte-1evr0xc .layout-full{display:block;width:100% !important;max-width:100% !important;margin:16px 0}.markdown-rendered.svelte-1evr0xc .shape-circle{border-radius:50% !important;width:200px !important;height:200px !important;object-fit:cover}.markdown-rendered.svelte-1evr0xc .shape-round{border-radius:20px !important}.markdown-rendered.svelte-1evr0xc .image-left-paragraph{text-align:left}.markdown-rendered.svelte-1evr0xc .image-right-paragraph{text-align:right}.markdown-rendered.svelte-1evr0xc .image-center-paragraph{text-align:center}.markdown-rendered.svelte-1evr0xc .image-full-paragraph{text-align:center}.markdown-rendered.svelte-1evr0xc .embed-left-paragraph{text-align:left}.markdown-rendered.svelte-1evr0xc .embed-center-paragraph{text-align:center}.markdown-rendered.svelte-1evr0xc .embed-right-paragraph{text-align:right}.markdown-rendered.svelte-1evr0xc .embed-full-paragraph{text-align:center}.markdown-rendered.svelte-1evr0xc .internal-embed.layout-left{display:block;margin:16px auto 16px 0}.markdown-rendered.svelte-1evr0xc .internal-embed.layout-right{display:block;margin:16px 0 16px auto}.markdown-rendered.svelte-1evr0xc .internal-embed.layout-center{display:block;margin:16px auto}.markdown-rendered.svelte-1evr0xc .internal-embed.layout-full{display:block;width:100% !important;max-width:100% !important;margin:16px 0}.markdown-rendered.svelte-1evr0xc img[src*="icon"]:not(.layout-left):not(.layout-center):not(.layout-full),.markdown-rendered.svelte-1evr0xc img[src*="avatar"]:not(.layout-left):not(.layout-center):not(.layout-full),.markdown-rendered.svelte-1evr0xc img[width="16"]:not(.layout-left):not(.layout-center):not(.layout-full),.markdown-rendered.svelte-1evr0xc img[width="24"]:not(.layout-left):not(.layout-center):not(.layout-full),.markdown-rendered.svelte-1evr0xc img[width="32"]:not(.layout-left):not(.layout-center):not(.layout-full){margin:8px 0 8px auto !important;max-width:64px !important}.markdown-rendered.svelte-1evr0xc:not(.editing) img:not(.no-preview):not(.icon):not(.avatar){cursor:zoom-in;transition:all 0.2s ease}.markdown-rendered.svelte-1evr0xc:not(.editing) img:not(.no-preview):not(.icon):not(.avatar):hover{opacity:0.9;transform:scale(1.02);box-shadow:0 4px 12px rgba(0, 0, 0, 0.15)}.markdown-rendered.svelte-1evr0xc video{max-width:400px !important;border-radius:8px;box-shadow:0 2px 8px rgba(0, 0, 0, 0.1)}.markdown-rendered.svelte-1evr0xc video:hover{box-shadow:0 4px 16px rgba(0, 0, 0, 0.15);transition:all 0.3s ease}.markdown-rendered.svelte-1evr0xc:empty::before{content:"\u53CC\u51FB\u7F16\u8F91\u5185\u5BB9...";color:var(--text-muted);font-style:italic;opacity:0.6}.selected.svelte-1evr0xc{box-shadow:0 0 0 2px var(--color-accent)}.search-highlight{background:var(--text-highlight-bg);color:var(--text-on-accent);border-radius:2px;box-shadow:0 0 0 2px var(--text-highlight-bg)}.search-current{background:var(--text-selection);color:var(--text-normal)}.node-preview{font-size:var(--font-text-size);margin-right:20px}.node-preview p{margin:0}.markdown-rendered.level-one-content.svelte-1evr0xc p{text-align:center}.markdown-rendered.level-one-content.svelte-1evr0xc h1,.markdown-rendered.level-one-content.svelte-1evr0xc h2,.markdown-rendered.level-one-content.svelte-1evr0xc h3,.markdown-rendered.level-one-content.svelte-1evr0xc h4,.markdown-rendered.level-one-content.svelte-1evr0xc h5,.markdown-rendered.level-one-content.svelte-1evr0xc h6{text-align:center}.markdown-rendered.level-one-content.svelte-1evr0xc ul,.markdown-rendered.level-one-content.svelte-1evr0xc ol{text-align:left;display:inline-block}.markdown-rendered.level-one-content.svelte-1evr0xc pre{text-align:left;max-width:100%;overflow-x:auto;white-space:pre-wrap;word-wrap:break-word;word-break:break-all}.markdown-rendered.level-one-content.svelte-1evr0xc code{text-align:left;max-width:100%;word-wrap:break-word;word-break:break-all}.markdown-rendered.level-one-content.svelte-1evr0xc div[class*="language-"],.markdown-rendered.level-one-content.svelte-1evr0xc div[class*="hljs"],.markdown-rendered.level-one-content.svelte-1evr0xc .cm-editor{text-align:left}.markdown-rendered.level-one-content.svelte-1evr0xc table{text-align:left;margin:0 auto}.markdown-rendered.level-one-content.svelte-1evr0xc blockquote{text-align:left}.markdown-editor-wrapper.svelte-1evr0xc .math,.markdown-editor-wrapper.svelte-1evr0xc .math-inline,.markdown-editor-wrapper.svelte-1evr0xc .math-block,.markdown-editor-wrapper.svelte-1evr0xc .mjx-container,.markdown-editor-wrapper.svelte-1evr0xc .katex,.markdown-editor-wrapper.svelte-1evr0xc .katex-display{font-size:larger !important}.editor-container.svelte-1evr0xc .math,.editor-container.svelte-1evr0xc .math-inline,.editor-container.svelte-1evr0xc .math-block,.editor-container.svelte-1evr0xc .mjx-container,.editor-container.svelte-1evr0xc .katex,.editor-container.svelte-1evr0xc .katex-display,.editor-container.svelte-1evr0xc .cm-math{font-size:larger !important}')}function fs(t){let e,n,r,o;return{c(){e=F("div"),w(e,"class","markdown-rendered svelte-1evr0xc"),Z(e,"selected",ms),Z(e,"level-one-content",t[0])},m(i,s){$(i,e,s),t[18](e),r||(o=io(n=Eo.call(null,e,{enabled:!t[1],onImageClick:t[6]})),r=!0)},p(i,s){n&&Ue(n.update)&&s[0]&2&&n.update.call(null,{enabled:!i[1],onImageClick:i[6]}),s[0]&1&&Z(e,"level-one-content",i[0])},d(i){i&&q(e),t[18](null),r=!1,o()}}}function hs(t){let e,n,r,o,i,s,a,l,c,d,u,f;return{c(){e=F("div"),n=F("div"),r=X(),o=F("div"),i=F("div"),i.innerHTML="<span>\u2328 Ctrl/Cmd + S \u6216 Enter \u4FDD\u5B58 \xB7 Esc \u53D6\u6D88</span>",s=X(),a=F("div"),l=F("button"),l.textContent="\u53D6\u6D88",c=X(),d=F("button"),d.textContent="\u4FDD\u5B58",w(n,"class","editor-container svelte-1evr0xc"),w(i,"class","editor-hint svelte-1evr0xc"),w(l,"class","btn-secondary svelte-1evr0xc"),w(d,"class","btn-primary svelte-1evr0xc"),w(a,"class","editor-actions svelte-1evr0xc"),w(o,"class","editor-toolbar svelte-1evr0xc"),w(e,"class","markdown-editor-container svelte-1evr0xc")},m(h,p){$(h,e,p),A(e,n),t[17](n),A(e,r),A(e,o),A(o,i),A(o,s),A(o,a),A(a,l),A(a,c),A(a,d),u||(f=[le(l,"mousedown",or(t[5])),le(d,"mousedown",or(t[4]))],u=!0)},p:ae,d(h){h&&q(e),t[17](null),u=!1,be(f)}}}function ps(t){let e;function n(i,s){return i[1]?hs:fs}let r=n(t,[-1,-1]),o=r(t);return{c(){e=F("div"),o.c(),w(e,"class","markdown-editor-wrapper svelte-1evr0xc")},m(i,s){$(i,e,s),o.m(e,null)},p(i,s){r===(r=n(i,s))&&o?o.p(i,s):(o.d(1),o=r(i),o&&(o.c(),o.m(e,null)))},i:ae,o:ae,d(i){i&&q(e),o.d()}}}var ms=!1;function gs(t,e){let n=Mo(t),r=Mo(e);if(n.length!==r.length)return!0;for(let o=0;o<n.length;o++)if(n[o].text!==r[o].text||n[o].level!==r[o].level)return!0;return!1}function Mo(t){let e=[],n=t.split(`
`),r=!1;return n.forEach(o=>{let i=o.trim();if(i.startsWith("```")){r=!r;return}if(!r){let s=i.match(/^(#{1,6})\s+(.+)$/);s&&e.push({text:s[2].trim(),level:s[1].length})}}),e}function vs(t,e){let n=t.split(/\r?\n/),r=!1;for(let o=e;o<n.length;o++){let i=n[o];if(/^\s*```/.test(i)){r=!r;continue}if(!r&&i.trim().match(/^(#{1,6})\s+/))return o+1}return n.length+1}function Lo(t){let e="none",n="normal",r=t;return t.startsWith("left:")?(e="left",r=t.substring(5).trim()):t.startsWith("right:")?(e="right",r=t.substring(6).trim()):t.startsWith("center:")?(e="center",r=t.substring(7).trim()):t.startsWith("full:")&&(e="full",r=t.substring(5).trim()),r.startsWith("circle:")?(n="circle",r=r.substring(7).trim()):r.startsWith("round:")&&(n="round",r=r.substring(6).trim()),t.startsWith("circle:")&&(n="circle",r=t.substring(7).trim(),r.startsWith("left:")?(e="left",r=r.substring(5).trim()):r.startsWith("right:")?(e="right",r=r.substring(6).trim()):r.startsWith("center:")&&(e="center",r=r.substring(7).trim())),{layout:e,shape:n,cleanText:r}}function bs(t){if(!t)return!1;let e=t.getBoundingClientRect();return e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)}function ys(t,e,n){let r,{node:o}=e,{View:i}=e,{searchKeyword:s}=e,{searchIndex:a}=e,{allHighlights:l}=e,{isLevelOne:c=!1}=e,{triggerEdit:d=!1}=e,{isSelected:u=!1}=e,f=tn(),h,p,m=!1,g="",v=!1,b,_,y,x=null,M=`editor_${o.startLine}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,I="",L=0,W=[],Y=String(o.startLine),Q=o.id||"unknown";function de(){m?K():Me()}function oe(){return o&&(o.content||p)||""}function Me(){m||v||(v=!0,x&&H(),n(1,m=!0),g=oe(),pt.requestEdit(M),queueMicrotask(()=>{ee(),v=!1}))}function ee(){if(!y){console.error("Editor container not available"),n(1,m=!1),v=!1,pt.exitEdit(M);return}x&&H(),!g&&p&&(g=p),g||(g="");try{n(3,y.innerHTML="",y),x=new Bt(i.app,y,{value:g,placeholder:"\u5728\u6B64\u7F16\u8F91 Markdown \u5185\u5BB9...",cls:"in-place-markdown-editor",onChange:k=>{g=k},onEnter:(k,N,V)=>N?(O(),!0):!1,onEscape:k=>{G()},onSubmit:k=>{O()},onSave:k=>{O()},onBlur:k=>{}}),queueMicrotask(()=>{x==null||x.focus()})}catch(k){console.error("\u521B\u5EFA\u5C31\u5730\u7F16\u8F91\u5668\u5931\u8D25:",k),ve()}}function ve(){if(!i.file){n(1,m=!1),v=!1,pt.exitEdit(M);return}n(1,m=!1),v=!1,pt.exitEdit(M),qe.getInstance(i.app).openFallbackEditor(i.file,o,i.leaf)}function H(){if(x){try{x.destroy()}catch(k){console.error("Error destroying editor:",k)}x=null}y&&n(3,y.innerHTML="",y),h&&h.removeEventListener("click",C)}function R(k){return{header:o.header,content:k,level:o.level}}function O(){if(v)return;x&&(g=x.value);let{header:k,content:N,level:V}=R(g);n(1,m=!1),v=!1,pt.exitEdit(M),H();let se=p!==N,xe=p;n(14,p=N),n(7,o.content=N,o),se&&i.file&&U(),nt().then(()=>{ie(!1)})}function G(){v||(n(1,m=!1),v=!1,pt.exitEdit(M),g=p,H(),nt().then(()=>{ie(!1)}))}function K(){m&&G()}async function U(){var k;try{if(!i.file||!i.app)return;let N=((k=i.editor)===null||k===void 0?void 0:k.getValue())||"";i.markInternalModification&&i.markInternalModification(i.file.path);let V=re();await i.app.vault.modify(i.file,V),N&&V&&N!==V&&gs(N,V)&&i.recalculateFoldStates&&i.recalculateFoldStates(N,V),f("contentUpdated",{node:o,newContent:g,fullMarkdown:V,skipGlobalRefresh:!0})}catch(N){console.error("\u4FDD\u5B58\u6587\u4EF6\u65F6\u51FA\u9519:",N),new i.app.Notice("\u4FDD\u5B58\u5931\u8D25: "+N.message)}}function re(){var k,N;try{let V=((k=i.editor)===null||k===void 0?void 0:k.getValue())||"",se=V.split(`
`),{header:xe,content:he,level:ye}=R(g),fe=o.startLine-1,Le=vs(V,o.startLine)-2,te=[...se],ne=`${"#".repeat(ye)} ${xe}`;te[fe]=ne;let ce=fe+1,me=Le,Se=he?he.split(`
`):[],Ye=Math.max(0,me-ce+1);return te.splice(ce,Ye,...Se),te.join(`
`)}catch(V){return console.error("\u91CD\u5EFAmarkdown\u6587\u6863\u65F6\u51FA\u9519:",V),((N=i.editor)===null||N===void 0?void 0:N.getValue())||""}}function ue(){h&&!m&&(h.removeEventListener("click",C),h.addEventListener("click",C))}function ge(){if(h)try{h.querySelectorAll("p").forEach(N=>{var V;let se=N.querySelectorAll("img"),xe=N.querySelectorAll("video"),he=N.querySelectorAll(".internal-embed"),ye=((V=N.textContent)===null||V===void 0?void 0:V.trim())||"";if(se.length===1){let fe=se[0],_e=fe.alt||"",{layout:Le,shape:te,cleanText:ne}=Lo(_e);ne!==_e&&(fe.alt=ne),Le!=="none"&&(fe.classList.add(`layout-${Le}`),N.classList.add(`image-${Le}-paragraph`)),te!=="normal"&&(fe.classList.add(`shape-${te}`),N.classList.add(`image-${te}-paragraph`))}if(xe.length===1){let fe=xe[0]}if(he.length===1){let fe=he[0],_e=fe.querySelector("video"),Le=fe.querySelector("img");if(_e||Le){let te="",ne=N.textContent||"";if(ne.match(/!\[\[(.*?)\]\]/)){let Be=ne.substring(0,ne.indexOf("![[")),et=ne.substring(ne.indexOf("]]")+2),Je=(Be+" "+et).match(/(left|right|center|full|circle|round):\s*/);Je&&(te=Je[1]+":")}let{layout:me,shape:Se,cleanText:Ye}=Lo(te);me!=="none"&&(fe.classList.add(`layout-${me}`),N.classList.add(`embed-${me}-paragraph`)),Se!=="normal"&&(fe.classList.add(`shape-${Se}`),_e&&_e.classList.add(`shape-${Se}`),Le&&Le.classList.add(`shape-${Se}`))}}})}catch(k){console.warn("\u5904\u7406\u56FE\u7247\u5E03\u5C40\u65F6\u51FA\u9519:",k)}}async function ie(k=!1){if(!(!h||!i||m)){W.length>0&&l&&l.update&&l.update(N=>N.filter(V=>!W.includes(V)));try{n(2,h.innerHTML="",h);let N=i.file,V=i.app;if(!N||!V){n(2,h.innerHTML=`<div class="fallback-content">${p}</div>`,h),await nt(),ue();return}let se=V.vault.adapter.getResourcePath(N.path),xe=i.addChild(new Mn.Component);await Mn.MarkdownRenderer.render(V,p,h,se,xe),await nt(),D(k),ue(),ge(),W=[],I&&(He(h,I),W.forEach(he=>{he.setAttribute("data-node-line",Y),he.setAttribute("data-is-header","false"),he.setAttribute("data-source","MarkdownEditor"),he.setAttribute("data-node-id",Q)}),l&&l.update&&l.update(he=>{let ye=[...he];for(let fe of W){let _e=parseInt(fe.getAttribute("data-node-line")||"0"),Le=fe.getAttribute("data-is-header")==="true",te=0,ne=ye.length;for(;te<ne;){let ce=Math.floor((te+ne)/2),me=parseInt(ye[ce].getAttribute("data-node-line")||"0"),Se=ye[ce].getAttribute("data-is-header")==="true";_e<me||_e===me&&Le&&!Se?ne=ce:te=ce+1}ye.splice(te,0,fe)}return ye}))}catch(N){console.error("\u6E32\u67D3Markdown\u65F6\u51FA\u9519:",N);try{n(2,h.innerHTML="",h);let V=h.createDiv("fallback-content");V.innerHTML=p.replace(/\n/g,"<br>"),await nt()}catch(V){console.error("\u964D\u7EA7\u6E32\u67D3\u4E5F\u5931\u8D25:",V),n(2,h.textContent=p,h)}ue()}}}function He(k,N){if(!k||!N)return;let V=N.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),se=new RegExp(V,"gi"),xe=document.createTreeWalker(k,NodeFilter.SHOW_TEXT,null),he=[],ye;for(;ye=xe.nextNode();){let fe=ye.textContent||"";se.test(fe)&&he.push(ye)}he.forEach(fe=>{let _e=fe.textContent||"",Le=fe.parentNode;if(!Le)return;let te=document.createDocumentFragment(),ne=0,ce;for(se.lastIndex=0;(ce=se.exec(_e))!==null;){ce.index>ne&&te.appendChild(document.createTextNode(_e.slice(ne,ce.index)));let me=document.createElement("span");me.className="search-highlight",me.textContent=ce[0],W.push(me),te.appendChild(me),ne=se.lastIndex,ce[0].length===0&&se.lastIndex++}ne<_e.length&&te.appendChild(document.createTextNode(_e.slice(ne))),Le.replaceChild(te,fe)})}async function D(k=!1){await nt();let V=(l?Xt(l):W).filter(se=>se.isConnected&&se.offsetParent!==null);if(V.length>0){V.forEach((xe,he)=>{xe.className=he===(k?0:L)?"search-current":"search-highlight"});let se=null;k?se=V[0]:V.length>0&&L<V.length&&(se=V[L]),se&&!bs(se)&&se.scrollIntoView({behavior:"smooth",block:"center"})}}$e(()=>{n(15,b=i.ProStatus),_=!0,ie();let k=pt.subscribe(N=>{m&&N.activeEditorId!==M&&(n(1,m=!1),nt().then(()=>{ie(!1)}))});return()=>{h&&h.removeEventListener("click",C),k()}}),tt(()=>{H(),m&&pt.exitEdit(M),W.length>0&&l&&l.update&&l.update(k=>k.filter(N=>!W.includes(N)))});function C(k){if(m)return;let N=k.target;N.tagName==="A"||N.closest("a")?i.handleClickLink(k,o.startLine):u&&(k.preventDefault(),k.stopPropagation(),b?de():T())}function P(k,N){new En(i.app,k,N).open()}function E(){try{let k=i.file;if(!k)return!1;let V=qe.getInstance(i.app).getFallbackEditor(k.path);if(V){let se=V.leaf;return se&&se.view&&!se.isDetached&&se.getViewState().type===Ze}return!1}catch(k){return console.error("Error checking right editor existence:",k),!1}}function T(){try{let k=i.file;if(!k)return;qe.getInstance(i.app).openFallbackEditor(k,o,i.leaf)}catch(k){console.error("Error opening right editor:",k)}}function j(k){pe[k?"unshift":"push"](()=>{y=k,n(3,y)})}function S(k){pe[k?"unshift":"push"](()=>{h=k,n(2,h)})}return t.$$set=k=>{"node"in k&&n(7,o=k.node),"View"in k&&n(8,i=k.View),"searchKeyword"in k&&n(9,s=k.searchKeyword),"searchIndex"in k&&n(10,a=k.searchIndex),"allHighlights"in k&&n(11,l=k.allHighlights),"isLevelOne"in k&&n(0,c=k.isLevelOne),"triggerEdit"in k&&n(12,d=k.triggerEdit),"isSelected"in k&&n(13,u=k.isSelected)},t.$$.update=()=>{if(t.$$.dirty[0]&33024){e:if(i&&b!==void 0){let k=i.ProStatus;k!==b&&n(15,b=k)}}if(t.$$.dirty[0]&36866){e:d&&!m&&(b?Me():ve())}if(t.$$.dirty[0]&16514){e:o&&(n(14,p=o.content),m||(g=p,ie(!1)))}if(t.$$.dirty[0]&2){e:n(16,r=!m)}if(t.$$.dirty[0]&66048){e:s.subscribe(k=>{I=k,r&&ie(!0)})}if(t.$$.dirty[0]&66560){e:a.subscribe(k=>{L=k,r&&D(!1)})}},[c,m,h,y,O,G,P,o,i,s,a,l,d,u,p,b,r,j,S]}var mr=class extends Ce{constructor(e){super(),Te(this,e,ys,ps,Ee,{node:7,View:8,searchKeyword:9,searchIndex:10,allHighlights:11,isLevelOne:0,triggerEdit:12,isSelected:13},us,[-1,-1])}},gr=mr;var vr=require("obsidian");function Io(t,e,n){t.empty();let r=new vr.ExtraButtonComponent(t).setIcon(e?`heading-${e}`:"heading").setDisabled(!0).onClick(()=>{});return r.extraSettingsEl.addEventListener("pointerdown",o=>{}),()=>{r.extraSettingsEl.addEventListener("pointerdown",o=>{})}}var Ge=require("obsidian");var Ln=require("obsidian");function ws(t,e,n=1){let r=new Ln.Menu;r.addItem(i=>i.setTitle("\u590D\u5236\u6574\u4E2A\u6587\u6863").setIcon("copy-plus").onClick(()=>{e("\u590D\u5236\u6574\u4E2A\u6587\u6863")})),r.addSeparator(),r.addItem(i=>i.setTitle("\u590D\u5236\u6B64\u8282\u70B9\uFF08\u7EAF\u6587\u672C\uFF09").setIcon("copy-minus").onClick(()=>{e("\u590D\u5236\u6B64\u8282\u70B9\uFF08\u7EAF\u6587\u672C\uFF09")})),r.addItem(i=>i.setTitle("\u590D\u5236\u8282\u70B9\u53CA\u5B50\u8282\u70B9\uFF08\u7EAF\u6587\u672C\uFF09").setIcon("copy").onClick(()=>{e("\u590D\u5236\u8282\u70B9\u53CA\u5B50\u8282\u70B9\uFF08\u7EAF\u6587\u672C\uFF09")})),r.addSeparator(),r.addItem(i=>i.setTitle("\u590D\u5236\u6B64\u8282\u70B9\uFF08\u5BCC\u6587\u672C\uFF09").setIcon("file-text").onClick(()=>{e("\u590D\u5236\u6B64\u8282\u70B9\uFF08\u5BCC\u6587\u672C\uFF09")})),r.addItem(i=>i.setTitle("\u590D\u5236\u8282\u70B9\u53CA\u5B50\u8282\u70B9\uFF08\u5BCC\u6587\u672C\uFF09").setIcon("files").onClick(()=>{e("\u590D\u5236\u8282\u70B9\u53CA\u5B50\u8282\u70B9\uFF08\u5BCC\u6587\u672C\uFF09")})),r.addSeparator(),r.addItem(i=>i.setTitle("\u5206\u4EAB\u4E3A\u56FE\u7247").setIcon("image").onClick(()=>{e("\u5206\u4EAB\u4E3A\u56FE\u7247")}));let o=t.getBoundingClientRect();r.showAtPosition({x:o.right,y:o.bottom})}function To(t,e,n=1){let r=new Ln.ExtraButtonComponent(t).setIcon("copy").setTooltip("\u590D\u5236").onClick(()=>{ws(r.extraSettingsEl,e,n)});return()=>{r.extraSettingsEl.remove()}}function Ao(t){let e=t.getBoundingClientRect();return e.top>=150&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)-150&&e.right<=(window.innerWidth||document.documentElement.clientWidth)}var In=require("obsidian");var br=class extends In.Modal{constructor(n,r){super(n);this.editor=null;this.options=r,this.currentValue=r.value,this.fileChangeHandler=()=>{this.close()}}onOpen(){let{contentEl:n}=this;this.modalEl.addClass("grid-note-editor-modal"),this.setupModalPosition(),this.options.title&&this.titleEl.setText(this.options.title),n.style.display="flex",n.style.flexDirection="column",n.style.height="100%",this.editorContainer=n.createDiv({cls:"grid-note-modal-editor-container"}),this.createEditor();let r=n.createDiv({cls:"grid-note-modal-button-area"});new In.Setting(r).addButton(o=>o.setButtonText("\u53D6\u6D88").onClick(()=>{this.handleCancel()})).addButton(o=>o.setButtonText("\u4FDD\u5B58").setCta().onClick(()=>{this.handleSave()})),this.app.workspace.on("active-leaf-change",this.fileChangeHandler)}setupModalPosition(){this.modalEl.style.width="90vw",this.modalEl.style.maxWidth="1200px",this.modalEl.style.minWidth="800px",this.modalEl.style.height="85vh",this.modalEl.style.maxHeight="900px",this.modalEl.style.minHeight="500px"}createEditor(){this.editorContainer&&(this.editor=new Bt(this.app,this.editorContainer,{value:this.currentValue,placeholder:this.options.placeholder||"\u5728\u6B64\u7F16\u8F91 Markdown \u5185\u5BB9...",cls:"grid-note-modal-editor",onChange:n=>{this.currentValue=n},onEnter:(n,r,o)=>r?(this.handleSave(),!0):!1,onEscape:n=>{this.handleCancel()},onSubmit:n=>{this.handleSave()}}),setTimeout(()=>{var n;(n=this.editor)==null||n.focus()},100))}handleSave(){this.editor&&(this.currentValue=this.editor.value),this.options.onSave&&this.options.onSave(this.currentValue),this.close()}handleCancel(){this.options.onCancel&&this.options.onCancel(),this.close()}onClose(){let{contentEl:n}=this;this.app.workspace.off("active-leaf-change",this.fileChangeHandler),this.editor&&(this.editor.destroy(),this.editor=null),n.empty(),this.options.onClose&&this.options.onClose(),at.getInstance(this.app).onModalClosed(this)}},at=class{constructor(e){this.currentModal=null;this.isOpening=!1;this.lastOpenTime=0;this.app=e}static getInstance(e){return at.instance||(at.instance=new at(e)),at.instance}openEditor(e){let n=Date.now();n-this.lastOpenTime<100||this.isOpening||this.currentModal||(this.isOpening=!0,this.lastOpenTime=n,this.currentModal=new br(this.app,e),this.currentModal.open(),setTimeout(()=>{this.isOpening=!1},100))}closeEditor(){this.currentModal&&(this.currentModal.close(),this.currentModal=null),this.isOpening=!1}onModalClosed(e){this.currentModal===e&&(this.currentModal=null,this.isOpening=!1,this.lastOpenTime=0)}isOpen(){return this.currentModal!==null||this.isOpening}};var Ae=require("obsidian");var Tn=require("obsidian");function xs(t){Ie(t,"svelte-b97y30",'@charset "UTF-8";.screenshot-node.svelte-b97y30.svelte-b97y30{height:fit-content;overflow:visible;contain:layout style;padding-bottom:16px;font-size:var(--font-text-size);line-height:1.4;max-width:100%;min-width:0;position:relative;clear:both}.screenshot-header.svelte-b97y30.svelte-b97y30{font-weight:700;border-bottom:2px solid var(--background-modifier-border);color:var(--color-orange);position:relative;margin-top:6px;font-size:calc(var(--font-text-size) * 1.2);display:flex;align-items:center;justify-content:space-between;gap:8px}.screenshot-header.level-1.svelte-b97y30.svelte-b97y30{color:var(--interactive-accent);border-image:linear-gradient(90deg, transparent, var(--interactive-accent), transparent) 1}.screenshot-header.svelte-b97y30 .hide-node-btn.svelte-b97y30{opacity:0;background:transparent;border:none;cursor:pointer;padding:4px;border-radius:4px;display:flex;align-items:center;justify-content:center;transition:all 0.2s ease;color:var(--text-muted);flex-shrink:0}.screenshot-header.svelte-b97y30 .hide-node-btn.svelte-b97y30:hover{background:var(--background-modifier-hover);color:var(--text-normal)}.screenshot-header.svelte-b97y30 .hide-node-btn svg.svelte-b97y30{width:16px;height:16px}.screenshot-header.svelte-b97y30:hover .hide-node-btn.svelte-b97y30{opacity:1}.screenshot-layout.svelte-b97y30.svelte-b97y30{display:grid;gap:20px;width:100%;align-items:start;min-height:0;height:fit-content;max-width:100%;overflow:visible}.screenshot-left.svelte-b97y30.svelte-b97y30{min-width:0;padding-right:6px;overflow:hidden;max-width:100%}.screenshot-right.svelte-b97y30.svelte-b97y30{min-width:0;display:flex;flex-direction:column;gap:12px;overflow:hidden;max-width:100%}.screenshot-children-vertical.svelte-b97y30.svelte-b97y30{margin-top:24px;display:flex;flex-direction:column;gap:20px;max-width:100%;overflow:hidden}.screenshot-content.svelte-b97y30.svelte-b97y30{word-break:break-word;height:auto;max-height:none;position:relative;z-index:1;font-size:var(--font-text-size);line-height:1.5}.screenshot-content.svelte-b97y30 p{margin:0}.screenshot-content.svelte-b97y30 p:first-child{margin-top:0}.screenshot-content.svelte-b97y30 p:last-child{margin-bottom:0}.screenshot-content.svelte-b97y30 ul,.screenshot-content.svelte-b97y30 ol{margin:0}.screenshot-content.svelte-b97y30 code{background:var(--code-background);padding:2px 6px;border-radius:4px;font-size:0.9em}.screenshot-content.svelte-b97y30 pre{background:var(--code-background);padding:8px;border-radius:4px;overflow-x:auto;margin:0.8em 0;font-size:0.85em;line-height:1.4}.screenshot-content.svelte-b97y30 .math{margin:0.5em 0;font-size:1.2em}.screenshot-content.svelte-b97y30 .inline-title,.screenshot-content.svelte-b97y30 .metadata-container{display:none !important}.screenshot-content.svelte-b97y30 img{width:100%;max-width:420px;height:auto;border-radius:8px;box-shadow:0 2px 8px rgba(0, 0, 0, 0.1);margin:16px 0}.screenshot-content.svelte-b97y30 video{width:100%;max-width:420px;height:auto;border-radius:8px;box-shadow:0 2px 8px rgba(0, 0, 0, 0.1)}.screenshot-content.svelte-b97y30 .layout-left{display:block;margin:16px auto 16px 0}.screenshot-content.svelte-b97y30 .layout-right{display:block;margin:16px 0 16px auto}.screenshot-content.svelte-b97y30 .layout-center{display:block;margin:16px auto}.screenshot-content.svelte-b97y30 .layout-full{display:block;width:100% !important;max-width:100% !important;margin:16px 0}.screenshot-content.svelte-b97y30 .shape-circle{border-radius:50% !important;width:200px !important;height:200px !important;object-fit:cover}.screenshot-content.svelte-b97y30 .shape-round{border-radius:20px !important}.screenshot-content.svelte-b97y30 .copy-code-button{display:none}.screenshot-content.svelte-b97y30 table{border-collapse:collapse;margin:16px 0;width:100%}.screenshot-content.svelte-b97y30 table th,.screenshot-content.svelte-b97y30 table td{border:1px solid var(--table-border-color, var(--background-modifier-border));padding:8px 12px;text-align:left}.screenshot-content.svelte-b97y30 table th{background-color:var(--table-header-background, var(--background-secondary));font-weight:600}.screenshot-content-placeholder.svelte-b97y30.svelte-b97y30{min-height:20px}.theme-dark .screenshot-header.svelte-b97y30.svelte-b97y30{color:var(--color-orange)}.theme-light .screenshot-header.svelte-b97y30.svelte-b97y30{color:var(--color-blue)}')}function No(t,e,n){let r=t.slice();return r[21]=e[n],r}function Fo(t,e,n){let r=t.slice();return r[21]=e[n],r}function Do(t,e,n){let r=t.slice();return r[21]=e[n],r}function Ro(t){let e,n,r=t[0].header+"",o,i,s,a,l,c,d,u,f,h,p=[_s,ks],m=[];function g(v,b){return v[14]?0:1}return c=g(t,-1),d=m[c]=p[c](t),{c(){e=F("div"),n=F("div"),o=Qe(r),i=X(),s=F("button"),s.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-b97y30"><path d="M9.88 9.88a3 3 0 1 0 4.24 4.24"></path><path d="M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68"></path><path d="M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61"></path><line x1="2" y1="2" x2="22" y2="22"></line></svg>',l=X(),d.c(),w(s,"class","hide-node-btn svelte-b97y30"),w(s,"title","\u9690\u85CF\u6B64\u8282\u70B9"),w(n,"class",a="screenshot-header level-"+(t[1]+1)+" svelte-b97y30"),w(e,"class","screenshot-node svelte-b97y30")},m(v,b){$(v,e,b),A(e,n),A(n,o),A(n,i),A(n,s),A(e,l),m[c].m(e,null),u=!0,f||(h=le(s,"click",t[12]),f=!0)},p(v,b){(!u||b&1)&&r!==(r=v[0].header+"")&&St(o,r),(!u||b&2&&a!==(a="screenshot-header level-"+(v[1]+1)+" svelte-b97y30"))&&w(n,"class",a),d.p(v,b)},i(v){u||(z(d),u=!0)},o(v){J(d),u=!1},d(v){v&&q(e),m[c].d(),f=!1,h()}}}function ks(t){var u;let e=(u=t[0].content)==null?void 0:u.trim(),n,r,o,i,s,a=e&&Ho(t),l=[Cs,Ss],c=[];function d(f,h){return f[0].level===1&&f[13]&&f[1]<f[3]?0:f[13]&&f[1]<f[3]?1:-1}return~(r=d(t,-1))&&(o=c[r]=l[r](t)),{c(){a&&a.c(),n=X(),o&&o.c(),i=_t()},m(f,h){a&&a.m(f,h),$(f,n,h),~r&&c[r].m(f,h),$(f,i,h),s=!0},p(f,h){var m;h&1&&(e=(m=f[0].content)==null?void 0:m.trim()),e?a?a.p(f,h):(a=Ho(f),a.c(),a.m(n.parentNode,n)):a&&(a.d(1),a=null);let p=r;r=d(f,h),r===p?~r&&c[r].p(f,h):(o&&(Ne(),J(c[p],1,1,()=>{c[p]=null}),Fe()),~r?(o=c[r],o?o.p(f,h):(o=c[r]=l[r](f),o.c()),z(o,1),o.m(i.parentNode,i)):o=null)},i(f){s||(z(o),s=!0)},o(f){J(o),s=!1},d(f){f&&(q(n),q(i)),a&&a.d(f),~r&&c[r].d(f)}}}function _s(t){let e,n,r,o,i;function s(d,u){var f;return u&1&&(r=null),r==null&&(r=!!((f=d[0].content)!=null&&f.trim())),r?Ms:Es}let a=s(t,-1),l=a(t),c=t[8]>0&&t[6]>0&&Po(t);return{c(){e=F("div"),n=F("div"),l.c(),o=X(),c&&c.c(),w(n,"class","screenshot-left svelte-b97y30"),w(e,"class","screenshot-layout svelte-b97y30"),we(e,"grid-template-columns",t[9])},m(d,u){$(d,e,u),A(e,n),l.m(n,null),A(e,o),c&&c.m(e,null),i=!0},p(d,u){a===(a=s(d,u))&&l?l.p(d,u):(l.d(1),l=a(d),l&&(l.c(),l.m(n,null))),d[8]>0&&d[6]>0?c?(c.p(d,u),u&320&&z(c,1)):(c=Po(d),c.c(),z(c,1),c.m(e,null)):c&&(Ne(),J(c,1,1,()=>{c=null}),Fe()),(!i||u&512)&&we(e,"grid-template-columns",d[9])},i(d){i||(z(c),i=!0)},o(d){J(c),i=!1},d(d){d&&q(e),l.d(),c&&c.d()}}}function Ho(t){let e;return{c(){e=F("div"),w(e,"class","screenshot-content svelte-b97y30"),we(e,"transform","scale("+t[10]+")"),we(e,"transform-origin","top left")},m(n,r){$(n,e,r),t[18](e)},p(n,r){r&1024&&we(e,"transform","scale("+n[10]+")")},d(n){n&&q(e),t[18](null)}}}function Ss(t){let e,n,r=ze(t[0].children),o=[];for(let s=0;s<r.length;s+=1)o[s]=Vo(No(t,r,s));let i=s=>J(o[s],1,1,()=>{o[s]=null});return{c(){e=F("div");for(let s=0;s<o.length;s+=1)o[s].c();w(e,"class","screenshot-children-vertical svelte-b97y30")},m(s,a){$(s,e,a);for(let l=0;l<o.length;l+=1)o[l]&&o[l].m(e,null);n=!0},p(s,a){if(a&63){r=ze(s[0].children);let l;for(l=0;l<r.length;l+=1){let c=No(s,r,l);o[l]?(o[l].p(c,a),z(o[l],1)):(o[l]=Vo(c),o[l].c(),z(o[l],1),o[l].m(e,null))}for(Ne(),l=r.length;l<o.length;l+=1)i(l);Fe()}},i(s){if(!n){for(let a=0;a<r.length;a+=1)z(o[a]);n=!0}},o(s){o=o.filter(Boolean);for(let a=0;a<o.length;a+=1)J(o[a]);n=!1},d(s){s&&q(e),kt(o,s)}}}function Cs(t){let e,n,r=ze(t[0].children),o=[];for(let s=0;s<r.length;s+=1)o[s]=Oo(Fo(t,r,s));let i=s=>J(o[s],1,1,()=>{o[s]=null});return{c(){e=F("div");for(let s=0;s<o.length;s+=1)o[s].c();w(e,"class","screenshot-children-vertical level-1-children svelte-b97y30")},m(s,a){$(s,e,a);for(let l=0;l<o.length;l+=1)o[l]&&o[l].m(e,null);n=!0},p(s,a){if(a&63){r=ze(s[0].children);let l;for(l=0;l<r.length;l+=1){let c=Fo(s,r,l);o[l]?(o[l].p(c,a),z(o[l],1)):(o[l]=Oo(c),o[l].c(),z(o[l],1),o[l].m(e,null))}for(Ne(),l=r.length;l<o.length;l+=1)i(l);Fe()}},i(s){if(!n){for(let a=0;a<r.length;a+=1)z(o[a]);n=!0}},o(s){o=o.filter(Boolean);for(let a=0;a<o.length;a+=1)J(o[a]);n=!1},d(s){s&&q(e),kt(o,s)}}}function Vo(t){let e,n;return e=new Wt({props:{node:t[21],level:t[1]+1,app:t[2],maxDepth:t[3],hiddenNodes:t[4],onToggleNode:t[5]}}),{c(){Ve(e.$$.fragment)},m(r,o){De(e,r,o),n=!0},p(r,o){let i={};o&1&&(i.node=r[21]),o&2&&(i.level=r[1]+1),o&4&&(i.app=r[2]),o&8&&(i.maxDepth=r[3]),o&16&&(i.hiddenNodes=r[4]),o&32&&(i.onToggleNode=r[5]),e.$set(i)},i(r){n||(z(e.$$.fragment,r),n=!0)},o(r){J(e.$$.fragment,r),n=!1},d(r){Re(e,r)}}}function Oo(t){let e,n;return e=new Wt({props:{node:t[21],level:t[1],app:t[2],maxDepth:t[3],hiddenNodes:t[4],onToggleNode:t[5]}}),{c(){Ve(e.$$.fragment)},m(r,o){De(e,r,o),n=!0},p(r,o){let i={};o&1&&(i.node=r[21]),o&2&&(i.level=r[1]),o&4&&(i.app=r[2]),o&8&&(i.maxDepth=r[3]),o&16&&(i.hiddenNodes=r[4]),o&32&&(i.onToggleNode=r[5]),e.$set(i)},i(r){n||(z(e.$$.fragment,r),n=!0)},o(r){J(e.$$.fragment,r),n=!1},d(r){Re(e,r)}}}function Es(t){let e;return{c(){e=F("div"),w(e,"class","screenshot-content-placeholder svelte-b97y30")},m(n,r){$(n,e,r)},p:ae,d(n){n&&q(e)}}}function Ms(t){let e;return{c(){e=F("div"),w(e,"class","screenshot-content svelte-b97y30"),we(e,"transform","scale("+t[10]+")"),we(e,"transform-origin","top left")},m(n,r){$(n,e,r),t[17](e)},p(n,r){r&1024&&we(e,"transform","scale("+n[10]+")")},d(n){n&&q(e),t[17](null)}}}function Po(t){let e,n,r=ze(t[0].children),o=[];for(let s=0;s<r.length;s+=1)o[s]=Bo(Do(t,r,s));let i=s=>J(o[s],1,1,()=>{o[s]=null});return{c(){e=F("div");for(let s=0;s<o.length;s+=1)o[s].c();w(e,"class","screenshot-right svelte-b97y30")},m(s,a){$(s,e,a);for(let l=0;l<o.length;l+=1)o[l]&&o[l].m(e,null);n=!0},p(s,a){if(a&63){r=ze(s[0].children);let l;for(l=0;l<r.length;l+=1){let c=Do(s,r,l);o[l]?(o[l].p(c,a),z(o[l],1)):(o[l]=Bo(c),o[l].c(),z(o[l],1),o[l].m(e,null))}for(Ne(),l=r.length;l<o.length;l+=1)i(l);Fe()}},i(s){if(!n){for(let a=0;a<r.length;a+=1)z(o[a]);n=!0}},o(s){o=o.filter(Boolean);for(let a=0;a<o.length;a+=1)J(o[a]);n=!1},d(s){s&&q(e),kt(o,s)}}}function Bo(t){let e,n;return e=new Wt({props:{node:t[21],level:t[1]+1,app:t[2],maxDepth:t[3],hiddenNodes:t[4],onToggleNode:t[5]}}),{c(){Ve(e.$$.fragment)},m(r,o){De(e,r,o),n=!0},p(r,o){let i={};o&1&&(i.node=r[21]),o&2&&(i.level=r[1]+1),o&4&&(i.app=r[2]),o&8&&(i.maxDepth=r[3]),o&16&&(i.hiddenNodes=r[4]),o&32&&(i.onToggleNode=r[5]),e.$set(i)},i(r){n||(z(e.$$.fragment,r),n=!0)},o(r){J(e.$$.fragment,r),n=!1},d(r){Re(e,r)}}}function Ls(t){let e,n,r=t[11]&&Ro(t);return{c(){r&&r.c(),e=_t()},m(o,i){r&&r.m(o,i),$(o,e,i),n=!0},p(o,[i]){o[11]?r?(r.p(o,i),i&2048&&z(r,1)):(r=Ro(o),r.c(),z(r,1),r.m(e.parentNode,e)):r&&(Ne(),J(r,1,1,()=>{r=null}),Fe())},i(o){n||(z(r),n=!0)},o(o){J(r),n=!1},d(o){o&&q(e),r&&r.d(o)}}}function Is(t,e,n){let r,o,{node:i}=e,{level:s=0}=e,{app:a}=e,{maxDepth:l=3}=e,{hiddenNodes:c=new Set}=e,{onToggleNode:d=()=>{}}=e;function u(){d(i.id)}let f=1,h=0,p="1fr",m,g=1,v=null;async function b(){var L;!m||!(!((L=i.content)===null||L===void 0)&&L.trim())||(v&&v.unload(),v=new Tn.Component,await Tn.MarkdownRenderer.render(a,i.content,m,"",v),m.querySelectorAll(".internal-link").forEach(W=>{let Y=W.textContent||"";W.replaceWith(document.createTextNode(Y))}),n(10,g=1))}let _=!1,y=i.children&&i.children.length>0,x=y&&s<l-1&&i.level!==1;tt(()=>{v&&(v.unload(),v=null)});function M(L){pe[L?"unshift":"push"](()=>{m=L,n(7,m)})}function I(L){pe[L?"unshift":"push"](()=>{m=L,n(7,m)})}return t.$$set=L=>{"node"in L&&n(0,i=L.node),"level"in L&&n(1,s=L.level),"app"in L&&n(2,a=L.app),"maxDepth"in L&&n(3,l=L.maxDepth),"hiddenNodes"in L&&n(4,c=L.hiddenNodes),"onToggleNode"in L&&n(5,d=L.onToggleNode)},t.$$.update=()=>{if(t.$$.dirty&27){e:n(11,r=s<l&&!c.has(i.id))}if(t.$$.dirty&1){e:n(8,o=i.children&&i.children.length>0?i.children.length:0)}if(t.$$.dirty&33098){e:{let L=Math.max(0,l-s-1);o===0||L<=0?(n(15,f=1),n(6,h=0),n(9,p="1fr")):(n(15,f=1),n(6,h=L),n(9,p=`${f}fr ${h}fr`))}}if(t.$$.dirty&65665){e:m&&i.content&&!_&&(n(16,_=!0),b())}},[i,s,a,l,c,d,h,m,o,p,g,r,u,y,x,f,_,M,I]}var Wt=class extends Ce{constructor(e){super(),Te(this,e,Is,Ls,Ee,{node:0,level:1,app:2,maxDepth:3,hiddenNodes:4,onToggleNode:5},xs)}},Wo=Wt;function Ts(t){Ie(t,"svelte-1p0ub1r",'.screenshot-preview.svelte-1p0ub1r{flex:1;width:100%;height:100%;display:flex;justify-content:center;align-items:flex-start;padding:20px;box-sizing:border-box;overflow-y:auto;overflow-x:hidden}.screenshot-wrapper.svelte-1p0ub1r{background:var(--background-primary);padding:20px;display:inline-flex;flex-direction:column;align-items:center;border-radius:4px;box-sizing:border-box;max-width:100%}.screenshot-container.svelte-1p0ub1r{background:linear-gradient(135deg, var(--background-primary) 0%, var(--background-secondary) 100%);padding:32px 28px 40px 28px;border-radius:16px;box-shadow:0 20px 60px rgba(0, 0, 0, 0.15);position:relative;transition:width 0.3s ease;border:5px solid transparent;background-image:linear-gradient(135deg, var(--background-primary) 0%, var(--background-secondary) 100%), linear-gradient(90deg, #6366f1, #8b5cf6, #d946ef);background-origin:border-box;background-clip:padding-box, border-box;overflow:visible;height:auto;max-width:100%;box-sizing:border-box}.screenshot-container.svelte-1p0ub1r .screenshot-node{position:relative;z-index:0}.screenshot-container.svelte-1p0ub1r::before{content:"";position:absolute;bottom:0;left:0;right:0;height:60px;background:linear-gradient(to bottom, transparent 0%, var(--background-primary) 100%);pointer-events:none;z-index:10}.screenshot-container.svelte-1p0ub1r::after{content:"Generated by GridNote";position:absolute;bottom:16px;right:24px;font-size:0.75em;opacity:0.35;font-weight:500;letter-spacing:0.8px;z-index:11;background:var(--background-primary);padding:2px 6px;border-radius:4px}.screenshot-container.full-height.svelte-1p0ub1r::before{display:none}')}function As(t){let e,n,r,o,i;return o=new Wo({props:{node:t[0],level:0,app:t[1],maxDepth:t[2],hiddenNodes:t[5],onToggleNode:t[6]}}),{c(){e=F("div"),n=F("div"),r=F("div"),Ve(o.$$.fragment),w(r,"class","screenshot-container svelte-1p0ub1r"),we(r,"width",t[3]),Z(r,"full-height",t[4]),w(n,"class","screenshot-wrapper svelte-1p0ub1r"),w(e,"class","screenshot-preview svelte-1p0ub1r")},m(s,a){$(s,e,a),A(e,n),A(n,r),De(o,r,null),t[9](n),i=!0},p(s,[a]){let l={};a&1&&(l.node=s[0]),a&2&&(l.app=s[1]),a&4&&(l.maxDepth=s[2]),a&32&&(l.hiddenNodes=s[5]),a&64&&(l.onToggleNode=s[6]),o.$set(l),(!i||a&8)&&we(r,"width",s[3]),(!i||a&16)&&Z(r,"full-height",s[4])},i(s){i||(z(o.$$.fragment,s),i=!0)},o(s){J(o.$$.fragment,s),i=!1},d(s){s&&q(e),Re(o),t[9](null)}}}function Ns(t,e,n){let{node:r}=e,{app:o}=e,{maxDepth:i=5}=e,{modalWidth:s="900px"}=e,{useFullHeight:a=!1}=e,{hiddenNodes:l=new Set}=e,{onToggleNode:c=()=>{}}=e,d;function u(){return d||null}$e(()=>{});function f(h){pe[h?"unshift":"push"](()=>{d=h,n(7,d)})}return t.$$set=h=>{"node"in h&&n(0,r=h.node),"app"in h&&n(1,o=h.app),"maxDepth"in h&&n(2,i=h.maxDepth),"modalWidth"in h&&n(3,s=h.modalWidth),"useFullHeight"in h&&n(4,a=h.useFullHeight),"hiddenNodes"in h&&n(5,l=h.hiddenNodes),"onToggleNode"in h&&n(6,c=h.onToggleNode)},[r,o,i,s,a,l,c,d,u,f]}var yr=class extends Ce{constructor(e){super(),Te(this,e,Ns,As,Ee,{node:0,app:1,maxDepth:2,modalWidth:3,useFullHeight:4,hiddenNodes:5,onToggleNode:6,getContainerElement:8},Ts)}get getContainerElement(){return this.$$.ctx[8]}},zo=yr;var B={image:new Map,background:new Map,resource:new Map,defaultStyle:new Map,baseStyle:new Map,computedStyle:new WeakMap,font:new Set,session:{styleMap:new Map,styleCache:new WeakMap,nodeMap:new Map}};function Fs(t="soft"){switch(t){case"auto":{B.session.styleMap=new Map,B.session.nodeMap=new Map;return}case"soft":{B.session.styleMap=new Map,B.session.nodeMap=new Map,B.session.styleCache=new WeakMap;return}case"full":return;case"disabled":{B.session.styleMap=new Map,B.session.nodeMap=new Map,B.session.styleCache=new WeakMap,B.computedStyle=new WeakMap,B.baseStyle=new Map,B.defaultStyle=new Map,B.image=new Map,B.background=new Map,B.resource=new Map,B.font=new Set;return}default:{B.session.styleMap=new Map,B.session.nodeMap=new Map,B.session.styleCache=new WeakMap;return}}}function Nr(t){let e=t.match(/url\((['"]?)(.*?)(\1)\)/);if(!e)return null;let n=e[2].trim();return n.startsWith("#")?null:n}function Ds(t){if(!t||t==="none")return"";let e=t.replace(/translate[XY]?\([^)]*\)/g,"");return e=e.replace(/matrix\(([^)]+)\)/g,(n,r)=>{let o=r.split(",").map(i=>i.trim());return o.length!==6?`matrix(${r})`:(o[4]="0",o[5]="0",`matrix(${o.join(", ")})`)}),e=e.replace(/matrix3d\(([^)]+)\)/g,(n,r)=>{let o=r.split(",").map(i=>i.trim());return o.length!==16?`matrix3d(${r})`:(o[12]="0",o[13]="0",`matrix3d(${o.join(", ")})`)}),e.trim().replace(/\s{2,}/g," ")}function Rn(t){if(/%[0-9A-Fa-f]{2}/.test(t))return t;try{return encodeURI(t)}catch(e){return t}}function Rs(t="[snapDOM]",{ttlMs:e=5*6e4,maxEntries:n=12}={}){let r=new Map,o=0;function i(s,a,l){if(o>=n)return;let c=Date.now();(r.get(a)||0)>c||(r.set(a,c+e),o++,s==="warn"&&console&&console.warn?console.warn(`${t} ${l}`):console&&console.error&&console.error(`${t} ${l}`))}return{warnOnce(s,a){i("warn",s,a)},errorOnce(s,a){i("error",s,a)},reset(){r.clear(),o=0}}}var qo=Rs("[snapDOM]",{ttlMs:3*6e4,maxEntries:10}),wr=new Map,An=new Map;function Hs(t){return/^data:|^blob:|^about:blank$/i.test(t)}function Vs(t,e){try{let n=typeof location!="undefined"&&location.href?location.href:"http://localhost/",r=e.includes("{url}")?e.split("{url}")[0]:e,o=new URL(r||".",n),i=new URL(t,n);if(i.origin===o.origin)return!0;let s=i.searchParams;if(s&&(s.has("url")||s.has("target")))return!0}catch(n){}return!1}function Os(t,e){if(!e||Hs(t)||Vs(t,e))return!1;try{let n=typeof location!="undefined"&&location.href?location.href:"http://localhost/",r=new URL(t,n);return typeof location!="undefined"?r.origin!==location.origin:!0}catch(n){return!!e}}function Ps(t,e){if(!e)return t;if(e.includes("{url}"))return e.replace("{urlRaw}",Rn(t)).replace("{url}",encodeURIComponent(t));if(/[?&]url=?$/.test(e))return`${e}${encodeURIComponent(t)}`;if(e.endsWith("?"))return`${e}url=${encodeURIComponent(t)}`;if(e.endsWith("/"))return`${e}${Rn(t)}`;let n=e.includes("?")?"&":"?";return`${e}${n}url=${encodeURIComponent(t)}`}function Uo(t){return new Promise((e,n)=>{let r=new FileReader;r.onload=()=>e(String(r.result||"")),r.onerror=()=>n(new Error("read_failed")),r.readAsDataURL(t)})}function Bs(t,e){var n,r;return[e.as||"blob",(n=e.timeout)!=null?n:3e3,e.useProxy||"",(r=e.errorTTL)!=null?r:8e3,t].join("|")}async function lt(t,e={}){var g,v,b;let n=(g=e.as)!=null?g:"blob",r=(v=e.timeout)!=null?v:3e3,o=e.useProxy||"",i=(b=e.errorTTL)!=null?b:8e3,s=e.headers||{},a=!!e.silent;if(/^data:/i.test(t))try{if(n==="text")return{ok:!0,data:String(t),status:200,url:t,fromCache:!1};if(n==="dataURL")return{ok:!0,data:String(t),status:200,url:t,fromCache:!1,mime:String(t).slice(5).split(";")[0]||""};let[,_="",y=""]=String(t).match(/^data:([^,]*),(.*)$/)||[],M=/;base64/i.test(_)?atob(y):decodeURIComponent(y),I=new Uint8Array([...M].map(W=>W.charCodeAt(0))),L=new Blob([I],{type:(_||"").split(";")[0]||""});return{ok:!0,data:L,status:200,url:t,fromCache:!1,mime:L.type||""}}catch(_){return{ok:!1,data:null,status:0,url:t,fromCache:!1,reason:"special_url_error"}}if(/^blob:/i.test(t))try{let _=await fetch(t);if(!_.ok)return{ok:!1,data:null,status:_.status,url:t,fromCache:!1,reason:"http_error"};let y=await _.blob(),x=y.type||_.headers.get("content-type")||"";return n==="dataURL"?{ok:!0,data:await Uo(y),status:_.status,url:t,fromCache:!1,mime:x}:n==="text"?{ok:!0,data:await y.text(),status:_.status,url:t,fromCache:!1,mime:x}:{ok:!0,data:y,status:_.status,url:t,fromCache:!1,mime:x}}catch(_){return{ok:!1,data:null,status:0,url:t,fromCache:!1,reason:"network"}}if(/^about:blank$/i.test(t))return n==="dataURL"?{ok:!0,data:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR4nGMAAQAABQABDQottAAAAABJRU5ErkJggg==",status:200,url:t,fromCache:!1,mime:"image/png"}:{ok:!0,data:n==="text"?"":new Blob([]),status:200,url:t,fromCache:!1};let l=Bs(t,{as:n,timeout:r,useProxy:o,errorTTL:i}),c=An.get(l);if(c&&c.until>Date.now())return{...c.result,fromCache:!0};c&&An.delete(l);let d=wr.get(l);if(d)return d;let u=Os(t,o)?Ps(t,o):t,f=e.credentials;if(!f)try{let _=typeof location!="undefined"&&location.href?location.href:"http://localhost/",y=new URL(t,_);f=typeof location!="undefined"&&y.origin===location.origin?"include":"omit"}catch(_){f="omit"}let h=new AbortController,p=setTimeout(()=>h.abort("timeout"),r),m=(async()=>{var _,y;try{let x=await fetch(u,{signal:h.signal,credentials:f,headers:s});if(!x.ok){let L={ok:!1,data:null,status:x.status,url:u,fromCache:!1,reason:"http_error"};if(i>0&&An.set(l,{until:Date.now()+i,result:L}),!a){let W=`${x.status} ${x.statusText||""}`.trim();qo.warnOnce(`http:${x.status}:${n}:${new URL(t,(_=location==null?void 0:location.href)!=null?_:"http://localhost/").origin}`,`HTTP error ${W} while fetching ${n} ${t}`)}return e.onError&&e.onError(L),L}if(n==="text")return{ok:!0,data:await x.text(),status:x.status,url:u,fromCache:!1};let M=await x.blob(),I=M.type||x.headers.get("content-type")||"";return n==="dataURL"?{ok:!0,data:await Uo(M),status:x.status,url:u,fromCache:!1,mime:I}:{ok:!0,data:M,status:x.status,url:u,fromCache:!1,mime:I}}catch(x){let M=x&&typeof x=="object"&&"name"in x&&x.name==="AbortError"?String(x.message||"").includes("timeout")?"timeout":"abort":"network",I={ok:!1,data:null,status:0,url:u,fromCache:!1,reason:M};if(!/^blob:/i.test(t)&&i>0&&An.set(l,{until:Date.now()+i,result:I}),!a){let L=`${M}:${n}:${new URL(t,(y=location==null?void 0:location.href)!=null?y:"http://localhost/").origin}`,W=M==="timeout"?`Timeout after ${r}ms. Consider increasing timeout or using a proxy for ${t}`:M==="abort"?`Request aborted while fetching ${n} ${t}`:`Network/CORS issue while fetching ${n} ${t}. A proxy may be required`;qo.errorOnce(L,W)}return e.onError&&e.onError(I),I}finally{clearTimeout(p),wr.delete(l)}})();return wr.set(l,m),m}function Fr(t,e){if(!e||!t.width||!t.height)return t;let n=document.createElement("canvas");n.width=t.width,n.height=t.height;let r=n.getContext("2d");return r.fillStyle=e,r.fillRect(0,0,n.width,n.height),r.drawImage(t,0,0),n}async function oi(t,e={}){if(/^((repeating-)?(linear|radial|conic)-gradient)\(/i.test(t)||t.trim()==="none")return t;let r=Nr(t);if(!r)return t;let o=Rn(r);if(B.background.has(o)){let i=B.background.get(o);return i?`url("${i}")`:"none"}try{let i=await lt(o,{as:"dataURL",useProxy:e.useProxy});return i.ok?(B.background.set(o,i.data),`url("${i.data}")`):(B.background.set(o,null),"none")}catch(i){return B.background.set(o,null),"none"}}var Ws=new Set(["meta","script","noscript","title","link","template"]),Dr=new Set(["meta","link","style","title","noscript","script","template","g","defs","use","marker","mask","clipPath","pattern","path","polygon","polyline","line","circle","ellipse","rect","filter","lineargradient","radialgradient","stop"]);function zs(t){if(t=String(t).toLowerCase(),Dr.has(t)){let i={};return B.defaultStyle.set(t,i),i}if(B.defaultStyle.has(t))return B.defaultStyle.get(t);let e=document.getElementById("snapdom-sandbox");e||(e=document.createElement("div"),e.id="snapdom-sandbox",e.setAttribute("data-snapdom-sandbox","true"),e.setAttribute("aria-hidden","true"),e.style.position="absolute",e.style.left="-9999px",e.style.top="-9999px",e.style.width="0px",e.style.height="0px",e.style.overflow="hidden",document.body.appendChild(e));let n=document.createElement(t);n.style.all="initial",e.appendChild(n);let r=getComputedStyle(n),o={};for(let i of r){if(ii(i))continue;let s=r.getPropertyValue(i);o[i]=s}return e.removeChild(n),B.defaultStyle.set(t,o),o}var qs=/(?:^|-)(animation|transition)(?:-|$)/i,Us=/^(--|view-timeline|scroll-timeline|animation-trigger|offset-|position-try|app-region|interactivity|overlay|view-transition|-webkit-locale|-webkit-user-(?:drag|modify)|-webkit-tap-highlight-color|-webkit-text-security)$/i,$s=new Set(["cursor","pointer-events","touch-action","user-select","print-color-adjust","speak","reading-flow","reading-order","anchor-name","anchor-scope","container-name","container-type","timeline-scope"]);function ii(t){let e=String(t).toLowerCase();return!!($s.has(e)||Us.test(e)||qs.test(e))}function _r(t,e){if(e=String(e||"").toLowerCase(),Dr.has(e))return"";let n=[],r=zs(e);for(let[o,i]of Object.entries(t)){if(ii(o))continue;let s=r[o];i&&i!==s&&n.push(`${o}:${i}`)}return n.sort(),n.join(";")}function js(t){let e=new Set;return t.nodeType!==Node.ELEMENT_NODE&&t.nodeType!==Node.DOCUMENT_FRAGMENT_NODE?[]:(t.tagName&&e.add(t.tagName.toLowerCase()),typeof t.querySelectorAll=="function"&&t.querySelectorAll("*").forEach(n=>e.add(n.tagName.toLowerCase())),Array.from(e))}function Gs(t){let e=new Map;for(let r of t){let o=B.defaultStyle.get(r);if(!o)continue;let i=Object.entries(o).map(([s,a])=>`${s}:${a};`).sort().join("");i&&(e.has(i)||e.set(i,[]),e.get(i).push(r))}let n="";for(let[r,o]of e.entries())n+=`${o.join(",")} { ${r} }
`;return n}function Ks(t){let e=Array.from(new Set(t.values())).filter(Boolean).sort(),n=new Map,r=1;for(let o of e)n.set(o,`c${r++}`);return n}function si(t,e=null){if(!(t instanceof Element))return window.getComputedStyle(t,e);let n=B.computedStyle.get(t);if(n||(n=new Map,B.computedStyle.set(t,n)),!n.has(e)){let r=window.getComputedStyle(t,e);n.set(e,r)}return n.get(e)}function $o(t){let e={};for(let n of t)e[n]=t.getPropertyValue(n);return e}function ai(t){let e=[],n=0,r=0;for(let o=0;o<t.length;o++){let i=t[o];i==="("&&n++,i===")"&&n--,i===","&&n===0&&(e.push(t.slice(r,o).trim()),r=o+1)}return e.push(t.slice(r).trim()),e}function zt(t,{fast:e=!1}={}){if(e)return t();"requestIdleCallback"in window?requestIdleCallback(t,{timeout:50}):setTimeout(t,1)}function Mt(){let t=typeof navigator!="undefined"&&navigator.userAgent?navigator.userAgent:"",e=/^((?!chrome|android).)*safari/i.test(t),n=/AppleWebKit/i.test(t)&&/Mobile/i.test(t)&&!/Safari/i.test(t),r=/(MicroMessenger|wxwork|WeCom|WindowsWechat|MacWechat)/i.test(t);return e||n||r}var jo=new WeakMap,Sr=new Map,Cr=0;function an(){Cr++}var Go=!1;function Xs(t=document.documentElement){var e,n;if(!Go){Go=!0;try{new MutationObserver(()=>an()).observe(t,{subtree:!0,childList:!0,characterData:!0,attributes:!0})}catch(r){}try{new MutationObserver(()=>an()).observe(document.head,{subtree:!0,childList:!0,characterData:!0,attributes:!0})}catch(r){}try{let r=document.fonts;r&&((e=r.addEventListener)==null||e.call(r,"loadingdone",an),(n=r.ready)==null||n.then(()=>an()).catch(()=>{}))}catch(r){}}}function Ys(t,e={}){let n={},r=t.getPropertyValue("visibility");for(let o=0;o<t.length;o++){let i=t[o],s=t.getPropertyValue(i);(i==="background-image"||i==="content")&&s.includes("url(")&&!s.includes("data:")&&(s="none"),n[i]=s}if(e.embedFonts){let o=["font-feature-settings","font-variation-settings","font-kerning","font-variant","font-variant-ligatures","font-optical-sizing"];for(let i of o)if(!n[i])try{let s=t.getPropertyValue(i);s&&(n[i]=s)}catch(s){}}return r==="hidden"&&(n.opacity="0"),n}var Ko=new WeakMap;function Js(t){let e=Ko.get(t);return e||(e=Object.entries(t).sort((r,o)=>r[0]<o[0]?-1:r[0]>o[0]?1:0).map(([r,o])=>`${r}:${o}`).join(";"),Ko.set(t,e),e)}function Zs(t,e=null,n={}){let r=jo.get(t);if(r&&r.epoch===Cr)return r.snapshot;let o=e||getComputedStyle(t),i=Ys(o,n);return oa(t,o,i),jo.set(t,{epoch:Cr,snapshot:i}),i}function Qs(t,e){return t&&t.session&&t.persist?t:t&&(t.styleMap||t.styleCache||t.nodeMap)?{session:t,persist:{snapshotKeyCache:Sr,defaultStyle:B.defaultStyle,baseStyle:B.baseStyle,image:B.image,resource:B.resource,background:B.background,font:B.font},options:e||{}}:{session:B.session,persist:{snapshotKeyCache:Sr,defaultStyle:B.defaultStyle,baseStyle:B.baseStyle,image:B.image,resource:B.resource,background:B.background,font:B.font},options:t||e||{}}}async function qt(t,e,n,r){var f,h,p;if(t.tagName==="STYLE")return;let o=Qs(n,r),i=o.options&&o.options.cache||"auto";if(i!=="disabled"&&Xs(document.documentElement),i==="disabled"&&!o.session.__bumpedForDisabled&&(an(),Sr.clear(),o.session.__bumpedForDisabled=!0),Dr.has((f=t.tagName)==null?void 0:f.toLowerCase())){let m=(h=t.getAttribute)==null?void 0:h.call(t,"style");m&&e.setAttribute("style",m)}let{session:s,persist:a}=o;s.styleCache.has(t)||s.styleCache.set(t,getComputedStyle(t));let l=s.styleCache.get(t),c=Zs(t,l,o.options),d=Js(c),u=a.snapshotKeyCache.get(d);if(!u){let m=((p=t.tagName)==null?void 0:p.toLowerCase())||"div";u=_r(c,m),a.snapshotKeyCache.set(d,u)}s.styleMap.set(e,u)}function ea(t){return t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof HTMLIFrameElement||t instanceof SVGElement||t instanceof HTMLObjectElement||t instanceof HTMLEmbedElement}function ta(t){return t.backgroundImage&&t.backgroundImage!=="none"||t.backgroundColor&&t.backgroundColor!=="rgba(0, 0, 0, 0)"&&t.backgroundColor!=="transparent"||(parseFloat(t.borderTopWidth)||0)>0||(parseFloat(t.borderBottomWidth)||0)>0||(parseFloat(t.paddingTop)||0)>0||(parseFloat(t.paddingBottom)||0)>0?!0:(t.overflowBlock||t.overflowY||"visible")!=="visible"}function na(t){let e=t.parentElement;if(!e)return!1;let n=getComputedStyle(e).display||"";return n.includes("flex")||n.includes("grid")}function ra(t,e){if(t.textContent&&/\S/.test(t.textContent))return!0;let n=t.firstElementChild,r=t.lastElementChild;if(n&&n.tagName==="BR"||r&&r.tagName==="BR")return!0;let o=t.scrollHeight;if(o===0)return!1;let i=parseFloat(e.paddingTop)||0,s=parseFloat(e.paddingBottom)||0;return o>i+s}function oa(t,e,n){if(t instanceof HTMLElement&&t.style&&t.style.height)return;let r=e.display||"";if(r.includes("flex")||r.includes("grid")||ea(t))return;let o=e.position;o==="absolute"||o==="fixed"||o==="sticky"||e.transform==="none"&&(ta(e)||na(t)||ra(t,e)&&(delete n.height,delete n["block-size"]))}function ia(t,e){var s,a,l;if(!(t instanceof Element)||!(e instanceof Element))return;let n=(s=t.getAttribute)==null?void 0:s.call(t,"style"),r=!!(n&&n.includes("var("));if(!r&&((a=t.attributes)!=null&&a.length)){let c=t.attributes;for(let d=0;d<c.length;d++){let u=c[d];if(u&&typeof u.value=="string"&&u.value.includes("var(")){r=!0;break}}}if(!r)return;let o;try{o=getComputedStyle(t)}catch(c){return}let i=t.style;if(i&&i.length)for(let c=0;c<i.length;c++){let d=i[c],u=i.getPropertyValue(d);if(!u||!u.includes("var("))continue;let f=o.getPropertyValue(d);if(f)try{e.style.setProperty(d,f.trim(),i.getPropertyPriority(d))}catch(h){}}if((l=t.attributes)!=null&&l.length){let c=t.attributes;for(let d=0;d<c.length;d++){let u=c[d];if(!u||typeof u.value!="string"||!u.value.includes("var("))continue;let f=u.name,h="";try{h=o.getPropertyValue(f)}catch(p){}if(h)try{e.style.setProperty(f,h.trim())}catch(p){}}}}function xr(t,e,n){return Promise.all(t.map(r=>new Promise(o=>{function i(){zt(s=>{(s&&typeof s.timeRemaining=="function"?s.timeRemaining()>0:!0)?e(r,o):i()},{fast:n})}i()})))}function sa(t){return t=t.trim(),!t||/:not\(\s*\[data-sd-slotted\]\s*\)\s*$/.test(t)?t:`${t}:not([data-sd-slotted])`}function aa(t,e,n=!0){return t.split(",").map(r=>r.trim()).filter(Boolean).map(r=>{if(r.startsWith(":where(")||r.startsWith("@"))return r;let o=n?sa(r):r;return`:where(${e} ${o})`}).join(", ")}function la(t,e){return t?(t=t.replace(/:host\(([^)]+)\)/g,(n,r)=>`:where(${e}:is(${r.trim()}))`),t=t.replace(/:host\b/g,`:where(${e})`),t=t.replace(/:host-context\(([^)]+)\)/g,(n,r)=>`:where(:where(${r.trim()}) ${e})`),t=t.replace(/::slotted\(([^)]+)\)/g,(n,r)=>`:where(${e} ${r.trim()})`),t=t.replace(/(^|})(\s*)([^@}{]+){/g,(n,r,o,i)=>{let s=aa(i,e,!0);return`${r}${o}${s}{`}),t):""}function ca(t){return t.shadowScopeSeq=(t.shadowScopeSeq||0)+1,`s${t.shadowScopeSeq}`}function da(t){let e="";try{t.querySelectorAll("style").forEach(r=>{e+=(r.textContent||"")+`
`});let n=t.adoptedStyleSheets||[];for(let r of n)try{if(r&&r.cssRules)for(let o of r.cssRules)e+=o.cssText+`
`}catch(o){}}catch(n){}return e}function ua(t,e,n){if(!e)return;let r=document.createElement("style");r.setAttribute("data-sd",n),r.textContent=e,t.insertBefore(r,t.firstChild||null)}function fa(t,e){try{let n=t.currentSrc||t.src||"";if(!n)return;e.setAttribute("src",n),e.removeAttribute("srcset"),e.removeAttribute("sizes"),e.loading="eager",e.decoding="sync"}catch(n){}}function ha(t){let e=new Set;if(!t)return e;let n=/var\(\s*(--[A-Za-z0-9_-]+)\b/g,r;for(;r=n.exec(t);)e.add(r[1]);return e}function pa(t,e){try{let r=getComputedStyle(t).getPropertyValue(e).trim();if(r)return r}catch(n){}try{let r=getComputedStyle(document.documentElement).getPropertyValue(e).trim();if(r)return r}catch(n){}return""}function ma(t,e,n){let r=[];for(let o of e){let i=pa(t,o);i&&r.push(`${o}: ${i};`)}return r.length?`${n}{${r.join("")}}
`:""}function ga(t){t&&(t.nodeType===Node.ELEMENT_NODE&&t.setAttribute("data-sd-slotted",""),t.querySelectorAll&&t.querySelectorAll("*").forEach(e=>e.setAttribute("data-sd-slotted","")))}async function va(t,e=3){let n=()=>{var i;try{return t.contentDocument||((i=t.contentWindow)==null?void 0:i.document)||null}catch(s){return null}},r=n(),o=0;for(;o<e&&(!r||!r.body&&!r.documentElement);)await new Promise(i=>setTimeout(i,0)),r=n(),o++;return r&&(r.body||r.documentElement)?r:null}function ba(t){let e=t.getBoundingClientRect(),n=0,r=0,o=0,i=0;try{let l=getComputedStyle(t);n=parseFloat(l.borderLeftWidth)||0,r=parseFloat(l.borderRightWidth)||0,o=parseFloat(l.borderTopWidth)||0,i=parseFloat(l.borderBottomWidth)||0}catch(l){}let s=Math.max(0,Math.round(e.width-(n+r))),a=Math.max(0,Math.round(e.height-(o+i)));return{contentWidth:s,contentHeight:a,rect:e}}function ya(t,e,n){let r=t.createElement("style");return r.setAttribute("data-sd-iframe-pin",""),r.textContent=`html, body {margin: 0 !important;padding: 0 !important;width: ${e}px !important;height: ${n}px !important;min-width: ${e}px !important;min-height: ${n}px !important;box-sizing: border-box !important;overflow: hidden !important;background-clip: border-box !important;}`,(t.head||t.documentElement).appendChild(r),()=>{try{r.remove()}catch(o){}}}async function wa(t,e,n){let r=await va(t,3);if(!r)throw new Error("iframe document not accessible/ready");let{contentWidth:o,contentHeight:i,rect:s}=ba(t),a=n==null?void 0:n.snap;if(!a||typeof a.toPng!="function")throw new Error("snapdom.toPng not available in iframe or window");let l={...n,scale:1},c=ya(r,o,i),d;try{d=await a.toPng(r.documentElement,l)}finally{c()}d.style.display="block",d.style.width=`${o}px`,d.style.height=`${i}px`;let u=document.createElement("div");return e.nodeMap.set(u,t),qt(t,u,e,n),u.style.overflow="hidden",u.style.display="block",u.style.width||(u.style.width=`${Math.round(s.width)}px`),u.style.height||(u.style.height=`${Math.round(s.height)}px`),u.appendChild(d),u}async function Fn(t,e,n){var c,d,u,f,h,p;if(!t)throw new Error("Invalid node");let r=new Set,o=null,i=null;if(t.nodeType===Node.ELEMENT_NODE){let m=(t.localName||t.tagName||"").toLowerCase();if(t.id==="snapdom-sandbox"||t.hasAttribute("data-snapdom-sandbox")||Ws.has(m))return null}if(t.nodeType===Node.TEXT_NODE||t.nodeType!==Node.ELEMENT_NODE)return t.cloneNode(!0);if(t.getAttribute("data-capture")==="exclude"){if(n.excludeMode==="hide"){let m=document.createElement("div"),g=t.getBoundingClientRect();return m.style.cssText=`display:inline-block;width:${g.width}px;height:${g.height}px;visibility:hidden;`,m}else if(n.excludeMode==="remove")return null}if(n.exclude&&Array.isArray(n.exclude))for(let m of n.exclude)try{if((c=t.matches)!=null&&c.call(t,m)){if(n.excludeMode==="hide"){let g=document.createElement("div"),v=t.getBoundingClientRect();return g.style.cssText=`display:inline-block;width:${v.width}px;height:${v.height}px;visibility:hidden;`,g}else if(n.excludeMode==="remove")return null}}catch(g){console.warn(`Invalid selector in exclude option: ${m}`,g)}if(typeof n.filter=="function")try{if(!n.filter(t)){if(n.filterMode==="hide"){let m=document.createElement("div"),g=t.getBoundingClientRect();return m.style.cssText=`display:inline-block;width:${g.width}px;height:${g.height}px;visibility:hidden;`,m}else if(n.filterMode==="remove")return null}}catch(m){console.warn("Error in filter function:",m)}if(t.tagName==="IFRAME"){let m=!1;try{m=!!(t.contentDocument||(d=t.contentWindow)!=null&&d.document)}catch(g){m=!1}if(m)try{return await wa(t,e,n)}catch(g){console.warn("[SnapDOM] iframe rasterization failed, fallback:",g)}if(n.placeholders){let g=document.createElement("div");return g.style.cssText=`width:${t.offsetWidth}px;height:${t.offsetHeight}px;background-image:repeating-linear-gradient(45deg,#ddd,#ddd 5px,#f9f9f9 5px,#f9f9f9 10px);display:flex;align-items:center;justify-content:center;font-size:12px;color:#555;border:1px solid #aaa;`,qt(t,g,e,n),g}else{let g=t.getBoundingClientRect(),v=document.createElement("div");return v.style.cssText=`display:inline-block;width:${g.width}px;height:${g.height}px;visibility:hidden;`,qt(t,v,e,n),v}}if(t.getAttribute("data-capture")==="placeholder"){let m=t.cloneNode(!1);e.nodeMap.set(m,t),qt(t,m,e,n);let g=document.createElement("div");return g.textContent=t.getAttribute("data-placeholder-text")||"",g.style.cssText="color:#666;font-size:12px;text-align:center;line-height:1.4;padding:0.5em;box-sizing:border-box;",m.appendChild(g),m}if(t.tagName==="CANVAS"){let m=t.toDataURL(),g=document.createElement("img");return g.src=m,g.width=t.width,g.height=t.height,e.nodeMap.set(g,t),qt(t,g,e,n),g}let s;try{if(s=t.cloneNode(!1),ia(t,s),e.nodeMap.set(s,t),t.tagName==="IMG"){fa(t,s);try{let m=t.getBoundingClientRect(),g=Math.round(m.width||0),v=Math.round(m.height||0);if(!g||!v){let b=window.getComputedStyle(t),_=parseFloat(b.width)||0,y=parseFloat(b.height)||0,x=parseInt(t.getAttribute("width")||"",10)||0,M=parseInt(t.getAttribute("height")||"",10)||0,I=t.width||t.naturalWidth||0,L=t.height||t.naturalHeight||0;g=Math.round(g||_||x||I||0),v=Math.round(v||y||M||L||0)}g&&(s.dataset.snapdomWidth=String(g)),v&&(s.dataset.snapdomHeight=String(v))}catch(m){}}}catch(m){throw console.error("[Snapdom] Failed to clone node:",t,m),m}if(t instanceof HTMLTextAreaElement){let m=t.getBoundingClientRect();s.style.width=`${m.width}px`,s.style.height=`${m.height}px`}if(t instanceof HTMLInputElement&&(s.value=t.value,s.setAttribute("value",t.value),t.checked!==void 0&&(s.checked=t.checked,t.checked&&s.setAttribute("checked",""),t.indeterminate&&(s.indeterminate=t.indeterminate))),t instanceof HTMLSelectElement&&(o=t.value),t instanceof HTMLTextAreaElement&&(i=t.value),qt(t,s,e,n),t.shadowRoot){let m=function(L,W){if(L.nodeType===Node.ELEMENT_NODE&&L.tagName==="STYLE")return W(null);Fn(L,e,n).then(Y=>{W(Y||null)}).catch(()=>{W(null)})};try{let L=t.shadowRoot.querySelectorAll("slot");for(let W of L){let Y=[];try{Y=((u=W.assignedNodes)==null?void 0:u.call(W,{flatten:!0}))||((f=W.assignedNodes)==null?void 0:f.call(W))||[]}catch(Q){Y=((h=W.assignedNodes)==null?void 0:h.call(W))||[]}for(let Q of Y)r.add(Q)}}catch(L){}let g=ca(e),v=`[data-sd="${g}"]`;try{s.setAttribute("data-sd",g)}catch(L){}let b=da(t.shadowRoot),_=la(b,v),y=ha(b),x=ma(t,y,v);ua(s,x+_,g);let M=document.createDocumentFragment(),I=await xr(Array.from(t.shadowRoot.childNodes),m,n.fast);M.append(...I.filter(L=>!!L)),s.appendChild(M)}if(t.tagName==="SLOT"){let m=function(y,x){Fn(y,e,n).then(M=>{M&&ga(M),x(M||null)}).catch(()=>{x(null)})},g=((p=t.assignedNodes)==null?void 0:p.call(t,{flatten:!0}))||[],v=g.length>0?g:Array.from(t.childNodes),b=document.createDocumentFragment(),_=await xr(Array.from(v),m,n.fast);return b.append(..._.filter(y=>!!y)),b}function a(m,g){if(r.has(m))return g(null);Fn(m,e,n).then(v=>{g(v||null)}).catch(()=>{g(null)})}let l=await xr(Array.from(t.childNodes),a,n.fast);if(s.append(...l.filter(m=>!!m)),o!==null&&s instanceof HTMLSelectElement){s.value=o;for(let m of s.options)m.value===o?m.setAttribute("selected",""):m.removeAttribute("selected")}return i!==null&&s instanceof HTMLTextAreaElement&&(s.textContent=i),s}var xa=[/font\s*awesome/i,/material\s*icons/i,/ionicons/i,/glyphicons/i,/feather/i,/bootstrap\s*icons/i,/remix\s*icons/i,/heroicons/i,/layui/i,/lucide/i],Er=[];function ka(t){let e=Array.isArray(t)?t:[t];for(let n of e)n instanceof RegExp?Er.push(n):typeof n=="string"?Er.push(new RegExp(n,"i")):console.warn("[snapdom] Ignored invalid iconFont value:",n)}function mt(t){let e=typeof t=="string"?t:"",n=[...xa,...Er];for(let r of n)if(r instanceof RegExp&&r.test(e))return!0;return!!(/icon/i.test(e)||/glyph/i.test(e)||/symbols/i.test(e)||/feather/i.test(e)||/fontawesome/i.test(e))}async function _a(t,e,n,r=32,o="#000"){e=e.replace(/^['"]+|['"]+$/g,"");let i=window.devicePixelRatio||1;try{await document.fonts.ready}catch(f){}let s=document.createElement("span");s.textContent=t,s.style.position="absolute",s.style.visibility="hidden",s.style.fontFamily=`"${e}"`,s.style.fontWeight=n||"normal",s.style.fontSize=`${r}px`,s.style.lineHeight="1",s.style.whiteSpace="nowrap",s.style.padding="0",s.style.margin="0",document.body.appendChild(s);let a=s.getBoundingClientRect(),l=Math.ceil(a.width),c=Math.ceil(a.height);document.body.removeChild(s);let d=document.createElement("canvas");d.width=Math.max(1,l*i),d.height=Math.max(1,c*i);let u=d.getContext("2d");return u.scale(i,i),u.font=n?`${n} ${r}px "${e}"`:`${r}px "${e}"`,u.textAlign="left",u.textBaseline="top",u.fillStyle=o,u.fillText(t,0,0),{dataUrl:d.toDataURL(),width:l,height:c}}var Sa=new Set(["serif","sans-serif","monospace","cursive","fantasy","system-ui","emoji","math","fangsong","ui-serif","ui-sans-serif","ui-monospace","ui-rounded"]);function Vn(t){if(!t)return"";for(let e of t.split(",")){let n=e.trim().replace(/^['"]+|['"]+$/g,"");if(n&&!Sa.has(n.toLowerCase()))return n}return""}function Dn(t){let e=String(t!=null?t:"400").trim().toLowerCase();if(e==="normal")return 400;if(e==="bold")return 700;let n=parseInt(e,10);return Number.isFinite(n)?Math.min(900,Math.max(100,n)):400}function Mr(t){let e=String(t!=null?t:"normal").trim().toLowerCase();return e.startsWith("italic")?"italic":e.startsWith("oblique")?"oblique":"normal"}function Ca(t){let e=String(t!=null?t:"100%").match(/(\d+(?:\.\d+)?)\s*%/);return e?Math.max(50,Math.min(200,parseFloat(e[1]))):100}function Ea(t){let e=String(t||"400").trim(),n=e.match(/^(\d{2,3})\s+(\d{2,3})$/);if(n){let o=Dn(n[1]),i=Dn(n[2]);return{min:Math.min(o,i),max:Math.max(o,i)}}let r=Dn(e);return{min:r,max:r}}function Ma(t){let e=String(t||"normal").trim().toLowerCase();return e==="italic"?{kind:"italic"}:e.startsWith("oblique")?{kind:"oblique"}:{kind:"normal"}}function La(t){let e=String(t||"100%").trim(),n=e.match(/(\d+(?:\.\d+)?)\s*%\s+(\d+(?:\.\d+)?)\s*%/);if(n){let i=parseFloat(n[1]),s=parseFloat(n[2]);return{min:Math.min(i,s),max:Math.max(i,s)}}let r=e.match(/(\d+(?:\.\d+)?)\s*%/),o=r?parseFloat(r[1]):100;return{min:o,max:o}}function Ia(t,e){if(!t)return!1;try{let n=new URL(t,location.href);if(n.origin===location.origin)return!0;let o=n.host.toLowerCase();if(["fonts.googleapis.com","fonts.gstatic.com","use.typekit.net","p.typekit.net","kit.fontawesome.com","use.fontawesome.com"].some(a=>o.endsWith(a)))return!0;let s=(n.pathname+n.search).toLowerCase();if(/\bfont(s)?\b/.test(s)||/\.woff2?(\b|$)/.test(s))return!0;for(let a of e){let l=a.toLowerCase().replace(/\s+/g,"+"),c=a.toLowerCase().replace(/\s+/g,"-");if(s.includes(l)||s.includes(c))return!0}return!1}catch(n){return!1}}function Ta(t){var n;let e=new Set;for(let r of t||[]){let o=(n=String(r).split("__")[0])==null?void 0:n.trim();o&&e.add(o)}return e}function Xo(t,e){return t&&t.replace(/url\(\s*(['"]?)([^)'"]+)\1\s*\)/g,(n,r,o)=>{let i=(o||"").trim();if(!i||/^data:|^blob:|^https?:|^file:|^about:/i.test(i))return n;let s=i;try{s=new URL(i,e||location.href).href}catch(a){}return`url("${s}")`})}var Lr=/@import\s+(?:url\(\s*(['"]?)([^)"']+)\1\s*\)|(['"])([^"']+)\3)([^;]*);/g,Hn=4;async function Aa(t,e,n){if(!t)return t;let r=new Set;function o(a,l){try{return new URL(a,l||location.href).href}catch(c){return a}}async function i(a,l,c=0){if(c>Hn)return console.warn(`[snapDOM] @import depth exceeded (${Hn}) at ${l}`),a;let d="",u=0,f;for(;f=Lr.exec(a);){d+=a.slice(u,f.index),u=Lr.lastIndex;let h=(f[2]||f[4]||"").trim(),p=o(h,l);if(r.has(p)){console.warn(`[snapDOM] Skipping circular @import: ${p}`);continue}r.add(p);let m="";try{let g=await lt(p,{as:"text",useProxy:n,silent:!0});g.ok&&typeof g.data=="string"&&(m=g.data)}catch(g){}m?(m=Xo(m,p),m=await i(m,p,c+1),d+=`
/* inlined: ${p} */
${m}
`):d+=f[0]}return d+=a.slice(u),d}let s=Xo(t,e||location.href);return s=await i(s,e||location.href,0),s}var li=/url\((["']?)([^"')]+)\1\)/g,Na=/@font-face[^{}]*\{[^}]*\}/g;function ci(t){if(!t)return[];let e=[],n=t.split(",").map(r=>r.trim()).filter(Boolean);for(let r of n){let o=r.match(/^U\+([0-9A-Fa-f?]+)(?:-([0-9A-Fa-f?]+))?$/);if(!o)continue;let i=o[1],s=o[2],a=l=>{if(!l.includes("?"))return parseInt(l,16);let c=parseInt(l.replace(/\?/g,"0"),16),d=parseInt(l.replace(/\?/g,"F"),16);return[c,d]};if(s){let l=a(i),c=a(s),d=Array.isArray(l)?l[0]:l,u=Array.isArray(c)?c[1]:c;e.push([Math.min(d,u),Math.max(d,u)])}else{let l=a(i);Array.isArray(l)?e.push([l[0],l[1]]):e.push([l,l])}}return e}function di(t,e){if(!e.length||!t||t.size===0)return!0;for(let n of t)for(let[r,o]of e)if(n>=r&&n<=o)return!0;return!1}function Rr(t,e){let n=[];if(!t)return n;for(let r of t.matchAll(li)){let o=(r[2]||"").trim();if(!(!o||o.startsWith("data:"))){if(!/^https?:/i.test(o))try{o=new URL(o,e||location.href).href}catch(i){}n.push(o)}}return n}async function ui(t,e,n=""){var o,i,s,a,l;let r=t;for(let c of t.matchAll(li)){let d=Nr(c[0]);if(!d)continue;let u=d;if(!u.startsWith("http")&&!u.startsWith("data:"))try{u=new URL(u,e||location.href).href}catch(f){}if(!mt(u)){if((o=B.resource)!=null&&o.has(u)){(i=B.font)==null||i.add(u),r=r.replace(c[0],`url(${B.resource.get(u)})`);continue}if(!((s=B.font)!=null&&s.has(u)))try{let f=await lt(u,{as:"dataURL",useProxy:n,silent:!0});if(f.ok&&typeof f.data=="string"){let h=f.data;(a=B.resource)==null||a.set(u,h),(l=B.font)==null||l.add(u),r=r.replace(c[0],`url(${h})`)}}catch(f){console.warn("[snapDOM] Failed to fetch font resource:",u)}}}return r}function Fa(t){if(!t.length)return null;let e=(a,l)=>t.some(([c,d])=>!(d<a||c>l)),n=e(0,255)||e(305,305),r=e(256,591)||e(7680,7935),o=e(880,1023),i=e(1024,1279);return e(7840,7929)||e(258,259)||e(416,417)||e(431,432)?"vietnamese":i?"cyrillic":o?"greek":r?"latin-ext":n?"latin":null}function Yo(t={}){let e=new Set((t.families||[]).map(o=>String(o).toLowerCase())),n=new Set((t.domains||[]).map(o=>String(o).toLowerCase())),r=new Set((t.subsets||[]).map(o=>String(o).toLowerCase()));return(o,i)=>{if(e.size&&e.has(o.family.toLowerCase()))return!0;if(n.size)for(let s of o.srcUrls)try{if(n.has(new URL(s).host.toLowerCase()))return!0}catch(a){}if(r.size){let s=Fa(i);if(s&&r.has(s))return!0}return!1}}function Da(t){var i,s,a,l,c,d;if(!t)return t;let e=/@font-face[^{}]*\{[^}]*\}/gi,n=new Set,r=[];for(let u of t.match(e)||[]){let f=((i=u.match(/font-family:\s*([^;]+);/i))==null?void 0:i[1])||"",h=Vn(f),p=(((s=u.match(/font-weight:\s*([^;]+);/i))==null?void 0:s[1])||"400").trim(),m=(((a=u.match(/font-style:\s*([^;]+);/i))==null?void 0:a[1])||"normal").trim(),g=(((l=u.match(/font-stretch:\s*([^;]+);/i))==null?void 0:l[1])||"100%").trim(),v=(((c=u.match(/unicode-range:\s*([^;]+);/i))==null?void 0:c[1])||"").trim(),b=(((d=u.match(/src\s*:\s*([^;]+);/i))==null?void 0:d[1])||"").trim(),_=Rr(b,location.href),y=_.length?_.map(M=>String(M).toLowerCase()).sort().join("|"):b.toLowerCase(),x=[String(h||"").toLowerCase(),p,m,g,v.toLowerCase(),y].join("|");n.has(x)||(n.add(x),r.push(u))}if(r.length===0)return t;let o=0;return t.replace(e,()=>r[o++]||"")}function Ra(t,e,n,r){let o=Array.from(t||[]).sort().join("|"),i=e?JSON.stringify({families:(e.families||[]).map(l=>String(l).toLowerCase()).sort(),domains:(e.domains||[]).map(l=>String(l).toLowerCase()).sort(),subsets:(e.subsets||[]).map(l=>String(l).toLowerCase()).sort()}):"",s=(n||[]).map(l=>`${(l.family||"").toLowerCase()}::${l.weight||"normal"}::${l.style||"normal"}::${l.src||""}`).sort().join("|");return`fonts-embed-css::req=${o}::ex=${i}::lf=${s}::px=${r||""}`}async function fi(t,e,n,r){let o;try{o=t.cssRules||[]}catch(s){return}let i=(s,a)=>{try{return new URL(s,a||location.href).href}catch(l){return s}};for(let s of o){if(s.type===CSSRule.IMPORT_RULE&&s.styleSheet){let a=s.href?i(s.href,e):e;if(r.depth>=Hn){console.warn(`[snapDOM] CSSOM import depth exceeded (${Hn}) at ${a}`);continue}if(a&&r.visitedSheets.has(a)){console.warn(`[snapDOM] Skipping circular CSSOM import: ${a}`);continue}a&&r.visitedSheets.add(a);let l={...r,depth:(r.depth||0)+1};await fi(s.styleSheet,a,n,l);continue}if(s.type===CSSRule.FONT_FACE_RULE){let a=(s.style.getPropertyValue("font-family")||"").trim(),l=Vn(a);if(!l||mt(l))continue;let c=(s.style.getPropertyValue("font-weight")||"400").trim(),d=(s.style.getPropertyValue("font-style")||"normal").trim(),u=(s.style.getPropertyValue("font-stretch")||"100%").trim(),f=(s.style.getPropertyValue("src")||"").trim(),h=(s.style.getPropertyValue("unicode-range")||"").trim();if(!r.faceMatchesRequired(l,d,c,u))continue;let p=ci(h);if(!di(r.usedCodepoints,p))continue;let m={family:l,weightSpec:c,styleSpec:d,stretchSpec:u,unicodeRange:h,srcRaw:f,srcUrls:Rr(f,e||location.href),href:e||location.href};if(r.simpleExcluder&&r.simpleExcluder(m,p))continue;if(/url\(/i.test(f)){let g=await ui(f,e||location.href,r.useProxy);await n(`@font-face{font-family:${l};src:${g};font-style:${d};font-weight:${c};font-stretch:${u};${h?`unicode-range:${h};`:""}}`)}else await n(`@font-face{font-family:${l};src:${f};font-style:${d};font-weight:${c};font-stretch:${u};${h?`unicode-range:${h};`:""}}`)}}}async function Ha({required:t,usedCodepoints:e,exclude:n=void 0,localFonts:r=[],useProxy:o=""}={}){var m,g,v,b,_,y,x,M,I,L,W,Y,Q,de,oe,Me,ee,ve;t instanceof Set||(t=new Set),e instanceof Set||(e=new Set);let i=new Map;for(let H of t){let[R,O,G,K]=String(H).split("__");if(!R)continue;let U=i.get(R)||[];U.push({w:parseInt(O,10),s:G,st:parseInt(K,10)}),i.set(R,U)}function s(H,R,O,G){if(!i.has(H))return!1;let K=i.get(H),U=Ea(O),re=Ma(R),ue=La(G),ge=U.min!==U.max,ie=U.min,He=C=>re.kind==="normal"&&C==="normal"||re.kind!=="normal"&&(C==="italic"||C==="oblique"),D=!1;for(let C of K){let P=ge?C.w>=U.min&&C.w<=U.max:C.w===ie,E=He(Mr(C.s)),T=C.st>=ue.min&&C.st<=ue.max;if(P&&E&&T){D=!0;break}}if(D)return!0;if(!ge)for(let C of K){let P=He(Mr(C.s)),E=C.st>=ue.min&&C.st<=ue.max;if(Math.abs(ie-C.w)<=300&&P&&E)return!0}return!1}let a=Yo(n),l=Ra(t,n,r,o);if((m=B.resource)!=null&&m.has(l))return B.resource.get(l);let c=Ta(t),d=[],u=Lr;for(let H of document.querySelectorAll("style")){let R=H.textContent||"";for(let O of R.matchAll(u)){let G=(O[2]||O[4]||"").trim();if(!G||mt(G))continue;!!document.querySelector(`link[rel="stylesheet"][href="${G}"]`)||d.push(G)}}d.length&&await Promise.all(d.map(H=>new Promise(R=>{if(document.querySelector(`link[rel="stylesheet"][href="${H}"]`))return R(null);let O=document.createElement("link");O.rel="stylesheet",O.href=H,O.setAttribute("data-snapdom","injected-import"),O.onload=()=>R(O),O.onerror=()=>R(null),document.head.appendChild(O)})));let f="",h=Array.from(document.querySelectorAll('link[rel="stylesheet"]')).filter(H=>!!H.href);for(let H of h)try{if(mt(H.href))continue;let R="",O=!1;try{O=new URL(H.href,location.href).origin===location.origin}catch(K){}if(!O&&!Ia(H.href,c))continue;if(O){let K=Array.from(document.styleSheets).find(U=>U.href===H.href);if(K)try{let U=K.cssRules||[];R=Array.from(U).map(re=>re.cssText).join("")}catch(U){}}if(!R&&(R=(await lt(H.href,{as:"text",useProxy:o})).data,mt(H.href)))continue;R=await Aa(R,H.href,o);let G="";for(let K of R.match(Na)||[]){let U=(((g=K.match(/font-family:\s*([^;]+);/i))==null?void 0:g[1])||"").trim(),re=Vn(U);if(!re||mt(re))continue;let ue=(((v=K.match(/font-weight:\s*([^;]+);/i))==null?void 0:v[1])||"400").trim(),ge=(((b=K.match(/font-style:\s*([^;]+);/i))==null?void 0:b[1])||"normal").trim(),ie=(((_=K.match(/font-stretch:\s*([^;]+);/i))==null?void 0:_[1])||"100%").trim(),He=(((y=K.match(/unicode-range:\s*([^;]+);/i))==null?void 0:y[1])||"").trim(),D=(((x=K.match(/src\s*:\s*([^;]+);/i))==null?void 0:x[1])||"").trim(),C=Rr(D,H.href);if(!s(re,ge,ue,ie))continue;let P=ci(He);if(!di(e,P))continue;let E={family:re,weightSpec:ue,styleSpec:ge,stretchSpec:ie,unicodeRange:He,srcRaw:D,srcUrls:C,href:H.href};if(n&&a(E,P))continue;let T=/url\(/i.test(D)?await ui(K,H.href,o):K;G+=T}G.trim()&&(f+=G)}catch(R){console.warn("[snapDOM] Failed to process stylesheet:",H.href)}let p={requiredIndex:i,usedCodepoints:e,faceMatchesRequired:s,simpleExcluder:n?Yo(n):null,useProxy:o,visitedSheets:new Set,depth:0};for(let H of document.styleSheets)if(!(H.href&&h.some(R=>R.href===H.href)))try{let R=H.href||location.href;R&&p.visitedSheets.add(R),await fi(H,R,async O=>{f+=O},p)}catch(R){}try{for(let H of document.fonts||[]){if(!H||!H.family||H.status!=="loaded"||!H._snapdomSrc)continue;let R=String(H.family).replace(/^['"]+|['"]+$/g,"");if(mt(R)||!i.has(R)||n!=null&&n.families&&n.families.some(G=>String(G).toLowerCase()===R.toLowerCase()))continue;let O=H._snapdomSrc;if(!String(O).startsWith("data:")){if((M=B.resource)!=null&&M.has(H._snapdomSrc))O=B.resource.get(H._snapdomSrc),(I=B.font)==null||I.add(H._snapdomSrc);else if(!((L=B.font)!=null&&L.has(H._snapdomSrc)))try{let G=await lt(H._snapdomSrc,{as:"dataURL",useProxy:o,silent:!0});if(G.ok&&typeof G.data=="string")O=G.data,(W=B.resource)==null||W.set(H._snapdomSrc,O),(Y=B.font)==null||Y.add(H._snapdomSrc);else continue}catch(G){console.warn("[snapDOM] Failed to fetch dynamic font src:",H._snapdomSrc);continue}}f+=`@font-face{font-family:'${R}';src:url(${O});font-style:${H.style||"normal"};font-weight:${H.weight||"normal"};}`}}catch(H){}for(let H of r){if(!H||typeof H!="object")continue;let R=String(H.family||"").replace(/^['"]+|['"]+$/g,"");if(!R||mt(R)||!i.has(R)||n!=null&&n.families&&n.families.some(ue=>String(ue).toLowerCase()===R.toLowerCase()))continue;let O=H.weight!=null?String(H.weight):"normal",G=H.style!=null?String(H.style):"normal",K=H.stretchPct!=null?`${H.stretchPct}%`:"100%",U=String(H.src||""),re=U;if(!re.startsWith("data:")){if((Q=B.resource)!=null&&Q.has(U))re=B.resource.get(U),(de=B.font)==null||de.add(U);else if(!((oe=B.font)!=null&&oe.has(U)))try{let ue=await lt(U,{as:"dataURL",useProxy:o,silent:!0});if(ue.ok&&typeof ue.data=="string")re=ue.data,(Me=B.resource)==null||Me.set(U,re),(ee=B.font)==null||ee.add(U);else continue}catch(ue){console.warn("[snapDOM] Failed to fetch localFonts src:",U);continue}}f+=`@font-face{font-family:'${R}';src:url(${re});font-style:${G};font-weight:${O};font-stretch:${K};}`}return f&&(f=Da(f),(ve=B.resource)==null||ve.set(l,f)),f}function Va(t){let e=new Set;if(!t)return e;let n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,null),r=s=>{let a=Vn(s.fontFamily);if(!a)return;let l=(c,d,u)=>`${a}__${Dn(c)}__${Mr(d)}__${Ca(u)}`;e.add(l(s.fontWeight,s.fontStyle,s.fontStretch))};r(getComputedStyle(t));let o=getComputedStyle(t,"::before");o&&o.content&&o.content!=="none"&&r(o);let i=getComputedStyle(t,"::after");for(i&&i.content&&i.content!=="none"&&r(i);n.nextNode();){let s=n.currentNode,a=getComputedStyle(s);r(a);let l=getComputedStyle(s,"::before");l&&l.content&&l.content!=="none"&&r(l);let c=getComputedStyle(s,"::after");c&&c.content&&c.content!=="none"&&r(c)}return e}function Oa(t){let e=new Set,n=o=>{if(o)for(let i of o)e.add(i.codePointAt(0))},r=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT,null);for(;r.nextNode();){let o=r.currentNode;if(o.nodeType===Node.TEXT_NODE)n(o.nodeValue||"");else if(o.nodeType===Node.ELEMENT_NODE){let i=o;for(let s of["::before","::after"]){let a=getComputedStyle(i,s),l=a==null?void 0:a.getPropertyValue("content");if(!(!l||l==="none"))if(/^"/.test(l)||/^'/.test(l))n(l.slice(1,-1));else{let c=l.match(/\\[0-9A-Fa-f]{1,6}/g);if(c)for(let d of c)try{e.add(parseInt(d.slice(1),16))}catch(u){}}}}}return e}async function Pa(t,e=2){try{await document.fonts.ready}catch(o){}let n=Array.from(t||[]).filter(Boolean);if(n.length===0)return;let r=()=>{let o=document.createElement("div");o.style.cssText="position:absolute!important;left:-9999px!important;top:0!important;opacity:0!important;pointer-events:none!important;contain:layout size style;";for(let i of n){let s=document.createElement("span");s.textContent="AaBbGg1234\xC1\xC9\xCD\xD3\xDA\xE7\xF1\u2014\u221E",s.style.fontFamily=`"${i}"`,s.style.fontWeight="700",s.style.fontStyle="italic",s.style.fontSize="32px",s.style.lineHeight="1",s.style.whiteSpace="nowrap",s.style.margin="0",s.style.padding="0",o.appendChild(s)}document.body.appendChild(o),o.offsetWidth,document.body.removeChild(o)};for(let o=0;o<Math.max(1,e);o++)r(),await new Promise(i=>requestAnimationFrame(()=>requestAnimationFrame(i)))}function Ba(t){return/\bcounter\s*\(|\bcounters\s*\(/.test(t||"")}function Wa(t){return(t||"").replace(/"([^"]*)"/g,"$1")}function Jo(t,e=!1){let n="",r=Math.max(1,t);for(;r>0;)r--,n=String.fromCharCode(97+r%26)+n,r=Math.floor(r/26);return e?n.toUpperCase():n}function Zo(t,e=!0){let n=[[1e3,"M"],[900,"CM"],[500,"D"],[400,"CD"],[100,"C"],[90,"XC"],[50,"L"],[40,"XL"],[10,"X"],[9,"IX"],[5,"V"],[4,"IV"],[1,"I"]],r=Math.max(1,Math.min(3999,t)),o="";for(let[i,s]of n)for(;r>=i;)o+=s,r-=i;return e?o:o.toLowerCase()}function Qo(t,e){switch((e||"decimal").toLowerCase()){case"decimal":return String(Math.max(0,t));case"decimal-leading-zero":return(t<10?"0":"")+String(Math.max(0,t));case"lower-alpha":return Jo(t,!1);case"upper-alpha":return Jo(t,!0);case"lower-roman":return Zo(t,!1);case"upper-roman":return Zo(t,!0);default:return String(Math.max(0,t))}}function za(t){let e=new WeakMap,n=t instanceof Document?t.documentElement:t,r=c=>c&&c.tagName==="LI",o=c=>{let d=0,u=c==null?void 0:c.parentElement;if(!u)return 0;for(let f of u.children){if(f===c)break;f.tagName==="LI"&&d++}return d},i=c=>{let d=new Map;for(let[u,f]of c)d.set(u,f.slice());return d},s=(c,d,u)=>{var m,g;let f=i(c),h;try{h=((m=u.style)==null?void 0:m.counterReset)||getComputedStyle(u).counterReset}catch(v){}if(h&&h!=="none")for(let v of h.split(",")){let b=v.trim().split(/\s+/),_=b[0],y=Number.isFinite(Number(b[1]))?Number(b[1]):0;if(!_)continue;let x=d.get(_);if(x&&x.length){let M=x.slice();M.push(y),f.set(_,M)}else f.set(_,[y])}let p;try{p=((g=u.style)==null?void 0:g.counterIncrement)||getComputedStyle(u).counterIncrement}catch(v){}if(p&&p!=="none")for(let v of p.split(",")){let b=v.trim().split(/\s+/),_=b[0],y=Number.isFinite(Number(b[1]))?Number(b[1]):1;if(!_)continue;let x=f.get(_)||[];x.length===0&&x.push(0),x[x.length-1]+=y,f.set(_,x)}try{if(getComputedStyle(u).display==="list-item"&&r(u)){let b=u.parentElement,_=1;if(b&&b.tagName==="OL"){let x=b.getAttribute("start"),M=Number.isFinite(Number(x))?Number(x):1,I=o(u),L=u.getAttribute("value");_=Number.isFinite(Number(L))?Number(L):M+I}else _=1+o(u);let y=f.get("list-item")||[];y.length===0&&y.push(0),y[y.length-1]=_,f.set("list-item",y)}}catch(v){}return f},a=(c,d,u)=>{let f=s(u,d,c);e.set(c,f);let h=f;for(let p of c.children)h=a(p,f,h);return f},l=new Map;return a(n,l,l),{get(c,d){var f;let u=(f=e.get(c))==null?void 0:f.get(d);return u&&u.length?u[u.length-1]:0},getStack(c,d){var f;let u=(f=e.get(c))==null?void 0:f.get(d);return u?u.slice():[]}}}function qa(t,e,n){if(!t||t==="none")return t;try{let r=/\b(counter|counters)\s*\(([^)]+)\)/g,o=t.replace(r,(i,s,a)=>{var c,d,u,f;let l=String(a).split(",").map(h=>h.trim());if(s==="counter"){let h=(c=l[0])==null?void 0:c.replace(/^["']|["']$/g,""),p=(l[1]||"decimal").toLowerCase(),m=n.get(e,h);return Qo(m,p)}else{let h=(d=l[0])==null?void 0:d.replace(/^["']|["']$/g,""),p=(f=(u=l[1])==null?void 0:u.replace(/^["']|["']$/g,""))!=null?f:"",m=(l[2]||"decimal").toLowerCase(),g=n.getStack(e,h);return g.length?g.map(b=>Qo(b,m)).join(p):""}});return Wa(o)}catch(r){return"- "}}var on=null,ln=new WeakMap;function Ua(t){return(t||"").replace(/"([^"]*)"/g,"$1")}function $a(t){if(!t)return"";let e=[],n=/"([^"]*)"/g,r;for(;r=n.exec(t);)e.push(r[1]);return e.length?e.join(""):Ua(t)}function Ir(t,e){let n=t.parentElement,r=n?ln.get(n):null;return r?{get(o,i){let s=e.get(o,i),a=r.get(i);return typeof a=="number"?Math.max(s,a):s},getStack(o,i){let s=e.getStack(o,i);if(!s.length)return s;let a=r.get(i);if(typeof a=="number"){let l=s.slice();return l[l.length-1]=Math.max(l[l.length-1],a),l}return s}}:e}function Tr(t,e,n){let r=new Map;function o(l){let c=[];if(!l||l==="none")return c;for(let d of String(l).split(",")){let u=d.trim().split(/\s+/),f=u[0],h=Number.isFinite(Number(u[1]))?Number(u[1]):void 0;f&&c.push({name:f,num:h})}return c}let i=o(e==null?void 0:e.counterReset),s=o(e==null?void 0:e.counterIncrement);function a(l){if(r.has(l))return r.get(l).slice();let c=n.getStack(t,l);c=c.length?c.slice():[];let d=i.find(f=>f.name===l);if(d){let f=Number.isFinite(d.num)?d.num:0;c=c.length?[...c,f]:[f]}let u=s.find(f=>f.name===l);if(u){let f=Number.isFinite(u.num)?u.num:1;c.length===0&&(c=[0]),c[c.length-1]+=f}return r.set(l,c.slice()),c}return{get(l,c){let d=a(c);return d.length?d[d.length-1]:0},getStack(l,c){return a(c)},__incs:s}}function ja(t,e,n){let r;try{r=getComputedStyle(t,e)}catch(c){}let o=r==null?void 0:r.content;if(!o||o==="none"||o==="normal")return{text:"",incs:[]};let i=Ir(t,n),s=Tr(t,r,i),a=Ba(o)?qa(o,t,s):o;return{text:$a(a),incs:s.__incs||[]}}async function hi(t,e,n,r){var s;if(!(t instanceof Element)||!(e instanceof Element))return;if(!on)try{on=za(t.ownerDocument||document)}catch(a){}for(let a of["::before","::after","::first-letter"])try{let l=si(t,a);if(!l||typeof l[Symbol.iterator]!="function"||l.content==="none"&&l.backgroundImage==="none"&&l.backgroundColor==="transparent"&&(l.borderStyle==="none"||parseFloat(l.borderWidth)===0)&&(!l.transform||l.transform==="none")&&l.display==="inline")continue;if(a==="::first-letter"){let R=getComputedStyle(t);if(!(l.color!==R.color||l.fontSize!==R.fontSize||l.fontWeight!==R.fontWeight))continue;let G=Array.from(e.childNodes).find(C=>{var P;return C.nodeType===Node.TEXT_NODE&&((P=C.textContent)==null?void 0:P.trim().length)>0});if(!G)continue;let K=G.textContent,U=K.match(/^([^\p{L}\p{N}\s]*[\p{L}\p{N}](?:['])?)/u),re=U==null?void 0:U[0],ue=K.slice((re==null?void 0:re.length)||0);if(!re||/[\uD800-\uDFFF]/.test(re))continue;let ge=document.createElement("span");ge.textContent=re,ge.dataset.snapdomPseudo="::first-letter";let ie=$o(l),He=_r(ie,"span");n.styleMap.set(ge,He);let D=document.createTextNode(ue);e.replaceChild(D,G),e.insertBefore(ge,D);continue}let d=l.content,{text:u,incs:f}=ja(t,a,on),h=l.backgroundImage,p=l.backgroundColor,m=l.fontFamily,g=parseInt(l.fontSize)||32,v=parseInt(l.fontWeight)||!1,b=l.color||"#000",_=l.borderStyle,y=parseFloat(l.borderWidth),x=l.transform,M=mt(m),I=d!=="none"&&u!=="",L=h&&h!=="none",W=p&&p!=="transparent"&&p!=="rgba(0, 0, 0, 0)",Y=_&&_!=="none"&&y>0,Q=x&&x!=="none";if(!(I||L||W||Y||Q)){if(f&&f.length&&t.parentElement){let R=ln.get(t.parentElement)||new Map;for(let{name:O}of f){if(!O)continue;let G=Ir(t,on),U=Tr(t,getComputedStyle(t,a),G).get(t,O);R.set(O,U)}ln.set(t.parentElement,R)}continue}let oe=document.createElement("span");oe.dataset.snapdomPseudo=a,oe.style.verticalAlign="middle",oe.style.pointerEvents="none";let Me=$o(l),ee=_r(Me,"span");if(n.styleMap.set(oe,ee),M&&u&&u.length===1){let{dataUrl:R,width:O,height:G}=await _a(u,m,v,g,b),K=document.createElement("img");K.src=R,K.style=`height:${g}px;width:${O/G*g}px;object-fit:contain;`,oe.appendChild(K),e.dataset.snapdomHasIcon="true"}else if(u&&u.startsWith("url(")){let R=Nr(u);if(R!=null&&R.trim())try{let O=document.createElement("img"),G=await lt(Rn(R),{as:"dataURL",useProxy:r.useProxy});O.src=G.data,O.style=`width:${g}px;height:auto;object-fit:contain;`,oe.appendChild(O)}catch(O){console.error(`[snapdom] Error in pseudo ${a} for`,t,O)}}else!M&&I&&(oe.textContent=u);if(oe.style.background="none","mask"in oe.style&&(oe.style.mask="none"),L)try{let R=ai(h),O=await Promise.all(R.map(oi));oe.style.backgroundImage=O.join(", ")}catch(R){console.warn(`[snapdom] Failed to inline background-image for ${a}`,R)}W&&(oe.style.backgroundColor=p);let H=oe.childNodes.length>0||((s=oe.textContent)==null?void 0:s.trim())!==""||L||W||Y||Q;if(f&&f.length&&t.parentElement){let R=ln.get(t.parentElement)||new Map,O=Ir(t,on),G=Tr(t,getComputedStyle(t,a),O);for(let{name:K}of f){if(!K)continue;let U=G.get(t,K);R.set(K,U)}ln.set(t.parentElement,R)}if(!H)continue;a==="::before"?e.insertBefore(oe,e.firstChild):e.appendChild(oe)}catch(l){console.warn(`[snapdom] Failed to capture ${a} for`,t,l)}let o=Array.from(t.children),i=Array.from(e.children).filter(a=>!a.dataset.snapdomPseudo);for(let a=0;a<Math.min(o.length,i.length);a++)await hi(o[a],i[a],n,r)}function Ga(t){if(!t)return;let e=new Set;if(t.querySelectorAll("use").forEach(a=>{let l=a.getAttribute("xlink:href")||a.getAttribute("href");l&&l.startsWith("#")&&e.add(l.slice(1))}),!e.size)return;let n=Array.from(document.querySelectorAll("svg > symbol, svg > defs")),r=n.filter(a=>a.tagName.toLowerCase()==="symbol"),o=n.filter(a=>a.tagName.toLowerCase()==="defs"),i=t.querySelector("svg.inline-defs-container");i||(i=document.createElementNS("http://www.w3.org/2000/svg","svg"),i.setAttribute("aria-hidden","true"),i.setAttribute("style","position: absolute; width: 0; height: 0; overflow: hidden;"),i.classList.add("inline-defs-container"),t.insertBefore(i,t.firstChild));let s=new Set;t.querySelectorAll("symbol[id], defs > *[id]").forEach(a=>{s.add(a.id)}),e.forEach(a=>{if(s.has(a))return;let l=r.find(c=>c.id===a);if(l){i.appendChild(l.cloneNode(!0)),s.add(a);return}for(let c of o){let d=c.querySelector(`#${CSS.escape(a)}`);if(d){let u=i.querySelector("defs");u||(u=document.createElementNS("http://www.w3.org/2000/svg","defs"),i.appendChild(u)),u.appendChild(d.cloneNode(!0)),s.add(a);break}}})}function Ka(t,e){var a;if(!t||!e)return;let n=t.scrollTop||0;if(!n)return;getComputedStyle(e).position==="static"&&(e.style.position="relative");let r=t.getBoundingClientRect(),o=t.clientHeight,i="data-snap-ph",s=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT);for(;s.nextNode();){let l=s.currentNode,c=getComputedStyle(l),d=c.position;if(d!=="sticky"&&d!=="-webkit-sticky")continue;let u=ei(c.top),f=ei(c.bottom);if(u==null&&f==null)continue;let h=Xa(l,t),p=Ya(e,h,i);if(!p)continue;let m=l.getBoundingClientRect(),g=m.width,v=m.height,b=m.left-r.left;if(!(g>0&&v>0)||!Number.isFinite(b))continue;let _=u!=null?u+n:n+(o-v-f);if(!Number.isFinite(_))continue;let y=Number.parseInt(c.zIndex,10),x=Number.isFinite(y),M=x?Math.max(y,1)+1:2,I=x?y-1:0,L=p.cloneNode(!1);L.setAttribute(i,"1"),L.style.position="sticky",L.style.left=`${b}px`,L.style.top=`${_}px`,L.style.width=`${g}px`,L.style.height=`${v}px`,L.style.visibility="hidden",L.style.zIndex=String(I),L.style.overflow="hidden",L.style.background="transparent",L.style.boxShadow="none",L.style.filter="none",(a=p.parentElement)==null||a.insertBefore(L,p),p.style.position="absolute",p.style.left=`${b}px`,p.style.top=`${_}px`,p.style.bottom="auto",p.style.zIndex=String(M),p.style.pointerEvents="none"}}function ei(t){if(!t||t==="auto")return null;let e=Number.parseFloat(t);return Number.isFinite(e)?e:null}function Xa(t,e){let n=[];for(let r=t;r&&r!==e;){let o=r.parentElement;if(!o)break;n.push(Array.prototype.indexOf.call(o.children,r)),r=o}return n.reverse()}function Ya(t,e,n){let r=t;for(let o=0;o<e.length;o++)if(r=Ja(r,n)[e[o]],!r)return null;return r instanceof HTMLElement?r:null}function Ja(t,e){let n=[],r=t.children;for(let o=0;o<r.length;o++){let i=r[o];i.hasAttribute(e)||n.push(i)}return n}async function Za(t,e={}){var l,c;let n={styleMap:B.session.styleMap,styleCache:B.session.styleCache,nodeMap:B.session.nodeMap},r,o="",i="";Qa(t);try{Ga(t)}catch(d){console.warn("inlineExternal defs or symbol failed:",d)}try{r=await Fn(t,n,e,t)}catch(d){throw console.warn("deepClone failed:",d),d}try{await hi(t,r,n,e)}catch(d){console.warn("inlinePseudoElements failed:",d)}await rl(r);try{let d=r.querySelectorAll("style[data-sd]");for(let u of d)i+=u.textContent||"",u.remove()}catch(d){}let s=Ks(n.styleMap);o=Array.from(s.entries()).map(([d,u])=>`.${u}{${d}}`).join(""),o=i+o;for(let[d,u]of n.styleMap.entries()){if(d.tagName==="STYLE")continue;if(d.getRootNode&&d.getRootNode()instanceof ShadowRoot){d.setAttribute("style",u.replace(/;/g,"; "));continue}let f=s.get(u);f&&d.classList.add(f);let h=(l=d.style)==null?void 0:l.backgroundImage,p=(c=d.dataset)==null?void 0:c.snapdomHasIcon;h&&h!=="none"&&(d.style.backgroundImage=h),p&&(d.style.verticalAlign="middle",d.style.display="inline")}for(let[d,u]of n.nodeMap.entries()){let f=u.scrollLeft,h=u.scrollTop;if((f||h)&&d instanceof HTMLElement){d.style.overflow="hidden",d.style.scrollbarWidth="none",d.style.msOverflowStyle="none";let m=document.createElement("div");for(m.style.transform=`translate(${-f}px, ${-h}px)`,m.style.willChange="transform",m.style.display="inline-block",m.style.width="100%";d.firstChild;)m.appendChild(d.firstChild);d.appendChild(m)}}let a=r instanceof HTMLElement&&r.firstElementChild instanceof HTMLElement?r.firstElementChild:r;if(Ka(t,a),t===n.nodeMap.get(r)){let d=n.styleCache.get(t)||window.getComputedStyle(t);n.styleCache.set(t,d);let u=Ds(d.transform);r.style.margin="0",r.style.top="auto",r.style.left="auto",r.style.right="auto",r.style.bottom="auto",r.style.animation="none",r.style.transition="none",r.style.willChange="auto",r.style.float="none",r.style.clear="none",r.style.transform=u||""}for(let[d,u]of n.nodeMap.entries())u.tagName==="PRE"&&(d.style.marginTop="0",d.style.marginBlockStart="0");return{clone:r,classCSS:o,styleCache:n.styleCache}}function Qa(t){let e=getComputedStyle(t),n=e.outlineStyle,r=e.outlineWidth,o=e.borderStyle,i=e.borderWidth,s=n!=="none"&&parseFloat(r)>0,a=o==="none"||parseFloat(i)===0;s&&a&&(t.style.border=`${r} solid transparent`)}var sn=new Map;async function cn(t){var n;if((n=B.resource)!=null&&n.has(t))return B.resource.get(t);if(sn.has(t))return sn.get(t);let e=(async()=>{var o;let r=await lt(t,{as:"dataURL",silent:!0});if(!r.ok||typeof r.data!="string")throw new Error(`[snapDOM] Failed to read blob URL: ${t}`);return(o=B.resource)==null||o.set(t,r.data),r.data})();sn.set(t,e);try{let r=await e;return sn.set(t,r),r}catch(r){throw sn.delete(t),r}}var el=/\bblob:[^)"'\s]+/g;async function ti(t){if(!t||t.indexOf("blob:")===-1)return t;let e=Array.from(new Set(t.match(el)||[]));if(e.length===0)return t;let n=t;for(let r of e)try{let o=await cn(r);n=n.split(r).join(o)}catch(o){}return n}function Nn(t){return typeof t=="string"&&t.startsWith("blob:")}function tl(t){return(t||"").split(",").map(e=>e.trim()).filter(Boolean).map(e=>{let n=e.match(/^(\S+)(\s+.+)?$/);return n?{url:n[1],desc:n[2]||""}:null}).filter(Boolean)}function nl(t){return t.map(e=>e.desc?`${e.url} ${e.desc.trim()}`:e.url).join(", ")}async function rl(t){var s,a;if(!t)return;let e=t.querySelectorAll?t.querySelectorAll("img"):[];for(let l of e)try{let d=l.getAttribute("src")||l.currentSrc||"";if(Nn(d)){let f=await cn(d);l.setAttribute("src",f)}let u=l.getAttribute("srcset");if(u&&u.includes("blob:")){let f=tl(u),h=!1;for(let p of f)if(Nn(p.url))try{p.url=await cn(p.url),h=!0}catch(m){}h&&l.setAttribute("srcset",nl(f))}}catch(c){}let n=t.querySelectorAll?t.querySelectorAll("image"):[];for(let l of n)try{let c="http://www.w3.org/1999/xlink",d=l.getAttribute("href")||((s=l.getAttributeNS)==null?void 0:s.call(l,c,"href"));if(Nn(d)){let u=await cn(d);l.setAttribute("href",u),(a=l.removeAttributeNS)==null||a.call(l,c,"href")}}catch(c){}let r=t.querySelectorAll?t.querySelectorAll("[style*='blob:']"):[];for(let l of r)try{let c=l.getAttribute("style");if(c&&c.includes("blob:")){let d=await ti(c);l.setAttribute("style",d)}}catch(c){}let o=t.querySelectorAll?t.querySelectorAll("style"):[];for(let l of o)try{let c=l.textContent||"";c.includes("blob:")&&(l.textContent=await ti(c))}catch(c){}let i=["poster"];for(let l of i){let c=t.querySelectorAll?t.querySelectorAll(`[${l}^='blob:']`):[];for(let d of c)try{let u=d.getAttribute(l);Nn(u)&&d.setAttribute(l,await cn(u))}catch(u){}}}async function ol(t,e={}){let n=Array.from(t.querySelectorAll("img")),r=async o=>{var d,u,f,h;if(!o.getAttribute("src")){let p=o.currentSrc||o.src||"";p&&o.setAttribute("src",p)}o.removeAttribute("srcset"),o.removeAttribute("sizes");let i=o.src||"";if(!i)return;let s=await lt(i,{as:"dataURL",useProxy:e.useProxy});if(s.ok&&typeof s.data=="string"&&s.data.startsWith("data:")){o.src=s.data,o.width||(o.width=o.naturalWidth||100),o.height||(o.height=o.naturalHeight||100);return}let{fallbackURL:a}=e||{};if(a)try{let p=parseInt(((d=o.dataset)==null?void 0:d.snapdomWidth)||"",10)||0,m=parseInt(((u=o.dataset)==null?void 0:u.snapdomHeight)||"",10)||0,g=parseInt(o.getAttribute("width")||"",10)||0,v=parseInt(o.getAttribute("height")||"",10)||0,b=parseFloat(((f=o.style)==null?void 0:f.width)||"")||0,_=parseFloat(((h=o.style)==null?void 0:h.height)||"")||0,y=p||b||g||o.width||void 0,x=m||_||v||o.height||void 0,M=typeof a=="function"?await a({width:y,height:x,src:i,element:o}):a;if(M){let I=await lt(M,{as:"dataURL",useProxy:e.useProxy});o.src=I.data,!o.width&&y&&(o.width=y),!o.height&&x&&(o.height=x),o.width||(o.width=o.naturalWidth||100),o.height||(o.height=o.naturalHeight||100);return}}catch(p){}let l=o.width||o.naturalWidth||100,c=o.height||o.naturalHeight||100;if(e.placeholders!==!1){let p=document.createElement("div");p.style.cssText=[`width:${l}px`,`height:${c}px`,"background:#ccc","display:inline-block","text-align:center",`line-height:${c}px`,"color:#666","font-size:12px","overflow:hidden"].join(";"),p.textContent="img",o.replaceWith(p)}else{let p=document.createElement("div");p.style.cssText=`display:inline-block;width:${l}px;height:${c}px;visibility:hidden;`,o.replaceWith(p)}};for(let o=0;o<n.length;o+=4){let i=n.slice(o,o+4).map(r);await Promise.allSettled(i)}}async function il(t,e,n,r={}){let o=[[t,e]],i=["background-image","mask","mask-image","-webkit-mask","-webkit-mask-image","mask-source","mask-box-image-source","mask-border-source","-webkit-mask-box-image-source","border-image","border-image-source"],s=["mask-position","mask-size","mask-repeat","-webkit-mask-position","-webkit-mask-size","-webkit-mask-repeat","mask-origin","mask-clip","-webkit-mask-origin","-webkit-mask-clip","-webkit-mask-position-x","-webkit-mask-position-y"],a=["border-image-slice","border-image-width","border-image-outset","border-image-repeat"];for(;o.length;){let[l,c]=o.shift(),d=n.get(l)||si(l);n.has(l)||n.set(l,d);let u=(()=>{let p=d.getPropertyValue("border-image"),m=d.getPropertyValue("border-image-source");return p&&p!=="none"||m&&m!=="none"})();for(let p of i){let m=d.getPropertyValue(p);if(!m||m==="none")continue;let g=ai(m),v=await Promise.all(g.map(b=>oi(b,r)));v.some(b=>b&&b!=="none"&&!/^url\(undefined/.test(b))&&c.style.setProperty(p,v.join(", "))}for(let p of s){let m=d.getPropertyValue(p);!m||m==="initial"||c.style.setProperty(p,m)}if(u)for(let p of a){let m=d.getPropertyValue(p);!m||m==="initial"||c.style.setProperty(p,m)}let f=Array.from(l.children),h=Array.from(c.children);for(let p=0;p<Math.min(f.length,h.length);p++)o.push([f[p],h[p]])}}function sl(t){var c;if(!t)return()=>{};let e=al(t);if(e<=0)return()=>{};if(!dl(t))return()=>{};let n=getComputedStyle(t),r=Math.round(ll(n)*e+cl(n)),o=(c=t.textContent)!=null?c:"",i=o;if(t.scrollHeight<=r+.5)return()=>{};let s=0,a=o.length,l=-1;for(;s<=a;){let d=s+a>>1;t.textContent=o.slice(0,d)+"\u2026",t.scrollHeight<=r+.5?(l=d,s=d+1):a=d-1}return t.textContent=(l>=0?o.slice(0,l):"")+"\u2026",()=>{t.textContent=i}}function al(t){let e=getComputedStyle(t),n=e.getPropertyValue("-webkit-line-clamp")||e.getPropertyValue("line-clamp");n=(n||"").trim();let r=parseInt(n,10);return Number.isFinite(r)&&r>0?r:0}function ll(t){let e=(t.lineHeight||"").trim(),n=parseFloat(t.fontSize)||16;return!e||e==="normal"?Math.round(n*1.2):e.endsWith("px")?parseFloat(e):/^\d+(\.\d+)?$/.test(e)?Math.round(parseFloat(e)*n):e.endsWith("%")?Math.round(parseFloat(e)/100*n):Math.round(n*1.2)}function cl(t){return(parseFloat(t.paddingTop)||0)+(parseFloat(t.paddingBottom)||0)}function dl(t){return t.childElementCount>0?!1:Array.from(t.childNodes).some(e=>e.nodeType===Node.TEXT_NODE)}function ul(t,e){if(!t||!e||!e.style)return;let n=getComputedStyle(t);try{e.style.boxShadow="none"}catch(i){}try{e.style.textShadow="none"}catch(i){}try{e.style.outline="none"}catch(i){}let o=(n.filter||"").replace(/\bblur\([^()]*\)\s*/gi,"").replace(/\bdrop-shadow\([^()]*\)\s*/gi,"").trim().replace(/\s+/g," ");try{e.style.filter=o.length?o:"none"}catch(i){}}async function pi(t,e){if(!t)throw new Error("Element cannot be null or undefined");Fs(e.cache);let n=e.fast,r=!!e.straighten,o=!!e.noShadows,i,s,a,l="",c="",d,u,f=null,h=sl(t);try{({clone:i,classCSS:s,styleCache:a}=await Za(t,e)),r&&i&&(f=fl(t,i)),o&&i&&ul(t,i)}finally{h()}await new Promise(v=>{zt(async()=>{await ol(i,e),v()},{fast:n})}),await new Promise(v=>{zt(async()=>{await il(t,i,a,e),v()},{fast:n})}),e.embedFonts&&await new Promise(v=>{zt(async()=>{let b=Va(t),_=Oa(t);if(Mt()){let y=new Set(Array.from(b).map(x=>String(x).split("__")[0]).filter(Boolean));await Pa(y,1)}l=await Ha({required:b,usedCodepoints:_,preCached:!1,exclude:e.excludeFonts,useProxy:e.useProxy}),v()},{fast:n})});let p=js(i).sort(),m=p.join(",");B.baseStyle.has(m)?c=B.baseStyle.get(m):await new Promise(v=>{zt(()=>{c=Gs(p),B.baseStyle.set(m,c),v()},{fast:n})}),await new Promise(v=>{zt(()=>{let b=getComputedStyle(t);function _(ne){var gn;let ce=`${ne.filter||""} ${ne.webkitFilter||""}`.trim();if(!ce||ce==="none")return{bleed:{top:0,right:0,bottom:0,left:0},has:!1};let me=ce.match(/drop-shadow\((?:[^()]|\([^()]*\))*\)/gi)||[],Se=0,Ye=0,Be=0,et=0,Je=!1;for(let jn of me){Je=!0;let Gn=((gn=jn.match(/-?\d+(?:\.\d+)?px/gi))==null?void 0:gn.map(qi=>parseFloat(qi)))||[],[vn=0,Kn=0,$r=0]=Gn,jr=Math.abs(vn)+$r,Gr=Math.abs(Kn)+$r;Ye=Math.max(Ye,jr+Math.max(vn,0)),et=Math.max(et,jr+Math.max(-vn,0)),Be=Math.max(Be,Gr+Math.max(Kn,0)),Se=Math.max(Se,Gr+Math.max(-Kn,0))}return{bleed:{top:Math.ceil(Se),right:Math.ceil(Ye),bottom:Math.ceil(Be),left:Math.ceil(et)},has:Je}}let y=t.getBoundingClientRect(),x=Math.max(1,Math.ceil(t.offsetWidth||parseFloat(b.width)||y.width||1)),M=Math.max(1,Math.ceil(t.offsetHeight||parseFloat(b.height)||y.height||1)),I=(ne,ce=NaN)=>{let me=typeof ne=="string"?parseFloat(ne):ne;return Number.isFinite(me)?me:ce},L=I(e.width),W=I(e.height),Y=x,Q=M,de=Number.isFinite(L),oe=Number.isFinite(W),Me=M>0?x/M:1;de&&oe?(Y=Math.max(1,Math.ceil(L)),Q=Math.max(1,Math.ceil(W))):de?(Y=Math.max(1,Math.ceil(L)),Q=Math.max(1,Math.ceil(Y/(Me||1)))):oe?(Q=Math.max(1,Math.ceil(W)),Y=Math.max(1,Math.ceil(Q*(Me||1)))):(Y=x,Q=M);let ee=0,ve=0,H=x,R=M;if(r&&f&&Number.isFinite(f.a)){let ne={a:f.a,b:f.b||0,c:f.c||0,d:f.d||1,e:0,f:0},ce=ni(x,M,ne,0,0);ee=ce.minX,ve=ce.minY,H=ce.maxX,R=ce.maxY}else if(!r&&gl(t)){let ce=b.transform&&b.transform!=="none"?b.transform:"",me=vl(t),Se=xl({baseTransform:ce,rotate:me.rotate||"0deg",scale:me.scale,translate:me.translate}),{ox:Ye,oy:Be}=yl(b,x,M),et=Se.is2D?Se:new DOMMatrix(Se.toString()),Je=ni(x,M,et,Ye,Be);ee=Je.minX,ve=Je.minY,H=Je.maxX,R=Je.maxY}let O=hl(b),G=pl(b),K=ml(b),U=_(b),re=o?{top:0,right:0,bottom:0,left:0}:{top:O.top+G.top+K.top+U.bleed.top,right:O.right+G.right+K.right+U.bleed.right,bottom:O.bottom+G.bottom+K.bottom+U.bleed.bottom,left:O.left+G.left+K.left+U.bleed.left};ee-=re.left,ve-=re.top,H+=re.right,R+=re.bottom;let ue=Math.max(1,Math.ceil(H-ee)),ge=Math.max(1,Math.ceil(R-ve)),ie=Math.max(1,Math.round(ue*(de||oe?Y/x:1))),He=Math.max(1,Math.round(ge*(oe||de?Q/M:1))),D="http://www.w3.org/2000/svg",E=(Mt()?1:0)+(r?1:0),T=document.createElementNS(D,"foreignObject"),j=Math.floor(ee),S=Math.floor(ve);T.setAttribute("x",String(-(j-E))),T.setAttribute("y",String(-(S-E))),T.setAttribute("width",String(Math.ceil(x+E*2))),T.setAttribute("height",String(Math.ceil(M+E*2))),T.style.overflow="visible";let k=document.createElement("style");k.textContent=c+l+"svg{overflow:visible;} foreignObject{overflow:visible;}"+s,T.appendChild(k);let N=document.createElement("div");N.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),N.style.width=`${x}px`,N.style.height=`${M}px`,N.style.overflow="visible",i.setAttribute("xmlns","http://www.w3.org/1999/xhtml"),N.appendChild(i),T.appendChild(N);let se=new XMLSerializer().serializeToString(T),xe=ue+E*2,he=ge+E*2,ye=de||oe;e.meta={w0:x,h0:M,vbW:xe,vbH:he,targetW:Y,targetH:Q};let fe=Mt()&&ye?xe:ie+E*2,_e=Mt()&&ye?he:He+E*2,Le=`<svg xmlns="${D}" width="${fe}" height="${_e}" viewBox="0 0 ${xe} ${he}">`,te="</svg>";u=Le+se+te,d=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(u)}`,v()},{fast:n})});let g=document.getElementById("snapdom-sandbox");return g&&g.style.position==="absolute"&&g.remove(),d}function fl(t,e){if(!t||!e||!e.style)return null;let n=getComputedStyle(t);try{e.style.transformOrigin="0 0"}catch(i){}try{"translate"in e.style&&(e.style.translate="none"),"rotate"in e.style&&(e.style.rotate="none")}catch(i){}let r=n.transform||"none";if(!r||r==="none")try{let i=mi(t);if(i.a===1&&i.b===0&&i.c===0&&i.d===1)return e.style.transform="none",{a:1,b:0,c:0,d:1}}catch(i){}let o=r.match(/^matrix\(\s*([^)]+)\)$/i);if(o){let i=o[1].split(",").map(s=>parseFloat(s.trim()));if(i.length===6&&i.every(Number.isFinite)){let[s,a,l,c]=i,d=Math.sqrt(s*s+a*a)||0,u=0,f=0,h=0,p=0,m=0,g=0;d>0&&(u=s/d,f=a/d,h=u*l+f*c,p=l-u*h,m=c-f*h,g=Math.sqrt(p*p+m*m)||0,g>0?h=h/g:h=0);let v=d,b=0,_=h*g,y=g;try{e.style.transform=`matrix(${v}, ${b}, ${_}, ${y}, 0, 0)`}catch(x){}return{a:v,b,c:_,d:y}}}try{let i=String(r).trim();return e.style.transform=i+" translate(0px, 0px) rotate(0deg)",null}catch(i){return null}}function hl(t){var a;let e=t.boxShadow||"";if(!e||e==="none")return{top:0,right:0,bottom:0,left:0};let n=e.split(/\),(?=(?:[^()]*\([^()]*\))*[^()]*$)/).map(l=>l.trim()),r=0,o=0,i=0,s=0;for(let l of n){let c=((a=l.match(/-?\d+(\.\d+)?px/g))==null?void 0:a.map(g=>parseFloat(g)))||[];if(c.length<2)continue;let[d,u,f=0,h=0]=c,p=Math.abs(d)+f+h,m=Math.abs(u)+f+h;o=Math.max(o,p+Math.max(d,0)),s=Math.max(s,p+Math.max(-d,0)),i=Math.max(i,m+Math.max(u,0)),r=Math.max(r,m+Math.max(-u,0))}return{top:Math.ceil(r),right:Math.ceil(o),bottom:Math.ceil(i),left:Math.ceil(s)}}function pl(t){let e=(t.filter||"").match(/blur\(\s*([0-9.]+)px\s*\)/),n=e?Math.ceil(parseFloat(e[1])||0):0;return{top:n,right:n,bottom:n,left:n}}function ml(t){if((t.outlineStyle||"none")==="none")return{top:0,right:0,bottom:0,left:0};let e=Math.ceil(parseFloat(t.outlineWidth||"0")||0);return{top:e,right:e,bottom:e,left:e}}function ni(t,e,n,r,o){let i=n.a,s=n.b,a=n.c,l=n.d,c=n.e||0,d=n.f||0;function u(v,b){let _=v-r,y=b-o,x=i*_+a*y,M=s*_+l*y;return x+=r+c,M+=o+d,[x,M]}let f=[u(0,0),u(t,0),u(0,e),u(t,e)],h=1/0,p=1/0,m=-1/0,g=-1/0;for(let[v,b]of f)v<h&&(h=v),b<p&&(p=b),v>m&&(m=v),b>g&&(g=b);return{minX:h,minY:p,maxX:m,maxY:g,width:m-h,height:g-p}}function gl(t){return bl(t)}function mi(t){let e=getComputedStyle(t).transform;if(!e||e==="none")return new DOMMatrix;try{return new DOMMatrix(e)}catch(n){return new WebKitCSSMatrix(e)}}function vl(t){var o,i,s,a,l,c,d,u;let e={rotate:"0deg",scale:null,translate:null},n=typeof t.computedStyleMap=="function"?t.computedStyleMap():null;if(n){let f=g=>{try{return typeof n.has=="function"&&!n.has(g)||typeof n.get!="function"?null:n.get(g)}catch(v){return null}},h=f("rotate");if(h)if(h.angle){let g=h.angle;e.rotate=g.unit==="rad"?g.value*180/Math.PI+"deg":g.value+g.unit}else h.unit?e.rotate=h.unit==="rad"?h.value*180/Math.PI+"deg":h.value+h.unit:e.rotate=String(h);else{let g=getComputedStyle(t);e.rotate=g.rotate&&g.rotate!=="none"?g.rotate:"0deg"}let p=f("scale");if(p){let g="x"in p&&((o=p.x)==null?void 0:o.value)!=null?p.x.value:Array.isArray(p)?(i=p[0])==null?void 0:i.value:Number(p)||1,v="y"in p&&((s=p.y)==null?void 0:s.value)!=null?p.y.value:Array.isArray(p)?(a=p[1])==null?void 0:a.value:g;e.scale=`${g} ${v}`}else{let g=getComputedStyle(t);e.scale=g.scale&&g.scale!=="none"?g.scale:null}let m=f("translate");if(m){let g="x"in m&&"value"in m.x?m.x.value:Array.isArray(m)?(l=m[0])==null?void 0:l.value:0,v="y"in m&&"value"in m.y?m.y.value:Array.isArray(m)?(c=m[1])==null?void 0:c.value:0,b="x"in m&&((d=m.x)!=null&&d.unit)?m.x.unit:"px",_="y"in m&&((u=m.y)!=null&&u.unit)?m.y.unit:"px";e.translate=`${g}${b} ${v}${_}`}else{let g=getComputedStyle(t);e.translate=g.translate&&g.translate!=="none"?g.translate:null}return e}let r=getComputedStyle(t);return e.rotate=r.rotate&&r.rotate!=="none"?r.rotate:"0deg",e.scale=r.scale&&r.scale!=="none"?r.scale:null,e.translate=r.translate&&r.translate!=="none"?r.translate:null,e}function bl(t){let e=getComputedStyle(t),n=e.transform||"none";if(n!=="none"&&!/^matrix\(\s*1\s*,\s*0\s*,\s*0\s*,\s*1\s*,\s*0\s*,\s*0\s*\)$/i.test(n))return!0;let o=e.rotate&&e.rotate!=="none"&&e.rotate!=="0deg",i=e.scale&&e.scale!=="none"&&e.scale!=="1",s=e.translate&&e.translate!=="none"&&e.translate!=="0px 0px";return Boolean(o||i||s)}function yl(t,e,n){let r=(t.transformOrigin||"0 0").trim().split(/\s+/),[o,i]=[r[0]||"0",r[1]||"0"],s=(a,l)=>{let c=a.toLowerCase();return c==="left"||c==="top"?0:c==="center"?l/2:c==="right"||c==="bottom"?l:c.endsWith("px")?parseFloat(c)||0:c.endsWith("%")?(parseFloat(c)||0)*l/100:/^-?\d+(\.\d+)?$/.test(c)&&parseFloat(c)||0};return{ox:s(o,e),oy:s(i,n)}}var kr=null;function wl(){if(kr)return kr;let t=document.createElement("div");return t.id="snapdom-measure-slot",t.setAttribute("aria-hidden","true"),Object.assign(t.style,{position:"absolute",left:"-99999px",top:"0px",width:"0px",height:"0px",overflow:"hidden",opacity:"0",pointerEvents:"none",contain:"size layout style"}),document.documentElement.appendChild(t),kr=t,t}function xl(t){let e=wl(),n=document.createElement("div");n.style.transformOrigin="0 0",t.baseTransform&&(n.style.transform=t.baseTransform),t.rotate&&(n.style.rotate=t.rotate),t.scale&&(n.style.scale=t.scale),t.translate&&(n.style.translate=t.translate),e.appendChild(n);let r=mi(n);return e.removeChild(n),r}function kl(t){if(typeof t=="string"){let e=t.toLowerCase().trim();if(e==="disabled"||e==="full"||e==="auto"||e==="soft")return e}return"soft"}function _l(t={}){var r,o,i,s,a,l,c,d,u,f,h,p,m,g,v,b,_,y,x,M;let e=(r=t.format)!=null?r:"png",n=kl(t.cache);return{debug:(o=t.debug)!=null?o:!1,fast:(i=t.fast)!=null?i:!0,scale:(s=t.scale)!=null?s:1,exclude:(a=t.exclude)!=null?a:[],excludeMode:(l=t.excludeMode)!=null?l:"hide",filter:(c=t.filter)!=null?c:null,filterMode:(d=t.filterMode)!=null?d:"hide",placeholders:t.placeholders!==!1,embedFonts:(u=t.embedFonts)!=null?u:!1,iconFonts:Array.isArray(t.iconFonts)?t.iconFonts:t.iconFonts?[t.iconFonts]:[],localFonts:Array.isArray(t.localFonts)?t.localFonts:[],excludeFonts:(f=t.excludeFonts)!=null?f:void 0,fallbackURL:(h=t.fallbackURL)!=null?h:void 0,cache:n,useProxy:typeof t.useProxy=="string"?t.useProxy:"",width:(p=t.width)!=null?p:null,height:(m=t.height)!=null?m:null,format:e,type:(g=t.type)!=null?g:"svg",quality:(v=t.quality)!=null?v:.92,dpr:(b=t.dpr)!=null?b:window.devicePixelRatio||1,backgroundColor:(_=t.backgroundColor)!=null?_:["jpg","jpeg","webp"].includes(e)?"#ffffff":null,filename:(y=t.filename)!=null?y:"snapDOM",straighten:(x=t.straighten)!=null?x:!1,noShadows:(M=t.noShadows)!=null?M:!1}}function Sl(t){return typeof t=="string"&&/^data:image\/svg\+xml/i.test(t)}function Cl(t){let e=t.indexOf(",");return e>=0?decodeURIComponent(t.slice(e+1)):""}function El(t){return`data:image/svg+xml;charset=utf-8,${encodeURIComponent(t)}`}function Ml(t){let e=[],n="",r=0;for(let o=0;o<t.length;o++){let i=t[o];i==="("&&r++,i===")"&&(r=Math.max(0,r-1)),i===";"&&r===0?(e.push(n),n=""):n+=i}return n.trim()&&e.push(n),e.map(o=>o.trim()).filter(Boolean)}function Ll(t){let e=[],n="",r=0;for(let i=0;i<t.length;i++){let s=t[i];s==="("&&r++,s===")"&&(r=Math.max(0,r-1)),s===","&&r===0?(e.push(n.trim()),n=""):n+=s}n.trim()&&e.push(n.trim());let o=[];for(let i of e){if(/\binset\b/i.test(i))continue;let s=i.match(/-?\d+(?:\.\d+)?px/gi)||[],[a="0px",l="0px",c="0px"]=s,d=i.replace(/-?\d+(?:\.\d+)?px/gi,"").replace(/\binset\b/ig,"").trim().replace(/\s{2,}/g," "),u=!!d&&d!==",";o.push(`drop-shadow(${a} ${l} ${c}${u?` ${d}`:""})`)}return o.join(" ")}function gi(t){let e=Ml(t),n=null,r=null,o=null,i=[];for(let a of e){let l=a.indexOf(":");if(l<0)continue;let c=a.slice(0,l).trim().toLowerCase(),d=a.slice(l+1).trim();c==="box-shadow"?o=d:c==="filter"?n=d:c==="-webkit-filter"?r=d:i.push([c,d])}if(o){let a=Ll(o);a&&(n=n?`${n} ${a}`:a,r=r?`${r} ${a}`:a)}let s=[...i];return n&&s.push(["filter",n]),r&&s.push(["-webkit-filter",r]),s.map(([a,l])=>`${a}:${l}`).join(";")}function Il(t){return t.replace(/([^{}]+)\{([^}]*)\}/g,(e,n,r)=>`${n}{${gi(r)}}`)}function Tl(t){return t=t.replace(/<style[^>]*>([\s\S]*?)<\/style>/gi,(e,n)=>e.replace(n,Il(n))),t=t.replace(/style=(['"])([\s\S]*?)\1/gi,(e,n,r)=>`style=${n}${gi(r)}${n}`),t}function Al(t){if(!Mt()||!Sl(t))return t;try{let e=Cl(t),n=Tl(e);return El(n)}catch(e){return t}}async function On(t,e){let{width:n,height:r,scale:o=1,dpr:i=1,meta:s={}}=e;t=Al(t);let a=new Image;a.loading="eager",a.decoding="sync",a.crossOrigin="anonymous",a.src=t,await a.decode();let l=a.naturalWidth,c=a.naturalHeight,d=Number.isFinite(s.w0)?s.w0:l,u=Number.isFinite(s.h0)?s.h0:c,f,h,p=Number.isFinite(n),m=Number.isFinite(r);if(p&&m)f=Math.max(1,n),h=Math.max(1,r);else if(p){let b=n/Math.max(1,d);f=n,h=Math.round(u*b)}else if(m){let b=r/Math.max(1,u);h=r,f=Math.round(d*b)}else f=l,h=c;f=Math.round(f*o),h=Math.round(h*o);let g=document.createElement("canvas");g.width=Math.ceil(f*i),g.height=Math.ceil(h*i),g.style.width=`${f}px`,g.style.height=`${h}px`;let v=g.getContext("2d");return i!==1&&v.scale(i,i),v.drawImage(a,0,0,f,h),g}async function vi(t,e){let n=await On(t,e),r=e.backgroundColor?Fr(n,e.backgroundColor):n,o=new Image;return o.src=r.toDataURL(`image/${e.format}`,e.quality),await o.decode(),o.style.width=`${r.width/e.dpr}px`,o.style.height=`${r.height/e.dpr}px`,o}async function ri(t,e){let{scale:n=1,width:r,height:o,meta:i={}}=e,s=Number.isFinite(r),a=Number.isFinite(o),l=Number.isFinite(n)&&n!==1||s||a;if(Mt()&&l)return await vi(t,{...e,format:"png",quality:1,meta:i});let c=new Image;if(c.decoding="sync",c.loading="eager",c.src=t,await c.decode(),s&&a)c.style.width=`${r}px`,c.style.height=`${o}px`;else if(s){let d=Number.isFinite(i.w0)?i.w0:c.naturalWidth,u=Number.isFinite(i.h0)?i.h0:c.naturalHeight,f=r/Math.max(1,d);c.style.width=`${r}px`,c.style.height=`${Math.round(u*f)}px`}else if(a){let d=Number.isFinite(i.w0)?i.w0:c.naturalWidth,u=Number.isFinite(i.h0)?i.h0:c.naturalHeight,f=o/Math.max(1,u);c.style.height=`${o}px`,c.style.width=`${Math.round(d*f)}px`}else{let d=Math.round(c.naturalWidth*n),u=Math.round(c.naturalHeight*n);if(c.style.width=`${d}px`,c.style.height=`${u}px`,typeof t=="string"&&t.startsWith("data:image/svg+xml"))try{let h=decodeURIComponent(t.split(",")[1]).replace(/width="[^"]*"/,`width="${d}"`).replace(/height="[^"]*"/,`height="${u}"`);t=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(h)}`,c.src=t}catch(f){}}return c}async function bi(t,e){let n=e.type;if(n==="svg"){let i=decodeURIComponent(t.split(",")[1]);return new Blob([i],{type:"image/svg+xml"})}let r=await On(t,e),o=e.backgroundColor?Fr(r,e.backgroundColor):r;return new Promise(i=>o.toBlob(s=>i(s),`image/${n}`,e.quality))}async function Nl(t,e){if(e.dpr=1,e.format==="svg"){let i=await bi(t,{...e,type:"svg"}),s=URL.createObjectURL(i),a=document.createElement("a");a.href=s,a.download=e.filename,a.click(),URL.revokeObjectURL(s);return}let n=await On(t,e),r=e.backgroundColor?Fr(n,e.backgroundColor):n,o=document.createElement("a");o.href=r.toDataURL(`image/${e.format}`,e.quality),o.download=e.filename,o.click()}var yi=Symbol("snapdom.internal"),Ar=!1;async function ke(t,e){if(!t)throw new Error("Element cannot be null or undefined");let n=_l(e);if(Mt()&&(n.embedFonts===!0||Dl(t)))for(let r=0;r<3;r++)try{await Fl(t,e),console.log("Iteraci\xF3n n\xFAmero:",r),Ar=!1}catch(o){}return n.iconFonts&&n.iconFonts.length>0&&ka(n.iconFonts),n.snap||(n.snap={toPng:(r,o)=>ke.toPng(r,o),toSvg:(r,o)=>ke.toSvg(r,o)}),ke.capture(t,n,yi)}ke.capture=async(t,e,n)=>{if(n!==yi)throw new Error("[snapdom.capture] is internal. Use snapdom(...) instead.");let r=await pi(t,e),o=s=>({...e,...s||{}}),i=s=>a=>{let l=o({...a||{},format:s}),c=s==="jpeg"||s==="jpg",d=l.backgroundColor==null||l.backgroundColor==="transparent";return c&&d&&(l.backgroundColor="#ffffff"),vi(r,l)};return{url:r,toRaw:()=>r,toImg:s=>ri(r,o(s)),toSvg:s=>ri(r,o(s)),toCanvas:s=>On(r,o(s)),toBlob:s=>bi(r,o(s)),toPng:i("png"),toJpg:i("jpeg"),toWebp:i("webp"),download:s=>Nl(r,o(s))}};ke.toRaw=(t,e)=>ke(t,e).then(n=>n.toRaw());ke.toImg=(t,e)=>ke(t,e).then(n=>n.toImg());ke.toSvg=(t,e)=>ke(t,e).then(n=>n.toSvg());ke.toCanvas=(t,e)=>ke(t,e).then(n=>n.toCanvas());ke.toBlob=(t,e)=>ke(t,e).then(n=>n.toBlob());ke.toPng=(t,e)=>ke(t,{...e,format:"png"}).then(n=>n.toPng());ke.toJpg=(t,e)=>ke(t,{...e,format:"jpeg"}).then(n=>n.toJpg());ke.toWebp=(t,e)=>ke(t,{...e,format:"webp"}).then(n=>n.toWebp());ke.download=(t,e)=>ke(t,e).then(n=>n.download());async function Fl(t,e){if(Ar)return;let n={...e,fast:!0,embedFonts:!0,scale:.2},r;try{r=await pi(t,n)}catch(o){return}await new Promise(o=>{let i=new Image;i.decoding="sync",i.loading="eager",i.style.position="fixed",i.style.left=0,i.style.top=0,i.style.width="10px",i.style.height="10px",i.style.opacity="0.01",i.style.transform="translateZ(10px)",i.style.willChange="transform,opacity;",i.src=r;let s=async()=>{await new Promise(a=>setTimeout(a,100)),i&&i.parentNode&&i.parentNode.removeChild(i),Ar=!0,o()};document.body.appendChild(i),s()})}function Dl(t){let e=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT);for(;e.nextNode();){let n=e.currentNode,r=getComputedStyle(n),o=r.backgroundImage&&r.backgroundImage!=="none",i=r.maskImage&&r.maskImage!=="none"||r.webkitMaskImage&&r.webkitMaskImage!=="none";if(o||i)return!0}return!1}var Pn=class extends Ae.Modal{constructor(n,r){super(n);this.previewComponent=null;this.displayDepth=5;this.modalWidth="900px";this.isCapturing=!1;this.useFullHeight=!0;this.fontSize=16;this.hiddenNodes=new Set;this.options=r}onOpen(){let{contentEl:n}=this;this.modalEl.addClass("grid-note-screenshot-modal"),this.setupModalPosition(),this.titleEl.setText("\u9884\u89C8\u5206\u4EAB\u56FE\u7247"),n.style.display="flex",n.style.flexDirection="column",n.style.height="100%",this.loadSystemFontSize(),this.previewContainer=n.createDiv({cls:"grid-note-screenshot-preview-container"}),this.createPreview(),this.createFooter(),this.updatePreviewDepth(),this.updateFontSize()}loadSystemFontSize(){let r=getComputedStyle(document.body).getPropertyValue("--font-text-size").trim();if(r){let o=r.match(/^(\d+(?:\.\d+)?)(px|em|rem)?$/);if(o){let i=parseFloat(o[1]),s=o[2]||"px";s==="px"?this.fontSize=i:(s==="em"||s==="rem")&&(this.fontSize=i*16)}}this.fontSize=Math.max(10,Math.min(32,this.fontSize))}setupModalPosition(){this.modalEl.style.width="95vw",this.modalEl.style.maxWidth="1600px",this.modalEl.style.minWidth="900px",this.modalEl.style.height="90vh",this.modalEl.style.maxHeight="1000px",this.modalEl.style.minHeight="600px"}createPreview(){this.previewContainer&&(this.previewComponent=new zo({target:this.previewContainer,props:{node:this.options.node,app:this.options.app,maxDepth:this.displayDepth,modalWidth:this.modalWidth,useFullHeight:this.useFullHeight,hiddenNodes:this.hiddenNodes,onToggleNode:this.handleToggleNode.bind(this)}}))}handleToggleNode(n){this.hiddenNodes.has(n)?this.hiddenNodes.delete(n):this.hiddenNodes.add(n),this.updatePreview()}updatePreview(){this.previewComponent&&this.previewComponent.$set({hiddenNodes:this.hiddenNodes})}resetNodes(){this.hiddenNodes.clear(),this.updatePreview()}updatePreviewDepth(){this.previewComponent&&(this.modalWidth=this.calculateWidth(this.options.node,this.displayDepth),this.previewComponent.$set({maxDepth:this.displayDepth,modalWidth:this.modalWidth}))}calculateWidth(n,r=3){return`${{1:1100,2:1200,3:1300,4:1400,5:1500}[r]||1400}px`}createFooter(){var s;let{contentEl:n}=this,r=n.createDiv({cls:"modal-button-container"}),o=(s=this.options.plugin.vipManager)==null?void 0:s.getActivationInfo(),i=(o==null?void 0:o.isActive)||!1;new Ae.Setting(r).addButton(a=>a.setButtonText("\u2212").setTooltip("\u51CF\u5C11\u5C42\u7EA7").onClick(()=>{this.displayDepth>1&&(this.displayDepth--,this.updateDepthDisplay(),this.updatePreviewDepth())})).addExtraButton(a=>(a.setIcon("layers").setTooltip("\u5F53\u524D\u663E\u793A\u5C42\u7EA7"),this.depthLabel=a.extraSettingsEl.createSpan({text:`${this.displayDepth} \u5C42`,cls:"depth-label-text"}),a)).addButton(a=>a.setButtonText("+").setTooltip("\u589E\u52A0\u5C42\u7EA7").onClick(()=>{this.displayDepth<5&&(this.displayDepth++,this.updateDepthDisplay(),this.updatePreviewDepth())})).addButton(a=>a.setButtonText("A\u2212").setTooltip("\u51CF\u5C0F\u5B57\u4F53").onClick(()=>{this.fontSize>10&&(this.fontSize=Math.max(10,this.fontSize-2),this.updateFontSizeDisplay(),this.updateFontSize())})).addExtraButton(a=>(a.setIcon("type").setTooltip("\u5F53\u524D\u5B57\u4F53\u5927\u5C0F"),this.fontSizeLabel=a.extraSettingsEl.createSpan({text:`${Math.round(this.fontSize)}px`,cls:"font-size-label-text"}),a)).addButton(a=>a.setButtonText("A+").setTooltip("\u589E\u5927\u5B57\u4F53").onClick(()=>{this.fontSize<32&&(this.fontSize=Math.min(32,this.fontSize+2),this.updateFontSizeDisplay(),this.updateFontSize())})).addButton(a=>a.setButtonText("\u663E\u793A\u91CD\u7F6E").setTooltip("\u91CD\u7F6E\u6240\u6709\u9690\u85CF\u7684\u8282\u70B9").onClick(()=>{this.resetNodes()})).addButton(a=>a.setButtonText("\u590D\u5236\u56FE\u7247").setTooltip(i?"\u590D\u5236\u56FE\u7247\u5230\u526A\u8D34\u677F":"\u590D\u5236\u56FE\u7247\u5230\u526A\u8D34\u677F (\u4E13\u4E1A\u7248\u529F\u80FD)").setCta().setDisabled(!i).onClick(()=>{if(!i){new Ae.Notice("\u590D\u5236\u56FE\u7247\u529F\u80FD\u9700\u8981\u4E13\u4E1A\u7248");return}this.handleCaptureWithSnapdom()})).addButton(a=>a.setButtonText("\u4FDD\u5B58\u5230 Vault").setTooltip(i?"\u4FDD\u5B58\u56FE\u7247\u5230 Obsidian \u4ED3\u5E93":"\u4FDD\u5B58\u56FE\u7247\u5230 Obsidian \u4ED3\u5E93 (\u4E13\u4E1A\u7248\u529F\u80FD)").setCta().setDisabled(!i).onClick(()=>{if(!i){new Ae.Notice("\u4FDD\u5B58\u5230 Vault \u529F\u80FD\u9700\u8981\u4E13\u4E1A\u7248");return}this.handleSaveToVault()})).addButton(a=>a.setButtonText("\u4FDD\u5B58\u5230\u672C\u5730").setTooltip(i?"\u4FDD\u5B58\u56FE\u7247\u5230\u672C\u5730\u6587\u4EF6\u5939":"\u4FDD\u5B58\u56FE\u7247\u5230\u672C\u5730\u6587\u4EF6\u5939 (\u4E13\u4E1A\u7248\u529F\u80FD)").setCta().setDisabled(!i).onClick(()=>{if(!i){new Ae.Notice("\u4FDD\u5B58\u5230\u672C\u5730\u529F\u80FD\u9700\u8981\u4E13\u4E1A\u7248");return}this.handleSaveImage()})).addButton(a=>a.setButtonText("\u5173\u95ED").onClick(()=>{this.close()}))}updateDepthDisplay(){this.depthLabel&&(this.depthLabel.textContent=`${this.displayDepth} \u5C42`)}updateFontSizeDisplay(){this.fontSizeLabel&&(this.fontSizeLabel.textContent=`${Math.round(this.fontSize)}px`)}updateFontSize(){this.previewContainer&&this.previewContainer.style.setProperty("--font-text-size",`${this.fontSize}px`)}async handleCaptureWithSnapdom(){if(this.isCapturing||!this.previewComponent)return;this.isCapturing=!0;let n=new Ae.Notice("\u6B63\u5728\u751F\u6210\u56FE\u7247...",0);try{await new Promise(a=>setTimeout(a,150));let r=this.previewComponent.getContainerElement();if(!r)throw new Error("\u65E0\u6CD5\u627E\u5230\u622A\u56FE\u5BB9\u5668");let i=await(await ke(r,{scale:window.devicePixelRatio||2})).toCanvas(),s=await new Promise((a,l)=>{i.toBlob(c=>{c?a(c):l(new Error("Canvas \u8F6C\u6362\u4E3A Blob \u5931\u8D25"))},"image/png",1)});await navigator.clipboard.write([new ClipboardItem({"image/png":s})]),n.hide(),new Ae.Notice("\u56FE\u7247\u5DF2\u590D\u5236\u5230\u526A\u8D34\u677F")}catch(r){n.hide(),console.error("\u622A\u56FE\u5931\u8D25:",r);let o=r instanceof Error?r.message:"\u672A\u77E5\u9519\u8BEF";new Ae.Notice(`\u622A\u56FE\u5931\u8D25: ${o}`)}finally{this.isCapturing=!1}}async handleSaveToVault(){if(this.isCapturing||!this.previewComponent)return;this.isCapturing=!0;let n=new Ae.Notice("\u6B63\u5728\u751F\u6210\u56FE\u7247...",0);try{await new Promise(g=>setTimeout(g,150));let r=this.previewComponent.getContainerElement();if(!r)throw new Error("\u65E0\u6CD5\u627E\u5230\u622A\u56FE\u5BB9\u5668");let i=await(await ke(r,{scale:window.devicePixelRatio||2})).toCanvas(),s=await new Promise((g,v)=>{i.toBlob(b=>{b?g(b):v(new Error("Canvas \u8F6C\u6362\u4E3A Blob \u5931\u8D25"))},"image/png",1)}),c=`GridNote_${new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5)}.png`,d=(this.options.plugin.settings.screenshotFolder||"GridNote-Screenshots").trim(),u=this.app.vault.getAbstractFileByPath(d);if(!u)await this.app.vault.createFolder(d);else if(!(u instanceof Ae.TFolder))throw new Error(`${d} \u5DF2\u5B58\u5728\u4E14\u4E0D\u662F\u6587\u4EF6\u5939`);let f=`${d}/${c}`,h=await s.arrayBuffer(),p=await this.app.vault.createBinary(f,h);n.hide(),new Ae.Notice(`\u56FE\u7247\u5DF2\u4FDD\u5B58: ${c}`);let m=this.app.workspace.getLeaf("tab");m&&await m.openFile(p)}catch(r){n.hide(),console.error("\u4FDD\u5B58\u56FE\u7247\u5931\u8D25:",r);let o=r instanceof Error?r.message:"\u672A\u77E5\u9519\u8BEF";new Ae.Notice(`\u4FDD\u5B58\u5931\u8D25: ${o}`)}finally{this.isCapturing=!1}}async handleSaveImage(){if(this.isCapturing||!this.previewComponent)return;this.isCapturing=!0;let n=new Ae.Notice("\u6B63\u5728\u751F\u6210\u56FE\u7247...",0);try{await new Promise(v=>setTimeout(v,150));let r=this.previewComponent.getContainerElement();if(!r)throw new Error("\u65E0\u6CD5\u627E\u5230\u622A\u56FE\u5BB9\u5668");let i=await(await ke(r,{scale:window.devicePixelRatio||2})).toCanvas(),s=await new Promise((v,b)=>{i.toBlob(_=>{_?v(_):b(new Error("Canvas \u8F6C\u6362\u4E3A Blob \u5931\u8D25"))},"image/png",1)}),a=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5),c=`GridNote_${this.options.node.header.trim().replace(/[^a-zA-Z0-9\u4e00-\u9fa5]/g,"_").slice(0,50)||"untitled"}_${a}.png`,d=window.require;if(!d){n.hide(),new Ae.Notice("\u4FDD\u5B58\u529F\u80FD\u4EC5\u5728\u684C\u9762\u5E94\u7528\u4E2D\u53EF\u7528");return}let{remote:u}=d("electron")||{};if(!u){n.hide(),new Ae.Notice("\u4FDD\u5B58\u529F\u80FD\u4EC5\u5728\u684C\u9762\u5E94\u7528\u4E2D\u53EF\u7528");return}n.hide();let{dialog:f}=u,h=await f.showSaveDialog({title:"\u4FDD\u5B58\u56FE\u7247",defaultPath:c,filters:[{name:"\u56FE\u7247",extensions:["png"]},{name:"\u6240\u6709\u6587\u4EF6",extensions:["*"]}],properties:["createDirectory","showOverwriteConfirmation"]});if(h.canceled||!h.filePath)return;let p=await s.arrayBuffer(),m=Buffer.from(p);d("fs").writeFileSync(h.filePath,m),new Ae.Notice("\u56FE\u7247\u5DF2\u4FDD\u5B58\u6210\u529F")}catch(r){n.hide(),console.error("\u4FDD\u5B58\u56FE\u7247\u5931\u8D25:",r);let o=r instanceof Error?r.message:"\u672A\u77E5\u9519\u8BEF";new Ae.Notice(`\u4FDD\u5B58\u5931\u8D25: ${o}`)}finally{this.isCapturing=!1}}onClose(){let{contentEl:n}=this;this.previewComponent&&(this.previewComponent.$destroy(),this.previewComponent=null),n.empty()}};function Rl(t){Ie(t,"svelte-160ftkp",'@charset "UTF-8";.container.svelte-160ftkp.svelte-160ftkp{min-height:30px;border-bottom:1.5px solid var(--background-modifier-border);display:flex;align-items:center;padding:4px 0}.container.svelte-160ftkp .title.svelte-160ftkp{flex:1;display:flex;align-items:center;width:calc(100% - 90px)}.container.svelte-160ftkp .title .header.svelte-160ftkp{vertical-align:bottom;font-size:var(--font-text-size);font-weight:700;flex:1;max-width:calc(100% - 60px);padding-left:10px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;letter-spacing:0.05em;cursor:pointer;transition:background-color 0.2s ease}.container.svelte-160ftkp .title .header.svelte-160ftkp:hover{background-color:var(--background-modifier-hover);border-radius:4px}.container.svelte-160ftkp .title .header.header-editing.svelte-160ftkp{background-color:var(--background-primary);border:2px solid var(--interactive-accent);border-radius:4px;outline:none;cursor:text;white-space:normal;overflow:visible;text-overflow:initial;padding:4px 8px;margin:-4px -8px}.container.svelte-160ftkp .title .header.header-editing.svelte-160ftkp:focus{border-color:var(--interactive-accent);box-shadow:0 0 0 2px rgba(var(--interactive-accent-rgb), 0.2)}.container.svelte-160ftkp .title .header.empty-header.svelte-160ftkp{color:var(--text-muted);font-style:italic;min-width:60px;min-height:20px}.container.svelte-160ftkp .title .header.empty-header.svelte-160ftkp:hover{color:var(--text-normal);background-color:var(--background-modifier-hover)}.container.svelte-160ftkp .action.svelte-160ftkp{opacity:0;margin-right:20px}.container.svelte-160ftkp .action .actions.svelte-160ftkp{display:flex;justify-content:space-between}.container.svelte-160ftkp:hover .action.svelte-160ftkp{opacity:1}.theme-dark .container.svelte-160ftkp .header.svelte-160ftkp{color:var(--color-orange)}.theme-light .container.svelte-160ftkp .header.svelte-160ftkp{color:var(--color-blue)}.selected.svelte-160ftkp.svelte-160ftkp{color:var(--color-accent);border-color:var(--color-accent)}.is-fold.svelte-160ftkp.svelte-160ftkp{opacity:0.5}.gridnote-delete-notice{position:fixed;bottom:80px;left:50%;transform:translateX(-50%);background:var(--background-primary);border:1px solid var(--color-green);border-radius:8px;padding:12px 24px;color:var(--text-normal);font-size:var(--font-small);font-weight:500;box-shadow:var(--shadow-m);z-index:10000;opacity:0;transition:all 0.3s ease;pointer-events:none;max-width:300px;text-align:center}.gridnote-delete-notice.show{opacity:1;transform:translateX(-50%) translateY(-10px)}.gridnote-delete-notice::before{content:"\u2713";margin-right:8px;color:var(--color-green);font-weight:bold}')}function Hl(t){let e,n,r,o;return{c(){e=F("div"),n=Qe(t[9]),w(e,"class","header svelte-160ftkp"),w(e,"role","button"),w(e,"aria-label","\u53CC\u51FB\u7F16\u8F91\u6807\u9898"),w(e,"tabindex","0"),Z(e,"empty-header",!t[0].header.trim())},m(i,s){$(i,e,s),A(e,n),t[22](e),r||(o=[le(e,"dblclick",t[10]),le(e,"keydown",t[11])],r=!0)},p(i,s){s[0]&512&&St(n,i[9]),s[0]&1&&Z(e,"empty-header",!i[0].header.trim())},d(i){i&&q(e),t[22](null),r=!1,be(o)}}}function Vl(t){let e,n=t[0].header+"",r,o,i;return{c(){e=F("div"),r=Qe(n),w(e,"class","header header-editing svelte-160ftkp"),w(e,"contenteditable","true"),w(e,"role","textbox"),w(e,"aria-label","\u7F16\u8F91\u6807\u9898"),w(e,"tabindex","0"),w(e,"spellcheck","false")},m(s,a){$(s,e,a),A(e,r),t[21](e),o||(i=[le(e,"keydown",t[12]),le(e,"blur",t[13])],o=!0)},p(s,a){a[0]&1&&n!==(n=s[0].header+"")&&mo(r,n)},d(s){s&&q(e),t[21](null),o=!1,be(i)}}}function Ol(t){let e,n,r,o,i,s,a,l,c;function d(h,p){return h[4]?Vl:Hl}let u=d(t,[-1,-1]),f=u(t);return{c(){e=F("div"),n=F("div"),r=F("div"),o=X(),i=F("div"),s=X(),f.c(),a=X(),l=F("div"),c=F("div"),w(n,"class","title svelte-160ftkp"),w(c,"class","actions svelte-160ftkp"),w(l,"class","action svelte-160ftkp"),w(e,"class","container svelte-160ftkp"),Z(e,"selected",t[3]),Z(e,"is-fold",!t[6])},m(h,p){$(h,e,p),A(e,n),A(n,r),t[19](r),A(n,o),A(n,i),t[20](i),A(n,s),f.m(n,null),A(e,a),A(e,l),A(l,c),t[23](c)},p(h,p){u===(u=d(h,p))&&f?f.p(h,p):(f.d(1),f=u(h),f&&(f.c(),f.m(n,null))),p[0]&8&&Z(e,"selected",h[3]),p[0]&64&&Z(e,"is-fold",!h[6])},i:ae,o:ae,d(h){h&&q(e),t[19](null),t[20](null),f.d(),t[23](null)}}}function Pl(t,e){let n=wi(t),r=wi(e);if(n.length!==r.length)return!0;for(let o=0;o<n.length;o++)if(n[o].text!==r[o].text||n[o].level!==r[o].level)return!0;return!1}function wi(t){let e=[],n=t.split(`
`),r=!1;return n.forEach(o=>{let i=o.trim();if(i.startsWith("```")){r=!r;return}if(!r){let s=i.match(/^(#{1,6})\s+(.+)$/);s&&e.push({text:s[2].trim(),level:s[1].length})}}),e}function Bl(t){let e=document.createElement("div");e.className="gridnote-delete-notice",e.textContent=`\u5DF2\u5220\u9664\u8282\u70B9"${t}"`,document.body.appendChild(e),requestAnimationFrame(()=>{e.classList.add("show")});let n,r=()=>{e.classList.remove("show"),e.addEventListener("transitionend",()=>{e.parentNode&&e.parentNode.removeChild(e)},{once:!0})};return n=window.setTimeout(r,3e3),()=>window.clearTimeout(n)}function Wl(t,e,n){let r,{node:o}=e,{currentLines:i}=e,{searchKeyword:s=""}=e,{allHighlights:a=null}=e,{triggerEditHeader:l=!1}=e,c=ot("View"),d,u,f,h=!1,p=null,m=null,g=null,v=!1,b,_=[],y=!1,x;function M(){n(4,y=!0),setTimeout(()=>{if(x){x.focus();let C=document.createRange();C.selectNodeContents(x);let P=window.getSelection();P==null||P.removeAllRanges(),P==null||P.addRange(C)}},0)}function I(){var C;if(!y)return;let P=((C=x==null?void 0:x.textContent)===null||C===void 0?void 0:C.trim())||"";n(4,y=!1),P!==o.header&&P!==""&&W(P)}function L(){n(4,y=!1)}function W(C){let{editor:P}=c;n(0,o.header=C,o);let E=`${"#".repeat(o.level)} ${C}`,T=o.startLine-1;if(P.setLine(T,E),c.file){c.markInternalModification&&c.markInternalModification(c.file.path);let j=P.getValue();c.app.vault.modify(c.file,j)}}function Y(C){C.preventDefault(),C.stopPropagation(),M()}function Q(C){(C.key==="Enter"||C.key===" ")&&(C.preventDefault(),C.stopPropagation(),M())}function de(C){C.key==="Enter"?(C.preventDefault(),I()):C.key==="Escape"&&(C.preventDefault(),C.stopPropagation(),L())}function oe(){I()}function Me(C){let P=new Ge.Menu;P.addItem(T=>T.setTitle("\u5220\u9664\u6807\u9898\u884C").setIcon("minus").onClick(()=>{O(R.HEADER_ONLY)})),P.addItem(T=>T.setTitle("\u5220\u9664\u5F53\u524D\u8282\u70B9").setIcon("trash-2").onClick(()=>{O(R.CURRENT_NODE)})),P.addItem(T=>T.setTitle("\u5220\u9664\u5F53\u524D\u8282\u70B9\u53CA\u5B50\u8282\u70B9").setIcon("trash").onClick(()=>{O(R.WITH_CHILDREN)}));let E=C.getBoundingClientRect();P.showAtPosition({x:E.right,y:E.bottom})}function ee(C){let P=new Ge.ExtraButtonComponent(C).setIcon("trash").setTooltip("\u5220\u9664\u9009\u9879").onClick(()=>{Me(P.extraSettingsEl)});return()=>{P.extraSettingsEl.remove()}}function ve(){if(!b||y)return;if(_.length>0&&a&&a.update&&a.update(N=>N.filter(V=>!_.includes(V))),_=[],!s){n(7,b.textContent=r,b);return}let C=s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),P=new RegExp(C,"gi"),E=o.header.trim();if(!E){n(7,b.textContent=r,b);return}let T=[],j;for(;(j=P.exec(E))!==null;)T.push({start:j.index,end:j.index+j[0].length,text:j[0]});if(T.length===0){n(7,b.textContent=r,b);return}n(7,b.textContent="",b);let S=document.createDocumentFragment(),k=0;T.forEach(N=>{N.start>k&&S.appendChild(document.createTextNode(E.slice(k,N.start)));let V=document.createElement("span");V.className="search-highlight",V.textContent=N.text,S.appendChild(V),k=N.end}),k<E.length&&S.appendChild(document.createTextNode(E.slice(k))),b.appendChild(S),requestAnimationFrame(()=>{if(b){let N=Array.from(b.querySelectorAll(".search-highlight, .search-current"));_=N,N.forEach(V=>{V.setAttribute("data-node-line",String(o.startLine)),V.setAttribute("data-is-header","true"),V.setAttribute("data-source","Header"),V.setAttribute("data-header-text",o.header)}),a&&a.update&&a.update(V=>((xe,he)=>{let ye=[...xe];for(let fe of he){let _e=parseInt(fe.getAttribute("data-node-line")||"0"),Le=fe.getAttribute("data-is-header")==="true",te=0,ne=ye.length;for(;te<ne;){let ce=Math.floor((te+ne)/2),me=parseInt(ye[ce].getAttribute("data-node-line")||"0"),Se=ye[ce].getAttribute("data-is-header")==="true";_e<me||_e===me&&Le&&!Se?ne=ce:te=ce+1}ye.splice(te,0,fe)}return ye})(V,N))}})}function H(C,P,E){let{editor:T}=c,j=T.getValue(),S=C,k=T.lineCount();E<=k&&!S.endsWith(`
`)&&(S=S+`
`),T.replaceRange(S,{line:P-1,ch:0},{line:E-1,ch:0});let V=T.getValue();if(j&&V&&j!==V){let se=j.split(`
`).length,xe=V.split(`
`).length;(se!==xe||Pl(j,V))&&c.recalculateFoldStates&&c.recalculateFoldStates(j,V)}c.file&&(c.markInternalModification&&c.markInternalModification(c.file.path),c.app.vault.modify(c.file,V))}var R;(function(C){C.HEADER_ONLY="header-only",C.CURRENT_NODE="current-node",C.WITH_CHILDREN="with-children"})(R||(R={}));function O(C=R.WITH_CHILDREN){if(!c.file)return;let{editor:P}=c,E=o.startLine-1,T,j;switch(C){case R.HEADER_ONLY:T=E,j="\u6807\u9898\u884C";break;case R.CURRENT_NODE:o.children&&o.children.length>0?T=o.children[0].startLine-2:T=o.endLine-1,j="\u5F53\u524D\u8282\u70B9";break;case R.WITH_CHILDREN:default:let S=P.getValue();T=Kt(S,o.startLine)-2,j="\u5F53\u524D\u8282\u70B9\u53CA\u5B50\u8282\u70B9";break}try{let S=P.getValue();P.replaceRange("",{line:E,ch:0},{line:T+1,ch:0});let k=P.getValue();c.recalculateFoldStates&&c.recalculateFoldStates(S,k),c.markInternalModification&&c.markInternalModification(c.file.path),c.app.vault.modify(c.file,k),Bl(`${j}: ${o.header}`)}catch(S){console.error("Delete node failed:",S),new Ge.Notice("\u5220\u9664\u8282\u70B9\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5")}}function G(){if(!c.file)return;qe.getInstance(c.app).openFallbackEditor(c.file,o,c.leaf)}function K(){if(c.file){if(!o||!o.startLine){new Ge.Notice("\u5F53\u524D\u6587\u4EF6\u6CA1\u6709\u6807\u9898\uFF0C\u65E0\u6CD5\u4F7F\u7528\u6B64\u529F\u80FD");return}if(qe.isEmbeddableEditorAvailable(c.app)){let{editor:C}=c,P=C.getValue(),E=o.startLine;try{let T=Kt(P,E),j=C.getRange({line:E-1,ch:0},{line:T-1,ch:0});at.getInstance(c.app).openEditor({title:o.header,value:j,placeholder:"\u7F16\u8F91\u5F53\u524D\u8282\u70B9\u53CA\u5176\u6240\u6709\u5B50\u8282\u70B9\u7684\u5185\u5BB9...",onSave:k=>{H(k,E,T)},onCancel:()=>{}})}catch(T){console.error("\u6253\u5F00\u7F16\u8F91\u5F39\u6846\u5931\u8D25:",T),new Ge.Notice("\u65E0\u6CD5\u6253\u5F00\u7F16\u8F91\u5668\uFF0C\u8BF7\u786E\u4FDD\u5F53\u524D\u884C\u662F\u6709\u6548\u7684\u6807\u9898")}}}}async function U(C){var P;let E=document.createElement("div"),T=new Ge.Component;try{await Ge.MarkdownRenderer.render(c.app,C,E,((P=c.file)===null||P===void 0?void 0:P.path)||"",T);let j=E.innerHTML,S=E.innerText;try{let k=new Blob([j],{type:"text/html"}),N=new Blob([S],{type:"text/plain"});await navigator.clipboard.write([new ClipboardItem({"text/html":k,"text/plain":N})])}catch(k){await navigator.clipboard.writeText(S)}}finally{T.unload()}}function re(){new Pn(c.app,{node:o,app:c.app,plugin:c.plugin}).open()}$e(()=>{if(f){new Ge.ExtraButtonComponent(f).setIcon("columns").setTooltip("\u5728\u53F3\u4FA7\u7F16\u8F91\u5668\u4E2D\u6253\u5F00").onClick(()=>{G()}),new Ge.ExtraButtonComponent(f).setIcon("edit").setTooltip("\u5F39\u6846\u7F16\u8F91\u8282\u70B9\u5185\u5BB9").onClick(()=>{K()}),g=ee(f),m=To(f,async P=>{let{editor:E}=c,{startLine:T,content:j}=o;switch(P){case"\u590D\u5236\u6574\u4E2A\u6587\u6863":{let S=E.getValue();await navigator.clipboard.writeText(S);break}case"\u590D\u5236\u6B64\u8282\u70B9\uFF08\u7EAF\u6587\u672C\uFF09":{let S=E.getLine(T-1);await navigator.clipboard.writeText(`${S}
${j}`);break}case"\u590D\u5236\u8282\u70B9\u53CA\u5B50\u8282\u70B9\uFF08\u7EAF\u6587\u672C\uFF09":{let S=E.getValue(),k=Kt(S,T),N=E.getRange({line:T-1,ch:0},{line:k-1,ch:0});await navigator.clipboard.writeText(N);break}case"\u590D\u5236\u6B64\u8282\u70B9\uFF08\u5BCC\u6587\u672C\uFF09":{let k=`${E.getLine(T-1)}
${j}`;await U(k);break}case"\u590D\u5236\u8282\u70B9\u53CA\u5B50\u8282\u70B9\uFF08\u5BCC\u6587\u672C\uFF09":{let S=E.getValue(),k=Kt(S,T),N=E.getRange({line:T-1,ch:0},{line:k-1,ch:0});await U(N);break}case"\u5206\u4EAB\u4E3A\u56FE\u7247":{re();break}default:}},o.level);let C=new Ge.ExtraButtonComponent(d).setIcon(h?"chevron-down":"chevron-right").onClick(()=>{c.handleClickFold(o.startChar,o.startLine,()=>{})});c.LOCAL_FOLDS.subscribe(P=>{n(6,h=!P.includes(o.startLine-1)),C.setIcon(h?"chevron-down":"chevron-right")})}return()=>{p&&p(),m&&m(),g&&g()}}),tt(()=>{_.length>0&&a&&a.update&&a.update(C=>C.filter(P=>!_.includes(P)))});function ue(C){pe[C?"unshift":"push"](()=>{d=C,n(5,d)})}function ge(C){pe[C?"unshift":"push"](()=>{u=C,n(1,u)})}function ie(C){pe[C?"unshift":"push"](()=>{x=C,n(8,x)})}function He(C){pe[C?"unshift":"push"](()=>{b=C,n(7,b)})}function D(C){pe[C?"unshift":"push"](()=>{f=C,n(2,f)})}return t.$$set=C=>{"node"in C&&n(0,o=C.node),"currentLines"in C&&n(14,i=C.currentLines),"searchKeyword"in C&&n(15,s=C.searchKeyword),"allHighlights"in C&&n(16,a=C.allHighlights),"triggerEditHeader"in C&&n(17,l=C.triggerEditHeader)},t.$$.update=()=>{if(t.$$.dirty[0]&131088){e:l&&!y&&M()}if(t.$$.dirty[0]&16395){e:i>0&&(n(3,v=i===o.startLine),v&&u&&(Ao(u)||setTimeout(()=>{u.scrollIntoView({behavior:"smooth",block:"start"})},0)))}if(t.$$.dirty[0]&32768){e:s!==void 0&&ve()}if(t.$$.dirty[0]&1){e:n(9,r=o.header.trim()||"\u7A7A\u6807\u9898")}if(t.$$.dirty[0]&262151){e:f&&(p&&p&&p(),n(18,p=Io(u,o.level,()=>{})))}},[o,u,f,v,y,d,h,b,x,r,Y,Q,de,oe,i,s,a,l,p,ue,ge,ie,He,D]}var Hr=class extends Ce{constructor(e){super(),Te(this,e,Wl,Ol,Ee,{node:0,currentLines:14,searchKeyword:15,allHighlights:16,triggerEditHeader:17},Rl,[-1,-1])}},Vr=Hr;function Ut(t){let e=t-1;return e*e*e+1}function wt(t){return--t*t*t*t*t+1}function dn(t,{delay:e=0,duration:n=400,easing:r=gt}={}){let o=+getComputedStyle(t).opacity;return{delay:e,duration:n,easing:r,css:i=>`opacity: ${i*o}`}}function un(t,{delay:e=0,duration:n=400,easing:r=Ut,x:o=0,y:i=0,opacity:s=0}={}){let a=getComputedStyle(t),l=+a.opacity,c=a.transform==="none"?"":a.transform,d=l*(1-s),[u,f]=nr(o),[h,p]=nr(i);return{delay:e,duration:n,easing:r,css:(m,g)=>`
			transform: ${c} translate(${(1-m)*u}${f}, ${(1-m)*h}${p});
			opacity: ${l-d*g}`}}function xi(t,{delay:e=0,duration:n=400,easing:r=Ut,axis:o="y"}={}){let i=getComputedStyle(t),s=+i.opacity,a=o==="y"?"height":"width",l=parseFloat(i[a]),c=o==="y"?["top","bottom"]:["left","right"],d=c.map(v=>`${v[0].toUpperCase()}${v.slice(1)}`),u=parseFloat(i[`padding${d[0]}`]),f=parseFloat(i[`padding${d[1]}`]),h=parseFloat(i[`margin${d[0]}`]),p=parseFloat(i[`margin${d[1]}`]),m=parseFloat(i[`border${d[0]}Width`]),g=parseFloat(i[`border${d[1]}Width`]);return{delay:e,duration:n,easing:r,css:v=>`overflow: hidden;opacity: ${Math.min(v*20,1)*s};${a}: ${v*l}px;padding-${c[0]}: ${v*u}px;padding-${c[1]}: ${v*f}px;margin-${c[0]}: ${v*h}px;margin-${c[1]}: ${v*p}px;border-${c[0]}-width: ${v*m}px;border-${c[1]}-width: ${v*g}px;`}}function zl(t){Ie(t,"svelte-u4gy5o",'@charset "UTF-8";.root-container.svelte-u4gy5o.svelte-u4gy5o{position:relative;cursor:pointer;border:2px solid transparent;border-radius:8px;padding:10px;transition:border-color 0.2s ease-in-out}.root-container.selected.svelte-u4gy5o.svelte-u4gy5o{border-color:var(--interactive-accent);box-shadow:0 0 0 1px var(--interactive-accent)}.root-container.svelte-u4gy5o.svelte-u4gy5o:has(.markdown-editor-container){border-color:transparent !important;box-shadow:none !important}.root-title-header.svelte-u4gy5o.svelte-u4gy5o{padding:30px 0px;border:none;margin:0}.add-child-btn.svelte-u4gy5o.svelte-u4gy5o{position:absolute;bottom:-14px;left:50%;transform:translateX(-50%);width:28px;height:28px;border-radius:50%;background:var(--interactive-accent);color:var(--text-on-accent);border:2px solid var(--background-primary);cursor:pointer;display:flex;align-items:center;justify-content:center;z-index:10;opacity:0;transition:all 0.2s ease-in-out;box-shadow:0 2px 8px rgba(0, 0, 0, 0.15);padding:0;pointer-events:none}.add-child-btn.svelte-u4gy5o.svelte-u4gy5o:hover{transform:translateX(-50%) scale(1.15);box-shadow:0 4px 12px rgba(0, 0, 0, 0.25)}.add-child-btn.svelte-u4gy5o.svelte-u4gy5o:active{transform:translateX(-50%) scale(0.95)}.add-child-btn.svelte-u4gy5o svg{width:16px;height:16px;display:block;flex-shrink:0}.root-container.svelte-u4gy5o:hover .add-child-btn.svelte-u4gy5o{opacity:1;pointer-events:auto}.root-container.svelte-u4gy5o:has(.markdown-editor-container) .add-child-btn.svelte-u4gy5o{opacity:0 !important;pointer-events:none}.tree-children-container.svelte-u4gy5o.svelte-u4gy5o{width:100%;max-width:100%;display:flex}.left-column.svelte-u4gy5o.svelte-u4gy5o{max-width:100%;flex:1 1 0%;padding:0px 10px;overflow-wrap:break-word;word-break:break-word;cursor:pointer;border:2px solid transparent;border-radius:6px;transition:border-color 0.2s ease-in-out;position:relative}.left-column.selected.svelte-u4gy5o.svelte-u4gy5o{border-color:var(--interactive-accent);box-shadow:0 0 0 1px var(--interactive-accent)}.left-column.svelte-u4gy5o.svelte-u4gy5o:has(.markdown-editor-container){border-color:transparent !important;box-shadow:none !important}.add-header-btn.svelte-u4gy5o.svelte-u4gy5o{position:absolute;width:28px;height:28px;border-radius:50%;background:var(--interactive-accent);color:var(--text-on-accent);border:2px solid var(--background-primary);cursor:pointer;display:flex;align-items:center;justify-content:center;z-index:10;opacity:0;transition:all 0.2s ease-in-out;box-shadow:0 2px 8px rgba(0, 0, 0, 0.15);padding:0;pointer-events:none}.add-header-btn.svelte-u4gy5o.svelte-u4gy5o:hover{transform:scale(1.15);box-shadow:0 4px 12px rgba(0, 0, 0, 0.25)}.add-header-btn.svelte-u4gy5o.svelte-u4gy5o:active{transform:scale(0.95)}.add-header-btn.svelte-u4gy5o svg{width:16px;height:16px;display:block;flex-shrink:0}.left-column.svelte-u4gy5o:hover .add-header-btn.svelte-u4gy5o{opacity:1;pointer-events:auto}.left-column.svelte-u4gy5o:has(.markdown-editor-container) .add-header-btn.svelte-u4gy5o{opacity:0 !important;pointer-events:none}.add-header-top.svelte-u4gy5o.svelte-u4gy5o{top:-14px;left:50%;transform:translateX(-50%)}.add-header-bottom.svelte-u4gy5o.svelte-u4gy5o{bottom:-14px;left:50%;transform:translateX(-50%)}.add-header-right.svelte-u4gy5o.svelte-u4gy5o{top:50%;right:-14px;transform:translateY(-50%)}.add-header-top.svelte-u4gy5o.svelte-u4gy5o:hover{transform:translateX(-50%) scale(1.15)}.add-header-bottom.svelte-u4gy5o.svelte-u4gy5o:hover{transform:translateX(-50%) scale(1.15)}.add-header-right.svelte-u4gy5o.svelte-u4gy5o:hover{transform:translateY(-50%) scale(1.15)}.right-column.svelte-u4gy5o.svelte-u4gy5o{overflow-wrap:break-word;word-break:break-word;min-width:50%}.left-column .inline-title{display:none}.left-column .markdown-rendered:not(.is-live-preview){max-width:100%;overflow-x:auto}.left-column .metadata-container{display:none !important}.search-highlight{background:var(--text-highlight-bg);color:var(--text-on-accent);border-radius:2px;box-shadow:0 0 0 2px var(--text-highlight-bg)}.search-current{background:var(--text-selection);color:var(--text-normal)}')}function ql(t){let e,n,r,o,i,s,a,l,c;return n=new Vr({props:{currentLines:t[2],node:t[0],searchKeyword:t[15],allHighlights:t[5],triggerEditHeader:t[12]}}),{c(){e=F("div"),Ve(n.$$.fragment),w(e,"data-node-id",r=t[0].id),w(e,"data-node-level",o=t[0].level),w(e,"data-start-line",i=t[0].startLine),w(e,"data-end-line",s=t[0].endLine),w(e,"data-start-char",a=t[0].startChar),w(e,"data-end-char",l=t[0].endChar)},m(d,u){$(d,e,u),De(n,e,null),c=!0},p(d,u){let f={};u[0]&4&&(f.currentLines=d[2]),u[0]&1&&(f.node=d[0]),u[0]&32768&&(f.searchKeyword=d[15]),u[0]&32&&(f.allHighlights=d[5]),u[0]&4096&&(f.triggerEditHeader=d[12]),n.$set(f),(!c||u[0]&1&&r!==(r=d[0].id))&&w(e,"data-node-id",r),(!c||u[0]&1&&o!==(o=d[0].level))&&w(e,"data-node-level",o),(!c||u[0]&1&&i!==(i=d[0].startLine))&&w(e,"data-start-line",i),(!c||u[0]&1&&s!==(s=d[0].endLine))&&w(e,"data-end-line",s),(!c||u[0]&1&&a!==(a=d[0].startChar))&&w(e,"data-start-char",a),(!c||u[0]&1&&l!==(l=d[0].endChar))&&w(e,"data-end-char",l)},i(d){c||(z(n.$$.fragment,d),c=!0)},o(d){J(n.$$.fragment,d),c=!1},d(d){d&&q(e),Re(n)}}}function Ul(t){let e,n,r,o,i,s,a,l,c,d,u;r=new Vr({props:{currentLines:t[2],node:t[0],searchKeyword:t[15],allHighlights:t[5],triggerEditHeader:t[12]}});let f=t[13]&&ki(t);return{c(){e=F("div"),n=F("h1"),Ve(r.$$.fragment),o=X(),f&&f.c(),w(n,"class","root-title-header svelte-u4gy5o"),w(e,"data-node-id",i=t[0].id),w(e,"data-node-level",s=t[0].level),w(e,"data-start-line",a=t[0].startLine),w(e,"data-end-line",l=t[0].endLine),w(e,"data-start-char",c=t[0].startChar),w(e,"data-end-char",d=t[0].endChar)},m(h,p){$(h,e,p),A(e,n),De(r,n,null),A(e,o),f&&f.m(e,null),u=!0},p(h,p){let m={};p[0]&4&&(m.currentLines=h[2]),p[0]&1&&(m.node=h[0]),p[0]&32768&&(m.searchKeyword=h[15]),p[0]&32&&(m.allHighlights=h[5]),p[0]&4096&&(m.triggerEditHeader=h[12]),r.$set(m),h[13]?f?(f.p(h,p),p[0]&8192&&z(f,1)):(f=ki(h),f.c(),z(f,1),f.m(e,null)):f&&(Ne(),J(f,1,1,()=>{f=null}),Fe()),(!u||p[0]&1&&i!==(i=h[0].id))&&w(e,"data-node-id",i),(!u||p[0]&1&&s!==(s=h[0].level))&&w(e,"data-node-level",s),(!u||p[0]&1&&a!==(a=h[0].startLine))&&w(e,"data-start-line",a),(!u||p[0]&1&&l!==(l=h[0].endLine))&&w(e,"data-end-line",l),(!u||p[0]&1&&c!==(c=h[0].startChar))&&w(e,"data-start-char",c),(!u||p[0]&1&&d!==(d=h[0].endChar))&&w(e,"data-end-char",d)},i(h){u||(z(r.$$.fragment,h),z(f),u=!0)},o(h){J(r.$$.fragment,h),J(f),u=!1},d(h){h&&q(e),Re(r),f&&f.d()}}}function ki(t){let e,n,r,o,i,s,a,l,c=t[10]&&_i(t);return r=new gr({props:{node:t[0],View:t[16],searchKeyword:t[3],searchIndex:t[4],allHighlights:t[5],isLevelOne:!0,triggerEdit:t[11],isSelected:t[10]}}),r.$on("contentUpdated",t[27]),r.$on("headerUpdated",t[28]),{c(){e=F("div"),c&&c.c(),n=X(),Ve(r.$$.fragment),w(e,"class","level-1-content root-container svelte-u4gy5o"),w(e,"data-start-line",o=t[0].startLine),w(e,"role","button"),w(e,"tabindex","0"),we(e,"max-width","70%"),we(e,"margin","0 auto"),Z(e,"selected",t[10])},m(d,u){$(d,e,u),c&&c.m(e,null),A(e,n),De(r,e,null),s=!0,a||(l=[le(e,"click",t[21]),le(e,"keydown",t[22])],a=!0)},p(d,u){d[10]?c?c.p(d,u):(c=_i(d),c.c(),c.m(e,n)):c&&(c.d(1),c=null);let f={};u[0]&1&&(f.node=d[0]),u[0]&8&&(f.searchKeyword=d[3]),u[0]&16&&(f.searchIndex=d[4]),u[0]&32&&(f.allHighlights=d[5]),u[0]&2048&&(f.triggerEdit=d[11]),u[0]&1024&&(f.isSelected=d[10]),r.$set(f),(!s||u[0]&1&&o!==(o=d[0].startLine))&&w(e,"data-start-line",o),(!s||u[0]&1024)&&Z(e,"selected",d[10])},i(d){s||(z(r.$$.fragment,d),d&&je(()=>{s&&(i||(i=st(e,t[24],{duration:400,easing:wt},!0)),i.run(1))}),s=!0)},o(d){J(r.$$.fragment,d),d&&(i||(i=st(e,t[24],{duration:400,easing:wt},!1)),i.run(0)),s=!1},d(d){d&&q(e),c&&c.d(),Re(r),d&&i&&i.end(),a=!1,be(l)}}}function _i(t){let e,n,r;return{c(){e=F("button"),e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>',w(e,"class","add-child-btn svelte-u4gy5o"),w(e,"title","\u6DFB\u52A0\u4E8C\u7EA7\u5B50\u6807\u9898"),w(e,"aria-label","\u6DFB\u52A0\u4E8C\u7EA7\u5B50\u6807\u9898")},m(o,i){$(o,e,i),n||(r=le(e,"click",Qt(t[34])),n=!0)},p:ae,d(o){o&&q(e),n=!1,r()}}}function Si(t){let e,n,r,o,i=t[9]==!1&&Ci(t),s=t[0].children&&t[0].children.length>0&&t[0].level<=t[7]&&Li(t);return{c(){e=F("div"),i&&i.c(),n=X(),s&&s.c(),w(e,"class","tree-children-container svelte-u4gy5o")},m(a,l){$(a,e,l),i&&i.m(e,null),A(e,n),s&&s.m(e,null),o=!0},p(a,l){a[9]==!1?i?(i.p(a,l),l[0]&512&&z(i,1)):(i=Ci(a),i.c(),z(i,1),i.m(e,n)):i&&(Ne(),J(i,1,1,()=>{i=null}),Fe()),a[0].children&&a[0].children.length>0&&a[0].level<=a[7]?s?(s.p(a,l),l[0]&129&&z(s,1)):(s=Li(a),s.c(),z(s,1),s.m(e,null)):s&&(Ne(),J(s,1,1,()=>{s=null}),Fe())},i(a){o||(z(i),z(s),a&&je(()=>{o&&(r||(r=st(e,t[24],{duration:350,easing:Ut},!0)),r.run(1))}),o=!0)},o(a){J(i),J(s),a&&(r||(r=st(e,t[24],{duration:350,easing:Ut},!1)),r.run(0)),o=!1},d(a){a&&q(e),i&&i.d(),s&&s.d(),a&&r&&r.end()}}}function Ci(t){let e,n,r,o,i,s,a,l,c,d=t[10]&&Ei(t);return r=new gr({props:{node:t[0],View:t[16],searchKeyword:t[3],searchIndex:t[4],allHighlights:t[5],isLevelOne:!1,triggerEdit:t[11],isSelected:t[10]}}),r.$on("contentUpdated",t[27]),r.$on("headerUpdated",t[28]),{c(){e=F("div"),d&&d.c(),n=X(),Ve(r.$$.fragment),w(e,"class","left-column svelte-u4gy5o"),we(e,"flex","1 1 0%"),w(e,"data-start-line",o=t[0].startLine),w(e,"role","button"),w(e,"tabindex","0"),Z(e,"selected",t[10])},m(u,f){$(u,e,f),d&&d.m(e,null),A(e,n),De(r,e,null),t[38](e),a=!0,l||(c=[le(e,"click",t[21]),le(e,"keydown",t[22])],l=!0)},p(u,f){u[10]?d?d.p(u,f):(d=Ei(u),d.c(),d.m(e,n)):d&&(d.d(1),d=null);let h={};f[0]&1&&(h.node=u[0]),f[0]&8&&(h.searchKeyword=u[3]),f[0]&16&&(h.searchIndex=u[4]),f[0]&32&&(h.allHighlights=u[5]),f[0]&2048&&(h.triggerEdit=u[11]),f[0]&1024&&(h.isSelected=u[10]),r.$set(h),(!a||f[0]&1&&o!==(o=u[0].startLine))&&w(e,"data-start-line",o),(!a||f[0]&1024)&&Z(e,"selected",u[10])},i(u){a||(z(r.$$.fragment,u),u&&je(()=>{a&&(s&&s.end(1),i=fr(e,t[25],{x:-20,duration:300,delay:100,easing:wt}),i.start())}),a=!0)},o(u){J(r.$$.fragment,u),i&&i.invalidate(),u&&(s=hr(e,t[26],{duration:200})),a=!1},d(u){u&&q(e),d&&d.d(),Re(r),t[38](null),u&&s&&s.end(),l=!1,be(c)}}}function Ei(t){let e,n,r,o,i,s,a,l=t[8]&&Mi(t);return{c(){e=F("button"),e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>',n=X(),r=F("button"),r.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>',o=X(),l&&l.c(),i=_t(),w(e,"class","add-header-btn add-header-top svelte-u4gy5o"),w(e,"title","\u5728\u4E0A\u65B9\u63D2\u5165\u540C\u7EA7\u6807\u9898 (Ctrl+Shift+\u2191)"),w(e,"aria-label","\u5728\u4E0A\u65B9\u63D2\u5165\u540C\u7EA7\u6807\u9898"),w(r,"class","add-header-btn add-header-bottom svelte-u4gy5o"),w(r,"title","\u5728\u4E0B\u65B9\u63D2\u5165\u540C\u7EA7\u6807\u9898 (Ctrl+Shift+\u2193)"),w(r,"aria-label","\u5728\u4E0B\u65B9\u63D2\u5165\u540C\u7EA7\u6807\u9898")},m(c,d){$(c,e,d),$(c,n,d),$(c,r,d),$(c,o,d),l&&l.m(c,d),$(c,i,d),s||(a=[le(e,"click",Qt(t[35])),le(r,"click",Qt(t[36]))],s=!0)},p(c,d){c[8]?l?l.p(c,d):(l=Mi(c),l.c(),l.m(i.parentNode,i)):l&&(l.d(1),l=null)},d(c){c&&(q(e),q(n),q(r),q(o),q(i)),l&&l.d(c),s=!1,be(a)}}}function Mi(t){let e,n,r;return{c(){e=F("button"),e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>',w(e,"class","add-header-btn add-header-right svelte-u4gy5o"),w(e,"title","\u5728\u53F3\u4FA7\u63D2\u5165\u5B50\u7EA7\u6807\u9898 (Ctrl+Shift+\u2192)"),w(e,"aria-label","\u5728\u53F3\u4FA7\u63D2\u5165\u5B50\u7EA7\u6807\u9898")},m(o,i){$(o,e,i),n||(r=le(e,"click",Qt(t[37])),n=!0)},p:ae,d(o){o&&q(e),n=!1,r()}}}function Li(t){let e,n,r,o,i;return n=new Bn({props:{currentLines:t[2],nodes:t[0].children,tier:t[1]+1,searchKeyword:t[3],searchIndex:t[4],allHighlights:t[5]}}),n.$on("contentUpdated",t[27]),n.$on("headerUpdated",t[28]),{c(){e=F("div"),Ve(n.$$.fragment),w(e,"class","right-column svelte-u4gy5o"),we(e,"flex",t[14]+" 1 0%")},m(s,a){$(s,e,a),De(n,e,null),i=!0},p(s,a){let l={};a[0]&4&&(l.currentLines=s[2]),a[0]&1&&(l.nodes=s[0].children),a[0]&2&&(l.tier=s[1]+1),a[0]&8&&(l.searchKeyword=s[3]),a[0]&16&&(l.searchIndex=s[4]),a[0]&32&&(l.allHighlights=s[5]),n.$set(l),(!i||a[0]&16384)&&we(e,"flex",s[14]+" 1 0%")},i(s){i||(z(n.$$.fragment,s),s&&je(()=>{i&&(o&&o.end(1),r=fr(e,t[25],{x:20,duration:300,delay:150,easing:wt}),r.start())}),i=!0)},o(s){J(n.$$.fragment,s),r&&r.invalidate(),s&&(o=hr(e,t[26],{duration:200})),i=!1},d(s){s&&q(e),Re(n),s&&o&&o.end()}}}function $l(t){let e,n,r,o,i,s,a=[Ul,ql],l=[];function c(u,f){return u[9]?0:1}n=c(t,[-1,-1]),r=l[n]=a[n](t);let d=t[13]&&Si(t);return{c(){e=F("div"),r.c(),o=X(),d&&d.c(),w(e,"class","gridnote-tree-item"),w(e,"data-node-id",i=t[0].id)},m(u,f){$(u,e,f),l[n].m(e,null),A(e,o),d&&d.m(e,null),s=!0},p(u,f){let h=n;n=c(u,f),n===h?l[n].p(u,f):(Ne(),J(l[h],1,1,()=>{l[h]=null}),Fe(),r=l[n],r?r.p(u,f):(r=l[n]=a[n](u),r.c()),z(r,1),r.m(e,o)),u[13]?d?(d.p(u,f),f[0]&8192&&z(d,1)):(d=Si(u),d.c(),z(d,1),d.m(e,null)):d&&(Ne(),J(d,1,1,()=>{d=null}),Fe()),(!s||f[0]&1&&i!==(i=u[0].id))&&w(e,"data-node-id",i)},i(u){s||(z(r),z(d),s=!0)},o(u){J(r),J(d),s=!1},d(u){u&&q(e),l[n].d(),d&&d.d()}}}function jl(t){let e=t.getBoundingClientRect();return e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)}function Gl(t,e,n){let r,o,i,s,a,l,c,d,u,f=ae,h=()=>(f(),f=ut(v,E=>n(15,u=E)),v);t.$$.on_destroy.push(()=>f());let{node:p}=e,{tier:m}=e,{currentLines:g}=e,{searchKeyword:v}=e;h();let{searchIndex:b}=e,{allHighlights:_}=e,y=ot("View"),x=ot("flexStore"),M=ot("selectedNodeLine");ft(t,M,E=>n(33,d=E));let I=ot("editTrigger");ft(t,I,E=>n(32,c=E));let L=ot("insertTrigger");ft(t,L,E=>n(31,l=E));let W=ot("editHeaderTrigger");ft(t,W,E=>n(30,a=E));function Y(E){let T=E.target;if(E.currentTarget.querySelector(".markdown-editor-container")!==null)return;if(!T.closest(".markdown-rendered, .header, .add-header-btn, .add-child-btn")&&o){M.set(null);return}o||M.set(p.startLine)}function Q(E){E.key==="Enter"&&Y(E)}let de,oe=!1,Me=0,ee=!1;async function ve(E){if(!(!y.file||!y.app))try{let T=await y.app.vault.read(y.file),j,S;switch(E){case"before":j=p.startLine,S=p.level;break;case"after":j=Zr(T,p.startLine,p.level),S=p.level;break;case"child":j=Qr(T,p.startLine),S=p.level+1;break}let k=eo(T,j,S);await y.app.vault.modify(y.file,k),M.set(j),y.render&&setTimeout(()=>{y.render(k)},100)}catch(T){console.error("\u63D2\u5165\u6807\u9898\u5931\u8D25:",T)}}let H=!0,R=[];function O(){let E=Date.now();return y.lastUserFoldInteraction>0&&E-y.lastUserFoldInteraction<500}y.LOCAL_FOLDS.subscribe(E=>{R=E,n(13,H=!E.includes(p.startLine-1))});function G(E,T){return O()?xi(E,T):{duration:0,css:()=>""}}function K(E,T){return O()?un(E,T):{duration:0,css:()=>""}}function U(E,T){return O()?dn(E,T):{duration:0,css:()=>""}}let re=3;$e(()=>{x.subscribe(E=>{n(7,re=E.tier),n(14,s=re-m)})});function ue(E){let{node:T,newContent:j,fullMarkdown:S,skipGlobalRefresh:k}=E.detail;T===p&&(n(0,p.content=j,p),n(0,p=Object.assign({},p))),!k&&y&&y.render&&S&&setTimeout(()=>{y.render(S)},100)}function ge(E){let{node:T,oldHeader:j,newHeader:S,oldLevel:k,newLevel:N}=E.detail;T===p&&(n(0,p.header=S,p),n(0,p.level=N,p),n(0,p=Object.assign({},p)))}let ie=()=>ve("child"),He=()=>ve("before"),D=()=>ve("after"),C=()=>ve("child");function P(E){pe[E?"unshift":"push"](()=>{de=E,n(6,de)})}return t.$$set=E=>{"node"in E&&n(0,p=E.node),"tier"in E&&n(1,m=E.tier),"currentLines"in E&&n(2,g=E.currentLines),"searchKeyword"in E&&h(n(3,v=E.searchKeyword)),"searchIndex"in E&&n(4,b=E.searchIndex),"allHighlights"in E&&n(5,_=E.allHighlights)},t.$$.update=()=>{if(t.$$.dirty[0]&1){e:n(9,r=p.level===1)}if(t.$$.dirty[0]&1|t.$$.dirty[1]&4){e:n(10,o=d===p.startLine)}if(t.$$.dirty[0]&129){e:n(8,i=p.level<6&&p.level<=re)}if(t.$$.dirty[0]&1600){e:o&&de&&!r&&nt().then(()=>{jl(de)||de.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})})}if(t.$$.dirty[0]&536870913|t.$$.dirty[1]&2){e:c===p.startLine&&(n(29,Me++,Me),n(11,oe=!0),I.set(null),setTimeout(()=>{n(11,oe=!1)},100))}if(t.$$.dirty[0]&769|t.$$.dirty[1]&1){e:if(l&&l.line===p.startLine&&!r){let E=l.position;L.set(null),(E!=="child"||i)&&ve(E)}}if(t.$$.dirty[0]&1073741825){e:a===p.startLine&&(n(12,ee=!0),W.set(null),setTimeout(()=>{n(12,ee=!1)},100))}if(t.$$.dirty[0]&130){e:n(14,s=re-m)}},[p,m,g,v,b,_,de,re,i,r,o,oe,ee,H,s,u,y,M,I,L,W,Y,Q,ve,G,K,U,ue,ge,Me,a,l,c,d,ie,He,D,C,P]}var Or=class extends Ce{constructor(e){super(),Te(this,e,Gl,$l,Ee,{node:0,tier:1,currentLines:2,searchKeyword:3,searchIndex:4,allHighlights:5},zl,[-1,-1])}},Ii=Or;function Kl(t){Ie(t,"svelte-zw1sbl",".tree-container.svelte-zw1sbl{width:100%;height:100%;position:relative}.tree-list.svelte-zw1sbl{width:100%;list-style-type:none;padding-left:0;margin:0;padding-top:0}.tree-container.svelte-zw1sbl::-webkit-scrollbar{width:8px}.tree-container.svelte-zw1sbl::-webkit-scrollbar-track{background:var(--background-primary)}.tree-container.svelte-zw1sbl::-webkit-scrollbar-thumb{background:var(--background-modifier-border);border-radius:4px}.tree-container.svelte-zw1sbl::-webkit-scrollbar-thumb:hover{background:var(--background-modifier-border-hover)}")}function Ti(t,e,n){let r=t.slice();return r[8]=e[n],r}function Ai(t,e){let n,r,o,i;return r=new Ii({props:{currentLines:e[2],node:e[8],tier:e[1],searchKeyword:e[3],searchIndex:e[4],allHighlights:e[5]}}),{key:t,first:null,c(){n=F("li"),Ve(r.$$.fragment),o=X(),this.first=n},m(s,a){$(s,n,a),De(r,n,null),A(n,o),i=!0},p(s,a){e=s;let l={};a&4&&(l.currentLines=e[2]),a&1&&(l.node=e[8]),a&2&&(l.tier=e[1]),a&8&&(l.searchKeyword=e[3]),a&16&&(l.searchIndex=e[4]),a&32&&(l.allHighlights=e[5]),r.$set(l)},i(s){i||(z(r.$$.fragment,s),i=!0)},o(s){J(r.$$.fragment,s),i=!1},d(s){s&&q(n),Re(r)}}}function Xl(t){let e,n,r=[],o=new Map,i,s=ze(t[0]),a=l=>l[8].id;for(let l=0;l<s.length;l+=1){let c=Ti(t,s,l),d=a(c);o.set(d,r[l]=Ai(d,c))}return{c(){e=F("div"),n=F("ul");for(let l=0;l<r.length;l+=1)r[l].c();w(n,"class","tree-list svelte-zw1sbl"),w(e,"class","tree-container svelte-zw1sbl")},m(l,c){$(l,e,c),A(e,n);for(let d=0;d<r.length;d+=1)r[d]&&r[d].m(n,null);t[7](e),i=!0},p(l,[c]){c&63&&(s=ze(l[0]),Ne(),r=xo(r,c,a,1,l,s,o,n,wo,Ai,null,Ti),Fe())},i(l){if(!i){for(let c=0;c<s.length;c+=1)z(r[c]);i=!0}},o(l){for(let c=0;c<r.length;c+=1)J(r[c]);i=!1},d(l){l&&q(e);for(let c=0;c<r.length;c+=1)r[c].d();t[7](null)}}}function Yl(t,e,n){let{nodes:r}=e,{tier:o}=e,{currentLines:i}=e,{searchKeyword:s}=e,{searchIndex:a}=e,{allHighlights:l}=e,c;function d(u){pe[u?"unshift":"push"](()=>{c=u,n(6,c)})}return t.$$set=u=>{"nodes"in u&&n(0,r=u.nodes),"tier"in u&&n(1,o=u.tier),"currentLines"in u&&n(2,i=u.currentLines),"searchKeyword"in u&&n(3,s=u.searchKeyword),"searchIndex"in u&&n(4,a=u.searchIndex),"allHighlights"in u&&n(5,l=u.allHighlights)},[r,o,i,s,a,l,c,d]}var Pr=class extends Ce{constructor(e){super(),Te(this,e,Yl,Xl,Ee,{nodes:0,tier:1,currentLines:2,searchKeyword:3,searchIndex:4,allHighlights:5},Kl)}},Bn=Pr;function Jl(t){Ie(t,"svelte-52qe79",'.search-bar.svelte-52qe79{display:flex;align-items:center;gap:8px;padding:6px 12px;background:var(--background-primary);border-radius:6px;box-shadow:0 2px 8px rgba(0,0,0,0.15)}input[type="text"].svelte-52qe79{flex:1;padding:4px 10px;border:1px solid var(--background-modifier-border);border-radius:4px;background:var(--background-primary);color:var(--text-normal);font-size:var(--font-small);transition:border-color 0.2s, box-shadow 0.2s}input[type="text"].svelte-52qe79:focus{outline:none;border-color:var(--interactive-accent);box-shadow:0 0 0 2px var(--interactive-accent-hover)}.search-btn.svelte-52qe79{padding:4px 8px;min-width:28px;height:28px;border:none;background:var(--interactive-normal);color:var(--text-normal);border-radius:4px;cursor:pointer;transition:all 0.2s;font-size:var(--font-small);display:flex;align-items:center;justify-content:center}.search-btn.svelte-52qe79:hover{background:var(--interactive-hover)}.search-btn.svelte-52qe79:active{background:var(--interactive-accent);color:var(--text-on-accent)}.search-btn.svelte-52qe79:disabled{background:var(--background-modifier-border);color:var(--text-faint);cursor:not-allowed}.result.svelte-52qe79{min-width:50px;text-align:center;color:var(--text-muted);font-size:var(--font-smaller);font-weight:500;padding:2px 6px}.result.has-results.svelte-52qe79{color:var(--interactive-accent)}.search-close.svelte-52qe79{padding:4px 6px;min-width:24px;height:24px;border:none;background:transparent;color:var(--text-muted);border-radius:50%;cursor:pointer;transition:all 0.2s;font-size:var(--font-smaller);display:flex;align-items:center;justify-content:center}.search-close.svelte-52qe79:hover{background:var(--background-modifier-hover);color:var(--text-normal)}')}function Zl(t){let e,n,r,o,i,s,a,l,c,d,u,f,h=t[2]>0?`${t[3]+1}/${t[2]}`:"\u65E0\u7ED3\u679C",p,m,g,v,b;return{c(){e=F("div"),n=F("input"),r=X(),o=F("button"),i=Qe("\u2191"),a=X(),l=F("button"),c=Qe("\u2193"),u=X(),f=F("span"),p=Qe(h),m=X(),g=F("button"),g.textContent="\u2715",w(n,"type","text"),w(n,"placeholder","\u641C\u7D22..."),w(n,"class","svelte-52qe79"),w(o,"class","search-btn svelte-52qe79"),o.disabled=s=t[2]===0,w(o,"title","\u4E0A\u4E00\u4E2A (Shift+Enter)"),w(l,"class","search-btn svelte-52qe79"),l.disabled=d=t[2]===0,w(l,"title","\u4E0B\u4E00\u4E2A (Enter)"),w(f,"class","result svelte-52qe79"),Z(f,"has-results",t[2]>0),w(g,"class","search-close svelte-52qe79"),w(g,"title","\u5173\u95ED (Esc)"),w(e,"class","search-bar search-component svelte-52qe79")},m(_,y){$(_,e,y),A(e,n),ir(n,t[1]),t[15](n),A(e,r),A(e,o),A(o,i),A(e,a),A(e,l),A(l,c),A(e,u),A(e,f),A(f,p),A(e,m),A(e,g),v||(b=[le(n,"input",t[5]),le(n,"input",t[14]),le(n,"focus",t[8]),le(n,"blur",t[9]),le(n,"keydown",t[10]),le(o,"click",t[6]),le(l,"click",t[7]),le(g,"click",t[16])],v=!0)},p(_,[y]){y&2&&n.value!==_[1]&&ir(n,_[1]),y&4&&s!==(s=_[2]===0)&&(o.disabled=s),y&4&&d!==(d=_[2]===0)&&(l.disabled=d),y&12&&h!==(h=_[2]>0?`${_[3]+1}/${_[2]}`:"\u65E0\u7ED3\u679C")&&St(p,h),y&4&&Z(f,"has-results",_[2]>0)},i:ae,o:ae,d(_){_&&q(e),t[15](null),v=!1,be(b)}}}function Ql(t,e,n){let{searchKeyword:r}=e,{searchIndex:o}=e,{searchCount:i}=e,{inputEl:s=null}=e,a=tn(),l="",c=0,d=0,u=null,f="";function h(I){n(1,l=I.target.value),u&&clearTimeout(u);let L=l.length>10?300:200;u=setTimeout(()=>{l!==f&&(r.set(l),o.set(0),a("search",{keyword:l}),f=l)},L)}function p(){c!==0&&(o.update(I=>(I-1+c)%c),a("jump",{direction:"prev"}))}function m(){c!==0&&(o.update(I=>(I+1)%c),a("jump",{direction:"next"}))}function g(I){if(I.key==="Enter"){if(c===0)return;I.shiftKey?p():m(),I.preventDefault()}}function v(){s&&s.removeEventListener("keydown",g),s&&s.addEventListener("keydown",g)}function b(){s&&s.removeEventListener("keydown",g)}$e(()=>{}),tt(()=>{s&&s.removeEventListener("keydown",g),r.set(""),o.set(0),i.set(0)});function _(I){I.key==="Escape"&&(a("exit"),I.stopPropagation())}function y(){l=this.value,n(1,l)}function x(I){pe[I?"unshift":"push"](()=>{s=I,n(0,s)})}let M=()=>a("exit");return t.$$set=I=>{"searchKeyword"in I&&n(11,r=I.searchKeyword),"searchIndex"in I&&n(12,o=I.searchIndex),"searchCount"in I&&n(13,i=I.searchCount),"inputEl"in I&&n(0,s=I.inputEl)},t.$$.update=()=>{if(t.$$.dirty&8192){e:i.subscribe(I=>n(2,c=I))}if(t.$$.dirty&4096){e:o.subscribe(I=>n(3,d=I))}},[s,l,c,d,a,h,p,m,v,b,_,r,o,i,y,x,M]}var Br=class extends Ce{constructor(e){super(),Te(this,e,Ql,Zl,Ee,{searchKeyword:11,searchIndex:12,searchCount:13,inputEl:0},Jl)}},Ni=Br;var rt=require("obsidian");var Fi=require("@codemirror/commands");function ec(t){Ie(t,"svelte-13uxerw",`@charset "UTF-8";.vertical-toolbar.svelte-13uxerw{position:fixed;bottom:16px;left:50%;transform:translateX(-50%);z-index:1000;background:var(--background-primary);border:1px solid var(--background-modifier-border);border-radius:12px;padding:8px 12px;margin-bottom:max(0px, env(safe-area-inset-bottom, 0px));box-shadow:0 4px 20px rgba(0, 0, 0, 0.2);display:flex;flex-direction:row;gap:6px;align-items:center;user-select:none;overflow:visible !important;opacity:0.9;transition:opacity 0.2s ease, transform 0.2s ease;backdrop-filter:blur(10px);pointer-events:auto;box-sizing:border-box}.vertical-toolbar.svelte-13uxerw:hover{opacity:1}.toolbar-section.svelte-13uxerw{display:flex;flex-direction:row;gap:4px;align-items:center;overflow:visible !important}.toolbar-divider.svelte-13uxerw{width:1px;height:24px;background:var(--background-modifier-border);margin:0 4px}.toolbar-button.svelte-13uxerw{width:28px;height:28px;border:none;border-radius:4px;background:var(--interactive-normal);color:var(--text-normal);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.2s ease;position:relative}.toolbar-button.svelte-13uxerw:hover:not(:disabled){background:var(--interactive-hover);transform:translateY(-1px);box-shadow:0 2px 6px rgba(0, 0, 0, 0.1)}.toolbar-button.svelte-13uxerw:active:not(:disabled){transform:translateY(0);background:var(--interactive-accent);color:var(--text-on-accent)}.toolbar-button.svelte-13uxerw:disabled,.toolbar-button[disabled].svelte-13uxerw,.toolbar-button.disabled.svelte-13uxerw{opacity:0.5 !important;cursor:not-allowed !important;background:var(--background-modifier-border) !important;color:var(--text-muted) !important}.toolbar-button.svelte-13uxerw:disabled:hover,.toolbar-button[disabled].svelte-13uxerw:hover,.toolbar-button.disabled.svelte-13uxerw:hover{opacity:0.5 !important;background:var(--background-modifier-border) !important;transform:none !important;box-shadow:none !important}.toolbar-button.active.svelte-13uxerw{background:var(--interactive-accent);color:var(--text-on-accent);box-shadow:0 0 0 2px var(--interactive-accent-hover)}.toolbar-button.active.svelte-13uxerw:hover{background:var(--interactive-accent-hover)}.toolbar-button.svelte-13uxerw svg{width:14px !important;height:14px !important;flex-shrink:0}.toolbar-button.vip-gold.svelte-13uxerw{position:relative;overflow:visible !important}.toolbar-button.vip-gold.svelte-13uxerw::after{content:"";position:absolute;top:-6px;right:-6px;width:16px;height:16px;background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><defs><linearGradient id="goldV" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:%23ffd700;stop-opacity:1" /><stop offset="50%" style="stop-color:%23ffed4e;stop-opacity:1" /><stop offset="100%" style="stop-color:%23ffb700;stop-opacity:1" /></linearGradient></defs><text x="8" y="12" text-anchor="middle" fill="url(%23goldV)" font-family="Georgia,serif" font-size="12" font-weight="bold" stroke="%23cc8800" stroke-width="0.3">V</text></svg>');background-size:contain;background-repeat:no-repeat;background-position:center;z-index:10001 !important;pointer-events:none;filter:drop-shadow(0 1px 3px rgba(0, 0, 0, 0.4));transition:all 0.2s ease}.toolbar-button.vip-gold.svelte-13uxerw:hover::after{transform:scale(1.2);filter:drop-shadow(0 2px 6px rgba(255, 215, 0, 0.6))}.toolbar-button.vip-premium.svelte-13uxerw{position:relative;overflow:visible !important}.toolbar-button.vip-premium.svelte-13uxerw::after{content:"";position:absolute;top:-6px;right:-6px;width:16px;height:16px;background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><defs><linearGradient id="premiumV" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:%23ff6b9d;stop-opacity:1" /><stop offset="30%" style="stop-color:%23c850c0;stop-opacity:1" /><stop offset="70%" style="stop-color:%237c4dff;stop-opacity:1" /><stop offset="100%" style="stop-color:%234158d0;stop-opacity:1" /></linearGradient></defs><text x="8" y="12" text-anchor="middle" fill="url(%23premiumV)" font-family="Georgia,serif" font-size="12" font-weight="bold" stroke="%23ffffff" stroke-width="0.4">V</text></svg>');background-size:contain;background-repeat:no-repeat;background-position:center;z-index:10001 !important;pointer-events:none;filter:drop-shadow(0 1px 3px rgba(0, 0, 0, 0.4));transition:all 0.2s ease}.toolbar-button.vip-premium.svelte-13uxerw:hover::after{transform:scale(1.2);filter:drop-shadow(0 2px 6px rgba(200, 80, 192, 0.6))}@media(max-width: 768px){.vertical-toolbar.svelte-13uxerw{bottom:12px;padding:6px 10px;margin-bottom:max(0px, env(safe-area-inset-bottom, 0px));gap:4px}.toolbar-section.svelte-13uxerw{gap:3px}.toolbar-divider.svelte-13uxerw{margin:0 3px;height:20px}.toolbar-button.svelte-13uxerw{width:32px;height:32px}}@media(max-width: 480px){.vertical-toolbar.svelte-13uxerw{bottom:10px;max-width:95vw;overflow-x:auto;scrollbar-width:none}.vertical-toolbar.svelte-13uxerw::-webkit-scrollbar{display:none}.toolbar-button.svelte-13uxerw{width:30px;height:30px;flex-shrink:0}}`)}function tc(t){let e,n,r,o,i,s,a,l,c,d,u,f,h,p,m,g,v,b,_,y,x,M,I,L,W,Y,Q,de,oe,Me,ee,ve,H,R,O,G,K,U,re,ue;return{c(){e=F("div"),n=F("div"),r=F("button"),a=X(),l=F("div"),c=X(),d=F("div"),u=F("button"),f=X(),h=F("button"),p=X(),m=F("div"),g=X(),v=F("div"),b=F("button"),y=X(),x=F("button"),I=X(),L=F("div"),W=X(),Y=F("div"),Q=F("button"),Me=X(),ee=F("button"),R=X(),O=F("div"),G=X(),K=F("div"),U=F("button"),w(r,"class","toolbar-button svelte-13uxerw"),r.disabled=o=!t[3],w(r,"title",i=t[3]?"\u5FEB\u901F\u5207\u6362\u6587\u4EF6 (Ctrl/Cmd+O)":"\u5FEB\u901F\u5207\u6362\u6587\u4EF6 (\u9700\u8981\u4E13\u4E1A\u7248)"),w(r,"aria-label",s=t[3]?"\u5FEB\u901F\u5207\u6362\u6587\u4EF6":"\u5FEB\u901F\u5207\u6362\u6587\u4EF6 (\u9700\u8981\u4E13\u4E1A\u7248)"),Z(r,"disabled",!t[3]),Z(r,"vip-gold",!t[3]),w(n,"class","toolbar-section svelte-13uxerw"),w(l,"class","toolbar-divider svelte-13uxerw"),w(u,"class","toolbar-button svelte-13uxerw"),w(u,"title","\u641C\u7D22 (Ctrl/Cmd+F/K)"),w(u,"aria-label","\u641C\u7D22"),Z(u,"active",t[1]),w(h,"class","toolbar-button svelte-13uxerw"),w(h,"title","\u5FEB\u6377\u952E\u63D0\u793A (K)"),w(h,"aria-label","\u5FEB\u6377\u952E\u63D0\u793A"),w(d,"class","toolbar-section svelte-13uxerw"),w(m,"class","toolbar-divider svelte-13uxerw"),w(b,"class","toolbar-button svelte-13uxerw"),b.disabled=_=!t[12],w(b,"title","\u64A4\u9500 (Ctrl/Cmd+Z)"),w(b,"aria-label","\u64A4\u9500"),w(x,"class","toolbar-button svelte-13uxerw"),x.disabled=M=!t[13],w(x,"title","\u91CD\u505A (Ctrl/Cmd+Y)"),w(x,"aria-label","\u91CD\u505A"),w(v,"class","toolbar-section svelte-13uxerw"),w(L,"class","toolbar-divider svelte-13uxerw"),w(Q,"class","toolbar-button svelte-13uxerw"),Q.disabled=de=!t[3]||t[14]>=5,w(Q,"aria-label",oe=t[3]?"\u589E\u52A0\u5C42\u7EA7":"\u589E\u52A0\u5C42\u7EA7 (\u9700\u8981\u4E13\u4E1A\u7248)"),Z(Q,"disabled",!t[3]),Z(Q,"vip-premium",!t[3]),w(ee,"class","toolbar-button svelte-13uxerw"),ee.disabled=ve=!t[3]||t[14]<=1,w(ee,"aria-label",H=t[3]?"\u51CF\u5C11\u5C42\u7EA7":"\u51CF\u5C11\u5C42\u7EA7 (\u9700\u8981\u4E13\u4E1A\u7248)"),Z(ee,"disabled",!t[3]),Z(ee,"vip-premium",!t[3]),w(Y,"class","toolbar-section svelte-13uxerw"),w(O,"class","toolbar-divider svelte-13uxerw"),w(U,"class","toolbar-button svelte-13uxerw"),w(U,"title","\u8BBE\u7F6E"),w(U,"aria-label","\u8BBE\u7F6E"),w(K,"class","toolbar-section svelte-13uxerw"),w(e,"class","vertical-toolbar svelte-13uxerw")},m(ge,ie){$(ge,e,ie),A(e,n),A(n,r),t[28](r),A(e,a),A(e,l),A(e,c),A(e,d),A(d,u),t[29](u),A(d,f),A(d,h),t[30](h),A(e,p),A(e,m),A(e,g),A(e,v),A(v,b),t[31](b),A(v,y),A(v,x),t[32](x),A(e,I),A(e,L),A(e,W),A(e,Y),A(Y,Q),t[33](Q),A(Y,Me),A(Y,ee),t[34](ee),A(e,R),A(e,O),A(e,G),A(e,K),A(K,U),t[35](U),re||(ue=[le(r,"click",t[21]),le(u,"click",t[19]),le(h,"click",function(){Ue(t[2])&&t[2].apply(this,arguments)}),le(b,"click",t[15]),le(x,"click",t[16]),le(Q,"click",t[17]),le(ee,"click",t[18]),le(U,"click",t[20])],re=!0)},p(ge,ie){t=ge,ie[0]&8&&o!==(o=!t[3])&&(r.disabled=o),ie[0]&8&&i!==(i=t[3]?"\u5FEB\u901F\u5207\u6362\u6587\u4EF6 (Ctrl/Cmd+O)":"\u5FEB\u901F\u5207\u6362\u6587\u4EF6 (\u9700\u8981\u4E13\u4E1A\u7248)")&&w(r,"title",i),ie[0]&8&&s!==(s=t[3]?"\u5FEB\u901F\u5207\u6362\u6587\u4EF6":"\u5FEB\u901F\u5207\u6362\u6587\u4EF6 (\u9700\u8981\u4E13\u4E1A\u7248)")&&w(r,"aria-label",s),ie[0]&8&&Z(r,"disabled",!t[3]),ie[0]&8&&Z(r,"vip-gold",!t[3]),ie[0]&2&&Z(u,"active",t[1]),ie[0]&4096&&_!==(_=!t[12])&&(b.disabled=_),ie[0]&8192&&M!==(M=!t[13])&&(x.disabled=M),ie[0]&16392&&de!==(de=!t[3]||t[14]>=5)&&(Q.disabled=de),ie[0]&8&&oe!==(oe=t[3]?"\u589E\u52A0\u5C42\u7EA7":"\u589E\u52A0\u5C42\u7EA7 (\u9700\u8981\u4E13\u4E1A\u7248)")&&w(Q,"aria-label",oe),ie[0]&8&&Z(Q,"disabled",!t[3]),ie[0]&8&&Z(Q,"vip-premium",!t[3]),ie[0]&16392&&ve!==(ve=!t[3]||t[14]<=1)&&(ee.disabled=ve),ie[0]&8&&H!==(H=t[3]?"\u51CF\u5C11\u5C42\u7EA7":"\u51CF\u5C11\u5C42\u7EA7 (\u9700\u8981\u4E13\u4E1A\u7248)")&&w(ee,"aria-label",H),ie[0]&8&&Z(ee,"disabled",!t[3]),ie[0]&8&&Z(ee,"vip-premium",!t[3])},i:ae,o:ae,d(ge){ge&&q(e),t[28](null),t[29](null),t[30](null),t[31](null),t[32](null),t[33](null),t[34](null),t[35](null),re=!1,be(ue)}}}var nc=500;function rc(t,e,n){let r,o,i=ae,s=()=>(i(),i=ut(l,S=>n(27,o=S)),l);t.$$.on_destroy.push(()=>i());let{View:a}=e,{flexStore:l}=e;s();let{increase:c}=e,{decrease:d}=e,{showSearch:u}=e,{openSearch:f}=e,{closeSearch:h}=e,{toggleShortcuts:p}=e,{proStatus:m=!1}=e,g,v,b,_,y,x,M,I,L=!1,W=!1,Y=[],Q=null,de=0;function oe(){let S=Date.now();return Q&&S<de||(Q=a.app.workspace.getActiveViewOfType(rt.MarkdownView),de=S+nc),Q}function Me(S){var k;try{let N=oe();if(!(!((k=N==null?void 0:N.editor)===null||k===void 0)&&k.cm)||!(S!=null&&S.changes))return!1;let V=null;if(S.changes.iterChanges(te=>{V===null&&(V=te)}),V===null)return!1;let he=N.editor.cm.state.doc.lineAt(V).number,ye=a.containerEl;if(!ye)return!1;let fe=ye.querySelectorAll("[data-node-id]");for(let te=0;te<fe.length;te++){let ne=fe[te],ce=ne.getAttribute("data-start-line"),me=ne.getAttribute("data-end-line");if(ce&&me){let Se=parseInt(ce),Ye=parseInt(me);if(he>=Se&&he<=Ye){let Be=ne.getBoundingClientRect(),et=window.innerHeight,Je=Be.top>=0&&Be.bottom<=et,gn=Be.top<et&&Be.bottom>0;if(Je)return!0;if(gn){let jn=Math.min(Be.bottom,et)-Math.max(Be.top,0),Gn=Be.bottom-Be.top;if(jn/Gn>.7)return!0}return ne.scrollIntoView({behavior:"smooth",block:"center"}),!0}}}let _e=null,Le=1/0;for(let te=0;te<fe.length;te++){let ne=fe[te],ce=ne.getAttribute("data-start-line");if(ce){let me=parseInt(ce),Se=Math.abs(he-me);Se<Le&&(Le=Se,_e=ne)}}if(_e){let te=_e.getBoundingClientRect(),ne=window.innerHeight,ce=te.top>=0&&te.bottom<=ne,me=te.top<ne&&te.bottom>0;if(ce)return!0;if(me){let Se=Math.min(te.bottom,ne)-Math.max(te.top,0),Ye=te.bottom-te.top;if(Se/Ye>.7)return!0}return _e.scrollIntoView({behavior:"smooth",block:"center"}),!0}return!1}catch(N){return console.error("[\u6EDA\u52A8] \u9519\u8BEF:",N),!1}}function ee(){var S;let k=oe();if(!((S=k==null?void 0:k.editor)===null||S===void 0)&&S.cm)try{let N=k.editor.cm.state.field(Fi.historyField);N&&(n(12,L=N.done&&N.done.length>0),n(13,W=N.undone&&N.undone.length>0))}catch(N){console.error("\u66F4\u65B0\u5386\u53F2\u72B6\u6001\u5931\u8D25:",N),n(12,L=!1),n(13,W=!1)}}function ve(){var S;let k=oe();if(!(!((S=k==null?void 0:k.editor)===null||S===void 0)&&S.cm)){H();return}try{let N=k.editor.cm.dom;if(N){let V=()=>{queueMicrotask(ee)},se=()=>{queueMicrotask(ee)};N.addEventListener("input",V),N.addEventListener("keyup",se),N.addEventListener("change",V);let xe=a.app.vault.on("modify",he=>{he&&a.file&&he.path===a.file.path&&queueMicrotask(ee)});Y.push(()=>{N.removeEventListener("input",V),N.removeEventListener("keyup",se),N.removeEventListener("change",V),a.app.vault.offref(xe)});return}}catch(N){console.error("\u8BBE\u7F6ECodeMirror\u76D1\u542C\u5668\u5931\u8D25:",N)}H()}function H(){try{let S=[],k=a.app.workspace.on("editor-change",()=>{queueMicrotask(ee)});S.push(k);let N=a.app.workspace.on("active-leaf-change",()=>{queueMicrotask(ee)});S.push(N);let V=a.app.vault.on("modify",se=>{se&&a.file&&se.path===a.file.path&&queueMicrotask(ee)});S.push(V),Y.push(()=>{S[0]&&a.app.workspace.offref(S[0]),S[1]&&a.app.workspace.offref(S[1]),S[2]&&a.app.vault.offref(S[2])})}catch(S){console.error("\u8BBE\u7F6Eworkspace\u76D1\u542C\u5668\u5931\u8D25:",S);let k=setInterval(ee,2e3);Y.push(()=>clearInterval(k))}}function R(){try{if(typeof MutationObserver!="undefined"){let S=document.querySelector(".gridnote-container");if(!S)return;let k=null,N=new MutationObserver(V=>{V.some(xe=>xe.type==="characterData"?!0:xe.type==="childList"?Array.from(xe.addedNodes).some(he=>{var ye;return he.nodeType===Node.TEXT_NODE&&((ye=he.textContent)===null||ye===void 0?void 0:ye.trim())}):!1)&&(k&&clearTimeout(k),k=setTimeout(()=>ee(),100))});N.observe(S,{characterData:!0,childList:!0,subtree:!1}),Y.push(()=>{N.disconnect(),k&&clearTimeout(k)})}}catch(S){console.error("\u8BBE\u7F6EGridNote\u5185\u5BB9\u76D1\u542C\u5668\u5931\u8D25:",S)}}$e(()=>{g&&(0,rt.setIcon)(g,"folder-open"),v&&(0,rt.setIcon)(v,"undo"),b&&(0,rt.setIcon)(b,"redo"),_&&(0,rt.setIcon)(_,"plus"),y&&(0,rt.setIcon)(y,"minus"),x&&(0,rt.setIcon)(x,"search"),M&&(0,rt.setIcon)(M,"keyboard"),I&&(0,rt.setIcon)(I,"settings");let S=a.app.workspace.on("active-leaf-change",()=>{Q=null,de=0});Y.push(()=>{a.app.workspace.offref(S)}),ee(),ve(),R()}),tt(()=>{Y.forEach(S=>{try{S()}catch(k){console.error("\u6E05\u7406\u76D1\u542C\u5668\u5931\u8D25:",k)}}),Y=[]});function O(){if(a!=null&&a.editor)try{let S=a.editor.getValue();a.editor.undo(),queueMicrotask(ee),queueMicrotask(()=>{if(a&&a.editor){let k=a.editor.getValue();a.render(k),a.recalculateFoldStates&&a.recalculateFoldStates(S,k)}})}catch(S){console.error("\u64A4\u9500\u64CD\u4F5C\u5931\u8D25:",S)}}function G(){if(a!=null&&a.editor)try{let S=a.editor.getValue();a.editor.redo(),queueMicrotask(ee),queueMicrotask(()=>{if(a&&a.editor){let k=a.editor.getValue();a.render(k),a.recalculateFoldStates&&a.recalculateFoldStates(S,k)}})}catch(S){console.error("\u91CD\u505A\u64CD\u4F5C\u5931\u8D25:",S)}}function K(){m&&c()}function U(){m&&d()}function re(){u?h():f()}function ue(){a.app.setting.open(),queueMicrotask(()=>{a.app.setting.openTabById(a.plugin.manifest.id)})}function ge(){m&&a.app.commands.executeCommandById("switcher:open")}function ie(S){pe[S?"unshift":"push"](()=>{g=S,n(4,g)})}function He(S){pe[S?"unshift":"push"](()=>{x=S,n(9,x)})}function D(S){pe[S?"unshift":"push"](()=>{M=S,n(10,M)})}function C(S){pe[S?"unshift":"push"](()=>{v=S,n(5,v)})}function P(S){pe[S?"unshift":"push"](()=>{b=S,n(6,b)})}function E(S){pe[S?"unshift":"push"](()=>{_=S,n(7,_)})}function T(S){pe[S?"unshift":"push"](()=>{y=S,n(8,y)})}function j(S){pe[S?"unshift":"push"](()=>{I=S,n(11,I)})}return t.$$set=S=>{"View"in S&&n(22,a=S.View),"flexStore"in S&&s(n(0,l=S.flexStore)),"increase"in S&&n(23,c=S.increase),"decrease"in S&&n(24,d=S.decrease),"showSearch"in S&&n(1,u=S.showSearch),"openSearch"in S&&n(25,f=S.openSearch),"closeSearch"in S&&n(26,h=S.closeSearch),"toggleShortcuts"in S&&n(2,p=S.toggleShortcuts),"proStatus"in S&&n(3,m=S.proStatus)},t.$$.update=()=>{if(t.$$.dirty[0]&134217728){e:n(14,r=o.tier)}},[l,u,p,m,g,v,b,_,y,x,M,I,L,W,r,O,G,K,U,re,ue,ge,a,c,d,f,h,o,ie,He,D,C,P,E,T,j]}var Wr=class extends Ce{constructor(e){super(),Te(this,e,rc,tc,Ee,{View:22,flexStore:0,increase:23,decrease:24,showSearch:1,openSearch:25,closeSearch:26,toggleShortcuts:2,proStatus:3},ec,[-1,-1])}},Di=Wr;function oc(t){Ie(t,"svelte-1y46ihy",'@charset "UTF-8";.shortcuts-backdrop.svelte-1y46ihy.svelte-1y46ihy{position:fixed;top:0;left:0;right:0;bottom:0;background:transparent;display:flex;align-items:flex-end;justify-content:center;z-index:9999;padding:16px;pointer-events:auto}.shortcuts-card.svelte-1y46ihy.svelte-1y46ihy{background:var(--background-primary);border-radius:12px;box-shadow:0 8px 32px rgba(0, 0, 0, 0.3);backdrop-filter:blur(16px);border:1px solid var(--background-modifier-border);max-width:700px;width:100%;max-height:70vh;display:flex;flex-direction:column;overflow:hidden;pointer-events:auto}.shortcuts-header.svelte-1y46ihy.svelte-1y46ihy{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;border-bottom:1px solid var(--background-modifier-border);background:var(--background-secondary)}.shortcuts-header.svelte-1y46ihy h3.svelte-1y46ihy{margin:0;font-size:18px;font-weight:600;color:var(--text-normal)}.close-btn.svelte-1y46ihy.svelte-1y46ihy{background:none;border:none;cursor:pointer;padding:4px;display:flex;align-items:center;justify-content:center;color:var(--text-muted);transition:color 0.2s ease}.close-btn.svelte-1y46ihy.svelte-1y46ihy:hover{color:var(--text-normal)}.close-btn.svelte-1y46ihy svg.svelte-1y46ihy{width:20px;height:20px}.shortcuts-content.svelte-1y46ihy.svelte-1y46ihy{flex:1;overflow-y:auto;padding:12px 16px}.shortcut-category.svelte-1y46ihy.svelte-1y46ihy{margin-bottom:16px}.shortcut-category.svelte-1y46ihy.svelte-1y46ihy:last-child{margin-bottom:0}.shortcut-category.svelte-1y46ihy h4.svelte-1y46ihy{margin:0 0 8px 0;font-size:13px;font-weight:600;color:var(--text-accent);text-transform:uppercase;letter-spacing:0.5px}.shortcut-list.svelte-1y46ihy.svelte-1y46ihy{display:flex;flex-direction:column;gap:4px}.shortcut-list.grid-layout.svelte-1y46ihy.svelte-1y46ihy{display:grid;grid-template-columns:repeat(2, 1fr);gap:6px}.shortcut-item.svelte-1y46ihy.svelte-1y46ihy{display:flex;align-items:center;gap:10px;padding:6px 10px;background:var(--background-secondary);border-radius:4px;transition:background 0.2s ease}.shortcut-item.svelte-1y46ihy.svelte-1y46ihy:hover{background:var(--background-modifier-hover)}.shortcut-key.svelte-1y46ihy.svelte-1y46ihy{font-family:var(--font-monospace);font-size:13px;padding:3px 8px;background:var(--background-primary);border:1px solid var(--background-modifier-border);border-radius:3px;color:var(--text-normal);min-width:90px;text-align:center;box-shadow:0 1px 2px rgba(0, 0, 0, 0.1);font-weight:500;white-space:nowrap}.shortcut-description.svelte-1y46ihy.svelte-1y46ihy{flex:1;font-size:13px;color:var(--text-muted);line-height:1.4}.shortcuts-footer.svelte-1y46ihy.svelte-1y46ihy{padding:10px 16px;border-top:1px solid var(--background-modifier-border);background:var(--background-secondary);display:flex;justify-content:center}.hint.svelte-1y46ihy.svelte-1y46ihy{font-size:12px;color:var(--text-faint);font-style:italic}.shortcuts-content.svelte-1y46ihy.svelte-1y46ihy::-webkit-scrollbar{width:8px}.shortcuts-content.svelte-1y46ihy.svelte-1y46ihy::-webkit-scrollbar-track{background:var(--background-primary)}.shortcuts-content.svelte-1y46ihy.svelte-1y46ihy::-webkit-scrollbar-thumb{background:var(--background-modifier-border);border-radius:4px}.shortcuts-content.svelte-1y46ihy.svelte-1y46ihy::-webkit-scrollbar-thumb:hover{background:var(--background-modifier-border-hover)}')}function Ri(t,e,n){let r=t.slice();return r[5]=e[n].category,r[6]=e[n].items,r[7]=e[n].grid,r}function Hi(t,e,n){let r=t.slice();return r[10]=e[n].key,r[11]=e[n].description,r}function Vi(t){let e,n,r,o,i,s,a,l,c,d,u,f,h,p,m,g=ze(t[2]),v=[];for(let b=0;b<g.length;b+=1)v[b]=Pi(Ri(t,g,b));return{c(){e=F("div"),n=F("div"),r=F("div"),o=F("h3"),o.textContent="\u5FEB\u6377\u952E\u63D0\u793A",i=X(),s=F("button"),s.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-1y46ihy"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>',a=X(),l=F("div");for(let b=0;b<v.length;b+=1)v[b].c();c=X(),d=F("div"),d.innerHTML='<span class="hint svelte-1y46ihy">\u6309 K \u952E\u6216 Esc \u952E\u5173\u95ED</span>',w(o,"id","shortcuts-title"),w(o,"class","svelte-1y46ihy"),w(s,"class","close-btn svelte-1y46ihy"),w(s,"aria-label","\u5173\u95ED"),w(r,"class","shortcuts-header svelte-1y46ihy"),w(l,"class","shortcuts-content svelte-1y46ihy"),w(d,"class","shortcuts-footer svelte-1y46ihy"),w(n,"class","shortcuts-card svelte-1y46ihy"),w(n,"role","dialog"),w(n,"aria-modal","true"),w(n,"aria-labelledby","shortcuts-title"),w(e,"class","shortcuts-backdrop svelte-1y46ihy")},m(b,_){$(b,e,_),A(e,n),A(n,r),A(r,o),A(r,i),A(r,s),A(n,a),A(n,l);for(let y=0;y<v.length;y+=1)v[y]&&v[y].m(l,null);A(n,c),A(n,d),h=!0,p||(m=[le(s,"click",function(){Ue(t[1])&&t[1].apply(this,arguments)}),le(e,"click",t[3]),le(e,"keydown",t[4])],p=!0)},p(b,_){if(t=b,_&4){g=ze(t[2]);let y;for(y=0;y<g.length;y+=1){let x=Ri(t,g,y);v[y]?v[y].p(x,_):(v[y]=Pi(x),v[y].c(),v[y].m(l,null))}for(;y<v.length;y+=1)v[y].d(1);v.length=g.length}},i(b){h||(b&&je(()=>{h&&(u||(u=st(n,un,{y:20,duration:300,easing:wt},!0)),u.run(1))}),b&&je(()=>{h&&(f||(f=st(e,dn,{duration:200},!0)),f.run(1))}),h=!0)},o(b){b&&(u||(u=st(n,un,{y:20,duration:300,easing:wt},!1)),u.run(0)),b&&(f||(f=st(e,dn,{duration:200},!1)),f.run(0)),h=!1},d(b){b&&q(e),kt(v,b),b&&u&&u.end(),b&&f&&f.end(),p=!1,be(m)}}}function Oi(t){let e,n,r,o,i;return{c(){e=F("div"),n=F("kbd"),n.textContent=`${t[10]}`,r=X(),o=F("span"),o.textContent=`${t[11]}`,i=X(),w(n,"class","shortcut-key svelte-1y46ihy"),w(o,"class","shortcut-description svelte-1y46ihy"),w(e,"class","shortcut-item svelte-1y46ihy")},m(s,a){$(s,e,a),A(e,n),A(e,r),A(e,o),A(e,i)},p:ae,d(s){s&&q(e)}}}function Pi(t){let e,n,r,o,i,s=ze(t[6]),a=[];for(let l=0;l<s.length;l+=1)a[l]=Oi(Hi(t,s,l));return{c(){e=F("div"),n=F("h4"),n.textContent=`${t[5]}`,r=X(),o=F("div");for(let l=0;l<a.length;l+=1)a[l].c();i=X(),w(n,"class","svelte-1y46ihy"),w(o,"class","shortcut-list svelte-1y46ihy"),Z(o,"grid-layout",t[7]),w(e,"class","shortcut-category svelte-1y46ihy")},m(l,c){$(l,e,c),A(e,n),A(e,r),A(e,o);for(let d=0;d<a.length;d+=1)a[d]&&a[d].m(o,null);A(e,i)},p(l,c){if(c&4){s=ze(l[6]);let d;for(d=0;d<s.length;d+=1){let u=Hi(l,s,d);a[d]?a[d].p(u,c):(a[d]=Oi(u),a[d].c(),a[d].m(o,null))}for(;d<a.length;d+=1)a[d].d(1);a.length=s.length}},d(l){l&&q(e),kt(a,l)}}}function ic(t){let e,n=t[0]&&Vi(t);return{c(){n&&n.c(),e=_t()},m(r,o){n&&n.m(r,o),$(r,e,o)},p(r,[o]){r[0]?n?(n.p(r,o),o&1&&z(n,1)):(n=Vi(r),n.c(),z(n,1),n.m(e.parentNode,e)):n&&(Ne(),J(n,1,1,()=>{n=null}),Fe())},i(r){z(n)},o(r){J(n)},d(r){r&&q(e),n&&n.d(r)}}}function sc(t,e,n){let{show:r=!1}=e,{onClose:o}=e,i=[{category:"\u5BFC\u822A\uFF08\u4E00\u7EA7\u6807\u9898\uFF09",grid:!0,items:[{key:"\u2191",description:"\u4E0A\u4E00\u4E2A\u4E00\u7EA7\u6807\u9898"},{key:"\u2193",description:"\u5B50\u7EA7/\u4E0B\u4E00\u4E2A\u4E00\u7EA7"}]},{category:"\u5BFC\u822A\uFF08\u4E8C\u7EA7\u6807\u9898\uFF09",grid:!0,items:[{key:"\u2191",description:"\u4E0A\u4E00\u4E2A\u540C\u7EA7"},{key:"\u2193",description:"\u4E0B\u4E00\u4E2A\u540C\u7EA7"},{key:"\u2192",description:"\u7B2C\u4E00\u4E2A\u5B50\u7EA7"}]},{category:"\u5BFC\u822A\uFF083-6\u7EA7\u6807\u9898\uFF09",grid:!0,items:[{key:"\u2191",description:"\u4E0A\u4E00\u4E2A\u540C\u7EA7"},{key:"\u2193",description:"\u4E0B\u4E00\u4E2A\u540C\u7EA7"},{key:"\u2190",description:"\u7236\u7EA7\u6807\u9898"},{key:"\u2192",description:"\u7B2C\u4E00\u4E2A\u5B50\u7EA7"}]},{category:"\u9009\u4E2D",items:[{key:"F",description:"\u9009\u4E2D\u7B2C\u4E00\u4E2A\u53EF\u89C1\u6807\u9898"},{key:"Esc",description:"\u53D6\u6D88\u9009\u4E2D"}]},{category:"\u7F16\u8F91",items:[{key:"F",description:"\u7F16\u8F91\u5185\u5BB9\uFF08\u5DF2\u9009\u4E2D\u65F6\uFF09"},{key:"T",description:"\u7F16\u8F91\u6807\u9898"},{key:"Esc",description:"\u9000\u51FA\u7F16\u8F91/\u641C\u7D22"}]},{category:"\u63D2\u5165\uFF08\u975E\u4E00\u7EA7\u6807\u9898\uFF09",items:[{key:"Ctrl+Shift+\u2191",description:"\u4E0A\u65B9\u63D2\u5165\u540C\u7EA7"},{key:"Ctrl+Shift+\u2193",description:"\u4E0B\u65B9\u63D2\u5165\u540C\u7EA7"},{key:"Ctrl+Shift+\u2192",description:"\u63D2\u5165\u5B50\u7EA7"}]},{category:"\u641C\u7D22",items:[{key:"Ctrl/Cmd+F/K",description:"\u6253\u5F00\u641C\u7D22"},{key:"K",description:"\u663E\u793A/\u9690\u85CF\u6B64\u63D0\u793A"}]}];function s(l){l.target===l.currentTarget&&o()}let a=l=>l.key==="Escape"&&o();return t.$$set=l=>{"show"in l&&n(0,r=l.show),"onClose"in l&&n(1,o=l.onClose)},[r,o,i,s,a]}var zr=class extends Ce{constructor(e){super(),Te(this,e,sc,ic,Ee,{show:0,onClose:1},oc)}},Bi=zr;function ac(){let t=navigator.userAgent.toLowerCase(),e=window.innerWidth,n=window.innerHeight,r=/ipad/.test(t)||navigator.maxTouchPoints>1&&/macintosh/.test(t)||e>=1024&&e<=1800,o=r&&e>=1020&&e<=1030,i=r||/tablet|android(?!.*mobile)/.test(t)||e>=768&&e<1024;return{isMobile:/android|webos|iphone|ipod|blackberry|iemobile|opera mini/.test(t)||e<768&&"ontouchstart"in window,isTablet:i,isIPad:r,isIPadMini:o,screenWidth:e,screenHeight:n}}function lc(t){let{screenWidth:e,isIPad:n,isIPadMini:r}=t;return n?r?.7:e<1150?.85:e<1300?.9:.95:t.isTablet?e<800?.8:e<1e3?.85:.9:t.isMobile?e<375?.7:e<480?.75:.8:1}function Wi(t){let e=()=>{let o=ac(),i=lc(o);t(i,o)};e();let n,r=()=>{clearTimeout(n),n=window.setTimeout(e,150)};return window.addEventListener("resize",r),window.addEventListener("orientationchange",e),()=>{window.removeEventListener("resize",r),window.removeEventListener("orientationchange",e),clearTimeout(n)}}function cc(t){Ie(t,"svelte-ut93o5",'@charset "UTF-8";.container.svelte-ut93o5{padding-bottom:300px;position:relative;height:100%;width:100%;overflow-y:auto;overflow-x:hidden}.container.integrated-view.svelte-ut93o5{height:calc(100vh - 100px)}.content-wrapper.svelte-ut93o5{width:100%;position:relative;overflow:visible}.content-wrapper.mobile-scaled.svelte-ut93o5{pointer-events:none}.content-scaler.svelte-ut93o5{width:100%;transition:transform 0.3s ease;transform-origin:top left;pointer-events:auto}.content-scaler.scaled.svelte-ut93o5{touch-action:manipulation;user-select:auto;-webkit-user-select:auto}.content-scaler.scaled.svelte-ut93o5 *{pointer-events:auto !important;touch-action:manipulation !important}.search-float.svelte-ut93o5{position:sticky;top:0;z-index:1000;background:var(--background-primary);padding:8px 0;box-shadow:0 2px 12px rgba(0, 0, 0, 0.15);border-bottom:1px solid var(--background-modifier-border);margin-bottom:12px;border-radius:0 0 8px 8px;backdrop-filter:blur(8px);display:flex;justify-content:center}.search-float.svelte-ut93o5 .search-component{width:600px;max-width:90%}')}function zi(t){let e,n,r,o;function i(a){t[28](a)}let s={searchKeyword:t[14],searchIndex:t[15],searchCount:t[16]};return t[8]!==void 0&&(s.inputEl=t[8]),n=new Ni({props:s}),pe.push(()=>ko(n,"inputEl",i)),n.$on("exit",t[20]),{c(){e=F("div"),Ve(n.$$.fragment),w(e,"class","search-float svelte-ut93o5")},m(a,l){$(a,e,l),De(n,e,null),o=!0},p(a,l){let c={};!r&&l[0]&256&&(r=!0,c.inputEl=a[8],bo(()=>r=!1)),n.$set(c)},i(a){o||(z(n.$$.fragment,a),o=!0)},o(a){J(n.$$.fragment,a),o=!1},d(a){a&&q(e),Re(n)}}}function dc(t){let e,n,r,o,i,s,a,l,c,d,u,f=t[7]&&zi(t);return r=new Di({props:{View:t[0],flexStore:t[3],increase:t[4],decrease:t[5],showSearch:t[7],openSearch:t[19],closeSearch:t[20],toggleShortcuts:t[21],proStatus:t[11]}}),i=new Bi({props:{show:t[9],onClose:t[22]}}),d=new Bn({props:{currentLines:t[12],nodes:t[10],tier:fc,searchKeyword:t[14],searchIndex:t[15],allHighlights:t[17]}}),{c(){e=F("div"),f&&f.c(),n=X(),Ve(r.$$.fragment),o=X(),Ve(i.$$.fragment),s=X(),a=F("div"),l=F("div"),c=F("div"),Ve(d.$$.fragment),we(c,"padding","20px"),w(l,"class","content-scaler svelte-ut93o5"),we(l,"transform","scale(var(--scale-factor))"),we(l,"transform-origin","top left"),we(l,"width",t[6]<1?100/t[6]+"%":"100%"),Z(l,"scaled",t[6]<1),w(a,"class","content-wrapper svelte-ut93o5"),we(a,"--scale-factor",t[6]),Z(a,"mobile-scaled",t[6]<1),w(e,"class","container svelte-ut93o5"),Z(e,"integrated-view",t[1])},m(h,p){$(h,e,p),f&&f.m(e,null),A(e,n),De(r,e,null),A(e,o),De(i,e,null),A(e,s),A(e,a),A(a,l),A(l,c),De(d,c,null),u=!0},p(h,p){h[7]?f?(f.p(h,p),p[0]&128&&z(f,1)):(f=zi(h),f.c(),z(f,1),f.m(e,n)):f&&(Ne(),J(f,1,1,()=>{f=null}),Fe());let m={};p[0]&1&&(m.View=h[0]),p[0]&128&&(m.showSearch=h[7]),p[0]&2048&&(m.proStatus=h[11]),r.$set(m);let g={};p[0]&512&&(g.show=h[9]),i.$set(g);let v={};p[0]&4096&&(v.currentLines=h[12]),p[0]&1024&&(v.nodes=h[10]),d.$set(v),(!u||p[0]&64)&&we(l,"width",h[6]<1?100/h[6]+"%":"100%"),(!u||p[0]&64)&&Z(l,"scaled",h[6]<1),(!u||p[0]&64)&&we(a,"--scale-factor",h[6]),(!u||p[0]&64)&&Z(a,"mobile-scaled",h[6]<1),(!u||p[0]&2)&&Z(e,"integrated-view",h[1])},i(h){u||(z(f),z(r.$$.fragment,h),z(i.$$.fragment,h),z(d.$$.fragment,h),u=!0)},o(h){J(f),J(r.$$.fragment,h),J(i.$$.fragment,h),J(d.$$.fragment,h),u=!1},d(h){h&&q(e),f&&f.d(),Re(r),Re(i),Re(d)}}}var uc=100,fc=0;function hc(t,e,n){let r,o,i,s,a,l=ae,c=()=>(l(),l=ut(h,D=>n(12,a=D)),h);t.$$.on_destroy.push(()=>l());let{View:d}=e,{root:u}=e,{isIntegratedView:f=!1}=e,h=Pe(-1);c();let p=Pe(!1);ft(t,p,D=>n(11,s=D));let m=1,g=null,v=!1,b=0;$e(()=>{let D=d==null?void 0:d.app.workspace.on("gridnote-setting-changed",(P,E)=>{if(P==="proStatus"){n(26,b=0);let T=d.ProStatus,j=Boolean(T);j!==v&&(n(25,v=j),p.set(j))}}),C=Wi((P,E)=>{n(6,m=P),g=E});return()=>{D&&(d==null||d.app.workspace.offref(D)),C()}});let _=Pe(""),y=Pe(0),x=Pe(0),M=Pe([]);ft(t,M,D=>n(27,o=D));let I=Pe(null);ft(t,I,D=>n(30,i=D));let L=Pe(null),W=Pe(null),Y=Pe(null),Q=new Map([["1",[0,1,1]],["2",[0,1,1,1]],["3",[0,1,2,1,1]],["4",[0,1,3,2,1,1]],["5",[0,1,4,3,2,1,1]]]),de=Pe({tier:3,flex:[0,1,2,1,1]});bt("flexStore",de),bt("selectedNodeLine",I),bt("editTrigger",L),bt("insertTrigger",W),bt("editHeaderTrigger",Y);function oe(D){de.update(C=>(C.tier=D,C.flex=Q.get(String(C.tier+1)),C))}function Me(){de.update(D=>(D.tier>=5||(D.tier++,D.flex=Q.get(String(D.tier))),D))}function ee(){de.update(D=>(D.tier<=1||(D.tier--,D.flex=Q.get(String(D.tier))),D))}bt("View",d);let ve=d.Level.flex,H=!1,R=null,O=!1;function G(){n(7,H=!0),queueMicrotask(()=>{R==null||R.focus()})}function K(){n(7,H=!1),queueMicrotask(()=>{_.set(""),M.update(D=>(D.forEach(C=>C.classList.remove("search-highlight")),[]))})}function U(){n(9,O=!O)}function re(){n(9,O=!1)}function ue(){function D(E){let T=E.getBoundingClientRect(),j=window.innerHeight||document.documentElement.clientHeight,S=window.innerWidth||document.documentElement.clientWidth,k=T.top>=0&&T.top<j||T.bottom>0&&T.bottom<=j||T.top<0&&T.bottom>j,N=T.left>=0&&T.left<S||T.right>0&&T.right<=S||T.left<0&&T.right>S;return k&&N}let C=[],P=document.querySelectorAll("[data-start-line][data-node-level]");for(let E of Array.from(P)){let T=parseInt(E.getAttribute("data-start-line")||"0");if(D(E)&&T>0){let j=E.getBoundingClientRect();C.push({element:E,top:j.top,startLine:T})}}if(C.length>0){C.sort((S,k)=>S.top-k.top);let E=C[0];I.set(E.startLine);let T=E.element.getBoundingClientRect();T.top>=0&&T.bottom<=window.innerHeight||setTimeout(()=>{E.element.scrollIntoView({behavior:"smooth",block:"center"})},50)}}function ge(D){let C=document.activeElement,P=C&&(C.tagName==="INPUT"||C.tagName==="TEXTAREA"||C.isContentEditable);if((D.key==="k"||D.key==="K")&&!P){D.preventDefault(),U();return}if(D.key==="Escape"&&!P&&i!==null){D.preventDefault(),I.set(null);return}if((D.key==="f"||D.key==="F")&&!P&&i===null){D.preventDefault(),ue();return}if(i===null||P)return;if(D.key==="f"||D.key==="F"){D.preventDefault(),L.set(i);return}if(D.key==="t"||D.key==="T"){D.preventDefault(),Y.set(i);return}let E=to(u);if(E.length===0)return;let T=E.find(k=>k.line===i);if(!T)return;let j=T.level===1;if((D.ctrlKey||D.metaKey)&&D.shiftKey&&!j){let k=null;switch(D.key){case"ArrowUp":k="before";break;case"ArrowDown":k="after";break;case"ArrowRight":k="child";break}if(k){D.preventDefault(),W.set({line:i,position:k});return}}let S=null;if(j)switch(D.key){case"ArrowUp":S=Zn(E,T.line,T.level);break;case"ArrowDown":S=er(E,T.line,T.level),S===null&&(S=Qn(E,T.line,T.level));break;case"ArrowLeft":case"ArrowRight":return;default:return}else switch(D.key){case"ArrowUp":S=Zn(E,T.line,T.level);break;case"ArrowDown":S=Qn(E,T.line,T.level);break;case"ArrowLeft":if(T.level===2)return;S=no(E,T.line,T.level);break;case"ArrowRight":S=er(E,T.line,T.level);break;default:return}S!==null&&(D.preventDefault(),I.set(S))}$e(()=>(document.addEventListener("keydown",ie),document.addEventListener("keydown",ge),()=>{document.removeEventListener("keydown",ie),document.removeEventListener("keydown",ge)}));function ie(D){let C=document.activeElement;C&&(C.tagName==="INPUT"||C.tagName==="TEXTAREA"||C.isContentEditable)||((D.ctrlKey||D.metaKey)&&["f","k"].includes(D.key.toLowerCase())&&(D.preventDefault(),G()),D.key==="Escape"&&H&&K())}function He(D){R=D,n(8,R)}t.$$set=D=>{"View"in D&&n(0,d=D.View),"root"in D&&n(23,u=D.root),"isIntegratedView"in D&&n(1,f=D.isIntegratedView)},t.$$.update=()=>{if(t.$$.dirty[0]&8388608){e:n(10,r=u.filter(D=>!(D.header==="Document"||D.header==="Document Header")))}if(t.$$.dirty[0]&100663297){e:if(d){let D=Date.now();if(D-b>uc){let C=d.ProStatus,P=Boolean(C);P!==v&&(n(25,v=P),p.set(P)),n(26,b=D)}}}if(t.$$.dirty[0]&134217728){e:{let D=o.filter(C=>C.isConnected&&C.offsetParent!==null);x.set(D.length)}}};e:_.subscribe(()=>{M.set([])});return[d,f,h,de,Me,ee,m,H,R,O,r,s,a,p,_,y,x,M,I,G,K,U,re,u,oe,v,b,o,He]}var qr=class extends Ce{constructor(e){super(),Te(this,e,hc,dc,Ee,{View:0,root:23,isIntegratedView:1,currentLines:2,flexStore:3,setTier:24,increase:4,decrease:5},cc,[-1,-1])}get currentLines(){return this.$$.ctx[2]}get flexStore(){return this.$$.ctx[3]}get setTier(){return this.$$.ctx[24]}get increase(){return this.$$.ctx[4]}get decrease(){return this.$$.ctx[5]}},Wn=qr;var zn=class{constructor(){this.tier=3;this._levels=new Map([["1",[0,1,1]],["2",[0,1,1,1]],["3",[0,1,2,1,1]],["4",[0,1,3,2,1,1]],["5",[0,1,4,3,2,1,1]]]);this.increase=()=>{this.tier>=5||this.tier++};this.decrease=()=>{this.tier<=1||this.tier--}}get flex(){return this._levels.get(this.tier.toString())}};var $t=class{constructor(e){this.foldStates=new Map;this.callbacks=new Map;this.stores=new Map;this.debounceTimers=new Map;this.app=e}static getInstance(e){if(!$t.instance){if(!e)throw new Error("FoldStateManager requires app instance on first initialization");$t.instance=new $t(e)}return $t.instance}getFolds(e){let n=this.foldStates.get(e);return n?Array.from(n).sort((r,o)=>r-o):[]}setFolds(e,n,r={}){let{silent:o=!1,skipPersist:i=!1,skipStoreUpdate:s=!1,animated:a=!0}=r,l=this.getFolds(e),c=[...n].sort((u,f)=>u-f);(l.length!==c.length||l.some((u,f)=>u!==c[f]))&&(this.foldStates.set(e,new Set(n)),s||this.getStore(e).set(c),i||this.debouncedPersist(e,c),o||this.notifyCallbacks(e,c,a))}toggleFold(e,n){let r=this.getFolds(e),o=new Set(r);o.has(n)?o.delete(n):o.add(n),this.setFolds(e,Array.from(o))}getStore(e){let n=this.stores.get(e);if(!n){let r=this.getFolds(e);n=Pe(r),this.stores.set(e,n)}return n}recalculateFolds(e,n,r){if(!n||!r)return;let o=this.getFolds(e);if(o.length!==0)try{let i=this.extractHeaders(n),s=this.extractHeaders(r),a=[];o.forEach(l=>{let c=i.find(d=>d.line===l+1);if(c){let d=s.find(u=>u.text===c.text&&u.level===c.level);d&&a.push(d.line-1)}}),this.setFolds(e,a,{animated:!1})}catch(i){console.error("\u91CD\u65B0\u8BA1\u7B97\u6298\u53E0\u72B6\u6001\u65F6\u51FA\u9519:",i)}}loadFromStorage(e){if(this.app)try{let r=`${this.app.appId}-note-fold-${e}`,o=localStorage.getItem(r);if(o){let a=(JSON.parse(o).folds||[]).map(l=>l.from);this.setFolds(e,a,{silent:!0,skipPersist:!0})}}catch(n){console.error("\u4ECE localStorage \u52A0\u8F7D\u6298\u53E0\u72B6\u6001\u5931\u8D25:",n),this.setFolds(e,[],{silent:!0,skipPersist:!0})}}subscribe(e,n,r={}){let o=this.callbacks.get(e);return o||(o=[],this.callbacks.set(e,o)),o.push(n),r.immediate!==!1&&n(this.getFolds(e)),()=>{let i=this.callbacks.get(e);if(i){let s=i.indexOf(n);s>-1&&i.splice(s,1),i.length===0&&this.callbacks.delete(e)}}}cleanup(e){this.foldStates.delete(e),this.callbacks.delete(e),this.stores.delete(e);let n=this.debounceTimers.get(e);n&&(clearTimeout(n),this.debounceTimers.delete(e))}extractHeaders(e){let n=[],r=e.split(`
`),o=!1;return r.forEach((i,s)=>{let a=i.trim();if(a.startsWith("```")){o=!o;return}if(!o){let l=a.match(/^(#{1,6})\s+(.+)$/);l&&n.push({text:l[2].trim(),level:l[1].length,line:s+1})}}),n}debouncedPersist(e,n){let r=this.debounceTimers.get(e);r&&clearTimeout(r);let o=setTimeout(()=>{this.persistToStorage(e,n),this.debounceTimers.delete(e)},300);this.debounceTimers.set(e,o)}persistToStorage(e,n){if(this.app)try{let o=`${this.app.appId}-note-fold-${e}`,s={folds:n.map(a=>({from:a,to:a+1})),timestamp:Date.now()};localStorage.setItem(o,JSON.stringify(s))}catch(r){console.error("\u6301\u4E45\u5316\u6298\u53E0\u72B6\u6001\u5230 localStorage \u5931\u8D25:",r)}}notifyCallbacks(e,n,r=!0){let o=this.callbacks.get(e);o&&o.forEach(i=>{try{i(n,r)}catch(s){console.error("\u6298\u53E0\u72B6\u6001\u56DE\u8C03\u6267\u884C\u5931\u8D25:",s)}})}},Lt=$t;Lt.instance=null;var fn=class{constructor(e){this.view=e,this.originalSetItem=localStorage.setItem.bind(localStorage),this.originalRemoveItem=localStorage.removeItem.bind(localStorage),this.isHijacked=!1}start(){this.isHijacked||(localStorage.setItem=(e,n)=>{let r=localStorage.getItem(e);this.originalSetItem(e,n),this.dispatchChangeEvent(e,n,r)},localStorage.removeItem=e=>{let n=localStorage.getItem(e);this.originalRemoveItem(e),this.dispatchChangeEvent(e,null,n)},this.isHijacked=!0)}stop(){localStorage.setItem=this.originalSetItem,localStorage.removeItem=this.originalRemoveItem,this.isHijacked=!1}dispatchChangeEvent(e,n,r){this.view.app&&this.view.app.workspace.trigger("localStorageChanged",{key:e,newValue:n,oldValue:r,timestamp:Date.now()})}};var It=class{constructor(e,n){this.viewStates=new WeakMap;this.eventRefs=[];this.leafFileMap=new Map;this.isDestroyed=!1;this.cachedActiveView=null;this.activeViewCacheValidUntil=0;this.ACTIVE_VIEW_CACHE_DURATION=300;It.instance&&It.instance.destroy(),this.app=e,this.plugin=n,this.foldManager=Lt.getInstance(e),It.instance=this,this.initialize()}getCachedActiveView(){let e=Date.now();return this.cachedActiveView&&e<this.activeViewCacheValidUntil?this.cachedActiveView:(this.cachedActiveView=this.app.workspace.getActiveViewOfType(pn.MarkdownView),this.activeViewCacheValidUntil=e+this.ACTIVE_VIEW_CACHE_DURATION,this.cachedActiveView)}clearActiveViewCache(){this.cachedActiveView=null,this.activeViewCacheValidUntil=0}initialize(){this.updateAllMarkdownViews(),this.eventRefs.push(this.app.workspace.on("layout-change",()=>{this.clearActiveViewCache(),this.updateAllMarkdownViews()})),this.eventRefs.push(this.app.workspace.on("file-open",n=>{this.clearActiveViewCache(),this.updateAllMarkdownViews(),this.handleFileSwitch(n)})),this.eventRefs.push(this.app.workspace.on("file-open",()=>{Promise.resolve().then(()=>this.cleanupClosedFiles())})),this.eventRefs.push(this.app.workspace.on("layout-change",()=>{Promise.resolve().then(()=>this.cleanupClosedFiles())}));let e=()=>{requestAnimationFrame(()=>this.updateActiveViewButtons())};this.eventRefs.push(this.app.workspace.on("active-leaf-change",n=>{if(e(),n&&n.view instanceof pn.MarkdownView){let r=n.view;r.file&&r.file.extension==="md"&&this.handleActiveLeafChange(n,r)}}),this.app.workspace.on("layout-change",e)),this.eventRefs.push(this.app.vault.on("modify",n=>{this.isDestroyed||n&&n instanceof pn.TFile&&n.extension==="md"&&queueMicrotask(async()=>{if(!this.isDestroyed)try{let r=this.leafFileMap.get(n.path);if(!r||r.size===0)return;r.forEach(o=>{if(!o||!o.view)return;let i=this.getViewState(o);if(!i.isGridNoteMode)return;let s=Date.now(),a=s-i.lastModificationTime;if(i.lastModificationSource==="internal"&&a<500)return;let c=o.view;if(!c||!c.editor)return;i.lastModificationSource="external",i.lastModificationTime=s;let d=c.editor.getValue(),u=dt(d,n.path,i.lastContent);i.nodes=u,i.lastContent=d,i.instance&&i.instance.$set({root:u})})}catch(r){console.error("GridNote: \u5904\u7406\u5916\u90E8\u6587\u4EF6\u4FEE\u6539\u65F6\u51FA\u9519:",r)}})})),this.cleanupStaleElements()}refreshAllProStatus(){this.app.workspace.getLeavesOfType("markdown").forEach(n=>{let r=n.view;if(r){let o=r.containerEl.querySelector(".gridnote-toggle-button");o&&this.updateButtonState(n,o)}})}cleanupStaleElements(){this.app.workspace.getLeavesOfType("markdown").forEach(n=>{let r=n.view;if(r&&r.contentEl){r.contentEl.querySelectorAll(".gridnote-container").forEach(s=>s.remove());let i=r.contentEl.querySelector(".markdown-source-view, .markdown-reading-view");i&&(i.style.display="")}})}cleanupClosedFiles(){let e=new Set;this.app.workspace.getLeavesOfType("markdown").forEach(r=>{e.add(r);let o=r.view;if(o&&o.file){let i=o.file.path;this.leafFileMap.has(i)||this.leafFileMap.set(i,new Set),this.leafFileMap.get(i).add(r)}}),this.leafFileMap.forEach((r,o)=>{let i=[];r.forEach(s=>{if(!e.has(s)){i.push(s);let a=this.viewStates.get(s);a&&(a.editorChangeEventRef&&this.app.workspace.offref(a.editorChangeEventRef),a.instance&&a.instance.$destroy(),a.localWatcher&&a.localWatcher.stop(),a.foldSyncRefs&&a.foldSyncRefs.forEach(l=>{try{this.app.workspace.offref(l)}catch(c){}}),this.viewStates.delete(s))}}),i.forEach(s=>r.delete(s)),r.size===0&&(this.leafFileMap.delete(o),Jr(o))})}handleFileSwitch(e){!e||e.extension!=="md"||setTimeout(()=>{var i;let n=this.getCachedActiveView();if(!n||!n.file||!n.leaf||n.file.path!==e.path)return;let r=n.leaf,o=n.contentEl.querySelector(".gridnote-container");if(o){let s=this.getViewState(r);if(s.currentFilePath===e.path)return;let a=((i=n.editor)==null?void 0:i.getValue())||"",l=dt(a,e.path,s.lastContent);for(s.isGridNoteMode=!0,s.nodes=l,s.lastContent=a,s.currentFilePath=e.path;o.firstChild;)o.removeChild(o.firstChild);if(s.instance=new Wn({target:o,props:{View:this.createGridNoteViewAdapter(n,s),root:l,isIntegratedView:!0}}),n.editor&&!s.editorChangeEventRef){let c=r,d=u=>{let f=this.getCachedActiveView();if(f&&f.leaf===c&&f.editor===u){let h=u.getValue()||"",p=this.getViewState(c),m=dt(h,e.path,p.lastContent);this.markInternalModification(c),p.isGridNoteMode&&p.instance&&(p.nodes=m,p.lastContent=h,p.instance.$set({root:m})),this.syncFileContent(e.path,m,c)}};s.editorChangeEventRef=this.app.workspace.on("editor-change",d)}s.localWatcher||(s.localWatcher=new fn(n),s.localWatcher.start()),this.updateLeafFileMapping(r,e.path)}},50)}handleActiveLeafChange(e,n){let r=n.contentEl.querySelector(".gridnote-container");!r||!n.file||setTimeout(()=>{var c;let o=this.getCachedActiveView();if(!o||o.leaf!==e||!o.file)return;let i=this.getViewState(e),s=o.file.path;if(i.currentFilePath===s)return;let a=((c=o.editor)==null?void 0:c.getValue())||"",l=dt(a,s,i.lastContent);for(i.isGridNoteMode=!0,i.nodes=l,i.lastContent=a,i.currentFilePath=s,i.instance&&i.instance.$destroy();r.firstChild;)r.removeChild(r.firstChild);i.instance=new Wn({target:r,props:{View:this.createGridNoteViewAdapter(o,i),root:l,isIntegratedView:!0}}),this.updateLeafFileMapping(e,s)},50)}syncFileContent(e,n,r){let o=this.leafFileMap.get(e);o&&o.forEach(i=>{if(i!==r){let s=this.viewStates.get(i);s&&s.isGridNoteMode&&s.instance&&(s.nodes=n,s.instance.$set({root:n}))}})}updateLeafFileMapping(e,n){this.leafFileMap.has(n)||this.leafFileMap.set(n,new Set),this.leafFileMap.get(n).add(e)}updateAllMarkdownViews(){this.app.workspace.getLeavesOfType("markdown").forEach(n=>{let r=n.view;r&&r.file&&r.file.extension==="md"&&(this.addToggleButtonToView(n,r),this.getViewState(n).isGridNoteMode&&this.updateLeafFileMapping(n,r.file.path))})}updateActiveViewButtons(){let e=this.getCachedActiveView();if(e&&e.file&&e.file.extension==="md"){let n=e.containerEl.querySelector(".gridnote-toggle-button");n&&this.updateButtonVisibility(e,n)}}addToggleButtonToView(e,n){let r=n.containerEl.querySelector(".gridnote-toggle-button");if(r){this.updateButtonState(e,r),this.updateButtonVisibility(n,r);return}let o=n.containerEl.querySelector(".view-actions");if(!o)return;let i=document.createElement("div");i.className="clickable-icon gridnote-toggle-button",i.setAttribute("aria-label","Toggle GridNote View"),o.insertBefore(i,o.firstChild),i.innerHTML=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
			<g fill="currentColor">
				<!-- \u5916\u8FB9\u6846 -->
				<rect x="1" y="1" width="14" height="14" stroke="currentColor" stroke-width="0.8" fill="none" rx="1"/>
				
				<!-- \u5EB7\u5948\u5C14\u7B14\u8BB0\u5206\u9694\u7EBF -->
				<!-- \u5DE6\u4FA7\u5173\u952E\u8BCD\u533A\u5206\u9694\u7EBF -->
				<line x1="5.5" y1="1" x2="5.5" y2="11" stroke="currentColor" stroke-width="0.6"/>
				<!-- \u5E95\u90E8\u603B\u7ED3\u533A\u5206\u9694\u7EBF -->
				<line x1="1" y1="11" x2="15" y2="11" stroke="currentColor" stroke-width="0.6"/>
				
				<!-- \u5DE6\u4FA7\u5173\u952E\u8BCD\u533A\u5185\u5BB9 (\u70B9\u72B6\u8868\u793A\u5173\u952E\u8BCD) -->
				<circle cx="3" cy="3.5" r="0.4" opacity="0.7"/>
				<circle cx="3" cy="5.5" r="0.4" opacity="0.7"/>
				<circle cx="3" cy="7.5" r="0.4" opacity="0.7"/>
				<circle cx="3" cy="9.5" r="0.4" opacity="0.7"/>
				
				<!-- \u53F3\u4FA7\u7B14\u8BB0\u533A\u5185\u5BB9 (\u77ED\u7EBF\u8868\u793A\u7B14\u8BB0\u5185\u5BB9) -->
				<rect x="7" y="3" width="6" height="0.6" rx="0.3" opacity="0.8"/>
				<rect x="7" y="4.2" width="4" height="0.6" rx="0.3" opacity="0.6"/>
				<rect x="7" y="5.8" width="5" height="0.6" rx="0.3" opacity="0.8"/>
				<rect x="7" y="7" width="3.5" height="0.6" rx="0.3" opacity="0.6"/>
				<rect x="7" y="8.5" width="4.5" height="0.6" rx="0.3" opacity="0.8"/>
				<rect x="7" y="9.7" width="3" height="0.6" rx="0.3" opacity="0.6"/>
				
				<!-- \u5E95\u90E8\u603B\u7ED3\u533A\u5185\u5BB9 (\u6A2A\u7EBF\u8868\u793A\u603B\u7ED3) -->
				<rect x="2" y="12.5" width="11" height="0.6" rx="0.3" opacity="0.9"/>
				<rect x="3" y="13.8" width="8" height="0.6" rx="0.3" opacity="0.7"/>
			</g>
		</svg>`,i.addEventListener("click",async a=>{if(a.preventDefault(),!i.hasAttribute("disabled")){i.setAttribute("disabled","true");try{this.toggleGridNoteView(e,n)}finally{i.removeAttribute("disabled")}}}),this.updateButtonState(e,i),this.updateButtonVisibility(n,i),this.getViewState(e).isGridNoteMode&&n.file&&this.updateLeafFileMapping(e,n.file.path)}async toggleGridNoteView(e,n){this.getViewState(e).isGridNoteMode?this.switchToMarkdownMode(e,n):await this.switchToGridNoteMode(e,n);let o=n.containerEl.querySelector(".gridnote-toggle-button");o&&this.updateButtonState(e,o)}async ensureDocumentHasH1Header(e,n){var m;let r=e.split(`
`),o=-1,i=-1,s=!1,a=/^(#{1,6})\s+/,l=/^\s*```/,c=-1;if(r.length>0&&r[0].trim()==="---"){for(let g=1;g<r.length;g++)if(r[g].trim()==="---"){c=g;break}}let d=c>=0?c+1:0;for(let g=d;g<r.length;g++){let v=r[g];if(l.test(v)){s=!s;continue}if(!s){let b=v.trim().match(a);if(b){o=g,i=b[1].length;break}}}if(i===1&&(o===d||r.slice(d,o).every(g=>!g.trim())))return e;let u="# Untitled",f=[...r],h=c>=0?c+1:0;c>=0?h<f.length&&((m=f[h])==null?void 0:m.trim())!==""?f.splice(h,0,"",u):f.splice(h,0,u):f.length>0&&f[0].trim()!==""?f.unshift(u,""):f.unshift(u);let p=f.join(`
`);if(n.file)try{this.markInternalModification(n.leaf),await this.app.vault.modify(n.file,p)}catch(g){console.error("[GridNote] \u81EA\u52A8\u63D2\u5165 H1 \u6807\u9898\u5931\u8D25:",g)}return p}parseMarkdown(e,n,r){return dt(e,n,r)}async switchToGridNoteMode(e,n){var a,l,c;let r=this.getViewState(e),o=n.contentEl,i=o.querySelector(".markdown-source-view, .markdown-reading-view");i&&(i.style.display="none"),this.hideOriginalMenuButtons(n);let s=o.createDiv("gridnote-container");try{let d=((a=n.editor)==null?void 0:a.getValue())||"";d=await this.ensureDocumentHasH1Header(d,n);let u=this.parseMarkdown(d,(l=n.file)==null?void 0:l.path,r.lastContent);r.nodes=u,r.lastContent=d;let f=this.createGridNoteViewAdapter(n,r);if(f.getLocalFoldsCache(),r.instance=new Wn({target:s,props:{View:f,root:u,isIntegratedView:!0}}),r.localWatcher=new fn(n),r.localWatcher.start(),n.editor&&!r.editorChangeEventRef){let h=e,p=(c=n.file)==null?void 0:c.path,m=g=>{let v=this.getCachedActiveView();if(v&&v.leaf===h&&v.editor===g){let b=g.getValue()||"",_=this.getViewState(h),y=dt(b,p,_.lastContent);this.markInternalModification(h),_.isGridNoteMode&&_.instance&&(_.nodes=y,_.lastContent=b,_.instance.$set({root:y})),p&&this.syncFileContent(p,y,h)}};r.editorChangeEventRef=this.app.workspace.on("editor-change",m)}n.file&&this.updateLeafFileMapping(e,n.file.path),r.isGridNoteMode=!0}catch(d){console.error("GridNote\u5207\u6362\u5931\u8D25:",d),s.innerHTML=`<div style="display: flex; align-items: center; justify-content: center; height: 200px; color: var(--text-error);">
				<div>\u52A0\u8F7D\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5</div>
			</div>`}}switchToMarkdownMode(e,n){let r=this.getViewState(e);r.editorChangeEventRef&&(this.app.workspace.offref(r.editorChangeEventRef),r.editorChangeEventRef=null),r.instance&&(r.instance.$destroy(),r.instance=null),r.localWatcher&&(r.localWatcher.stop(),r.localWatcher=null);let o=n.contentEl.querySelector(".gridnote-container");o&&o.remove();let i=n.contentEl.querySelector(".markdown-source-view, .markdown-reading-view");i&&(i.style.display=""),this.showOriginalMenuButtons(n),r.isGridNoteMode=!1}createGridNoteViewAdapter(e,n){var i,s;let r=this.plugin,o={app:this.app,file:e.file,editor:e.editor,contentEl:e.contentEl,Level:n.levelController,lastUserFoldInteraction:0,plugin:r,nodes:n.nodes,instance:n.instance,LOCAL_FOLDS:Pe([]),leaf:e.leaf,containerEl:e.containerEl,addChild:(i=e.addChild)==null?void 0:i.bind(e),removeChild:(s=e.removeChild)==null?void 0:s.bind(e),getViewType:()=>e.getViewType(),getState:()=>e.getState(),setState:(a,l)=>e.setState(a,l),get ProStatus(){var a;try{let l=(a=r.vipManager)==null?void 0:a.getActivationInfo(),c=(l==null?void 0:l.isActive)||!1;return Boolean(c)}catch(l){return console.error("[ViewAdapter] VIP\u72B6\u6001\u68C0\u67E5\u5931\u8D25:",l),!1}},scrollToLine:a=>{n.instance&&n.instance.currentLines&&n.instance.currentLines.set(a+1)},markInternalModification:a=>{this.markInternalFileModification(a)},handleClickHeader:a=>{e.editor&&e.editor.scrollIntoView({from:{line:a,ch:0},to:{line:a,ch:0}},!0)},handleClickFold:(a,l,c)=>{if(o.lastUserFoldInteraction=Date.now(),e.editor){let d=l-1,u=e.editor.cm;if(!u){c();return}let f=u.domAtPos(a),h=f.node instanceof Element?f.node:f.node.parentElement,p=h==null?void 0:h.querySelector(".cm-fold-indicator");if(!p&&h){let m=h.parentElement;for(;m&&!p&&m!==u.dom;)p=m.querySelector(".cm-fold-indicator"),m=m.parentElement}if(p){let m=p.classList.contains("is-collapsed");p.dispatchEvent(new MouseEvent("click",{bubbles:!1,cancelable:!0})),o.LOCAL_FOLDS.update(g=>{let v=g.indexOf(d),b;return m?b=g.filter(_=>_!==d):b=[...g,d],b}),Promise.resolve().then(()=>{var b,_,y;let g=this.app.foldManager,v=((b=g==null?void 0:g.load)==null?void 0:b.call(g,e.file))||((_=g==null?void 0:g.get)==null?void 0:_.call(g,e.file));if(v&&v.folds){let M=`${this.app.appId}-note-fold-${(y=e.file)==null?void 0:y.path}`;localStorage.setItem(M,JSON.stringify({folds:v.folds,lines:e.editor.lineCount()}))}}),c()}else c()}},handleClickLink:(a,l)=>{let c=a.target;if(c instanceof HTMLAnchorElement){let d=c.dataset.href;if(e.file){let{basename:u,path:f}=e.file;d&&!d.startsWith(u)?c.classList.contains("internal-link")&&this.app.workspace.openLinkText(d,f,!0):o.handleClickHeader(l)}}},getLocalFoldsCache:()=>{var d;let l=`${this.app.appId}-note-fold-${(d=e.file)==null?void 0:d.path}`,c=localStorage.getItem(l);if(c)try{let f=JSON.parse(c).folds.map(h=>h.from);o.LOCAL_FOLDS.set(f)}catch(u){console.error(u)}else o.LOCAL_FOLDS.set([])},recalculateFoldStates:(a,l)=>{if(!e.file||!a||!l)return;let c=Xt(o.LOCAL_FOLDS);if(c.length!==0)try{let d=this.extractHeaders(a),u=this.extractHeaders(l),f=[];c.forEach(g=>{let v=d.find(b=>b.line===g+1);if(v){let b=u.find(_=>_.text===v.text&&_.level===v.level);b&&f.push(b.line-1)}});let h=[...c].sort((g,v)=>g-v),p=[...f].sort((g,v)=>g-v);(h.length!==p.length||h.some((g,v)=>g!==p[v]))&&(o.LOCAL_FOLDS.set(f),this.saveFoldsToStorage(f,e.file.path))}catch(d){console.error("\u91CD\u65B0\u8BA1\u7B97\u6298\u53E0\u72B6\u6001\u65F6\u51FA\u9519:",d)}},refreshFromMarkdown:a=>{var c;let l=dt(a,(c=e.file)==null?void 0:c.path,n.lastContent);n.nodes=l,n.lastContent=a,n.instance&&n.instance.$set({root:l})},get foldManager(){return Lt.getInstance(this.app)},loadFoldStates:()=>{var c;if(!((c=e.file)!=null&&c.path))return;let a=Lt.getInstance(this.app);a.loadFromStorage(e.file.path);let l=a.getFolds(e.file.path);o.LOCAL_FOLDS.set(l)},render:a=>{var l;try{let c=dt(a,(l=e.file)==null?void 0:l.path,n.lastContent);n.nodes=c,n.lastContent=a,n.instance&&n.instance.$set({root:c})}catch(c){console.error("GridNote adapter render failed:",c)}}};return o}extractHeaders(e){let n=[],r=e.split(`
`),o=!1;return r.forEach((i,s)=>{let a=i.trim();if(a.startsWith("```")){o=!o;return}if(!o){let l=a.match(/^(#{1,6})\s+(.+)$/);l&&n.push({text:l[2].trim(),level:l[1].length,line:s+1})}}),n}saveFoldsToStorage(e,n){if(!n)return;let o=`${this.app.appId}-note-fold-${n}`,s={folds:e.map(a=>({from:a,to:a+1})),lines:e.length};localStorage.setItem(o,JSON.stringify(s))}getViewState(e){return this.viewStates.has(e)||this.viewStates.set(e,{isGridNoteMode:!1,instance:null,levelController:new zn,localWatcher:null,nodes:[],editorChangeEventRef:null,lastModificationSource:null,lastModificationTime:0}),this.viewStates.get(e)}markInternalModification(e){let n=this.getViewState(e);n.lastModificationSource="internal",n.lastModificationTime=Date.now()}markInternalFileModification(e){let n=this.leafFileMap.get(e);n&&n.forEach(r=>{this.markInternalModification(r)})}updateButtonState(e,n){this.getViewState(e).isGridNoteMode?(n.addClass("is-active"),n.setAttribute("aria-label","Switch to Markdown View")):(n.removeClass("is-active"),n.setAttribute("aria-label","Switch to GridNote View"))}updateButtonVisibility(e,n){try{e.getMode()==="source"?n.style.display="":n.style.display="none"}catch(r){n.style.display=""}}hideOriginalMenuButtons(e){let n=e.containerEl.querySelector(".view-actions");n&&n.querySelectorAll(".clickable-icon:not(.gridnote-toggle-button)").forEach(o=>{let i=o;i.style.display="none",i.setAttribute("data-gridnote-hidden","true")})}showOriginalMenuButtons(e){let n=e.containerEl.querySelector(".view-actions");n&&n.querySelectorAll('[data-gridnote-hidden="true"]').forEach(o=>{let i=o;i.style.display="",i.removeAttribute("data-gridnote-hidden")})}setupFoldManagerSync(e,n,r){let o=this.getViewState(e);if(!n.file)return;let i=n.file.path,s="",a=!1,l=()=>{var p,m,g;if(!a)try{let v=this.app.foldManager,b=((p=v==null?void 0:v.load)==null?void 0:p.call(v,n.file))||((m=v==null?void 0:v.get)==null?void 0:m.call(v,n.file));if(b&&b.folds){let _=JSON.stringify(b.folds);if(_!==s){s=_;let y=b.folds.map(I=>I.from);r.LOCAL_FOLDS.set(y);let M=`${this.app.appId}-note-fold-${i}`;localStorage.setItem(M,JSON.stringify({folds:b.folds,lines:((g=n.editor)==null?void 0:g.lineCount())||0}))}}}catch(v){console.error("[\u6298\u53E0\u540C\u6B65] \u9519\u8BEF:",v)}},c=null,d=null,u=()=>{c&&clearTimeout(c),d&&cancelIdleCallback(d),d=requestIdleCallback(()=>{l(),d=null},{timeout:100})},f=this.app.workspace.on("layout-change",u),h=this.app.workspace.on("active-leaf-change",p=>{p===e&&u()});o.foldSyncRefs||(o.foldSyncRefs=[]),o.foldSyncRefs.push(f,h),o.triggerFoldSync=u,queueMicrotask(l)}destroy(){if(this.isDestroyed)return;this.isDestroyed=!0;try{this.eventRefs.forEach(r=>{try{this.app.workspace.offref(r)}catch(o){}}),this.eventRefs=[],this.app.workspace.getLeavesOfType("markdown").forEach(r=>{try{let o=this.viewStates.get(r);if(o){if(o.editorChangeEventRef){try{this.app.workspace.offref(o.editorChangeEventRef)}catch(s){}o.editorChangeEventRef=null}if(o.instance){try{o.instance.$destroy()}catch(s){}o.instance=null}if(o.localWatcher){try{o.localWatcher.stop()}catch(s){}o.localWatcher=null}o.foldSyncRefs&&(o.foldSyncRefs.forEach(s=>{try{this.app.workspace.offref(s)}catch(a){}}),o.foldSyncRefs=void 0);let i=r.view;if(i&&i.contentEl){let s=i.contentEl.querySelector(".gridnote-container");s&&s.remove();let a=i.containerEl.querySelector(".gridnote-toggle-button");a&&a.remove();let l=i.contentEl.querySelector(".markdown-source-view, .markdown-reading-view");l&&(l.style.display="")}}}catch(o){}}),this.leafFileMap.clear(),It.instance===this&&(It.instance=null)}catch(n){console.error("GridNote: \u6E05\u7406\u8D44\u6E90\u65F6\u51FA\u9519:",n)}this.app.workspace.getLeavesOfType("markdown").forEach(n=>{let r=n.view;if(r){let o=r.containerEl.querySelector(".gridnote-toggle-button");o&&o.remove()}})}},hn=It;hn.instance=null;var Ke=require("obsidian"),qn=class extends Ke.PluginSettingTab{constructor(n,r){super(n,r);this.plugin=r}display(){var p,m,g,v,b,_;let{containerEl:n}=this;n.empty(),new Ke.Setting(n).setName("\u529F\u80FD\u4ECB\u7ECD").setHeading(),new Ke.Setting(n).setDesc("GridNote \u5C06 Markdown \u6587\u6863\u8F6C\u6362\u4E3A\u805A\u7126\u5F0F\u6811\u72B6\u7ED3\u6784\u89C6\u56FE\uFF0C\u7ED3\u5408\u5EB7\u5948\u5C14\u7B14\u8BB0\u6CD5\u548C\u5361\u7247\u76D2\u7B14\u8BB0\u7CFB\u7EDF\uFF0C\u63D0\u5347\u77E5\u8BC6\u7EC4\u7EC7\u548C\u9605\u8BFB\u7406\u89E3\u6548\u7387\u3002"),new Ke.Setting(n).setName("\u6FC0\u6D3B\u72B6\u6001").setHeading(),new Ke.Setting(n).setName("\u8BBE\u5907 ID").setDesc("ID \u7528\u4E8E\u6FC0\u6D3B\u63D2\u4EF6,\u4E00\u4E2A\u8BA2\u5355\u53F7\u6700\u591A\u6FC0\u6D3B\u4E09\u53F0\u8BBE\u5907").addButton(y=>{let x=()=>{try{return this.app.appId||"unknown-device"}catch(M){return"unknown-device"}};return y.setButtonText(x()).onClick(async()=>{})}),new Ke.Setting(n).setName("\u8D2D\u4E70\u4E13\u4E1A\u7248").setDesc("\u8D2D\u4E70\u540E\uFF0C\u53EF\u6FC0\u6D3B\u4E13\u4E1A\u7248").addButton(y=>y.setButtonText("\u53BB\u8D2D\u4E70").onClick(()=>{window.open("https://gridnote.cn/#/landing")}));let r=null;(p=this.plugin.vipManager)==null||p.clearCache();let o=((m=this.plugin.vipManager)==null?void 0:m.getActivationInfo())||{isActive:!1},i=((g=this.plugin.vipManager)==null?void 0:g.isVIPActive())||!1,s="";o.isActive&&o.activatedAt?s=`\u2705 \u5DF2\u6FC0\u6D3B\u4E13\u4E1A\u7248 (\u6C38\u4E45\u6709\u6548\uFF0C\u6FC0\u6D3B\u65F6\u95F4\uFF1A${((v=o.activatedAt)==null?void 0:v.toLocaleDateString())||"\u672A\u77E5"})`:s="\u274C \u672A\u6FC0\u6D3B\u4E13\u4E1A\u7248";let a=new Ke.Setting(n).setName("\u6FC0\u6D3B\u4E13\u4E1A\u7248").setDesc(s).setClass("grid-note-setting-activate").addText(y=>{r=y,y.setPlaceholder("\u8BA2\u5355\u53F7").setValue("").onChange(async x=>{this.plugin.settings.activationCode=x,await this.plugin.saveSettings(),this.app.workspace.trigger("gridnote-setting-changed","activationCode",x)})}).addButton(y=>y.setButtonText("\u7ACB\u5373\u9A8C\u8BC1").onClick(async()=>{var M,I;let x=((M=r==null?void 0:r.getValue())==null?void 0:M.trim())||"";if(!x){new Ke.Notice("\u8BF7\u8F93\u5165\u8BA2\u5355\u53F7");return}try{y.setButtonText("\u9A8C\u8BC1\u4E2D..."),y.setDisabled(!0),await((I=this.plugin.vipManager)==null?void 0:I.activate(x))?this.display():(y.setButtonText("\u7ACB\u5373\u9A8C\u8BC1"),y.setDisabled(!1))}catch(L){console.error("[Settings] \u6FC0\u6D3B\u9519\u8BEF:",L),y.setButtonText("\u7ACB\u5373\u9A8C\u8BC1"),y.setDisabled(!1)}}));new Ke.Setting(n).setName("\u622A\u56FE\u8BBE\u7F6E").setHeading(),new Ke.Setting(n).setName("\u622A\u56FE\u4FDD\u5B58\u6587\u4EF6\u5939").setDesc("\u8BBE\u7F6E\u4FDD\u5B58\u622A\u56FE\u7684\u6587\u4EF6\u5939\u540D\u79F0\uFF08\u76F8\u5BF9\u4E8E vault \u6839\u76EE\u5F55\uFF09").addText(y=>y.setPlaceholder("GridNote-Screenshots").setValue(this.plugin.settings.screenshotFolder).onChange(async x=>{this.plugin.settings.screenshotFolder=x.trim()||"GridNote-Screenshots",await this.plugin.saveSettings()})),(b=this.plugin.vipManager)!=null&&b.isVIPActive()&&new Ke.Setting(n).setName("\u5237\u65B0\u9A8C\u8BC1\u72B6\u6001").setDesc("\u7ACB\u5373\u8054\u7F51\u9A8C\u8BC1\u5F53\u524D\u6FC0\u6D3B\u72B6\u6001").addButton(y=>y.setButtonText("\u7ACB\u5373\u9A8C\u8BC1").onClick(async()=>{var x;try{y.setButtonText("\u9A8C\u8BC1\u4E2D..."),y.setDisabled(!0),await((x=this.plugin.vipManager)==null?void 0:x.manualVerify())?this.display():this.display(),y.setButtonText("\u7ACB\u5373\u9A8C\u8BC1"),y.setDisabled(!1)}catch(M){console.error("Manual verify error:",M),y.setButtonText("\u7ACB\u5373\u9A8C\u8BC1"),y.setDisabled(!1)}})),n.createEl("div",{text:"\u9047\u5230\u95EE\u9898\uFF1F",cls:"gridnote-help-links"}).append(createEl("a",{href:"https://gridnote.cn/#/landing",text:"\u8054\u7CFB\u6280\u672F\u652F\u6301"})),n.createEl("div",{cls:"gridnote-section-spacer"}),new Ke.Setting(n).setName("\u529F\u80FD\u5BF9\u6BD4").setHeading();let l=n.createDiv({cls:"gridnote-features-container"}),c=l.createDiv({cls:"features-section free-features"});c.createEl("h4",{text:"\u{1F4CB} \u514D\u8D39\u529F\u80FD",cls:"features-section-title"}),[{icon:"\u{1F332}",name:"\u6811\u72B6\u7ED3\u6784\u89C6\u56FE",desc:"\u5C06 Markdown \u6587\u6863\u8F6C\u6362\u4E3A\u76F4\u89C2\u7684\u6811\u72B6\u7ED3\u6784"},{icon:"\u{1F50D}",name:"\u5168\u6587\u641C\u7D22",desc:"\u5FEB\u901F\u641C\u7D22\u5E76\u5B9A\u4F4D\u5230\u5177\u4F53\u5185\u5BB9\u4F4D\u7F6E (Ctrl/Cmd + F/K)"},{icon:"\u{1F4F1}",name:"\u667A\u80FD\u6807\u9898\u70B9\u51FB",desc:"\u70B9\u51FB\u6807\u9898\u5FEB\u901F\u8DF3\u8F6C\u5230\u5BF9\u5E94\u7F16\u8F91\u4F4D\u7F6E"},{icon:"\u{1F4BE}",name:"\u72B6\u6001\u8BB0\u5FC6",desc:"\u81EA\u52A8\u4FDD\u5B58\u6298\u53E0\u5C55\u5F00\u72B6\u6001\uFF0C\u4E0B\u6B21\u6253\u5F00\u6062\u590D"}].forEach(y=>{let x=c.createEl("div",{cls:"feature-row"});x.createEl("span",{text:y.icon,cls:"feature-icon"});let M=x.createEl("div",{cls:"feature-content"});M.createEl("div",{text:y.name,cls:"feature-name"}),M.createEl("div",{text:y.desc,cls:"feature-desc"})});let u=l.createDiv({cls:`features-section pro-features${(_=this.plugin.vipManager)!=null&&_.isVIPActive()?" activated":""}`});u.createEl("h4",{text:"\u2B50 \u4E13\u4E1A\u7248\u529F\u80FD",cls:"features-section-title"}),[{icon:"\u270F\uFE0F",name:"\u53CC\u51FB\u5C31\u5730\u7F16\u8F91",desc:"\u53CC\u51FB\u4EFB\u610F\u8282\u70B9\u5185\u5BB9\u5373\u53EF\u76F4\u63A5\u7F16\u8F91\uFF0C\u652F\u6301\u8BED\u6CD5\u9AD8\u4EAE"},{icon:"\u{1F4CA}",name:"\u5C42\u7EA7\u6DF1\u5EA6\u63A7\u5236",desc:"\u81EA\u7531\u8C03\u8282\u663E\u793A\u6DF1\u5EA6\uFF081-5\u7EA7\uFF09\uFF0C\u4E13\u6CE8\u91CD\u8981\u4FE1\u606F"},{icon:"\u{1F4C1}",name:"\u6587\u4EF6\u5FEB\u901F\u5207\u6362",desc:"\u4E00\u952E\u8BBF\u95EE\u540C\u76EE\u5F55 Markdown \u6587\u4EF6\uFF0C\u5FEB\u901F\u8DF3\u8F6C"},{icon:"\u{1F517}",name:"\u667A\u80FD\u53CC\u89C6\u56FE",desc:"\u5DE6\u4FA7\u6811\u72B6\u7ED3\u6784 + \u53F3\u4FA7\u7F16\u8F91\u5668\uFF0C\u5B8C\u7F8E\u7ED3\u5408"}].forEach(y=>{var I;let x=u.createEl("div",{cls:"feature-row"});x.createEl("span",{text:y.icon,cls:"feature-icon"});let M=x.createEl("div",{cls:"feature-content"});M.createEl("div",{text:y.name,cls:"feature-name"}),M.createEl("div",{text:y.desc,cls:"feature-desc"}),(I=this.plugin.vipManager)!=null&&I.isVIPActive()?x.createEl("span",{text:"\u2713",cls:"feature-status activated"}):x.createEl("span",{text:"\u{1F512}",cls:"feature-status locked"})});let h=n.createEl("style");h.textContent=`
			.gridnote-section-spacer {
				height: 32px;
			}

			/* \u529F\u80FD\u4ECB\u7ECD\u5BB9\u5668 */
			.gridnote-features-container {
				margin-bottom: 16px;
				display: grid;
				gap: 12px;
			}

			.features-section {
				padding: 12px;
				border-radius: 6px;
				border: 1px solid var(--background-modifier-border);
				background: var(--background-primary);
			}

			.features-section-title {
				margin: 0 0 8px 0;
				font-size: 15px;
				font-weight: 600;
				color: var(--text-normal);
			}

			.free-features {
				border-left: 4px solid var(--color-green);
			}

			.pro-features {
				border-left: 4px solid var(--color-orange);
				position: relative;
			}

			.pro-features.activated {
				border-left-color: var(--interactive-accent);
				background: var(--background-secondary);
			}

			.feature-row {
				display: flex;
				align-items: flex-start;
				padding: 6px 0;
				border-bottom: 1px solid var(--background-modifier-border-focus);
				transition: all 0.2s ease;
			}

			.feature-row:last-child {
				border-bottom: none;
			}

			.feature-row:hover {
				background: var(--background-modifier-hover);
				border-radius: 4px;
				padding-left: 6px;
				padding-right: 6px;
				margin-left: -6px;
				margin-right: -6px;
			}

			.feature-icon {
				font-size: 16px;
				margin-right: 10px;
				margin-top: 1px;
				flex-shrink: 0;
			}

			.feature-content {
				flex: 1;
			}

			.feature-name {
				font-weight: 600;
				color: var(--text-normal);
				font-size: 13px;
				margin-bottom: 2px;
			}

			.feature-desc {
				color: var(--text-muted);
				font-size: 12px;
				line-height: 1.3;
			}

			.feature-status {
				flex-shrink: 0;
				margin-left: 6px;
				margin-top: 1px;
				font-size: 14px;
				font-weight: bold;
			}

			.feature-status.activated {
				color: var(--color-green);
			}

			.feature-status.locked {
				color: var(--text-muted);
				opacity: 0.6;
			}

			/* \u6FC0\u6D3B\u72B6\u6001\u4E0B\u7684\u7279\u6B8A\u6837\u5F0F */
			.pro-features.activated .feature-name {
				color: var(--interactive-accent);
			}

			.pro-features.activated .feature-row:hover {
				background: var(--background-modifier-success);
			}
		`}};var Xe=require("obsidian");function Un(t,e){let n="";for(let r=0;r<e.length;r++){let o=t.charCodeAt(r%t.length);n+=(e.charCodeAt(r)^o).toString(16).padStart(2,"0")}return n}function jt(t,e){let n="",r=[];for(let o=0;o<e.length;o+=2)r.push(parseInt(e.substr(o,2),16));for(let o=0;o<r.length;o++){let i=t.charCodeAt(o%t.length);n+=String.fromCharCode(r[o]^i)}return n}var ct=class{constructor(e,n){this.STORAGE_KEY_PREFIX="GRID_NOTE_VIP_";this.VERIFICATION_INTERVAL=7*24*60*60*1e3;this.isInitialized=!1;this.cachedVIPStatus=null;this.cacheValidUntil=0;this.CACHE_DURATION=5*60*1e3;this.app=e,this.plugin=n}static getInstance(e,n){return ct.instance||(ct.instance=new ct(e,n)),ct.instance}async initialize(){if(!this.isInitialized)try{if(!this.plugin.settings){console.error("[GridNote VIP] Settings not initialized!");return}this.cleanupOldStorageKeys(),await this.validateLocalData(),this.setupSettingsWatcher(),this.setupPeriodicVerification(),this.isInitialized=!0}catch(e){console.error("[GridNote VIP] Initialization failed:",e)}}getAppId(){try{return this.app.appId||"unknown-device"}catch(e){return console.error("Failed to get app ID:",e),"unknown-device"}}getStorageKey(){return`${this.STORAGE_KEY_PREFIX}${this.getAppId()}`}async activate(e){try{let n=this.getAppId(),r=await(0,Xe.requestUrl)({url:"https://gridnote.cn/plugin-verify",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e,vault_id:n})}),{code:o,message:i}=r.json;if(o!==201)return new Xe.Notice(`\u6FC0\u6D3B\u5931\u8D25\uFF1A${i||"\u672A\u77E5\u9519\u8BEF"}`),!1;let s={appId:n,activationCode:e,activatedAt:Date.now(),lastVerified:Date.now()},a=Un(n,JSON.stringify(s));return localStorage.setItem(this.getStorageKey(),a),this.plugin.settings.activationCode=e,this.plugin.settings.proStatus=!0,await this.plugin.saveSettings(),this.plugin.app.workspace.trigger("gridnote-setting-changed","proStatus",!0),this.notifyStatusChange(),new Xe.Notice("\u2705 \u4E13\u4E1A\u7248\u6FC0\u6D3B\u6210\u529F\uFF01"),!0}catch(n){return console.error("[VIPManager] \u274C \u6FC0\u6D3B\u5931\u8D25:",n),new Xe.Notice(`\u6FC0\u6D3B\u5931\u8D25\uFF1A${n.message}`),!1}}async validateLocalData(){if(!this.isMobilePlatform())try{let e=this.getAppId(),n=this.getStorageKey(),r=localStorage.getItem(n);if(!r){await this.resetVIPStatus();return}let o=jt(e,r),i=JSON.parse(o);if(!i.appId||!i.activationCode||i.appId!==e){await this.resetVIPStatus();return}(!this.plugin.settings.proStatus||this.plugin.settings.activationCode!==i.activationCode)&&(this.plugin.settings.proStatus=!0,this.plugin.settings.activationCode=i.activationCode,await this.plugin.saveSettings(),this.plugin.app.workspace.trigger("gridnote-setting-changed","proStatus",!0)),Date.now()-i.lastVerified>this.VERIFICATION_INTERVAL&&setTimeout(()=>{this.backgroundVerify(i.activationCode)},2e3)}catch(e){console.error("[GridNote VIP] localStorage \u9A8C\u8BC1\u5F02\u5E38:",e),await this.resetVIPStatus()}}async backgroundVerify(e){try{let n=this.getAppId(),r=await(0,Xe.requestUrl)({url:"https://gridnote.cn/plugin-verify",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e,vault_id:n})}),{code:o}=r.json;if(o===201){let i={appId:n,activationCode:e,activatedAt:Date.now(),lastVerified:Date.now()},s=Un(n,JSON.stringify(i));localStorage.setItem(this.getStorageKey(),s)}else await this.resetVIPStatus(),new Xe.Notice("\u26A0\uFE0F VIP\u72B6\u6001\u9A8C\u8BC1\u5931\u8D25\uFF0C\u53EF\u80FD\u8BA2\u5355\u5DF2\u9000\u6B3E")}catch(n){}}async resetVIPStatus(){try{localStorage.removeItem(this.getStorageKey())}catch(e){}try{this.plugin.settings.proStatus=!1,this.plugin.settings.activationCode="",await this.plugin.saveSettings()}catch(e){console.error("[GridNote VIP] Failed to reset settings:",e)}this.clearCache(),this.plugin.app.workspace.trigger("gridnote-setting-changed","proStatus",!1)}async manualVerify(){let e=(this.plugin.settings.activationCode||"").trim();if(!e||e.length===0)return new Xe.Notice("\u8BF7\u5148\u8F93\u5165\u6FC0\u6D3B\u7801"),!1;try{let n=this.getAppId(),r=await(0,Xe.requestUrl)({url:"https://gridnote.cn/plugin-verify",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e,vault_id:n})}),{code:o,message:i}=r.json;if(o===201){let s={appId:n,activationCode:e,activatedAt:Date.now(),lastVerified:Date.now()},a=Un(n,JSON.stringify(s));return localStorage.setItem(this.getStorageKey(),a),this.plugin.settings.proStatus=!0,await this.plugin.saveSettings(),this.clearCache(),this.plugin.app.workspace.trigger("gridnote-setting-changed","proStatus",!0),new Xe.Notice("\u2705 \u9A8C\u8BC1\u6210\u529F\uFF0CVIP\u72B6\u6001\u6B63\u5E38"),!0}else return await this.resetVIPStatus(),new Xe.Notice(`\u274C \u9A8C\u8BC1\u5931\u8D25\uFF1A${i||"\u6FC0\u6D3B\u7801\u65E0\u6548"}`),!1}catch(n){return console.error("Manual verification failed:",n),new Xe.Notice(`\u274C \u9A8C\u8BC1\u5931\u8D25\uFF1A${n.message}`),!1}}isMobilePlatform(){return Xe.Platform.isMobile}syncMobileVIPStatus(){try{let e=this.getAppId(),n=this.getStorageKey(),r=localStorage.getItem(n);if(r){let o=jt(e,r),i=JSON.parse(o);i.appId===e&&i.activationCode&&(!this.plugin.settings.proStatus||this.plugin.settings.activationCode!==i.activationCode)&&(this.plugin.settings.proStatus=!0,this.plugin.settings.activationCode=i.activationCode,this.plugin.saveSettings().catch(s=>console.error("[GridNote VIP] Failed to save synced settings:",s)))}}catch(e){}}isVIPActive(){let e=Date.now();if(this.cachedVIPStatus!==null&&e<this.cacheValidUntil)return this.cachedVIPStatus;if(this.isMobilePlatform()){this.syncMobileVIPStatus();let r=this.plugin.settings.proStatus===!0,o=this.plugin.settings.activationCode||"",i=r&&o.length>0;return this.updateCache(i),i}try{let r=this.getAppId(),o=this.getStorageKey(),i=localStorage.getItem(o);if(!i)return this.updateCache(!1),!1;let s=jt(r,i),a=JSON.parse(s);if(a.appId!==r||!a.activationCode)return this.updateCache(!1),!1;if((this.plugin.settings.activationCode||"")!==a.activationCode)return this.updateCache(!1),!1;let c=this.plugin.settings.proStatus===!0;return this.updateCache(c),c}catch(r){return console.error("[GridNote VIP] \u684C\u9762\u7AEF VIP \u9A8C\u8BC1\u5931\u8D25:",r),this.updateCache(!1),!1}}getActivationInfo(){if(this.isMobilePlatform())return{isActive:this.plugin.settings.proStatus&&!!this.plugin.settings.activationCode,activatedAt:null};try{let e=this.getAppId(),n=localStorage.getItem(this.getStorageKey());if(n){let r=jt(e,n),o=JSON.parse(r);if(o.appId===e&&o.activationCode&&this.plugin.settings.proStatus)return{isActive:!0,activatedAt:new Date(o.activatedAt)}}}catch(e){console.error("[VIPManager] Failed to get activation info:",e)}return{isActive:!1,activatedAt:null}}setupSettingsWatcher(){this.plugin.registerEvent(this.plugin.app.workspace.on("gridnote-setting-changed",(e,n)=>{(e==="activationCode"||e==="proStatus")&&this.notifyStatusChange()}))}updateCache(e){this.cachedVIPStatus=e,this.cacheValidUntil=Date.now()+this.CACHE_DURATION}notifyStatusChange(){this.clearCache(),this.plugin.viewToggleManager&&this.plugin.viewToggleManager.refreshAllProStatus()}setupPeriodicVerification(){setInterval(()=>{this.checkAndPerformBackgroundVerification()},24*60*60*1e3)}async checkAndPerformBackgroundVerification(){try{let e=this.getAppId(),n=localStorage.getItem(this.getStorageKey());if(!n)return;let r=jt(e,n),o=JSON.parse(r);Date.now()-o.lastVerified>this.VERIFICATION_INTERVAL&&await this.backgroundVerify(o.activationCode)}catch(e){console.error("Periodic verification check failed:",e)}}clearCache(){this.cachedVIPStatus=null,this.cacheValidUntil=0}cleanupOldStorageKeys(){let n=`GRID_NOTE_${this.getAppId()}`;localStorage.getItem(n)&&localStorage.removeItem(n);let r="gridnote_vip_cache";localStorage.getItem(r)&&localStorage.removeItem(r)}destroy(){ct.instance=null}};var Ur={signature:"",activationCode:"",proStatus:!1,screenshotFolder:"GridNote-Screenshots"},$n=class extends mn.Plugin{async onload(){await this.loadSettings(),this.addSettingTab(new qn(this.app,this)),this.vipManager=ct.getInstance(this.app,this),await this.vipManager.initialize(),this.viewToggleManager=new hn(this.app,this),this.registerView(Ze,n=>new At(n))}async loadSettings(){try{let n=await this.loadData(),r={};n&&(typeof n.signature=="string"&&(r.signature=n.signature),typeof n.activationCode=="string"&&(r.activationCode=n.activationCode),typeof n.proStatus=="boolean"&&(r.proStatus=n.proStatus)),this.settings=Object.assign({},Ur,r)}catch(n){console.error("[GridNote] Failed to load settings, using defaults:",n),this.settings=Object.assign({},Ur),new mn.Notice("GridNote: \u914D\u7F6E\u52A0\u8F7D\u5931\u8D25\uFF0C\u4F7F\u7528\u9ED8\u8BA4\u8BBE\u7F6E")}}async saveSettings(){try{await this.saveData(this.settings)}catch(n){throw console.error("[GridNote] Failed to save settings:",n),new mn.Notice("GridNote: \u914D\u7F6E\u4FDD\u5B58\u5931\u8D25"),n}}onunload(){this.vipManager&&(this.vipManager.destroy(),this.vipManager=null),this.viewToggleManager&&(this.viewToggleManager.destroy(),this.viewToggleManager=null);let n=qe.getInstance(this.app);n&&n.destroy(),this.app.workspace.detachLeavesOfType(Ze),setTimeout(()=>{document.querySelectorAll(".gridnote-container").forEach(r=>r.remove()),document.querySelectorAll(".gridnote-toggle-button").forEach(r=>r.remove())},0)}};
