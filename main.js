/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var xt=Object.defineProperty;var en=Object.getOwnPropertyDescriptor;var nn=Object.getOwnPropertyNames;var rn=Object.prototype.hasOwnProperty;var on=(e,t,n)=>t in e?xt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var sn=(e,t)=>{for(var n in t)xt(e,n,{get:t[n],enumerable:!0})},cn=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of nn(t))!rn.call(e,o)&&o!==n&&xt(e,o,{get:()=>t[o],enumerable:!(r=en(t,o))||r.enumerable});return e};var ln=e=>cn(xt({},"__esModule",{value:!0}),e);var L=(e,t,n)=>(on(e,typeof t!="symbol"?t+"":t,n),n),an=(e,t,n)=>{if(!t.has(e))throw TypeError("Cannot "+n)};var ae=(e,t,n)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,n)};var Pt=(e,t,n)=>(an(e,t,"access private method"),n);var Un={};sn(Un,{DEFAULT_SETTINGS:()=>Qe,default:()=>Vt});module.exports=ln(Un);var gt=require("obsidian");var Je=require("obsidian");function y(){}var at=e=>e;function jt(e){return e()}function wt(){return Object.create(null)}function F(e){e.forEach(jt)}function J(e){return typeof e=="function"}function I(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function ue(e){return Object.keys(e).length===0}function qt(e,...t){if(e==null){for(let r of t)r(void 0);return y}let n=e.subscribe(...t);return n.unsubscribe?()=>n.unsubscribe():n}var fe=typeof window!="undefined",Rt=fe?()=>window.performance.now():()=>Date.now(),ut=fe?e=>requestAnimationFrame(e):y;var et=new Set;function de(e){et.forEach(t=>{t.c(e)||(et.delete(t),t.f())}),et.size!==0&&ut(de)}function Ht(e){let t;return et.size===0&&ut(de),{promise:new Promise(n=>{et.add(t={c:e,f:n})}),abort(){et.delete(t)}}}var Wt=typeof window!="undefined"?window:typeof globalThis!="undefined"?globalThis:global;var nt=class{constructor(t){L(this,"_listeners","WeakMap"in Wt?new WeakMap:void 0);L(this,"_observer");L(this,"options");this.options=t}observe(t,n){return this._listeners.set(t,n),this._getObserver().observe(t,this.options),()=>{this._listeners.delete(t),this._observer.unobserve(t)}}_getObserver(){var t;return(t=this._observer)!=null?t:this._observer=new ResizeObserver(n=>{var r;for(let o of n)nt.entries.set(o.target,o),(r=this._listeners.get(o.target))==null||r(o)})}};nt.entries="WeakMap"in Wt?new WeakMap:void 0;var pe=!1;function he(){pe=!0}function me(){pe=!1}function k(e,t){e.appendChild(t)}function V(e,t,n){let r=bt(e);if(!r.getElementById(t)){let o=x("style");o.id=t,o.textContent=n,ge(r,o)}}function bt(e){if(!e)return document;let t=e.getRootNode?e.getRootNode():e.ownerDocument;return t&&t.host?t:e.ownerDocument}function _e(e){let t=x("style");return t.textContent="/* empty */",ge(bt(e),t),t.sheet}function ge(e,t){return k(e.head||e,t),t.sheet}function $(e,t,n){e.insertBefore(t,n||null)}function v(e){e.parentNode&&e.parentNode.removeChild(e)}function xe(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function x(e){return document.createElement(e)}function yt(e){return document.createTextNode(e)}function A(){return yt(" ")}function we(){return yt("")}function E(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function be(e){return Array.from(e.childNodes)}function ye(e,t){t=""+t,e.data!==t&&(e.data=t)}function q(e,t,n,r){n==null?e.style.removeProperty(t):e.style.setProperty(t,n,r?"important":"")}function Q(e,t,n){e.classList.toggle(t,!!n)}function vt(e,t,{bubbles:n=!1,cancelable:r=!1}={}){return new CustomEvent(e,{detail:t,bubbles:n,cancelable:r})}function ve(e){let t={};return e.childNodes.forEach(n=>{t[n.slot||"default"]=!0}),t}var $t=new Map,kt=0;function fn(e){let t=5381,n=e.length;for(;n--;)t=(t<<5)-t^e.charCodeAt(n);return t>>>0}function dn(e,t){let n={stylesheet:_e(t),rules:{}};return $t.set(e,n),n}function Et(e,t,n,r,o,i,s,c=0){let a=16.666/r,l=`{
`;for(let h=0;h<=1;h+=a){let g=t+(n-t)*i(h);l+=h*100+`%{${s(g,1-g)}}
`}let u=l+`100% {${s(n,1-n)}}
}`,f=`__svelte_${fn(u)}_${c}`,p=bt(e),{stylesheet:w,rules:m}=$t.get(p)||dn(p,e);m[f]||(m[f]=!0,w.insertRule(`@keyframes ${f} ${u}`,w.cssRules.length));let d=e.style.animation||"";return e.style.animation=`${d?`${d}, `:""}${f} ${r}ms linear ${o}ms 1 both`,kt+=1,f}function Gt(e,t){let n=(e.style.animation||"").split(", "),r=n.filter(t?i=>i.indexOf(t)<0:i=>i.indexOf("__svelte")===-1),o=n.length-r.length;o&&(e.style.animation=r.join(", "),kt-=o,kt||pn())}function pn(){ut(()=>{kt||($t.forEach(e=>{let{ownerNode:t}=e.stylesheet;t&&v(t)}),$t.clear())})}var z;function R(e){z=e}function Lt(){if(!z)throw new Error("Function called outside component initialization");return z}function H(e){Lt().$$.on_mount.push(e)}function St(e,t){return Lt().$$.context.set(e,t),t}function Y(e){return Lt().$$.context.get(e)}var Z=[];var X=[],ot=[],$e=[],hn=Promise.resolve(),Ut=!1;function ke(){Ut||(Ut=!0,hn.then(Ct))}function W(e){ot.push(e)}var Bt=new Set,rt=0;function Ct(){if(rt!==0)return;let e=z;do{try{for(;rt<Z.length;){let t=Z[rt];rt++,R(t),mn(t.$$)}}catch(t){throw Z.length=0,rt=0,t}for(R(null),Z.length=0,rt=0;X.length;)X.pop()();for(let t=0;t<ot.length;t+=1){let n=ot[t];Bt.has(n)||(Bt.add(n),n())}ot.length=0}while(Z.length);for(;$e.length;)$e.pop()();Ut=!1,Bt.clear(),R(e)}function mn(e){if(e.fragment!==null){e.update(),F(e.before_update);let t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(W)}}function Ee(e){let t=[],n=[];ot.forEach(r=>e.indexOf(r)===-1?t.push(r):n.push(r)),n.forEach(r=>r()),ot=t}var ft;function _n(){return ft||(ft=Promise.resolve(),ft.then(()=>{ft=null})),ft}function zt(e,t,n){e.dispatchEvent(vt(`${t?"intro":"outro"}${n}`))}var Mt=new Set,G;function B(){G={r:0,c:[],p:G}}function U(){G.r||F(G.c),G=G.p}function _(e,t){e&&e.i&&(Mt.delete(e),e.i(t))}function b(e,t,n,r){if(e&&e.o){if(Mt.has(e))return;Mt.add(e),G.c.push(()=>{Mt.delete(e),r&&(n&&e.d(1),r())}),e.o(t)}else r&&r()}var gn={duration:0};function dt(e,t,n,r){let i=t(e,n,{direction:"both"}),s=r?0:1,c=null,a=null,l=null,u;function f(){l&&Gt(e,l)}function p(m,d){let h=m.b-s;return d*=Math.abs(h),{a:s,b:m.b,d:h,duration:d,start:m.start,end:m.start+d,group:m.group}}function w(m){let{delay:d=0,duration:h=300,easing:g=at,tick:D=y,css:K}=i||gn,lt={start:Rt()+d,b:m};m||(lt.group=G,G.r+=1),"inert"in e&&(m?u!==void 0&&(e.inert=u):(u=e.inert,e.inert=!0)),c||a?a=lt:(K&&(f(),l=Et(e,s,m,h,d,g,K)),m&&D(0,1),c=p(lt,h),W(()=>zt(e,m,"start")),Ht(O=>{if(a&&O>a.start&&(c=p(a,h),a=null,zt(e,c.b,"start"),K&&(f(),l=Et(e,s,c.b,c.duration,0,g,i.css))),c){if(O>=c.end)D(s=c.b,1-s),zt(e,c.b,"end"),a||(c.b?f():--c.group.r||F(c.group.c)),c=null;else if(O>=c.start){let At=O-c.start;s=c.a+c.d*g(At/c.duration),D(s,1-s)}}return!!(c||a)}))}return{run(m){J(i)?_n().then(()=>{i=i({direction:m?"in":"out"}),w(m)}):w(m)},end(){f(),c=a=null}}}function pt(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}var xn=["allowfullscreen","allowpaymentrequest","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],wn=new Set([...xn]);function P(e){e&&e.c()}function T(e,t,n){let{fragment:r,after_update:o}=e.$$;r&&r.m(t,n),W(()=>{let i=e.$$.on_mount.map(jt).filter(J);e.$$.on_destroy?e.$$.on_destroy.push(...i):F(i),e.$$.on_mount=[]}),o.forEach(W)}function N(e,t){let n=e.$$;n.fragment!==null&&(Ee(n.after_update),F(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function yn(e,t){e.$$.dirty[0]===-1&&(Z.push(e),ke(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function j(e,t,n,r,o,i,s=null,c=[-1]){let a=z;R(e);let l=e.$$={fragment:null,ctx:[],props:i,update:y,not_equal:o,bound:wt(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(a?a.$$.context:[])),callbacks:wt(),dirty:c,skip_bound:!1,root:t.target||a.$$.root};s&&s(l.root);let u=!1;if(l.ctx=n?n(e,t.props||{},(f,p,...w)=>{let m=w.length?w[0]:p;return l.ctx&&o(l.ctx[f],l.ctx[f]=m)&&(!l.skip_bound&&l.bound[f]&&l.bound[f](m),u&&yn(e,f)),p}):[],l.update(),u=!0,F(l.before_update),l.fragment=r?r(l.ctx):!1,t.target){if(t.hydrate){he();let f=be(t.target);l.fragment&&l.fragment.l(f),f.forEach(v)}else l.fragment&&l.fragment.c();t.intro&&_(e.$$.fragment),T(e,t.target,t.anchor),me(),Ct()}R(a)}var vn;typeof HTMLElement=="function"&&(vn=class extends HTMLElement{constructor(t,n,r){super();L(this,"$$ctor");L(this,"$$s");L(this,"$$c");L(this,"$$cn",!1);L(this,"$$d",{});L(this,"$$r",!1);L(this,"$$p_d",{});L(this,"$$l",{});L(this,"$$l_u",new Map);this.$$ctor=t,this.$$s=n,r&&this.attachShadow({mode:"open"})}addEventListener(t,n,r){if(this.$$l[t]=this.$$l[t]||[],this.$$l[t].push(n),this.$$c){let o=this.$$c.$on(t,n);this.$$l_u.set(n,o)}super.addEventListener(t,n,r)}removeEventListener(t,n,r){if(super.removeEventListener(t,n,r),this.$$c){let o=this.$$l_u.get(n);o&&(o(),this.$$l_u.delete(n))}}async connectedCallback(){if(this.$$cn=!0,!this.$$c){let t=function(i){return()=>{let s;return{c:function(){s=x("slot"),i!=="default"&&E(s,"name",i)},m:function(l,u){$(l,s,u)},d:function(l){l&&v(s)}}}};if(await Promise.resolve(),!this.$$cn||this.$$c)return;let n={},r=ve(this);for(let i of this.$$s)i in r&&(n[i]=[t(i)]);for(let i of this.attributes){let s=this.$$g_p(i.name);s in this.$$d||(this.$$d[s]=Yt(s,i.value,this.$$p_d,"toProp"))}for(let i in this.$$p_d)!(i in this.$$d)&&this[i]!==void 0&&(this.$$d[i]=this[i],delete this[i]);this.$$c=new this.$$ctor({target:this.shadowRoot||this,props:{...this.$$d,$$slots:n,$$scope:{ctx:[]}}});let o=()=>{this.$$r=!0;for(let i in this.$$p_d)if(this.$$d[i]=this.$$c.$$.ctx[this.$$c.$$.props[i]],this.$$p_d[i].reflect){let s=Yt(i,this.$$d[i],this.$$p_d,"toAttribute");s==null?this.removeAttribute(this.$$p_d[i].attribute||i):this.setAttribute(this.$$p_d[i].attribute||i,s)}this.$$r=!1};this.$$c.$$.after_update.push(o),o();for(let i in this.$$l)for(let s of this.$$l[i]){let c=this.$$c.$on(i,s);this.$$l_u.set(s,c)}this.$$l={}}}attributeChangedCallback(t,n,r){var o;this.$$r||(t=this.$$g_p(t),this.$$d[t]=Yt(t,r,this.$$p_d,"toProp"),(o=this.$$c)==null||o.$set({[t]:this.$$d[t]}))}disconnectedCallback(){this.$$cn=!1,Promise.resolve().then(()=>{!this.$$cn&&this.$$c&&(this.$$c.$destroy(),this.$$c=void 0)})}$$g_p(t){return Object.keys(this.$$p_d).find(n=>this.$$p_d[n].attribute===t||!this.$$p_d[n].attribute&&n.toLowerCase()===t)||t}});function Yt(e,t,n,r){var i;let o=(i=n[e])==null?void 0:i.type;if(t=o==="Boolean"&&typeof t!="boolean"?t!=null:t,!r||!n[e])return t;if(r==="toAttribute")switch(o){case"Object":case"Array":return t==null?null:JSON.stringify(t);case"Boolean":return t?"":null;case"Number":return t==null?null:t;default:return t}else switch(o){case"Object":case"Array":return t&&JSON.parse(t);case"Boolean":return t;case"Number":return t!=null?+t:t;default:return t}}var C=class{constructor(){L(this,"$$");L(this,"$$set")}$destroy(){N(this,1),this.$destroy=y}$on(t,n){if(!J(n))return y;let r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(n),()=>{let o=r.indexOf(n);o!==-1&&r.splice(o,1)}}$set(t){this.$$set&&!ue(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}};var Le="4";typeof window!="undefined"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Le);var Oe=require("obsidian");var S=[];for(let e=0;e<256;++e)S.push((e+256).toString(16).slice(1));function Se(e,t=0){return(S[e[t+0]]+S[e[t+1]]+S[e[t+2]]+S[e[t+3]]+"-"+S[e[t+4]]+S[e[t+5]]+"-"+S[e[t+6]]+S[e[t+7]]+"-"+S[e[t+8]]+S[e[t+9]]+"-"+S[e[t+10]]+S[e[t+11]]+S[e[t+12]]+S[e[t+13]]+S[e[t+14]]+S[e[t+15]]).toLowerCase()}var Xt,$n=new Uint8Array(16);function Kt(){if(!Xt){if(typeof crypto=="undefined"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Xt=crypto.getRandomValues.bind(crypto)}return Xt($n)}var kn=typeof crypto!="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Jt={randomUUID:kn};function En(e,t,n){var o,i,s;if(Jt.randomUUID&&!t&&!e)return Jt.randomUUID();e=e||{};let r=(s=(i=e.random)!=null?i:(o=e.rng)==null?void 0:o.call(e))!=null?s:Kt();if(r.length<16)throw new Error("Random bytes length must be >= 16");if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,t){if(n=n||0,n<0||n+16>t.length)throw new RangeError(`UUID byte range ${n}:${n+15} is out of buffer bounds`);for(let c=0;c<16;++c)t[n+c]=r[c];return t}return Se(r)}var Qt=En;function Ce(e){let t=e.split(`
`),n=[],r=[],o=0;return t.forEach((i,s)=>{let c=i.match(/^(#{1,6})\s+(.*)$/);if(c){let a=c[1].length,l=c[2],u={id:Qt(),header:l,content:"",level:a,children:[],startLine:s+1,endLine:s+1,startChar:o,endChar:o+i.length+1};for(;r.length>0&&r[r.length-1].level>=a;)r.pop();r.length===0?n.push(u):r[r.length-1].children.push(u),r.push(u)}else if(r.length>0){let a=r[r.length-1];a.content+=i+`
`,a.endLine=s+1,a.endChar=o+i.length+1}o+=i.length+1}),n}function Me(e,t){let n=e.split(/\r?\n/);if(t<1||t>n.length)throw new Error("currentLineNumber \u8D85\u51FA\u6587\u672C\u884C\u6570\u8303\u56F4");let o=n[t-1].trim().match(/^(#{1,6})\s+/);if(!o)throw new Error("\u6307\u5B9A\u884C\u4E0D\u662F\u4E00\u4E2A\u6709\u6548\u7684 Markdown \u6807\u9898");let i=o[1].length;for(let s=t;s<n.length;s++){let a=n[s].trim().match(/^(#{1,6})\s+/);if(a&&a[1].length<=i)return s+1}return null}function Fe(e,t){let n=e.split(/\r?\n/),r=t-1;for(;r>0;){if(n[r].match(/^(#{1,6})\s+/))return r;r--}return null}function Ie(e,t){let n=e.split(/\r?\n/),r=t;for(;r<n.length;){if(n[r].match(/^(#{1,6})\s+/))return r;r++}return null}function Ln(e){V(e,"svelte-1vrh5qm",".markdown-rendered.svelte-1vrh5qm{max-width:100%;padding-right:5px;user-select:text}.selected.svelte-1vrh5qm{box-shadow:0 0 0 2px var(--color-accent)}.node-preview{font-size:var(--font-text-size);margin-right:20px}.node-preview p{margin:0}")}function Sn(e){let t;return{c(){t=x("div"),E(t,"class","markdown-rendered svelte-1vrh5qm"),Q(t,"selected",Cn)},m(n,r){$(n,t,r),e[2](t)},p:y,i:y,o:y,d(n){n&&v(t),e[2](null)}}}var Cn=!1;function Mn(e,t,n){let{node:r}=t,o=Y("View"),i,s;H(()=>(i.addEventListener("click",c),()=>{i.removeEventListener("click",c)}));function c(l){o.handleClickLink(l,r.startLine)}function a(l){X[l?"unshift":"push"](()=>{i=l,n(0,i),n(1,r)})}return e.$$set=l=>{"node"in l&&n(1,r=l.node)},e.$$.update=()=>{if(e.$$.dirty&3){t:if(i){n(0,i.innerHTML="",i);let l=o.app.vault.adapter.getResourcePath(o.file.path);Oe.MarkdownRenderer.render(o.app,s=r.content,i,l,o)}}},[i,r,a]}var Zt=class extends C{constructor(t){super(),j(this,t,Mn,Sn,I,{node:1},Ln)}},te=Zt;var ee=require("obsidian");function Te(e,t,n){e.empty();let r=new ee.ExtraButtonComponent(e).setIcon(t?`heading-${t}`:"heading").setDisabled(!0).onClick(()=>{});return r.extraSettingsEl.addEventListener("pointerdown",o=>{}),()=>{r.extraSettingsEl.addEventListener("pointerdown",o=>{})}}var ne=require("obsidian");var Ft=require("obsidian");function Ne(e,t){let n=new Ft.Menu;n.addItem(r=>r.setTitle("\u590D\u5236\u5168\u6587").setIcon("copy-plus").onClick(()=>{t("\u590D\u5236\u5168\u6587")})),n.addItem(r=>r.setTitle("\u590D\u5236\u5F53\u524D\u8282\u70B9").setIcon("copy-minus").onClick(()=>{t("\u590D\u5236\u5F53\u524D\u8282\u70B9")})),n.addItem(r=>r.setTitle("\u590D\u5236\u5305\u542B\u5B50\u8282\u70B9").setIcon("copy").onClick(()=>{t("\u590D\u5236\u5305\u542B\u5B50\u8282\u70B9")})),n.showAtMouseEvent(e)}function De(e,t){let n=new Ft.ExtraButtonComponent(e).setIcon("copy").onClick(()=>{});return n.extraSettingsEl.addEventListener("pointerdown",r=>{Ne(r,t)}),()=>{n.extraSettingsEl.addEventListener("pointerdown",r=>{Ne(r,t)})}}function Ve(e){let t=e.getBoundingClientRect();return t.top>=150&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)-150&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}function Fn(e){V(e,"svelte-1mp45jq",'@charset "UTF-8";.container.svelte-1mp45jq.svelte-1mp45jq{height:30px;border-bottom:1.5px solid var(--background-modifier-border);display:flex;align-items:center}.container.svelte-1mp45jq .title.svelte-1mp45jq{flex:1;display:flex;align-items:center;width:calc(100% - 90px)}.container.svelte-1mp45jq .title .header.svelte-1mp45jq{color:var(--text-accent-color);user-select:text;font-weight:700;flex:1;max-width:calc(100% - 60px);padding-left:10px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.container.svelte-1mp45jq .action.svelte-1mp45jq{opacity:0}.container.svelte-1mp45jq .action .actions.svelte-1mp45jq{display:flex;justify-content:space-between}.container.svelte-1mp45jq:hover .action.svelte-1mp45jq{opacity:1}.selected.svelte-1mp45jq.svelte-1mp45jq{color:var(--color-accent);border-color:var(--color-accent)}.is-fold.svelte-1mp45jq.svelte-1mp45jq{opacity:0.5}')}function In(e){let t,n,r,o,i,s,c,a=e[0].header+"",l,u,f,p;return{c(){t=x("div"),n=x("div"),r=x("div"),o=A(),i=x("div"),s=A(),c=x("div"),l=yt(a),u=A(),f=x("div"),p=x("div"),E(c,"class","header svelte-1mp45jq"),E(n,"class","title svelte-1mp45jq"),E(p,"class","actions svelte-1mp45jq"),E(f,"class","action svelte-1mp45jq"),E(t,"class","container svelte-1mp45jq"),Q(t,"selected",e[3]),Q(t,"is-fold",!e[5])},m(w,m){$(w,t,m),k(t,n),k(n,r),e[8](r),k(n,o),k(n,i),e[9](i),k(n,s),k(n,c),k(c,l),k(t,u),k(t,f),k(f,p),e[10](p)},p(w,[m]){m&1&&a!==(a=w[0].header+"")&&ye(l,a),m&8&&Q(t,"selected",w[3]),m&32&&Q(t,"is-fold",!w[5])},i:y,o:y,d(w){w&&v(t),e[8](null),e[9](null),e[10](null)}}}function On(e,t,n){let{node:r}=t,{currentLines:o}=t,i=Y("View"),s,c,a,l=!1,u=null,f=null,p=!1;H(()=>{if(a){new ne.ExtraButtonComponent(a).setIcon("pencil").setTooltip("\u7F16\u8F91\u6807\u9898").onClick(()=>{var g;(g=i.instance)===null||g===void 0||g.currentLines.set(r.startLine),i.handleClickHeader(r.startLine)}),f=De(a,async g=>{let{editor:D}=i,{startLine:K,content:lt}=r;switch(g){case"\u590D\u5236\u5168\u6587":{let O=D.getValue();await navigator.clipboard.writeText(O);break}case"\u590D\u5236\u5F53\u524D\u8282\u70B9":{let O=D.getLine(K-1);await navigator.clipboard.writeText(`${O}
${lt}`);break}case"\u590D\u5236\u5305\u542B\u5B50\u8282\u70B9":{let O=D.getValue(),At=O.split(`
`),Ze=Me(O,K)||At.length,tn=D.getRange({line:K-1,ch:0},{line:Ze-1,ch:0});await navigator.clipboard.writeText(tn);break}default:}});let h=new ne.ExtraButtonComponent(s).setIcon(l?"chevron-right":"chevron-down").onClick(()=>{i.handleClickFold(r.startChar,r.startLine,()=>{n(5,l=!l),h.setIcon(l?"chevron-down":"chevron-right")})});i.LOCAL_FOLDS.subscribe(g=>{let D=g.includes(r.startLine-1);n(5,l=!D),h.setIcon(l?"chevron-down":"chevron-right")})}return()=>{u&&u(),f&&f()}});function w(h){X[h?"unshift":"push"](()=>{s=h,n(4,s)})}function m(h){X[h?"unshift":"push"](()=>{c=h,n(1,c)})}function d(h){X[h?"unshift":"push"](()=>{a=h,n(2,a)})}return e.$$set=h=>{"node"in h&&n(0,r=h.node),"currentLines"in h&&n(6,o=h.currentLines)},e.$$.update=()=>{if(e.$$.dirty&75){t:o>0&&(n(3,p=o===r.startLine),p&&c&&(Ve(c)||setTimeout(()=>{c.scrollIntoView({behavior:"smooth",block:"start"})},0)))}if(e.$$.dirty&135){t:a&&(u&&u&&u(),n(7,u=Te(c,r.level,h=>{})))}},[r,c,a,p,s,l,o,u,w,m,d]}var re=class extends C{constructor(t){super(),j(this,t,On,In,I,{node:0,currentLines:6},Fn)}},oe=re;function Ae(e){let t=e-1;return t*t*t+1}function ht(e,{delay:t=0,duration:n=400,easing:r=Ae,axis:o="y"}={}){let i=getComputedStyle(e),s=+i.opacity,c=o==="y"?"height":"width",a=parseFloat(i[c]),l=o==="y"?["top","bottom"]:["left","right"],u=l.map(g=>`${g[0].toUpperCase()}${g.slice(1)}`),f=parseFloat(i[`padding${u[0]}`]),p=parseFloat(i[`padding${u[1]}`]),w=parseFloat(i[`margin${u[0]}`]),m=parseFloat(i[`margin${u[1]}`]),d=parseFloat(i[`border${u[0]}Width`]),h=parseFloat(i[`border${u[1]}Width`]);return{delay:t,duration:n,easing:r,css:g=>`overflow: hidden;opacity: ${Math.min(g*20,1)*s};${c}: ${g*a}px;padding-${l[0]}: ${g*f}px;padding-${l[1]}: ${g*p}px;margin-${l[0]}: ${g*w}px;margin-${l[1]}: ${g*m}px;border-${l[0]}-width: ${g*d}px;border-${l[1]}-width: ${g*h}px;`}}function Tn(e){V(e,"svelte-1wli4nz",'@charset "UTF-8";.tree-children-container.svelte-1wli4nz{width:100%;max-width:100%;display:flex}.left-column.svelte-1wli4nz{max-width:100%;flex:1 1 0%;overflow-wrap:break-word;word-break:break-word}.right-column.svelte-1wli4nz{overflow-wrap:break-word;word-break:break-word;min-width:50%}.left-column .inline-title{display:none}.left-column .markdown-rendered div{max-width:100%;overflow-x:auto}.left-column .metadata-container{display:none !important}.cm-contentContainer > .cm-lineWrapping{padding:0 !important}.cm-scroller{padding:3px}')}function Nn(e){let t,n;return t=new oe({props:{currentLines:e[2],node:e[0]}}),{c(){P(t.$$.fragment)},m(r,o){T(t,r,o),n=!0},p(r,o){let i={};o&4&&(i.currentLines=r[2]),o&1&&(i.node=r[0]),t.$set(i)},i(r){n||(_(t.$$.fragment,r),n=!0)},o(r){b(t.$$.fragment,r),n=!1},d(r){N(t,r)}}}function Dn(e){let t,n,r,o,i;r=new oe({props:{currentLines:e[2],node:e[0]}});let s=e[4]&&Pe(e);return{c(){t=x("div"),n=x("h1"),P(r.$$.fragment),o=A(),s&&s.c(),q(n,"padding","30px 0px"),q(n,"border","none"),q(t,"text-align","center")},m(c,a){$(c,t,a),k(t,n),T(r,n,null),k(t,o),s&&s.m(t,null),i=!0},p(c,a){let l={};a&4&&(l.currentLines=c[2]),a&1&&(l.node=c[0]),r.$set(l),c[4]?s?(s.p(c,a),a&16&&_(s,1)):(s=Pe(c),s.c(),_(s,1),s.m(t,null)):s&&(B(),b(s,1,1,()=>{s=null}),U())},i(c){i||(_(r.$$.fragment,c),_(s),i=!0)},o(c){b(r.$$.fragment,c),b(s),i=!1},d(c){c&&v(t),N(r),s&&s.d()}}}function Pe(e){let t,n,r,o;return n=new te({props:{node:e[0]}}),{c(){t=x("div"),P(n.$$.fragment),q(t,"max-width","70%"),q(t,"margin","0 auto")},m(i,s){$(i,t,s),T(n,t,null),o=!0},p(i,s){let c={};s&1&&(c.node=i[0]),n.$set(c)},i(i){o||(_(n.$$.fragment,i),i&&W(()=>{o&&(r||(r=dt(t,ht,{},!0)),r.run(1))}),o=!0)},o(i){b(n.$$.fragment,i),i&&(r||(r=dt(t,ht,{},!1)),r.run(0)),o=!1},d(i){i&&v(t),N(n),i&&r&&r.end()}}}function je(e){let t,n,r,o,i=e[6]==!1&&qe(e),s=e[0].children&&e[0].children.length>0&&e[0].level<=e[3]&&Re(e);return{c(){t=x("div"),i&&i.c(),n=A(),s&&s.c(),E(t,"class","tree-children-container svelte-1wli4nz")},m(c,a){$(c,t,a),i&&i.m(t,null),k(t,n),s&&s.m(t,null),o=!0},p(c,a){c[6]==!1?i?(i.p(c,a),a&64&&_(i,1)):(i=qe(c),i.c(),_(i,1),i.m(t,n)):i&&(B(),b(i,1,1,()=>{i=null}),U()),c[0].children&&c[0].children.length>0&&c[0].level<=c[3]?s?(s.p(c,a),a&9&&_(s,1)):(s=Re(c),s.c(),_(s,1),s.m(t,null)):s&&(B(),b(s,1,1,()=>{s=null}),U())},i(c){o||(_(i),_(s),c&&W(()=>{o&&(r||(r=dt(t,ht,{},!0)),r.run(1))}),o=!0)},o(c){b(i),b(s),c&&(r||(r=dt(t,ht,{},!1)),r.run(0)),o=!1},d(c){c&&v(t),i&&i.d(),s&&s.d(),c&&r&&r.end()}}}function qe(e){let t,n,r;return n=new te({props:{node:e[0]}}),{c(){t=x("div"),P(n.$$.fragment),E(t,"class","left-column svelte-1wli4nz"),q(t,"flex","1 1 0%")},m(o,i){$(o,t,i),T(n,t,null),r=!0},p(o,i){let s={};i&1&&(s.node=o[0]),n.$set(s)},i(o){r||(_(n.$$.fragment,o),r=!0)},o(o){b(n.$$.fragment,o),r=!1},d(o){o&&v(t),N(n)}}}function Re(e){let t,n,r;return n=new It({props:{currentLines:e[2],nodes:e[0].children,tier:e[1]+1}}),{c(){t=x("div"),P(n.$$.fragment),E(t,"class","right-column svelte-1wli4nz"),q(t,"flex",e[5]+" 1 0%")},m(o,i){$(o,t,i),T(n,t,null),r=!0},p(o,i){let s={};i&4&&(s.currentLines=o[2]),i&1&&(s.nodes=o[0].children),i&2&&(s.tier=o[1]+1),n.$set(s),(!r||i&32)&&q(t,"flex",o[5]+" 1 0%")},i(o){r||(_(n.$$.fragment,o),r=!0)},o(o){b(n.$$.fragment,o),r=!1},d(o){o&&v(t),N(n)}}}function Vn(e){let t,n,r,o,i,s=[Dn,Nn],c=[];function a(u,f){return u[6]?0:1}t=a(e,-1),n=c[t]=s[t](e);let l=e[4]&&je(e);return{c(){n.c(),r=A(),l&&l.c(),o=we()},m(u,f){c[t].m(u,f),$(u,r,f),l&&l.m(u,f),$(u,o,f),i=!0},p(u,[f]){let p=t;t=a(u,f),t===p?c[t].p(u,f):(B(),b(c[p],1,1,()=>{c[p]=null}),U(),n=c[t],n?n.p(u,f):(n=c[t]=s[t](u),n.c()),_(n,1),n.m(r.parentNode,r)),u[4]?l?(l.p(u,f),f&16&&_(l,1)):(l=je(u),l.c(),_(l,1),l.m(o.parentNode,o)):l&&(B(),b(l,1,1,()=>{l=null}),U())},i(u){i||(_(n),_(l),i=!0)},o(u){b(n),b(l),i=!1},d(u){u&&(v(r),v(o)),c[t].d(u),l&&l.d(u)}}}function An(e,t,n){let r,o,i,{node:s}=t,{tier:c}=t,{currentLines:a}=t,l=Y("View"),u=Y("flexStore"),f=3;H(()=>{u.subscribe(p=>{n(3,f=p.tier),n(5,i=f-c)}),l.LOCAL_FOLDS.subscribe(p=>{let w=p.includes(s.startLine-1);n(4,o=!w)})}),e.$$set=p=>{"node"in p&&n(0,s=p.node),"tier"in p&&n(1,c=p.tier),"currentLines"in p&&n(2,a=p.currentLines)},e.$$.update=()=>{if(e.$$.dirty&1){t:n(6,r=s.level===1)}if(e.$$.dirty&10){t:n(5,i=f-c)}};t:n(4,o=!0);return[s,c,a,f,o,i,r]}var ie=class extends C{constructor(t){super(),j(this,t,An,Vn,I,{node:0,tier:1,currentLines:2},Tn)}},He=ie;function Pn(e){V(e,"svelte-8catmf","ul.svelte-8catmf{width:100%;list-style-type:none;padding-left:0}")}function We(e,t,n){let r=e.slice();return r[3]=t[n],r}function Ge(e){let t,n,r,o;return n=new He({props:{currentLines:e[2],node:e[3],tier:e[1]}}),{c(){t=x("li"),P(n.$$.fragment),r=A()},m(i,s){$(i,t,s),T(n,t,null),k(t,r),o=!0},p(i,s){let c={};s&4&&(c.currentLines=i[2]),s&1&&(c.node=i[3]),s&2&&(c.tier=i[1]),n.$set(c)},i(i){o||(_(n.$$.fragment,i),o=!0)},o(i){b(n.$$.fragment,i),o=!1},d(i){i&&v(t),N(n)}}}function jn(e){let t,n,r=pt(e[0]),o=[];for(let s=0;s<r.length;s+=1)o[s]=Ge(We(e,r,s));let i=s=>b(o[s],1,1,()=>{o[s]=null});return{c(){t=x("ul");for(let s=0;s<o.length;s+=1)o[s].c();E(t,"class","svelte-8catmf")},m(s,c){$(s,t,c);for(let a=0;a<o.length;a+=1)o[a]&&o[a].m(t,null);n=!0},p(s,[c]){if(c&7){r=pt(s[0]);let a;for(a=0;a<r.length;a+=1){let l=We(s,r,a);o[a]?(o[a].p(l,c),_(o[a],1)):(o[a]=Ge(l),o[a].c(),_(o[a],1),o[a].m(t,null))}for(B(),a=r.length;a<o.length;a+=1)i(a);U()}},i(s){if(!n){for(let c=0;c<r.length;c+=1)_(o[c]);n=!0}},o(s){o=o.filter(Boolean);for(let c=0;c<o.length;c+=1)b(o[c]);n=!1},d(s){s&&v(t),xe(o,s)}}}function qn(e,t,n){let{nodes:r}=t,{tier:o}=t,{currentLines:i}=t;return e.$$set=s=>{"nodes"in s&&n(0,r=s.nodes),"tier"in s&&n(1,o=s.tier),"currentLines"in s&&n(2,i=s.currentLines)},[r,o,i]}var se=class extends C{constructor(t){super(),j(this,t,qn,jn,I,{nodes:0,tier:1,currentLines:2},Pn)}},It=se;var it=[];function mt(e,t=y){let n,r=new Set;function o(c){if(I(e,c)&&(e=c,n)){let a=!it.length;for(let l of r)l[1](),it.push(l,e);if(a){for(let l=0;l<it.length;l+=2)it[l][0](it[l+1]);it.length=0}}}function i(c){o(c(e))}function s(c,a=y){let l=[c,a];return r.add(l),r.size===1&&(n=t(o,i)||y),c(e),()=>{r.delete(l),r.size===0&&n&&(n(),n=null)}}return{set:o,update:i,subscribe:s}}function Rn(e){V(e,"svelte-r4t1xv",".container.svelte-r4t1xv{padding-bottom:300px}")}function Hn(e){let t,n,r;return n=new It({props:{currentLines:e[2],nodes:e[0],tier:Wn}}),{c(){t=x("div"),P(n.$$.fragment),E(t,"class","container svelte-r4t1xv")},m(o,i){$(o,t,i),T(n,t,null),r=!0},p(o,[i]){let s={};i&4&&(s.currentLines=o[2]),i&1&&(s.nodes=o[0]),n.$set(s)},i(o){r||(_(n.$$.fragment,o),r=!0)},o(o){b(n.$$.fragment,o),r=!1},d(o){o&&v(t),N(n)}}}var Wn=0;function Gn(e,t,n){let r,o=y,i=()=>(o(),o=qt(a,d=>n(2,r=d)),a);e.$$.on_destroy.push(()=>o());let{View:s}=t,{root:c}=t,a=mt(-1);i();let l=new Map([["1",[0,1,1]],["2",[0,1,1,1]],["3",[0,1,2,1,1]],["4",[0,1,3,2,1,1]],["5",[0,1,4,3,2,1,1]]]),u=mt({tier:3,flex:[0,1,2,1,1]});St("flexStore",u);function f(d){u.update(h=>(h.tier=d,h.flex=l.get(String(h.tier+1)),h))}function p(){u.update(d=>(d.tier>=5||(d.tier++,d.flex=l.get(String(d.tier))),d))}function w(){u.update(d=>(d.tier<=1||(d.tier--,d.flex=l.get(String(d.tier))),d))}St("View",s);let m=s.Level.flex;return H(()=>{}),e.$$set=d=>{"View"in d&&n(3,s=d.View),"root"in d&&n(0,c=d.root)},[c,a,r,s,u,f,p,w]}var ce=class extends C{constructor(t){super(),j(this,t,Gn,Hn,I,{View:3,root:0,currentLines:1,flexStore:4,setTier:5,increase:6,decrease:7},Rn)}get currentLines(){return this.$$.ctx[1]}get flexStore(){return this.$$.ctx[4]}get setTier(){return this.$$.ctx[5]}get increase(){return this.$$.ctx[6]}get decrease(){return this.$$.ctx[7]}},Be=ce;var Ot=class{constructor(){this.tier=3;this._levels=new Map([["1",[0,1,1]],["2",[0,1,1,1]],["3",[0,1,2,1,1]],["4",[0,1,3,2,1,1]],["5",[0,1,4,3,2,1,1]]]);this.increase=()=>{this.tier>=5||this.tier++};this.decrease=()=>{this.tier<=1||this.tier--}}get flex(){return this._levels.get(this.tier.toString())}};var Ue=require("obsidian");var st="Grid-Note-Markdown-View",Tt=class extends Ue.MarkdownView{getViewType(){return st}getIcon(){return"star"}constructor(t){super(t)}async onOpen(){this.headerEl.style.display="flex",this.onClickEditor(),this.actionsEl.empty()}onScrollToSelectedRange(t){this.editor.scrollIntoView({from:{line:t,ch:0},to:{line:t,ch:0}},!0),setTimeout(()=>{let n=Ie(this.editor.getValue(),t);this.editor.setSelection({line:t-1,ch:0},{line:n||t,ch:0}),this.editor.focus()},0)}onClickEditor(){this.editor.cm.dom.addEventListener("click",this.handleClick.bind(this))}handleClick(t){let n=t.target;if(n instanceof HTMLAnchorElement){let r=n.innerText,{basename:o,path:i}=this.file;if(!r.startsWith(o)){let s=n.parentNode;s&&s.classList.contains("cm-link")||this.app.workspace.openLinkText(r,i,!0)}}else this.handleScrollToLine()}handleScrollToLine(){let t=this.editor.getCursor(),n=Fe(this.editor.getValue(),t.line+1),o=this.app.workspace.getLeavesOfType(tt).find(i=>{var s;return((s=i.getViewState().state)==null?void 0:s.file)==this.getState().file});o&&(o==null?void 0:o.view)instanceof ct&&o.view.scrollToLine(n||t.line)}onSimulateClickFoldBtn(t,n){return this.editor.scrollIntoView({from:{line:n,ch:0},to:{line:n,ch:0}},!0),new Promise(r=>{let s=this.editor.cm.domAtPos(t).node.querySelector(".cm-fold-indicator");if(s){let c=new MouseEvent("click",{bubbles:!1,cancelable:!0,view:window,button:0});s.dispatchEvent(c),r(!0)}else r(!1)})}async onClose(){this.editor.cm.dom.removeEventListener("click",this.handleClick)}};var _t,le,Nt=class{constructor(t){ae(this,_t);this.view=t,this.originalSetItem=localStorage.setItem.bind(localStorage),this.originalRemoveItem=localStorage.removeItem.bind(localStorage),this.isHijacked=!1}start(){this.isHijacked||(localStorage.setItem=(t,n)=>{let r=localStorage.getItem(t);this.originalSetItem(t,n),Pt(this,_t,le).call(this,t,n,r)},localStorage.removeItem=t=>{let n=localStorage.getItem(t);this.originalRemoveItem(t),Pt(this,_t,le).call(this,t,null,n)},this.isHijacked=!0)}stop(){localStorage.setItem=this.originalSetItem,localStorage.removeItem=this.originalRemoveItem,this.isHijacked=!1}};_t=new WeakSet,le=function(t,n,r){this.view.app&&this.view.app.workspace.trigger("localStorageChanged",{key:t,newValue:n,oldValue:r,timestamp:Date.now()})};var ze=require("obsidian");function Ye(e){let t=document.createElement("div");t.createEl("span",{text:"\u4F7F\u7528\u4E13\u4E1A\u7248\u529F\u80FD\uFF0C\u4F60\u53EF\u4EE5\u4ECE\u8FD9\u91CC\u83B7\u53D6\u4E13\u4E1A\u7248\uFF1A"});let n=t.createEl("a",{text:"GridNote",href:"#",cls:"pro-notice-link"});n.onclick=o=>{o.preventDefault(),e(),r.hide()};let r=new ze.Notice(t)}function Xe(e,t){let n="";for(let r=0;r<t.length;r++){let o=e.charCodeAt(r%e.length);n+=(t.charCodeAt(r)^o).toString(16).padStart(2,"0")}return localStorage.setItem(`GRID_NOTE_${e}`,n),n}function Ke(e,t){let n="",r=[];for(let o=0;o<t.length;o+=2)r.push(parseInt(t.substr(o,2),16));for(let o=0;o<r.length;o++){let i=e.charCodeAt(o%e.length);n+=String.fromCharCode(r[o]^i)}return n}var tt="GRID_NOTE_VIEW_TYPE",ct=class extends Je.MarkdownView{constructor(n,r){super(n);this.nodes=[];this.instance=null;this.modalEditor=null;this.LOCAL_FOLDS=mt([]);this.leafDemo=null;this.headerLine=0;this.rightLeaf=void 0;this.plugin=r,this.Level=new Ot,this.Level.tier=3,this.localWatcher=new Nt(this),this.localWatcher.start()}getViewType(){return tt}getIcon(){return"star"}getDisplayText(){return this.file?this.file.basename:"\u672A\u77E5"}get ProStatus(){return this.plugin.settings.proStatus||Ye(()=>{this.app.setting.open(),this.app.setting.openTabById(this.plugin.manifest.id)}),this.plugin.settings.proStatus}onResize(){}setViewData(n,r){this.render(n),super.setViewData(n,r)}render(n){let r=Ce(n);this.nodes=r,this.initComponent(r)}initComponent(n){this.instance?this.instance&&this.instance.$set({root:n}):this.instance=new Be({target:this.contentEl,props:{View:this,root:n}})}async onOpen(){this.editorEl=this.contentEl.querySelector(".markdown-source-view"),this.contentEl.empty(),this.actionsEl.empty(),this.action(),this.registerEvent(this.app.workspace.on("editor-change",(n,r)=>{n==this.editor&&this.render(n.getValue())})),setTimeout(()=>{this.openMarkdownView()},0),this.registerEvent(this.app.workspace.on("file-open",n=>{var r,o;this.rightLeaf&&((r=this.rightLeaf.view.file)==null?void 0:r.path)!==((o=this.file)==null?void 0:o.path)&&(this.rightLeaf.detach(),this.rightLeaf=void 0,this.openMarkdownView())})),this.registerEvent(this.app.workspace.on("localStorageChanged",n=>{var i;let o=`${this.app.appId}-note-fold-${(i=this.file)==null?void 0:i.path}`;n.key===o&&this.getLocalFoldsCache()}))}getLeavesOfPath(){let n=this.getState().file;return n?this.app.workspace.getLeavesOfType(st).find(o=>{var i;return((i=o.getViewState().state)==null?void 0:i.file)==n}):void 0}scrollToLine(n){this.app.workspace.setActiveLeaf(this.leaf),this.instance&&this.instance.currentLines.set(n+1)}handleClickHeader(n){if(this.ProStatus&&(this.openMarkdownView(),this.rightLeaf)){let r=this.rightLeaf.view;this.app.workspace.setActiveLeaf(this.rightLeaf),this.app.workspace.revealLeaf(this.rightLeaf),r&&r.onScrollToSelectedRange&&r.onScrollToSelectedRange(n)}}handleClickFold(n,r,o){if(this.openMarkdownView(),this.rightLeaf){let i=this.rightLeaf.view;this.app.workspace.setActiveLeaf(this.rightLeaf),this.app.workspace.revealLeaf(this.rightLeaf),i.onSimulateClickFoldBtn(n,r).then(s=>{s&&o()})}}getLocalFoldsCache(){var i;let r=`${this.app.appId}-note-fold-${(i=this.file)==null?void 0:i.path}`,o=localStorage.getItem(r);if(o)try{let c=JSON.parse(o).folds.map(a=>a.from);this.LOCAL_FOLDS.set(c)}catch(s){console.error(s)}else this.LOCAL_FOLDS.set([])}openMarkdownView(){this.ProStatus&&this.validateActivationCode().then(n=>{if(!n)return;let r=this.getLeavesOfPath();if(r)this.rightLeaf=r,this.app.workspace.setActiveLeaf(r);else{this.rightLeaf=this.app.workspace.getRightLeaf(!1);let o=this.getState().file;this.rightLeaf.setViewState({type:st,state:{file:o},active:!0})}})}handleClickLink(n,r){let o=n.target;if(o instanceof HTMLAnchorElement){let i=o.dataset.href,{basename:s,path:c}=this.file;i&&!i.startsWith(s)?o.classList.contains("internal-link")&&this.app.workspace.openLinkText(i,c,!0):this.handleClickHeader(r)}}action(){this.addAction("redo","\u91CD\u505A",n=>{this.editor.redo(),setTimeout(()=>{this.render(this.editor.getValue())},0)}),this.addAction("undo","\u64A4\u9500",n=>{this.editor.undo(),setTimeout(()=>{this.render(this.editor.getValue())},0)}),this.addAction("plus","\u5C55\u793A\u66F4\u591A\u5C42\u7EA7",n=>{var r;this.ProStatus&&((r=this.instance)==null||r.increase())}),this.addAction("minus","\u5C55\u793A\u66F4\u5C11\u5C42\u7EA7",n=>{var r;this.ProStatus&&((r=this.instance)==null||r.decrease())})}validateActivationCode(){return new Promise(n=>{let r=this.app.appId,o=`GRID_NOTE_${r}`,i=localStorage.getItem(o);if(!i)this.plugin.settings.proStatus=!1,this.plugin.saveSettings(),n(!1);else{let s=`${r}.${this.plugin.settings.activationCode}`,c=Ke(r,i);n(s===c)}})}async onClose(){this.leafDemo&&this.leafDemo.detach(),this.rightLeaf&&this.rightLeaf.detach(),this.localWatcher.stop()}onunload(){this.leafDemo&&this.leafDemo.detach(),this.rightLeaf&&this.rightLeaf.detach(),this.localWatcher.stop()}};var M=require("obsidian");var Dt=class extends M.PluginSettingTab{constructor(n,r){super(n,r);this.plugin=r}display(){let{containerEl:n}=this;n.empty(),new M.Setting(n).setName("\u6FC0\u6D3B\u72B6\u6001").setHeading(),new M.Setting(n).setName("\u8BBE\u5907 ID").setDesc("ID \u7528\u4E8E\u6FC0\u6D3B\u63D2\u4EF6,\u4E00\u4E2A\u8BA2\u5355\u53F7\u6700\u591A\u6FC0\u6D3B\u4E09\u53F0\u8BBE\u5907").addButton(o=>o.setButtonText(this.app.appId).onClick(async()=>{})),new M.Setting(n).setName("\u8D2D\u4E70\u4E13\u4E1A\u7248").setDesc("\u8D2D\u4E70\u540E\uFF0C\u53EF\u6FC0\u6D3B\u4E13\u4E1A\u7248").addButton(o=>o.setButtonText("\u53BB\u8D2D\u4E70").onClick(()=>{window.open("https://gridnote.cn/#/landing")}));let r=new M.Setting(n).setName("\u6FC0\u6D3B\u4E13\u4E1A\u7248").setDesc(this.plugin.settings.proStatus?"\u2705 \u5DF2\u6FC0\u6D3B\u4E13\u4E1A\u7248":"\u274C \u672A\u6FC0\u6D3B\u4E13\u4E1A\u7248").setClass("grid-note-setting-activate").addText(o=>o.setPlaceholder("\u8BA2\u5355\u53F7").setValue("").onChange(async i=>{this.plugin.settings.activationCode=i})).addButton(o=>o.setButtonText("\u7ACB\u5373\u9A8C\u8BC1").onClick(async()=>{if(!this.plugin.settings.activationCode)return;let i=await Bn(this.plugin.settings.activationCode,this.app.appId);r.clear(),i&&(this.plugin.settings.proStatus=!0,Xe(this.app.appId,`${this.app.appId}.${this.plugin.settings.activationCode}`),new M.Notice("\u2705 \u4E13\u4E1A\u7248\u5DF2\u6FC0\u6D3B\uFF01")),await this.plugin.saveSettings(),this.display()}));n.createEl("div",{text:"\u9047\u5230\u95EE\u9898\uFF1F",cls:"gridnote-help-links"}).append(createEl("a",{href:"https://gridnote.cn/#/landing",text:"\u8054\u7CFB\u6280\u672F\u652F\u6301"}))}};async function Bn(e,t){try{let n=await(0,M.requestUrl)({url:"https://gridnote.cn/plugin-verify",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e,vault_id:t})}),{code:r,message:o}=n.json;return r==201?!0:(new M.Notice(o),!1)}catch(n){return console.error(n),new M.Notice("\u9A8C\u8BC1\u5931\u8D25"),!1}}var Qe={signature:"",activationCode:"",proStatus:!1},Vt=class extends gt.Plugin{async onload(){await this.loadSettings(),this.addSettingTab(new Dt(this.app,this)),this.registerView(tt,r=>new ct(r,this)),this.registerView(st,r=>new Tt(r));let n=this.addRibbonIcon("sparkles","GridNote",r=>{let o=this.app.workspace.getActiveFile();if(!o)return;if(o.extension!="md"){new gt.Notice("\u5F53\u524D\u6587\u4EF6\u4E0D\u662Fmarkdown\u6587\u4EF6");return}let i=this.getLeavesOfPath(o.path);if(i){new gt.Notice("\u6811\u5F62\u5BFC\u56FE\u5DF2\u6253\u5F00"),this.app.workspace.setActiveLeaf(i);return}this.app.workspace.getLeaf(!0).setViewState({type:tt,state:{file:o.path},active:!0})})}async loadSettings(){this.settings=Object.assign({},Qe,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}getLeavesOfPath(n){return this.app.workspace.getLeavesOfType(tt).find(o=>{var i;return((i=o.getViewState().state)==null?void 0:i.file)==n})}onunload(){}};
